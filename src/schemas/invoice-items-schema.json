{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://example.local/schemas/it-costs-sheet1.schema.json",
    "title": "Invoice Items (Rechnunspositionen)",
    "description": "Schema for the Excel sheet 'IT_Costs_2026'. Each row represents a single invoice line item (DocumentId + LineId). This schema validates the JSON representation after Excel import (array of rows).",
    "type": "array",
    "minItems": 1,
    "items": {
        "type": "object",
        "additionalProperties": true,
        "required": [
            "Period",
            "PostingDate",
            "LineId",
            "Amount"
        ],
        "anyOf": [
            {
                "required": [
                    "VendorId"
                ]
            },
            {
                "required": [
                    "VendorName"
                ]
            }
        ],
        "properties": {
            "FiscalYear": {
                "type": "integer",
                "minimum": 2000,
                "maximum": 2100,
                "description": "Fiscal year of the posting, e.g. 2026."
            },
            "Period": {
                "type": "string",
                "pattern": "^[0-9]{4}-(0[1-9]|1[0-3])$",
                "description": "Accounting period (month key) in format YYYY-MM, e.g. 2026-10 or 2026-13."
            },
            "PostingDate": {
                "type": "string",
                "format": "date",
                "description": "Posting or service date (ISO date string YYYY-MM-DD) after Excel import."
            },
            "VendorName": {
                "type": "string",
                "minLength": 1,
                "description": "Supplier name. At least VendorName or VendorId must be provided."
            },
            "VendorId": {
                "type": "string",
                "minLength": 1,
                "description": "Stable supplier identifier (preferred over name for grouping), e.g. V002."
            },
            "DocumentId": {
                "type": "string",
                "minLength": 1,
                "description": "Invoice / document identifier. Multiple rows can share the same DocumentId for multi-line invoices."
            },
            "LineId": {
                "type": "integer",
                "minimum": 1,
                "description": "Line number within the document (invoice position). Together with DocumentId forms the line item key."
            },
            "CostCenter": {
                "type": "string",
                "minLength": 1,
                "description": "Cost center or organizational unit charged, e.g. IT-OPS."
            },
            "GLAccount": {
                "type": "string",
                "pattern": "^[0-9]{4,10}$",
                "description": "General ledger account / nominal account (Sachkonto). Often numeric string like 640000."
            },
            "Category": {
                "type": "string",
                "enum": [
                    "Hosting",
                    "Infrastructure",
                    "Licenses",
                    "Consulting",
                    "Security",
                    "Application"
                ],
                "description": "Primary cost category used for KPI aggregation and drilldown."
            },
            "SubCategory": {
                "type": "string",
                "minLength": 1,
                "description": "Secondary classification within Category (e.g., Server, Subscription, SOC)."
            },
            "Service": {
                "type": "string",
                "minLength": 1,
                "description": "Business/IT service label for analysis, e.g. 'SAP IS-U Betrieb' or 'M365'."
            },
            "System": {
                "type": "string",
                "minLength": 1,
                "description": "System/domain label (e.g., SAP, M365, Security, Cloud, Data, Network, CRM, Integration)."
            },
            "RunChangeInnovation": {
                "type": "string",
                "enum": [
                    "Run",
                    "Change",
                    "Innovation"
                ],
                "description": "Classification for operating vs change vs innovation spend."
            },
            "Amount": {
                "type": "number",
                "description": "Line amount in Currency. Costs are positive, credits/credit notes are negative."
            },
            "Currency": {
                "type": "string",
                "pattern": "^[A-Z]{3}$",
                "description": "ISO 4217 currency code, e.g. EUR."
            },
            "Quantity": {
                "type": "number",
                "description": "Quantity for unit-based charging (optional). Can be negative for corrections."
            },
            "Unit": {
                "type": "string",
                "minLength": 1,
                "description": "Unit of measure for Quantity, e.g. Hours, Seats, GB, Months, Units."
            },
            "UnitPrice": {
                "type": "number",
                "minimum": 0,
                "description": "Unit price in Currency (optional). Often Amount ≈ Quantity × UnitPrice."
            },
            "ContractId": {
                "type": "string",
                "description": "Contract reference (may be empty). Used for contract coverage KPIs."
            },
            "POId": {
                "type": "string",
                "description": "Purchase order reference (may be empty). Used for procurement traceability."
            },
            "IsRecurring": {
                "type": "string",
                "enum": [
                    "Y",
                    "N"
                ],
                "description": "Indicates recurring monthly spend (Y) vs ad-hoc (N)."
            },
            "Description": {
                "type": "string",
                "description": "Free text description of the line item (from invoice/position text)."
            },
            "SourceTag": {
                "type": "string",
                "description": "Test-data tag for scenario control (e.g., RECURRING, ADHOC, PROJECT_SPIKE, ANOMALY_SPIKE, NEW_VENDOR, CONTRACTLESS). Can include '|CREDIT'."
            }
        }
    }
}