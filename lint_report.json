[{"filePath":"C:\\github\\litebistudio\\check-lucide.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\check-lucide.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\public\\coi-serviceworker.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\scripts\\compile-schemas.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\ComponentGrid.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1248,1251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1248,1251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { COMPONENTS } from '../config/components';\r\nimport { getComponent } from './registry';\r\nimport {\r\n    DndContext,\r\n    closestCenter,\r\n    KeyboardSensor,\r\n    PointerSensor,\r\n    useSensor,\r\n    useSensors,\r\n    DragOverlay,\r\n    type DragEndEvent,\r\n} from '@dnd-kit/core';\r\nimport { sortableKeyboardCoordinates } from '@dnd-kit/sortable';\r\nimport { SortableComponent } from './SortableComponent';\r\nimport { cn } from '../lib/utils';\r\n\r\ninterface ComponentGridProps {\r\n    visibleComponentIds: string[];\r\n    componentOrder: string[];\r\n    onOrderChange: (newOrder: string[]) => void;\r\n    onRemoveComponent: (id: string) => void;\r\n}\r\n\r\nexport const ComponentGrid: React.FC<ComponentGridProps> = ({\r\n    visibleComponentIds,\r\n    componentOrder,\r\n    onOrderChange,\r\n    onRemoveComponent\r\n}) => {\r\n    const sensors = useSensors(\r\n        useSensor(PointerSensor, {\r\n            activationConstraint: {\r\n                distance: 8,\r\n            },\r\n        }),\r\n        useSensor(KeyboardSensor, {\r\n            coordinateGetter: sortableKeyboardCoordinates,\r\n        })\r\n    );\r\n\r\n    const [activeId, setActiveId] = React.useState<string | null>(null);\r\n\r\n    const handleDragStart = (event: { active: { id: any } }) => {\r\n        setActiveId(event.active.id as string);\r\n    };\r\n\r\n    const handleDragEnd = (event: DragEndEvent) => {\r\n        const { active, over } = event;\r\n        setActiveId(null);\r\n\r\n        if (over && active.id !== over.id) {\r\n            const oldIndex = componentOrder.indexOf(active.id as string);\r\n            const newIndex = componentOrder.indexOf(over.id as string);\r\n\r\n            // True Swap behavior: we exchange the contents of the indices\r\n            const nextOrder = [...componentOrder];\r\n            [nextOrder[oldIndex], nextOrder[newIndex]] = [nextOrder[newIndex], nextOrder[oldIndex]];\r\n            onOrderChange(nextOrder);\r\n        }\r\n    };\r\n\r\n    const handleDragCancel = () => {\r\n        setActiveId(null);\r\n    };\r\n\r\n    const activeComponent = activeId ? COMPONENTS.find(t => t.id === activeId) : null;\r\n\r\n    return (\r\n        <DndContext\r\n            sensors={sensors}\r\n            collisionDetection={closestCenter}\r\n            onDragStart={handleDragStart}\r\n            onDragEnd={handleDragEnd}\r\n            onDragCancel={handleDragCancel}\r\n        >\r\n            <div className=\"relative [container-type:inline-size] w-full min-h-[calc(100vh-4rem)] overflow-y-auto custom-scrollbar pb-20\">\r\n                <div className={cn(\r\n                    \"relative grid gap-6 p-6 auto-rows-[minmax(0,1fr)] transition-all\",\r\n                    \"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4\",\r\n                    \"[--cols:1] md:[--cols:2] lg:[--cols:3] xl:[--cols:4]\",\r\n                    \"grid-auto-rows-[calc((100cqw-((var(--cols)-1)*1.5rem)-3rem)/var(--cols))]\"\r\n                )}>\r\n                    {componentOrder.map((id) => {\r\n                        const component = COMPONENTS.find(t => t.id === id);\r\n                        const isVisible = component && visibleComponentIds.includes(component.id);\r\n                        const Component = isVisible ? getComponent(component.component) : null;\r\n\r\n                        return (\r\n                            <SortableComponent\r\n                                key={id}\r\n                                id={id}\r\n                                title={component?.title || `Slot ${id}`}\r\n                                size={component?.defaultSize || 'small'}\r\n                                targetView={component?.targetView}\r\n                                onRemove={onRemoveComponent}\r\n                                className={cn(!isVisible && \"hidden md:block\")}\r\n                            >\r\n                                {Component ? <Component /> : <div className=\"w-full h-full\" />}\r\n                            </SortableComponent>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Drag Overlay for high-fidelity preview */}\r\n            <DragOverlay adjustScale={true} zIndex={100}>\r\n                {activeId && activeComponent ? (() => {\r\n                    const Component = getComponent(activeComponent.component);\r\n                    return Component ? (\r\n                        <div className=\"w-full h-full opacity-80 cursor-grabbing shadow-2xl scale-105 transition-transform\">\r\n                            <Component isOverlay={true} />\r\n                        </div>\r\n                    ) : null;\r\n                })() : null}\r\n            </DragOverlay>\r\n        </DndContext>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\Layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\SortableComponent.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2104,2107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2104,2107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { useDraggable, useDroppable } from '@dnd-kit/core';\r\nimport { CSS } from '@dnd-kit/utilities';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport type { ComponentSize } from '../types';\r\nimport { cn } from '../lib/utils';\r\n\r\nconst getSizeClass = (size: ComponentSize) => {\r\n    switch (size) {\r\n        case 'large':\r\n            return 'col-span-1 md:col-span-2 row-span-2';\r\n        case 'medium':\r\n            return 'col-span-1 md:col-span-2';\r\n        case 'small':\r\n            return 'col-span-1';\r\n        default:\r\n            return 'col-span-1';\r\n    }\r\n};\r\n\r\ninterface SortableComponentProps {\r\n    id: string;\r\n    title: string;\r\n    size: ComponentSize;\r\n    targetView?: string;\r\n    onRemove?: (id: string) => void;\r\n    children: React.ReactNode;\r\n    className?: string;\r\n}\r\n\r\nexport const SortableComponent: React.FC<SortableComponentProps> = ({\r\n    id, size, targetView, onRemove, children, className\r\n}) => {\r\n    const navigate = useNavigate();\r\n\r\n    // Use Draggable for movement\r\n    const {\r\n        attributes,\r\n        listeners,\r\n        setNodeRef: setDraggableRef,\r\n        transform,\r\n        isDragging\r\n    } = useDraggable({ id });\r\n\r\n    // Also use Droppable to allow components to be swapped with other components\r\n    const { setNodeRef: setDroppableRef, isOver } = useDroppable({ id });\r\n\r\n    // Combine refs\r\n    const setNodeRef = (node: HTMLElement | null) => {\r\n        setDraggableRef(node);\r\n        setDroppableRef(node);\r\n    };\r\n\r\n    const style = {\r\n        transform: CSS.Translate.toString(transform),\r\n        // Significant dimming of source component to emphasize the overlay\r\n        opacity: isDragging ? 0.2 : 1,\r\n        zIndex: isDragging ? 10 : 0,\r\n    };\r\n\r\n    const childrenWithProps = React.Children.map(children, child => {\r\n        if (React.isValidElement(child)) {\r\n            // Only inject props into custom components, not plain DOM elements like 'div'\r\n            if (typeof child.type === 'string') return child;\r\n\r\n            return React.cloneElement(child as React.ReactElement<any>, {\r\n                onRemove: onRemove ? () => onRemove(id) : undefined,\r\n                dragHandleProps: listeners,\r\n                onClick: targetView ? () => navigate(targetView) : undefined,\r\n                targetView: targetView\r\n            });\r\n        }\r\n        return child;\r\n    });\r\n\r\n    return (\r\n        <div\r\n            ref={setNodeRef}\r\n            style={style}\r\n            className={cn(\r\n                getSizeClass(size),\r\n                \"relative transition-all duration-200\",\r\n                isOver && !isDragging && \"scale-[1.02] z-10 ring-4 ring-blue-500/30 ring-offset-2 rounded-2xl\",\r\n                className\r\n            )}\r\n            {...attributes}\r\n        >\r\n            {childrenWithProps}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\ColumnMapper.tsx","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":34,"column":9,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":34,"endColumn":22,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[1271,1284],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\github\\litebistudio\\src\\app\\components\\ColumnMapper.tsx:55:13\n  53 |     useEffect(() => {\n  54 |         if (!initialMapping || Object.keys(initialMapping).length === 0) {\n> 55 |             handleAutoMap();\n     |             ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  56 |         }\n  57 |     }, [initialMapping]);\n  58 |","line":55,"column":13,"nodeType":null,"endLine":55,"endColumn":26},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleAutoMap'. Either include it or remove the dependency array.","line":57,"column":8,"nodeType":"ArrayExpression","endLine":57,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [handleAutoMap, initialMapping]","fix":{"range":[2149,2165],"text":"[handleAutoMap, initialMapping]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { ArrowRight, Save, Wand2, AlertCircle, Settings2, Plus, ArrowDownUp } from 'lucide-react';\r\nimport { transformers } from '../../lib/transformers';\r\n\r\nexport interface MappingConfig {\r\n    sourceColumn: string;\r\n    transformId?: string;\r\n    constantValue?: string;\r\n    operation?: 'direct' | 'coalesce' | 'concat';\r\n    secondaryColumn?: string;\r\n    separator?: string;\r\n}\r\n\r\ninterface ColumnMapperProps {\r\n    sourceColumns: string[];\r\n    targetSchema: {\r\n        properties: Record<string, { description?: string; type?: string }>;\r\n        required?: string[];\r\n    };\r\n    onConfirm: (mapping: Record<string, MappingConfig>) => void;\r\n    onCancel: () => void;\r\n    initialMapping?: Record<string, MappingConfig>;\r\n}\r\n\r\nexport const ColumnMapper: React.FC<ColumnMapperProps> = ({ sourceColumns, targetSchema, onConfirm, onCancel, initialMapping }) => {\r\n    const [mapping, setMapping] = useState<Record<string, MappingConfig>>(initialMapping || {});\r\n\r\n    // Extract target fields from schema\r\n    const schemaProperties = targetSchema.properties;\r\n    const requiredFields = targetSchema.required || [];\r\n\r\n    const targetFields = Object.keys(schemaProperties).map(key => ({\r\n        key,\r\n        // @ts-ignore\r\n        description: schemaProperties[key].description,\r\n        required: requiredFields.includes(key)\r\n    }));\r\n\r\n    const handleAutoMap = () => {\r\n        const newMapping: Record<string, MappingConfig> = {};\r\n        targetFields.forEach(field => {\r\n            const match = sourceColumns.find(col =>\r\n                col.toLowerCase() === field.key.toLowerCase() ||\r\n                col.toLowerCase().replace(/[^a-z0-9]/g, '') === field.key.toLowerCase().replace(/[^a-z0-9]/g, '')\r\n            );\r\n            if (match) {\r\n                newMapping[field.key] = { sourceColumn: match, operation: 'direct' };\r\n            }\r\n        });\r\n        setMapping(prev => ({ ...prev, ...newMapping }));\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (!initialMapping || Object.keys(initialMapping).length === 0) {\r\n            handleAutoMap();\r\n        }\r\n    }, [initialMapping]);\r\n\r\n    const isValid = targetFields\r\n        .filter(f => f.required)\r\n        .every(f => {\r\n            const m = mapping[f.key];\r\n            if (!m) return false;\r\n            // If Constant, must have a constantValue\r\n            if (m.sourceColumn === '__CONSTANT__') return !!m.constantValue;\r\n\r\n            // If Concat, must have secondaryColumn\r\n            if (m.operation === 'concat' && !m.secondaryColumn) return false;\r\n\r\n            return !!m.sourceColumn;\r\n        });\r\n\r\n    const getUnmappedRequiredCount = () => {\r\n        return targetFields.filter(f => {\r\n            if (!f.required) return false;\r\n            const m = mapping[f.key];\r\n            if (!m) return true;\r\n            if (m.sourceColumn === '__CONSTANT__') return !m.constantValue;\r\n            if (m.operation === 'concat' && !m.secondaryColumn) return true;\r\n            return !m.sourceColumn;\r\n        }).length;\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 animate-in fade-in duration-200\">\r\n            <div className=\"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col\">\r\n                <div className=\"p-6 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between\">\r\n                    <div>\r\n                        <h2 className=\"text-xl font-bold text-slate-900 dark:text-white\">Map Columns & Transforms</h2>\r\n                        <p className=\"text-sm text-slate-500 dark:text-slate-400\">\r\n                            Match columns and apply necessary format conversions.\r\n                        </p>\r\n                    </div>\r\n                    <button\r\n                        onClick={handleAutoMap}\r\n                        className=\"flex items-center gap-2 px-3 py-1.5 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium\"\r\n                    >\r\n                        <Wand2 className=\"w-4 h-4\" />\r\n                        Auto-Map\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"flex-1 overflow-auto p-6\">\r\n                    <div className=\"grid grid-cols-[1fr,auto,2fr,1fr] gap-4 items-start mb-2 px-4 text-xs font-bold text-slate-400 uppercase tracking-wider\">\r\n                        <div>Required Field</div>\r\n                        <div className=\"w-8\"></div>\r\n                        <div>Source Configuration</div>\r\n                        <div>Transformation</div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-3\">\r\n                        {targetFields.map((field) => {\r\n                            const availableTransforms = transformers[field.key] || [];\r\n                            const currentMapping = mapping[field.key];\r\n                            const op = currentMapping?.operation || 'direct';\r\n\r\n                            return (\r\n                                <div key={field.key} className={`\r\n                                    grid grid-cols-[1fr,auto,2fr,1fr] gap-4 items-start p-4 rounded-xl border transition-colors\r\n                                    ${currentMapping?.sourceColumn\r\n                                        ? 'bg-slate-50 dark:bg-slate-900/30 border-slate-200 dark:border-slate-700'\r\n                                        : field.required\r\n                                            ? 'bg-red-50 dark:bg-red-900/10 border-red-200 dark:border-red-900/30'\r\n                                            : 'bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 opacity-70 hover:opacity-100'\r\n                                    }\r\n                                `}>\r\n                                    <div className=\"mt-2\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <span className={`font-semibold ${field.required ? 'text-slate-900 dark:text-white' : 'text-slate-500 dark:text-slate-400'}`}>\r\n                                                {field.key}\r\n                                            </span>\r\n                                            {field.required && (\r\n                                                <span className=\"text-[10px] bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 px-1.5 py-0.5 rounded font-bold uppercase\">Required</span>\r\n                                            )}\r\n                                        </div>\r\n                                        <div className=\"text-xs text-slate-500 mt-1 line-clamp-1\" title={field.description}>\r\n                                            {field.description}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <ArrowRight className={`w-4 h-4 mt-3 ${currentMapping?.sourceColumn ? 'text-blue-500' : 'text-slate-300'}`} />\r\n\r\n                                    <div className=\"space-y-2\">\r\n                                        {/* Primary Input / Operation Selector */}\r\n                                        <div className=\"flex gap-2 items-center h-10\">\r\n                                            <select\r\n                                                value={currentMapping?.sourceColumn || ''}\r\n                                                onChange={(e) => {\r\n                                                    const val = e.target.value;\r\n                                                    setMapping(prev => {\r\n                                                        const next = { ...prev };\r\n                                                        if (val) {\r\n                                                            let initialTransform = next[field.key]?.transformId;\r\n                                                            if (val === '__CONSTANT__' && !initialTransform && availableTransforms.length > 0) {\r\n                                                                initialTransform = availableTransforms[0].id;\r\n                                                            }\r\n                                                            next[field.key] = {\r\n                                                                sourceColumn: val,\r\n                                                                transformId: initialTransform,\r\n                                                                operation: 'direct' // Default to direct on change\r\n                                                            };\r\n                                                        } else {\r\n                                                            delete next[field.key];\r\n                                                        }\r\n                                                        return next;\r\n                                                    });\r\n                                                }}\r\n                                                className={`\r\n                                                    flex-1 h-full px-3 rounded-lg border text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-all\r\n                                                    ${currentMapping?.sourceColumn\r\n                                                        ? 'border-blue-200 bg-white dark:bg-slate-900 dark:border-blue-900/50'\r\n                                                        : 'border-slate-200 bg-slate-50 dark:bg-slate-800 dark:border-slate-600'\r\n                                                    }\r\n                                                `}\r\n                                            >\r\n                                                <option value=\"\">-- Ignored --</option>\r\n                                                <option value=\"__CONSTANT__\" className=\"font-bold text-blue-600\">-- Set Constant Value --</option>\r\n                                                <optgroup label=\"Source Columns\">\r\n                                                    {sourceColumns.map(col => (\r\n                                                        <option key={col} value={col}>{col}</option>\r\n                                                    ))}\r\n                                                </optgroup>\r\n                                            </select>\r\n\r\n                                            {currentMapping?.sourceColumn && currentMapping.sourceColumn !== '__CONSTANT__' && (\r\n                                                <div className=\"flex h-full bg-slate-100 dark:bg-slate-700 rounded-lg p-1 border border-slate-200 dark:border-slate-600 shrink-0 items-center\">\r\n                                                    <button\r\n                                                        onClick={() => setMapping(prev => ({ ...prev, [field.key]: { ...prev[field.key]!, operation: 'direct' } }))}\r\n                                                        className={`h-full px-3 rounded-md text-xs font-bold transition-all flex items-center ${op === 'direct' ? 'bg-white dark:bg-slate-600 shadow-sm text-slate-900 dark:text-white' : 'text-slate-500 hover:text-slate-700'}`}\r\n                                                        title=\"Direct Mapping\"\r\n                                                    >\r\n                                                        1:1\r\n                                                    </button>\r\n                                                    <div className=\"w-px h-4 bg-slate-200 dark:bg-slate-600 mx-0.5\" />\r\n                                                    <button\r\n                                                        onClick={() => setMapping(prev => ({ ...prev, [field.key]: { ...prev[field.key]!, operation: 'coalesce' } }))}\r\n                                                        className={`h-full px-3 rounded-md text-xs font-bold transition-all flex items-center ${op === 'coalesce' ? 'bg-white dark:bg-slate-600 shadow-sm text-slate-900 dark:text-white' : 'text-slate-500 hover:text-slate-700'}`}\r\n                                                        title=\"Fallback if empty (Coalesce)\"\r\n                                                    >\r\n                                                        Fallback\r\n                                                    </button>\r\n                                                    <div className=\"w-px h-4 bg-slate-200 dark:bg-slate-600 mx-0.5\" />\r\n                                                    <button\r\n                                                        onClick={() => setMapping(prev => ({ ...prev, [field.key]: { ...prev[field.key]!, operation: 'concat', separator: ' ' } }))}\r\n                                                        className={`h-full px-3 rounded-md text-xs font-bold transition-all flex items-center ${op === 'concat' ? 'bg-white dark:bg-slate-600 shadow-sm text-slate-900 dark:text-white' : 'text-slate-500 hover:text-slate-700'}`}\r\n                                                        title=\"Combine Columns (Concat)\"\r\n                                                    >\r\n                                                        Combine\r\n                                                    </button>\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n\r\n                                        {/* Configuration for Operations */}\r\n                                        {op === 'coalesce' && (\r\n                                            <div className=\"flex items-center gap-2 animate-in slide-in-from-top-2 h-10\">\r\n                                                <ArrowDownUp className=\"w-4 h-4 text-slate-400 rotate-45\" />\r\n                                                <span className=\"text-xs font-bold text-slate-400 shrink-0\">ELSE USE</span>\r\n                                                <select\r\n                                                    value={currentMapping?.secondaryColumn || ''}\r\n                                                    onChange={(e) => setMapping(prev => ({ ...prev, [field.key]: { ...prev[field.key]!, secondaryColumn: e.target.value } }))}\r\n                                                    className=\"flex-1 h-full px-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm focus:ring-2 focus:ring-blue-500\"\r\n                                                >\r\n                                                    <option value=\"\">-- Select Fallback Column --</option>\r\n                                                    {sourceColumns.map(col => (\r\n                                                        <option key={col} value={col}>{col}</option>\r\n                                                    ))}\r\n                                                </select>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {op === 'concat' && (\r\n                                            <div className=\"flex items-center gap-2 animate-in slide-in-from-top-2 h-10\">\r\n                                                <Plus className=\"w-4 h-4 text-slate-400\" />\r\n                                                <input\r\n                                                    type=\"text\"\r\n                                                    placeholder=\"Separator (space)\"\r\n                                                    value={currentMapping?.separator ?? ' '}\r\n                                                    onChange={(e) => setMapping(prev => ({ ...prev, [field.key]: { ...prev[field.key]!, separator: e.target.value } }))}\r\n                                                    className=\"w-16 h-full px-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-center text-sm\"\r\n                                                    title=\"Separator\"\r\n                                                />\r\n                                                <Plus className=\"w-4 h-4 text-slate-400\" />\r\n                                                <select\r\n                                                    value={currentMapping?.secondaryColumn || ''}\r\n                                                    onChange={(e) => setMapping(prev => ({ ...prev, [field.key]: { ...prev[field.key]!, secondaryColumn: e.target.value } }))}\r\n                                                    className=\"flex-1 h-full px-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm focus:ring-2 focus:ring-blue-500\"\r\n                                                >\r\n                                                    <option value=\"\">-- Select 2nd Column --</option>\r\n                                                    {sourceColumns.map(col => (\r\n                                                        <option key={col} value={col}>{col}</option>\r\n                                                    ))}\r\n                                                </select>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {/* Constant Value Input */}\r\n                                        {currentMapping?.sourceColumn === '__CONSTANT__' && (\r\n                                            <div className=\"relative animate-in fade-in zoom-in-95 h-10\">\r\n                                                <input\r\n                                                    type=\"text\"\r\n                                                    placeholder=\"Enter constant value...\"\r\n                                                    value={currentMapping.constantValue || ''}\r\n                                                    onChange={(e) => {\r\n                                                        const val = e.target.value;\r\n                                                        setMapping(prev => ({\r\n                                                            ...prev,\r\n                                                            [field.key]: { ...prev[field.key]!, constantValue: val }\r\n                                                        }));\r\n                                                    }}\r\n                                                    className={`\r\n                                                        w-full h-full px-3 rounded-lg border text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-all\r\n                                                        ${!currentMapping.constantValue\r\n                                                            ? 'border-red-300 ring-2 ring-red-100 bg-red-50'\r\n                                                            : 'border-blue-200 bg-white dark:bg-slate-900 dark:border-blue-900/50'\r\n                                                        }\r\n                                                    `}\r\n                                                />\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n\r\n                                    {/* Transformation */}\r\n                                    <div>\r\n                                        {(availableTransforms.length > 0) && (currentMapping?.sourceColumn || field.key === 'Currency') && (\r\n                                            <div className=\"relative h-10\">\r\n                                                <Settings2 className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none\" />\r\n                                                <select\r\n                                                    value={currentMapping?.transformId || ''}\r\n                                                    onChange={(e) => {\r\n                                                        const val = e.target.value;\r\n                                                        setMapping(prev => ({\r\n                                                            ...prev,\r\n                                                            [field.key]: { ...prev[field.key]!, transformId: val || undefined }\r\n                                                        }));\r\n                                                    }}\r\n                                                    className=\"w-full h-full pl-9 pr-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm focus:ring-2 focus:ring-blue-500 appearance-none\"\r\n                                                >\r\n                                                    <option value=\"\">No Transformation</option>\r\n                                                    {availableTransforms.map(t => (\r\n                                                        <option key={t.id} value={t.id}>\r\n                                                            {t.label}\r\n                                                        </option>\r\n                                                    ))}\r\n                                                </select>\r\n                                                <div className=\"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none\">\r\n                                                    <ArrowDownUp className=\"w-3 h-3 text-slate-400\" />\r\n                                                </div>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"p-6 border-t border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900/50 rounded-b-2xl\">\r\n                    <button\r\n                        onClick={onCancel}\r\n                        className=\"px-4 py-2 text-slate-600 hover:text-slate-900 dark:text-slate-400 dark:hover:text-white font-medium transition-colors\"\r\n                    >\r\n                        Cancel Import\r\n                    </button>\r\n\r\n                    <div className=\"flex items-center gap-4\">\r\n                        {!isValid && (\r\n                            <div className=\"flex items-center gap-2 text-red-600 text-sm font-medium\">\r\n                                <AlertCircle className=\"w-4 h-4\" />\r\n                                {getUnmappedRequiredCount()} required fields missing\r\n                            </div>\r\n                        )}\r\n                        <button\r\n                            onClick={() => onConfirm(mapping)}\r\n                            disabled={!isValid}\r\n                            className={`\r\n                                flex items-center gap-2 px-6 py-2.5 rounded-xl font-semibold shadow-lg transition-all transform\r\n                                ${isValid\r\n                                    ? 'bg-blue-600 hover:bg-blue-700 text-white shadow-blue-200 dark:shadow-none hover:-translate-y-0.5'\r\n                                    : 'bg-slate-200 dark:bg-slate-700 text-slate-400 cursor-not-allowed'\r\n                                }\r\n                            `}\r\n                        >\r\n                            <Save className=\"w-4 h-4\" />\r\n                            Confirm Mapping\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div >\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\ExcelImport.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[338,341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[338,341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[365,368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[365,368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[417,420],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[417,420],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[459,462],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[459,462],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2383,2386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2383,2386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useCallback, useRef } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { FileSpreadsheet, CheckCircle2 as Check, AlertCircle, RefreshCw, Layers } from 'lucide-react';\r\nimport * as XLSX from 'xlsx';\r\n\r\nexport interface ImportConfig {\r\n    key: string;\r\n    entityLabel: string;\r\n    schema: any;\r\n    validate: (data: any[]) => boolean;\r\n    getValidationErrors: (data: any[]) => string[];\r\n    importFn: (data: any[]) => Promise<void>;\r\n    clearFn?: () => Promise<void>;\r\n}\r\n\r\ninterface ExcelImportProps {\r\n    config?: ImportConfig;\r\n    onImportComplete?: () => void;\r\n}\r\n\r\nexport const ExcelImport: React.FC<ExcelImportProps> = ({ config, onImportComplete }) => {\r\n    const { t } = useTranslation();\r\n    const [isDragging, setIsDragging] = useState(false);\r\n    const [isProcessing, setIsProcessing] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [success, setSuccess] = useState<string | null>(null);\r\n    const [importMode, setImportMode] = useState<'append' | 'overwrite'>('append');\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    const processFile = useCallback(async (file: File) => {\r\n        if (!config) return;\r\n\r\n        setIsProcessing(true);\r\n        setError(null);\r\n        setSuccess(null);\r\n\r\n        try {\r\n            const data = await file.arrayBuffer();\r\n            const workbook = XLSX.read(data);\r\n            const firstSheetName = workbook.SheetNames[0];\r\n            const worksheet = workbook.Sheets[firstSheetName];\r\n            const jsonData = XLSX.utils.sheet_to_json(worksheet);\r\n\r\n            if (jsonData.length === 0) {\r\n                setError(t('datasource.excel_import.no_data'));\r\n                return;\r\n            }\r\n\r\n            // Transform data (e.g., lowercase keys to match DB if needed, or mapping)\r\n            // Here we assume keys match column names\r\n\r\n            if (importMode === 'overwrite' && config.clearFn) {\r\n                await config.clearFn();\r\n            }\r\n\r\n            await config.importFn(jsonData);\r\n\r\n            setSuccess(t('datasource.excel_import.success_msg', { count: jsonData.length }));\r\n            if (onImportComplete) onImportComplete();\r\n\r\n            // Trigger global sync for counters\r\n            window.dispatchEvent(new Event('db-updated'));\r\n\r\n        } catch (err: any) {\r\n            setError(t('datasource.excel_import.error_reading', { error: err.message }));\r\n        } finally {\r\n            setIsProcessing(false);\r\n        }\r\n    }, [config, importMode, onImportComplete, t]);\r\n\r\n    const handleDrop = useCallback((e: React.DragEvent) => {\r\n        e.preventDefault();\r\n        setIsDragging(false);\r\n        const file = e.dataTransfer.files[0];\r\n        if (file) processFile(file);\r\n    }, [processFile]);\r\n\r\n    if (!config) {\r\n        return (\r\n            <div className=\"p-8 text-center bg-slate-50 border-2 border-dashed border-slate-200 rounded-2xl\">\r\n                <p className=\"text-slate-400 text-sm\">{t('datasource.excel_import.none_selected')}</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            <div className=\"flex bg-slate-100 p-1 rounded-lg w-fit\">\r\n                <button\r\n                    onClick={() => setImportMode('append')}\r\n                    className={`px-3 py-1.5 text-xs font-bold rounded-md flex items-center gap-2 transition-all ${importMode === 'append' ? 'bg-white shadow text-blue-600' : 'text-slate-500'}`}\r\n                >\r\n                    <Layers className=\"w-3.5 h-3.5\" /> {t('datasource.excel_import.append')}\r\n                </button>\r\n                <button\r\n                    onClick={() => setImportMode('overwrite')}\r\n                    className={`px-3 py-1.5 text-xs font-bold rounded-md flex items-center gap-2 transition-all ${importMode === 'overwrite' ? 'bg-white shadow text-red-600' : 'text-slate-500'}`}\r\n                >\r\n                    <RefreshCw className=\"w-3.5 h-3.5\" /> {t('datasource.excel_import.overwrite')}\r\n                </button>\r\n            </div>\r\n\r\n            <div\r\n                onDragOver={(e) => { e.preventDefault(); setIsDragging(true); }}\r\n                onDragLeave={() => setIsDragging(false)}\r\n                onDrop={handleDrop}\r\n                onClick={() => fileInputRef.current?.click()}\r\n                className={`\r\n                    relative group border-2 border-dashed rounded-2xl p-8 transition-all cursor-pointer text-center\r\n                    ${isDragging ? 'border-blue-500 bg-blue-50' : 'border-slate-200 hover:border-slate-400 hover:bg-slate-50'}\r\n                    ${isProcessing ? 'opacity-50 pointer-events-none' : ''}\r\n                `}\r\n            >\r\n                <input\r\n                    type=\"file\"\r\n                    ref={fileInputRef}\r\n                    onChange={(e) => e.target.files?.[0] && processFile(e.target.files[0])}\r\n                    accept=\".xlsx,.xls,.csv\"\r\n                    className=\"hidden\"\r\n                />\r\n\r\n                <div className=\"flex flex-col items-center gap-3\">\r\n                    <div className={`p-3 rounded-xl transition-colors ${isDragging ? 'bg-blue-100 text-blue-600' : 'bg-slate-100 text-slate-400 group-hover:bg-slate-200 group-hover:text-slate-600'}`}>\r\n                        <FileSpreadsheet className=\"w-8 h-8\" />\r\n                    </div>\r\n                    <div>\r\n                        <p className=\"text-sm font-bold text-slate-700\">{t('datasource.smart_import.upload_label')}</p>\r\n                        <p className=\"text-xs text-slate-400 mt-1\">{t('datasource.excel_import.drop_hint')}</p>\r\n                    </div>\r\n                </div>\r\n\r\n                {isProcessing && (\r\n                    <div className=\"absolute inset-0 bg-white/60 flex items-center justify-center rounded-2xl backdrop-blur-[1px]\">\r\n                        <div className=\"flex items-center gap-3 text-blue-600\">\r\n                            <div className=\"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin\" />\r\n                            <span className=\"text-xs font-bold\">{t('datasource.excel_import.processing_file')}</span>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {error && (\r\n                <div className=\"p-3 bg-red-50 border border-red-100 rounded-xl flex items-center gap-3 text-red-600 text-xs animate-in slide-in-from-top-2\">\r\n                    <AlertCircle className=\"w-4 h-4 shrink-0\" />\r\n                    <span className=\"font-medium\">{error}</span>\r\n                </div>\r\n            )}\r\n\r\n            {success && (\r\n                <div className=\"p-3 bg-emerald-50 border border-emerald-100 rounded-xl flex items-center gap-3 text-emerald-600 text-xs animate-in slide-in-from-top-2\">\r\n                    <Check className=\"w-4 h-4 shrink-0\" />\r\n                    <span className=\"font-medium\">{success}</span>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\ImportPreview.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[239,242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[239,242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport { Check, AlertCircle } from 'lucide-react';\r\n\r\nexport interface ValidationResult {\r\n    isValid: boolean;\r\n    errors: Record<string, string>;\r\n}\r\n\r\ninterface ImportPreviewProps {\r\n    data: any[];\r\n    schema: {\r\n        properties: Record<string, { description?: string; type?: string }>;\r\n        required?: string[];\r\n    };\r\n    onConfirm: () => void;\r\n    onCancel: () => void;\r\n    isImporting: boolean;\r\n}\r\n\r\nexport const ImportPreview: React.FC<ImportPreviewProps> = ({ data, schema, onConfirm, onCancel, isImporting }) => {\r\n    // Validate rows\r\n    const validation = useMemo(() => {\r\n        const results = data.map(row => {\r\n            const errors: Record<string, string> = {};\r\n            let isValid = true;\r\n\r\n            // Check required fields\r\n            if (schema.required) {\r\n                schema.required.forEach(field => {\r\n                    if (row[field] === undefined || row[field] === null || row[field] === '') {\r\n                        errors[field] = 'Pflichtfeld fehlt';\r\n                        isValid = false;\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Check types\r\n            Object.entries(schema.properties).forEach(([field, prop]) => {\r\n                const val = row[field];\r\n                if (val === undefined || val === null || val === '') return;\r\n\r\n                if (prop.type === 'number') {\r\n                    const num = Number(val);\r\n                    if (isNaN(num)) {\r\n                        errors[field] = 'Gltige Zahl erwartet';\r\n                        isValid = false;\r\n                    }\r\n                }\r\n            });\r\n\r\n            return { isValid, errors };\r\n        });\r\n\r\n        const errorCount = results.filter(r => !r.isValid).length;\r\n        const validCount = results.length - errorCount;\r\n\r\n        return { results, errorCount, validCount };\r\n    }, [data, schema]);\r\n\r\n    const columns = Object.keys(schema.properties);\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 animate-in fade-in duration-200\">\r\n            <div className=\"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-7xl max-h-[90vh] flex flex-col\">\r\n                <div className=\"p-6 border-b border-slate-200 dark:border-slate-700\">\r\n                    <h2 className=\"text-xl font-bold text-slate-900 dark:text-white\">Daten-Vorschau & Validierung</h2>\r\n                    <p className=\"text-sm text-slate-500 dark:text-slate-400\">\r\n                        berprfen Sie die eingelesenen Daten vor dem endgltigen Import.\r\n                    </p>\r\n\r\n                    <div className=\"mt-4 flex gap-4\">\r\n                        <div className=\"flex items-center gap-2 px-3 py-1.5 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 rounded-lg text-sm font-bold border border-green-100 dark:border-green-900/30\">\r\n                            <Check className=\"w-4 h-4\" />\r\n                            {validation.validCount} Zeilen bereit\r\n                        </div>\r\n                        {validation.errorCount > 0 && (\r\n                            <div className=\"flex items-center gap-2 px-3 py-1.5 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 rounded-lg text-sm font-bold border border-red-100 dark:border-red-900/30\">\r\n                                <AlertCircle className=\"w-4 h-4\" />\r\n                                {validation.errorCount} Zeilen mit Fehlern\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex-1 overflow-auto p-0 relative\">\r\n                    <table className=\"w-full text-left border-collapse min-w-max\">\r\n                        <thead className=\"sticky top-0 bg-slate-50 dark:bg-slate-900 z-10\">\r\n                            <tr>\r\n                                <th className=\"p-3 border-b border-slate-200 dark:border-slate-700 text-[10px] font-black uppercase text-slate-400 w-12 text-center\">#</th>\r\n                                <th className=\"p-3 border-b border-slate-200 dark:border-slate-700 text-[10px] font-black uppercase text-slate-400 w-12 text-center\">Status</th>\r\n                                {columns.map(col => (\r\n                                    <th key={col} className=\"p-3 border-b border-slate-200 dark:border-slate-700 text-[10px] font-black uppercase text-slate-400\">\r\n                                        <div className=\"flex flex-col\">\r\n                                            <span>{col}</span>\r\n                                            <span className=\"text-[8px] font-normal leading-tight opacity-60\">\r\n                                                {schema.properties[col].type || 'any'}\r\n                                                {schema.required?.includes(col) ? ' (REQ)' : ''}\r\n                                            </span>\r\n                                        </div>\r\n                                    </th>\r\n                                ))}\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-slate-100 dark:divide-slate-800\">\r\n                            {data.map((row, idx) => {\r\n                                const res = validation.results[idx];\r\n                                return (\r\n                                    <tr key={idx} className={res.isValid ? 'hover:bg-slate-50 dark:hover:bg-slate-700/50' : 'bg-red-50/30 dark:bg-red-900/5'}>\r\n                                        <td className=\"p-2 text-[10px] text-slate-400 text-center font-mono border-r border-slate-100 dark:border-slate-800\">{idx + 1}</td>\r\n                                        <td className=\"p-2 text-center border-r border-slate-100 dark:border-slate-800\">\r\n                                            {res.isValid ? (\r\n                                                <Check className=\"w-4 h-4 text-green-500 mx-auto\" />\r\n                                            ) : (\r\n                                                <AlertCircle className=\"w-4 h-4 text-red-500 mx-auto\" />\r\n                                            )}\r\n                                        </td>\r\n                                        {columns.map(col => {\r\n                                            const error = res.errors[col];\r\n                                            return (\r\n                                                <td key={col} className={`p-3 text-xs ${error ? 'text-red-600 font-bold bg-red-100/50 dark:bg-red-900/20' : 'text-slate-600 dark:text-slate-300'}`}>\r\n                                                    <div className=\"group relative\">\r\n                                                        <span>{String(row[col] ?? '')}</span>\r\n                                                        {error && (\r\n                                                            <div className=\"absolute bottom-full left-0 mb-2 invisible group-hover:visible bg-slate-900 text-white text-[10px] px-2 py-1 rounded shadow-xl whitespace-nowrap z-50\">\r\n                                                                {error}\r\n                                                            </div>\r\n                                                        )}\r\n                                                    </div>\r\n                                                </td>\r\n                                            );\r\n                                        })}\r\n                                    </tr>\r\n                                );\r\n                            })}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n\r\n                <div className=\"p-6 border-t border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900/50 rounded-b-2xl\">\r\n                    <button\r\n                        onClick={onCancel}\r\n                        disabled={isImporting}\r\n                        className=\"px-4 py-2 text-slate-600 hover:text-slate-900 dark:text-slate-400 dark:hover:text-white font-medium transition-colors disabled:opacity-50\"\r\n                    >\r\n                        Verwerfen\r\n                    </button>\r\n\r\n                    <div className=\"flex items-center gap-4\">\r\n                        {validation.errorCount > 0 && (\r\n                            <div className=\"text-xs text-amber-600 font-medium\">\r\n                                Achtung: {validation.errorCount} Zeilen werden bersprungen.\r\n                            </div>\r\n                        )}\r\n                        <button\r\n                            onClick={onConfirm}\r\n                            disabled={isImporting || validation.validCount === 0}\r\n                            className={`\r\n                                flex items-center gap-2 px-8 py-3 rounded-xl font-bold shadow-lg transition-all transform\r\n                                ${validation.validCount > 0\r\n                                    ? 'bg-blue-600 hover:bg-blue-700 text-white shadow-blue-200 dark:shadow-none hover:-translate-y-0.5 active:translate-y-0'\r\n                                    : 'bg-slate-200 dark:bg-slate-700 text-slate-400 cursor-not-allowed'\r\n                                }\r\n                                disabled:opacity-50\r\n                            `}\r\n                        >\r\n                            {isImporting ? (\r\n                                <>In Bearbeitung...</>\r\n                            ) : (\r\n                                <>{validation.validCount} Zeilen importieren</>\r\n                            )}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\KeySelectionModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[297,300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[297,300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from 'react';\r\nimport { Key, AlertCircle, Check, Info } from 'lucide-react';\r\nimport { Modal } from './Modal';\r\n\r\ninterface KeySelectionModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onConfirm: (keyFields: string[]) => void;\r\n    mappedData: any[];\r\n    initialKeyFields: string[];\r\n    availableFields: string[];\r\n}\r\n\r\nexport const KeySelectionModal: React.FC<KeySelectionModalProps> = ({\r\n    isOpen,\r\n    onClose,\r\n    onConfirm,\r\n    mappedData,\r\n    initialKeyFields,\r\n    availableFields\r\n}) => {\r\n    const [selectedFields, setSelectedFields] = useState<string[]>(initialKeyFields);\r\n\r\n    const duplicateStats = useMemo(() => {\r\n        if (mappedData.length === 0 || selectedFields.length === 0) return { count: 0, total: mappedData.length };\r\n\r\n        const seen = new Set();\r\n        let duplicates = 0;\r\n\r\n        mappedData.forEach(row => {\r\n            const compositeKey = selectedFields.map(f => String(row[f] || '')).join('|');\r\n            if (seen.has(compositeKey)) {\r\n                duplicates++;\r\n            } else {\r\n                seen.add(compositeKey);\r\n            }\r\n        });\r\n\r\n        return { count: duplicates, total: mappedData.length };\r\n    }, [mappedData, selectedFields]);\r\n\r\n    const toggleField = (field: string) => {\r\n        setSelectedFields(prev =>\r\n            prev.includes(field)\r\n                ? prev.filter(f => f !== field)\r\n                : [...prev, field]\r\n        );\r\n    };\r\n\r\n    const isSuccess = duplicateStats.count === 0 && selectedFields.length > 0;\r\n\r\n    return (\r\n        <Modal\r\n            isOpen={isOpen}\r\n            onClose={onClose}\r\n            title=\"Configure Primary Key\"\r\n        >\r\n            <div className=\"space-y-6\">\r\n                <div className=\"bg-blue-50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-900/30 p-4 rounded-xl flex gap-3\">\r\n                    <Info className=\"w-5 h-5 text-blue-600 shrink-0 mt-0.5\" />\r\n                    <p className=\"text-sm text-blue-700 dark:text-blue-300\">\r\n                        Select the fields that uniquely identify a single record.\r\n                        A unique combination is required for accurate trend analysis and anomaly detection.\r\n                    </p>\r\n                </div>\r\n\r\n                <div className=\"space-y-3 max-h-64 overflow-y-auto pr-2 custom-scrollbar\">\r\n                    {availableFields.map(field => (\r\n                        <label\r\n                            key={field}\r\n                            className={`flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-all ${selectedFields.includes(field)\r\n                                    ? 'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800'\r\n                                    : 'bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700'\r\n                                }`}\r\n                        >\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    checked={selectedFields.includes(field)}\r\n                                    onChange={() => toggleField(field)}\r\n                                    className=\"w-4 h-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500\"\r\n                                />\r\n                                <span className={`text-sm font-medium ${selectedFields.includes(field) ? 'text-blue-900 dark:text-blue-100' : 'text-slate-700 dark:text-slate-300'}`}>\r\n                                    {field}\r\n                                </span>\r\n                            </div>\r\n                            {selectedFields.includes(field) && <Key className=\"w-3.5 h-3.5 text-blue-500\" />}\r\n                        </label>\r\n                    ))}\r\n                </div>\r\n\r\n                <div className={`p-4 rounded-xl flex items-center justify-between ${isSuccess\r\n                        ? 'bg-emerald-50 dark:bg-emerald-900/10 text-emerald-700 dark:text-emerald-300'\r\n                        : 'bg-orange-50 dark:bg-orange-900/10 text-orange-700 dark:text-orange-300'\r\n                    }`}>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        {isSuccess ? <Check className=\"w-5 h-5\" /> : <AlertCircle className=\"w-5 h-5\" />}\r\n                        <div className=\"text-sm font-bold\">\r\n                            {isSuccess ? 'Unique ID established!' : `${duplicateStats.count} duplicates found`}\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"text-xs font-medium opacity-70\">\r\n                        {selectedFields.length} fields selected\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex justify-end gap-3 pt-2\">\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"px-4 py-2 text-slate-600 dark:text-slate-400 font-medium hover:text-slate-900 dark:hover:text-white\"\r\n                    >\r\n                        Cancel\r\n                    </button>\r\n                    <button\r\n                        disabled={selectedFields.length === 0}\r\n                        onClick={() => onConfirm(selectedFields)}\r\n                        className={`px-6 py-2 rounded-xl font-bold transition-all ${selectedFields.length > 0\r\n                                ? 'bg-blue-600 text-white shadow-lg shadow-blue-200 dark:shadow-none hover:bg-blue-700 active:scale-95'\r\n                                : 'bg-slate-200 dark:bg-slate-700 text-slate-400 cursor-not-allowed'\r\n                            }`}\r\n                    >\r\n                        Save Configuration\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </Modal>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\LockScreen.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\MappingManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1357,1360],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1357,1360],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2239,2242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2239,2242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Download, Upload, Trash2, CheckCircle2 as Check, AlertCircle } from 'lucide-react';\r\nimport { useLocalStorage } from '../../hooks/useLocalStorage';\r\nimport type { MappingConfig } from './ColumnMapper';\r\n\r\nexport const MappingManager: React.FC = () => {\r\n    const { t } = useTranslation();\r\n    // Shared key with ExcelImport\r\n    const [savedMappings, setSavedMappings] = useLocalStorage<Record<string, Record<string, MappingConfig>>>('excel_mappings_v2', {});\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n    const [message, setMessage] = React.useState<string | null>(null);\r\n    const [status, setStatus] = React.useState<'success' | 'error' | null>(null);\r\n\r\n    const handleExport = () => {\r\n        try {\r\n            const data = JSON.stringify(savedMappings, null, 2);\r\n            const blob = new Blob([data], { type: 'application/json' });\r\n            const url = URL.createObjectURL(blob);\r\n            const a = document.createElement('a');\r\n            a.href = url;\r\n            a.download = `itdashboard_mappings_${new Date().toISOString().split('T')[0]}.json`;\r\n            a.click();\r\n            URL.revokeObjectURL(url);\r\n            setStatus('success');\r\n            setMessage(t('common.success'));\r\n        } catch (e: any) {\r\n            setStatus('error');\r\n            setMessage(t('common.error') + ': ' + e.message);\r\n        }\r\n    };\r\n\r\n    const handleImport = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = (event) => {\r\n            try {\r\n                const json = JSON.parse(event.target?.result as string);\r\n                if (typeof json !== 'object' || json === null) throw new Error('Invalid JSON');\r\n\r\n                // Merge strategies?\r\n                // For now, let's merge and overwrite existing keys\r\n                setSavedMappings((prev: Record<string, Record<string, MappingConfig>>) => ({ ...prev, ...json }));\r\n\r\n                setStatus('success');\r\n                setMessage(t('common.success'));\r\n            } catch (err: any) {\r\n                setStatus('error');\r\n                setMessage(t('common.error') + ': ' + err.message);\r\n            }\r\n        };\r\n        reader.readAsText(file);\r\n        // Reset input\r\n        if (fileInputRef.current) fileInputRef.current.value = '';\r\n    };\r\n\r\n    const handleClear = () => {\r\n        if (confirm(t('datasource.clear_mappings_confirm'))) {\r\n            setSavedMappings({});\r\n            setStatus('success');\r\n            setMessage(t('common.success'));\r\n        }\r\n    };\r\n\r\n    // Auto-hide message\r\n    React.useEffect(() => {\r\n        if (message) {\r\n            const timer = setTimeout(() => {\r\n                setMessage(null);\r\n                setStatus(null);\r\n            }, 3000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [message]);\r\n\r\n    const count = Object.keys(savedMappings).length;\r\n\r\n    return (\r\n        <div className=\"flex items-center gap-3\">\r\n            {message && (\r\n                <div className={`text-xs px-2 py-1 rounded flex items-center gap-1.5 animate-in fade-in slide-in-from-right-4 ${status === 'success'\r\n                    ? 'bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-300'\r\n                    : 'bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-300'\r\n                    }`}>\r\n                    {status === 'success' ? <Check className=\"w-3 h-3\" /> : <AlertCircle className=\"w-3 h-3\" />}\r\n                    {message}\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"flex items-center gap-2\">\r\n                <span className=\"text-xs text-slate-400 mr-2\">\r\n                    {t('datasource.mappings_saved', { count })}\r\n                </span>\r\n\r\n                <button\r\n                    onClick={handleExport}\r\n                    disabled={count === 0}\r\n                    className=\"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-slate-700 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    title={t('datasource.export_mappings')}\r\n                >\r\n                    <Download className=\"w-4 h-4\" />\r\n                </button>\r\n\r\n                <div className=\"relative\">\r\n                    <input\r\n                        type=\"file\"\r\n                        accept=\".json\"\r\n                        ref={fileInputRef}\r\n                        onChange={handleImport}\r\n                        className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\"\r\n                        title={t('datasource.import_mappings')}\r\n                    />\r\n                    <button className=\"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-slate-700 rounded transition-colors pointer-events-none\">\r\n                        <Upload className=\"w-4 h-4\" />\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"w-px h-4 bg-slate-200 dark:bg-slate-700 mx-1\" />\r\n\r\n                <button\r\n                    onClick={handleClear}\r\n                    disabled={count === 0}\r\n                    className=\"p-1.5 text-slate-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-slate-700 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    title={t('datasource.clear_mappings')}\r\n                >\r\n                    <Trash2 className=\"w-4 h-4\" />\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\Modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\MultiTabModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An empty interface declaration allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowInterfaces' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":4,"column":11,"nodeType":"Identifier","messageId":"noEmptyInterface","endLine":4,"endColumn":29,"suggestions":[{"messageId":"replaceEmptyInterface","data":{"replacement":"object"},"fix":{"range":[100,180],"text":"type MultiTabModalProps = object"},"desc":"Replace empty interface with `object`."},{"messageId":"replaceEmptyInterface","data":{"replacement":"unknown"},"fix":{"range":[100,180],"text":"type MultiTabModalProps = unknown"},"desc":"Replace empty interface with `unknown`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { AlertTriangle, XCircle, ExternalLink } from 'lucide-react';\r\n\r\ninterface MultiTabModalProps {\r\n    // No props needed for informational only\r\n}\r\n\r\nexport const MultiTabModal: React.FC<MultiTabModalProps> = () => {\r\n    return (\r\n        <div className=\"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm animate-in fade-in duration-300\">\r\n            <div className=\"bg-white dark:bg-slate-800 rounded-3xl shadow-2xl border border-slate-200 dark:border-slate-700 max-w-md w-full overflow-hidden animate-in zoom-in-95 duration-300\">\r\n                <div className=\"p-8\">\r\n                    <div className=\"flex items-center justify-center w-16 h-16 bg-amber-100 dark:bg-amber-900/30 rounded-2xl mb-6 mx-auto\">\r\n                        <AlertTriangle className=\"w-8 h-8 text-amber-600 dark:text-amber-500\" />\r\n                    </div>\r\n\r\n                    <h2 className=\"text-2xl font-bold text-slate-900 dark:text-white text-center mb-3\">\r\n                        Zweite Instanz erkannt\r\n                    </h2>\r\n\r\n                    <p className=\"text-slate-600 dark:text-slate-400 text-center mb-8 leading-relaxed\">\r\n                        LiteBI Studio ist bereits in einem anderen Tab geffnet. Um Datenverlust zu vermeiden, ist der Zugriff auf <span className=\"font-semibold text-slate-900 dark:text-white\">einen aktiven Tab</span> beschrnkt.\r\n                    </p>\r\n\r\n                    <div className=\"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800/50 rounded-2xl p-4 flex gap-3 items-start mb-6\">\r\n                        <XCircle className=\"w-5 h-5 text-amber-600 dark:text-amber-500 mt-0.5 shrink-0\" />\r\n                        <p className=\"text-sm text-amber-800 dark:text-amber-400\">\r\n                            Bitte schlieen Sie diesen Tab manuell und nutzen Sie die bereits geffnete Instanz.\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-slate-50 dark:bg-slate-900/50 p-4 border-t border-slate-100 dark:border-slate-800 flex justify-center\">\r\n                    <a\r\n                        href=\"https://github.com/hrmnns/litebistudio/blob/48f73003fb415174711f4e77baaf1433637d76ff/docs/Single-Instance-Policy.md\"\r\n                        target=\"_blank\"\r\n                        rel=\"noopener noreferrer\"\r\n                        className=\"text-xs text-blue-500 hover:text-blue-600 flex items-center gap-1 transition-colors\"\r\n                    >\r\n                        Warum ist das so? <ExternalLink className=\"w-3 h-3\" />\r\n                    </a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\PivotTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[286,289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[286,289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { formatValue } from '../utils/formatUtils';\r\n\r\ninterface PivotMeasure {\r\n    field: string;\r\n    agg: 'sum' | 'count' | 'avg' | 'min' | 'max';\r\n}\r\n\r\ninterface PivotTableProps {\r\n    data: any[];\r\n    rows: string[];\r\n    cols: string[];\r\n    measures: PivotMeasure[];\r\n}\r\n\r\nexport const PivotTable: React.FC<PivotTableProps> = ({ data, rows, cols, measures }) => {\r\n    const { t } = useTranslation();\r\n\r\n    const pivotData = useMemo(() => {\r\n        if (!data || data.length === 0 || measures.length === 0) return null;\r\n\r\n        const rowKeys = new Set<string>();\r\n        const colKeys = new Set<string>();\r\n        const matrix: Record<string, Record<string, Record<string, number[]>>> = {};\r\n\r\n        // 1. Group Data\r\n        data.forEach(item => {\r\n            const rowKey = rows.map(r => String(item[r] ?? '')).join(' | ');\r\n            const colKey = cols.map(c => String(item[c] ?? '')).join(' | ');\r\n\r\n            rowKeys.add(rowKey);\r\n            colKeys.add(colKey);\r\n\r\n            if (!matrix[rowKey]) matrix[rowKey] = {};\r\n            if (!matrix[rowKey][colKey]) matrix[rowKey][colKey] = {};\r\n\r\n            measures.forEach(m => {\r\n                if (!matrix[rowKey][colKey][m.field]) matrix[rowKey][colKey][m.field] = [];\r\n                const val = Number(item[m.field]);\r\n                if (!isNaN(val)) matrix[rowKey][colKey][m.field].push(val);\r\n                else if (m.agg === 'count') matrix[rowKey][colKey][m.field].push(1);\r\n            });\r\n        });\r\n\r\n        const sortedRowKeys = Array.from(rowKeys).sort();\r\n        const sortedColKeys = Array.from(colKeys).sort();\r\n\r\n        // 2. Aggregate\r\n        const aggregated: Record<string, Record<string, Record<string, number>>> = {};\r\n        sortedRowKeys.forEach(r => {\r\n            aggregated[r] = {};\r\n            sortedColKeys.forEach(c => {\r\n                aggregated[r][c] = {};\r\n                measures.forEach(m => {\r\n                    const vals = matrix[r]?.[c]?.[m.field] || [];\r\n                    let result = 0;\r\n                    if (vals.length > 0) {\r\n                        switch (m.agg) {\r\n                            case 'sum': result = vals.reduce((a, b) => a + b, 0); break;\r\n                            case 'count': result = vals.length; break;\r\n                            case 'avg': result = vals.reduce((a, b) => a + b, 0) / vals.length; break;\r\n                            case 'min': result = Math.min(...vals); break;\r\n                            case 'max': result = Math.max(...vals); break;\r\n                        }\r\n                    }\r\n                    aggregated[r][c][m.field] = result;\r\n                });\r\n            });\r\n        });\r\n\r\n        return {\r\n            rowLabels: sortedRowKeys,\r\n            colLabels: sortedColKeys,\r\n            values: aggregated\r\n        };\r\n    }, [data, rows, cols, measures]);\r\n\r\n    if (!pivotData) {\r\n        return <div className=\"p-8 text-center text-slate-400 italic\">{t('common.no_data')}</div>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"w-full h-full overflow-auto bg-white dark:bg-slate-900 shadow-inner rounded-lg border border-slate-200 dark:border-slate-700\">\r\n            <table className=\"min-w-full text-xs border-collapse\">\r\n                <thead className=\"sticky top-0 z-20 bg-slate-50 dark:bg-slate-800 border-b border-slate-300 dark:border-slate-700\">\r\n                    {/* Column Headers */}\r\n                    <tr>\r\n                        <th\r\n                            colSpan={rows.length}\r\n                            className=\"p-2 border border-slate-300 dark:border-slate-700 font-bold bg-slate-100 dark:bg-slate-800 text-slate-500 uppercase tracking-wider\"\r\n                        >\r\n                            {rows.join(' / ')}\r\n                        </th>\r\n                        {pivotData.colLabels.map(c => (\r\n                            <th\r\n                                key={c}\r\n                                colSpan={measures.length}\r\n                                className=\"p-2 border border-slate-300 dark:border-slate-700 font-bold text-center bg-blue-50/50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300\"\r\n                            >\r\n                                {c || '--'}\r\n                            </th>\r\n                        ))}\r\n                    </tr>\r\n                    {/* Measure Headers (if multiple measures) */}\r\n                    {measures.length > 1 && (\r\n                        <tr>\r\n                            <th colSpan={rows.length} className=\"border border-slate-300 dark:border-slate-700\"></th>\r\n                            {pivotData.colLabels.map(c =>\r\n                                measures.map(m => (\r\n                                    <th key={`${c}-${m.field}`} className=\"p-1 border border-slate-300 dark:border-slate-700 text-[10px] text-slate-400 font-medium\">\r\n                                        {m.field} ({t(`querybuilder.pivot_agg_${m.agg}`)})\r\n                                    </th>\r\n                                ))\r\n                            )}\r\n                        </tr>\r\n                    )}\r\n                    {measures.length === 1 && (\r\n                        <tr>\r\n                            <th colSpan={rows.length} className=\"border border-slate-300 dark:border-slate-700\"></th>\r\n                            {pivotData.colLabels.map(c => (\r\n                                <th key={`measure-${c}`} className=\"p-1 border border-slate-300 dark:border-slate-700 text-[10px] text-slate-400 font-medium italic\">\r\n                                    {t(`querybuilder.pivot_agg_${measures[0].agg}`)}\r\n                                </th>\r\n                            ))}\r\n                        </tr>\r\n                    )}\r\n                </thead>\r\n                <tbody>\r\n                    {pivotData.rowLabels.map((r, rIdx) => (\r\n                        <tr key={r} className={rIdx % 2 === 0 ? 'bg-white dark:bg-slate-900' : 'bg-slate-50/30 dark:bg-slate-800/20'}>\r\n                            {r.split(' | ').map((part, pIdx) => (\r\n                                <td key={pIdx} className=\"p-2 border border-slate-200 dark:border-slate-800 font-medium text-slate-700 dark:text-slate-300 whitespace-nowrap\">\r\n                                    {part}\r\n                                </td>\r\n                            ))}\r\n                            {pivotData.colLabels.map(c =>\r\n                                measures.map(m => {\r\n                                    const val = pivotData.values[r][c][m.field];\r\n                                    return (\r\n                                        <td key={`${c}-${m.field}`} className=\"p-2 border border-slate-200 dark:border-slate-800 text-right font-mono tabular-nums\">\r\n                                            {formatValue(val, m.field)}\r\n                                        </td>\r\n                                    );\r\n                                })\r\n                            )}\r\n                        </tr>\r\n                    ))}\r\n                </tbody>\r\n            </table>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\RecordDetailModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[462,465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[462,465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[557,560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[557,560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1183,1186],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1183,1186],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1330,1333],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1330,1333],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\github\\litebistudio\\src\\app\\components\\RecordDetailModal.tsx:55:13\n  53 |             // Always sync provided index when modal opens\n  54 |             const val = Math.max(0, initialIndex);\n> 55 |             setCurrentIndex(val);\n     |             ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  56 |             setReferenceIndex(val); // Auto-set initial item as reference logic\n  57 |             setPreviousIndex(null);\n  58 |             setHelpOpen(false);","line":55,"column":13,"nodeType":null,"endLine":55,"endColumn":28},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\github\\litebistudio\\src\\app\\components\\RecordDetailModal.tsx:68:13\n  66 |\n  67 |         if (schema) {\n> 68 |             setResolvedSchema(schema);\n     |             ^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  69 |             return;\n  70 |         }\n  71 |","line":68,"column":13,"nodeType":null,"endLine":68,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3286,3289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3286,3289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Modal } from './Modal';\r\nimport { ChevronLeft, ChevronRight, Info, Bookmark, Target, AlertCircle } from 'lucide-react';\r\nimport { SystemRepository } from '../../lib/repositories/SystemRepository';\r\n\r\nimport { SchemaTable } from './SchemaDocumentation';\r\n\r\ninterface RecordDetailModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    items: any[];\r\n    initialIndex?: number;\r\n    title?: string;\r\n    tableName?: string;\r\n    schema?: any;\r\n}\r\n\r\nexport const RecordDetailModal: React.FC<RecordDetailModalProps> = ({\r\n    isOpen,\r\n    onClose,\r\n    items,\r\n    initialIndex = 0,\r\n    title,\r\n    tableName,\r\n    schema\r\n}) => {\r\n    const { t } = useTranslation();\r\n    const [currentIndex, setCurrentIndex] = useState(initialIndex);\r\n    const [previousIndex, setPreviousIndex] = useState<number | null>(null);\r\n    const [referenceIndex, setReferenceIndex] = useState<number | null>(null);\r\n    const [helpOpen, setHelpOpen] = useState(false);\r\n    const [isInWorklist, setIsInWorklist] = useState(false);\r\n    const [worklistItem, setWorklistItem] = useState<any>(null);\r\n    const [recordExists, setRecordExists] = useState<boolean | null>(null);\r\n    const [resolvedSchema, setResolvedSchema] = useState<any>(null);\r\n\r\n    const modalTitle = title || t('record_detail.title');\r\n\r\n    // Get table name context\r\n    const activeTable = tableName || 'unknown';\r\n\r\n    const initializedRef = React.useRef(false);\r\n\r\n    // Sync index when items change or modal opens\r\n    useEffect(() => {\r\n        if (!isOpen) {\r\n            initializedRef.current = false;\r\n            return;\r\n        }\r\n\r\n        if (isOpen && !initializedRef.current && items && items.length > 0) {\r\n            // Always sync provided index when modal opens\r\n            const val = Math.max(0, initialIndex);\r\n            setCurrentIndex(val);\r\n            setReferenceIndex(val); // Auto-set initial item as reference logic\r\n            setPreviousIndex(null);\r\n            setHelpOpen(false);\r\n            initializedRef.current = true;\r\n        }\r\n    }, [isOpen, initialIndex, items]);\r\n\r\n    // Resolve schema if not provided\r\n    useEffect(() => {\r\n        if (!isOpen) return;\r\n\r\n        if (schema) {\r\n            setResolvedSchema(schema);\r\n            return;\r\n        }\r\n\r\n        if (tableName && tableName !== 'unknown') {\r\n            const fetchSchema = async () => {\r\n                const cols = await SystemRepository.getTableSchema(tableName);\r\n                if (cols && cols.length > 0) {\r\n                    const dynamicSchema = {\r\n                        title: `${t('datasource.tab_structure')}: ${tableName}`,\r\n                        description: t('datasource.user_tables_hint'),\r\n                        type: 'object',\r\n                        properties: cols.reduce((acc, col) => {\r\n                            acc[col.name] = {\r\n                                type: col.type.toLowerCase().includes('int') || col.type.toLowerCase().includes('real') ? 'number' : 'string',\r\n                                description: `${col.name} (${col.type})`\r\n                            };\r\n                            return acc;\r\n                        }, {} as any)\r\n                    };\r\n                    setResolvedSchema(dynamicSchema);\r\n                } else {\r\n                    setResolvedSchema(null);\r\n                }\r\n            };\r\n            fetchSchema();\r\n        } else {\r\n            setResolvedSchema(null);\r\n        }\r\n    }, [isOpen, tableName, schema, t]);\r\n\r\n    // Check if current item is in worklist and if it exists\r\n    useEffect(() => {\r\n        const checkStatus = async () => {\r\n            const currentItem = items[currentIndex];\r\n            if (currentItem?.id && activeTable !== 'unknown') {\r\n                const result = await SystemRepository.executeRaw(\r\n                    'SELECT * FROM sys_worklist WHERE source_table = ? AND source_id = ?',\r\n                    [activeTable, currentItem.id]\r\n                );\r\n                setIsInWorklist(result.length > 0);\r\n                setWorklistItem(result[0] || null);\r\n\r\n                // Check existence\r\n                const exists = await SystemRepository.checkRecordExists(activeTable, currentItem.id);\r\n                setRecordExists(exists);\r\n            } else {\r\n                setRecordExists(null);\r\n                setWorklistItem(null);\r\n                setIsInWorklist(false);\r\n            }\r\n        };\r\n        if (isOpen) {\r\n            checkStatus();\r\n        }\r\n    }, [isOpen, currentIndex, items, activeTable]);\r\n\r\n    const handleToggleWorklist = async () => {\r\n        const currentItem = items[currentIndex];\r\n        if (!currentItem?.id) return;\r\n\r\n        // Label: Use generic label detection or fallback to ID\r\n        const labelCandidates = ['name', 'title', 'description', 'label', 'display_name', 'VendorName', 'Description'];\r\n        let label = '';\r\n        for (const candidate of labelCandidates) {\r\n            // Find key case-insensitive\r\n            const actualKey = Object.keys(currentItem).find(k => k.toLowerCase() === candidate.toLowerCase());\r\n            if (actualKey && currentItem[actualKey]) {\r\n                label = String(currentItem[actualKey]);\r\n                break;\r\n            }\r\n        }\r\n        if (!label) label = t('worklist.entry_id', { id: currentItem.id });\r\n\r\n        // Context: Use generic period/category or Table\r\n        const contextCandidates = ['period', 'fiscalyear', 'category', 'type', 'group', 'Period'];\r\n        let context = activeTable;\r\n        for (const candidate of contextCandidates) {\r\n            const actualKey = Object.keys(currentItem).find(k => k.toLowerCase() === candidate.toLowerCase());\r\n            if (actualKey && currentItem[actualKey]) {\r\n                context = String(currentItem[actualKey]);\r\n                break;\r\n            }\r\n        }\r\n\r\n        const existing = await SystemRepository.executeRaw(\r\n            'SELECT id FROM sys_worklist WHERE source_table = ? AND source_id = ?',\r\n            [activeTable, currentItem.id]\r\n        );\r\n\r\n        if (existing.length > 0) {\r\n            await SystemRepository.executeRaw(\r\n                'DELETE FROM sys_worklist WHERE source_table = ? AND source_id = ?',\r\n                [activeTable, currentItem.id]\r\n            );\r\n            setIsInWorklist(false);\r\n            setWorklistItem(null);\r\n        } else {\r\n            await SystemRepository.executeRaw(\r\n                'INSERT INTO sys_worklist (source_table, source_id, display_label, display_context) VALUES (?, ?, ?, ?)',\r\n                [activeTable, currentItem.id, label, context]\r\n            );\r\n\r\n            // Re-fetch to get the newly created ID for status/comment updates\r\n            const newItem = await SystemRepository.executeRaw(\r\n                'SELECT * FROM sys_worklist WHERE source_table = ? AND source_id = ?',\r\n                [activeTable, currentItem.id]\r\n            );\r\n            setIsInWorklist(true);\r\n            setWorklistItem(newItem[0] || null);\r\n        }\r\n\r\n        // Trigger global sync for counters etc.\r\n        window.dispatchEvent(new Event('db-updated'));\r\n    };\r\n\r\n    const handleToggleReference = () => {\r\n        if (referenceIndex === currentIndex) {\r\n            setReferenceIndex(null); // Toggle off if clicking active reference\r\n        } else {\r\n            setReferenceIndex(currentIndex); // Set current as reference\r\n        }\r\n    };\r\n\r\n    const handleNavigate = (newIndex: number) => {\r\n        setPreviousIndex(currentIndex);\r\n        setCurrentIndex(newIndex);\r\n    };\r\n\r\n    if (!items || items.length === 0) return null;\r\n\r\n    const currentItem = items[currentIndex];\r\n\r\n    // Comparison Logic: Reference > Previous Visited\r\n    const comparisonItem = referenceIndex !== null\r\n        ? items[referenceIndex]\r\n        : (previousIndex !== null && previousIndex >= 0 && previousIndex < items.length) ? items[previousIndex] : null;\r\n\r\n    const isReferenceActive = referenceIndex !== null;\r\n    const isCurrentReference = referenceIndex === currentIndex;\r\n\r\n    if (!currentItem) return null;\r\n\r\n    return (\r\n        <>\r\n            <Modal\r\n                isOpen={isOpen}\r\n                onClose={onClose}\r\n                title={items.length > 1\r\n                    ? `${modalTitle} (${currentIndex + 1} / ${items.length})`\r\n                    : modalTitle\r\n                }\r\n                noScroll\r\n            >\r\n                <div className=\"flex flex-col h-full min-h-0 bg-white dark:bg-slate-800\">\r\n                    {/* Fixed Menu Bar / Toolbar */}\r\n                    <div className=\"shrink-0 px-6 py-3 bg-slate-50 dark:bg-slate-900/50 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between z-20\">\r\n                        <div className=\"flex items-center gap-1\">\r\n                            {resolvedSchema && (\r\n                                <button\r\n                                    onClick={() => setHelpOpen(true)}\r\n                                    className=\"p-1.5 rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors text-slate-500\"\r\n                                    title={t('record_detail.schema_definition')}\r\n                                >\r\n                                    <Info className=\"w-4 h-4\" />\r\n                                </button>\r\n                            )}\r\n                            <button\r\n                                onClick={handleToggleWorklist}\r\n                                className={`p-1.5 rounded-lg border transition-colors flex items-center gap-1.5 ${isInWorklist\r\n                                    ? 'bg-amber-50 border-amber-200 text-amber-600 dark:bg-amber-900/20 dark:border-amber-800 dark:text-amber-400'\r\n                                    : 'bg-white border-slate-300 text-slate-500 hover:bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-slate-700'\r\n                                    }`}\r\n                                title={isInWorklist ? t('record_detail.remove_worklist') : t('record_detail.add_worklist')}\r\n                            >\r\n                                <Bookmark className={`w-4 h-4 ${isInWorklist ? 'fill-current' : ''}`} />\r\n                            </button>\r\n\r\n                            <div className=\"h-4 w-[1px] bg-slate-200 dark:bg-slate-700 mx-1\" />\r\n\r\n                            <button\r\n                                onClick={handleToggleReference}\r\n                                className={`p-1.5 rounded-lg border transition-colors flex items-center gap-1.5 group relative ${isReferenceActive\r\n                                    ? 'bg-blue-50 border-blue-200 text-blue-600 dark:bg-blue-900/20 dark:border-blue-800 dark:text-blue-400'\r\n                                    : 'bg-white border-slate-300 text-slate-500 hover:bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-slate-700'\r\n                                    }`}\r\n                                title={isCurrentReference ? t('record_detail.clear_reference') : t('record_detail.set_reference')}\r\n                            >\r\n                                <Target className={`w-4 h-4 ${isReferenceActive ? 'fill-current' : ''}`} />\r\n                                {isReferenceActive && !isCurrentReference && (\r\n                                    <span className=\"absolute -top-1 -right-1 flex h-2.5 w-2.5\">\r\n                                        <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75\"></span>\r\n                                        <span className=\"relative inline-flex rounded-full h-2.5 w-2.5 bg-blue-500\"></span>\r\n                                    </span>\r\n                                )}\r\n                            </button>\r\n\r\n                            <div className=\"h-4 w-[1px] bg-slate-200 dark:bg-slate-700 mx-1\" />\r\n                            <div className=\"text-[10px] font-bold text-slate-400 uppercase tracking-widest px-2\">\r\n                                {t('record_detail.navigation')}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center gap-2\">\r\n                            {recordExists === false && (\r\n                                <div className=\"flex items-center gap-1.5 px-2 py-1 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 border border-red-200 dark:border-red-800 rounded-lg text-[10px] font-black animate-pulse\">\r\n                                    <AlertCircle className=\"w-3.5 h-3.5\" /> {t('record_detail.deleted_badge')}\r\n                                </div>\r\n                            )}\r\n                            <button\r\n                                disabled={currentIndex === 0}\r\n                                onClick={() => handleNavigate(currentIndex - 1)}\r\n                                className=\"p-1.5 rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 disabled:opacity-30 disabled:cursor-not-allowed hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors\"\r\n                            >\r\n                                <ChevronLeft className=\"w-4 h-4\" />\r\n                            </button>\r\n                            <div className=\"text-[11px] font-black text-slate-700 dark:text-slate-200 min-w-[60px] text-center bg-white dark:bg-slate-800 px-2 py-1 rounded-md border border-slate-200 dark:border-slate-800 shadow-sm\">\r\n                                {currentIndex + 1} / {items.length}\r\n                            </div>\r\n                            <button\r\n                                disabled={currentIndex === items.length - 1}\r\n                                onClick={() => handleNavigate(currentIndex + 1)}\r\n                                className=\"p-1.5 rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 disabled:opacity-30 disabled:cursor-not-allowed hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors\"\r\n                            >\r\n                                <ChevronRight className=\"w-4 h-4\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Worklist Details Editor */}\r\n                    {isInWorklist && (\r\n                        <div className=\"shrink-0 px-6 py-4 bg-amber-50/30 dark:bg-amber-900/5 border-b border-slate-200 dark:border-slate-700 space-y-3\">\r\n                            <div className=\"flex items-start gap-4\">\r\n                                <div className=\"w-48 shrink-0\">\r\n                                    <label className=\"block text-[9px] font-black uppercase text-amber-600 dark:text-amber-400 mb-1.5 px-1\">{t('record_detail.status_label')}</label>\r\n                                    <select\r\n                                        value={worklistItem?.status || 'pending'}\r\n                                        onChange={async (e) => {\r\n                                            if (worklistItem) {\r\n                                                const newStatus = e.target.value;\r\n                                                setWorklistItem({ ...worklistItem, status: newStatus });\r\n                                                try {\r\n                                                    await SystemRepository.updateWorklistItem(worklistItem.id, { status: newStatus });\r\n                                                    // Trigger global sync for widget/other views\r\n                                                    window.dispatchEvent(new Event('db-updated'));\r\n                                                } catch (err) {\r\n                                                    console.error('Failed to update status', err);\r\n                                                }\r\n                                            }\r\n                                        }}\r\n                                        className=\"w-full p-2 bg-white dark:bg-slate-800 border border-amber-200 dark:border-amber-900/50 rounded-xl text-xs font-bold outline-none focus:ring-2 focus:ring-amber-500/20 transition-all cursor-pointer\"\r\n                                    >\r\n                                        <option value=\"pending\">{t('record_detail.status_pending')}</option>\r\n                                        <option value=\"in_progress\">{t('record_detail.status_in_progress')}</option>\r\n                                        <option value=\"error\">{t('record_detail.status_error')}</option>\r\n                                        <option value=\"obsolete\">{t('record_detail.status_obsolete')}</option>\r\n                                        <option value=\"done\">{t('record_detail.status_done')}</option>\r\n                                    </select>\r\n                                </div>\r\n                                <div className=\"flex-1 min-w-0\">\r\n                                    <label className=\"block text-[9px] font-black uppercase text-amber-600 dark:text-amber-400 mb-1.5 px-1\">{t('record_detail.comment_label')}</label>\r\n                                    <textarea\r\n                                        value={worklistItem?.comment || ''}\r\n                                        onChange={(e) => setWorklistItem({ ...worklistItem, comment: e.target.value })}\r\n                                        onBlur={async (e) => {\r\n                                            if (worklistItem) {\r\n                                                try {\r\n                                                    await SystemRepository.updateWorklistItem(worklistItem.id, { comment: e.target.value });\r\n                                                    // Trigger global sync for widget/other views\r\n                                                    window.dispatchEvent(new Event('db-updated'));\r\n                                                } catch (err) {\r\n                                                    console.error('Failed to update comment', err);\r\n                                                }\r\n                                            }\r\n                                        }}\r\n                                        placeholder={t('record_detail.comment_placeholder')}\r\n                                        className=\"w-full p-2 h-[37px] bg-white dark:bg-slate-800 border border-amber-200 dark:border-amber-900/50 rounded-xl text-xs font-medium outline-none focus:ring-2 focus:ring-amber-500/20 transition-all resize-none overflow-hidden hover:overflow-y-auto\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Scrollable Data Area */}\r\n                    <div className=\"flex-1 overflow-auto p-6 pt-4 min-h-0 scrollbar-thin scrollbar-thumb-slate-200 dark:scrollbar-thumb-slate-700\">\r\n                        {isReferenceActive && !isCurrentReference && (\r\n                            <div className=\"bg-blue-50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-900/30 rounded-lg px-3 py-2 text-[10px] text-blue-700 dark:text-blue-300 flex items-center gap-2 mb-6\">\r\n                                <Target className=\"w-3.5 h-3.5\" />\r\n                                <span className=\"font-bold\">{t('record_detail.comparison_active')}</span>\r\n                                <span>\r\n                                    {t('record_detail.differences_relative', { id: items[referenceIndex].id || referenceIndex + 1 })}\r\n                                </span>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6\">\r\n                            {Object.entries(currentItem).map(([key, value]) => {\r\n                                // Skip internal tracking fields if they exist and are boolean/utility\r\n                                if (key.startsWith('is') || key === 'compositeKey' || key === 'status') return null;\r\n\r\n                                const isChanged = comparisonItem && String(value) !== String(comparisonItem[key]);\r\n\r\n                                return (\r\n                                    <div\r\n                                        key={key}\r\n                                        className={`\r\n                                            border-b border-slate-100 dark:border-slate-700/50 pb-2 transition-colors duration-500\r\n                                            ${isChanged ? 'bg-amber-50 dark:bg-amber-900/20 -mx-2 px-2 rounded-lg border-amber-200 dark:border-amber-800 shadow-sm' : ''}\r\n                                        `}\r\n                                    >\r\n                                        <dt className=\"text-[10px] font-bold uppercase text-slate-400 mb-1 flex items-center justify-between tracking-wider\">\r\n                                            {key}\r\n                                            {isChanged && (\r\n                                                <span className=\"text-[9px] bg-amber-200 dark:bg-amber-800 text-amber-800 dark:text-amber-200 px-1.5 rounded-full font-black\">\r\n                                                    DIFF\r\n                                                </span>\r\n                                            )}\r\n                                        </dt>\r\n                                        <dd className={`text-sm font-semibold break-all ${isChanged ? 'text-amber-900 dark:text-amber-100' : 'text-slate-900 dark:text-white'}`}>\r\n                                            {value === null || value === undefined || value === '' ? (\r\n                                                <span className=\"text-slate-300 italic\">{t('record_detail.empty_value')}</span>\r\n                                            ) : (\r\n                                                String(value)\r\n                                            )}\r\n                                        </dd>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </Modal>\r\n\r\n\r\n\r\n            {/* Direct Schema Definition Modal (if available) */}\r\n            {\r\n                resolvedSchema && helpOpen && (\r\n                    <Modal\r\n                        isOpen={helpOpen}\r\n                        onClose={() => setHelpOpen(false)}\r\n                        title={resolvedSchema.title || modalTitle}\r\n                    >\r\n                        <div className=\"space-y-6\">\r\n                            <p className=\"text-sm text-slate-500 dark:text-slate-400 italic\">\r\n                                {resolvedSchema.description}\r\n                            </p>\r\n                            <SchemaTable schema={resolvedSchema} />\r\n                            <button\r\n                                onClick={() => setHelpOpen(false)}\r\n                                className=\"w-full py-2.5 bg-slate-900 dark:bg-slate-100 text-white dark:text-slate-900 rounded-xl font-bold text-xs transition-opacity hover:opacity-90 mt-4\"\r\n                            >\r\n                                {t('record_detail.close')}\r\n                            </button>\r\n                        </div>\r\n                    </Modal>\r\n                )\r\n            }\r\n        </>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\SchemaDocumentation.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[187,190],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[187,190],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[264,267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[264,267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1662,1665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1662,1665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":116,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":119,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7215,7218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7215,7218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { ExternalLink, ShieldCheck } from 'lucide-react';\r\nimport { Modal } from './Modal';\r\n\r\ninterface SchemaDocumentationProps {\r\n    schema: any;\r\n    title?: string;\r\n}\r\n\r\nexport const SchemaTable: React.FC<{ schema: any }> = ({ schema }) => {\r\n    if (!schema) return null;\r\n\r\n    // Handle both array/list schemas (with .items) and direct object schemas\r\n    const target = schema.items || schema;\r\n    const properties = target.properties;\r\n    const required = target.required || [];\r\n\r\n    if (!properties) return <div className=\"p-4 text-center text-slate-400 italic text-sm\">Keine Feld-Informationen verfgbar.</div>;\r\n\r\n    const propertyEntries = Object.entries(properties);\r\n\r\n    return (\r\n        <div className=\"overflow-x-auto rounded-xl border border-slate-200 dark:border-slate-700\">\r\n            <table className=\"w-full text-sm text-left border-collapse\">\r\n                <thead className=\"bg-slate-50 dark:bg-slate-900/50 text-slate-500 uppercase text-[11px] font-bold\">\r\n                    <tr>\r\n                        <th className=\"px-4 py-3 border-b border-slate-200 dark:border-slate-700\">Property</th>\r\n                        <th className=\"px-4 py-3 border-b border-slate-200 dark:border-slate-700\">Type</th>\r\n                        <th className=\"px-4 py-3 border-b border-slate-200 dark:border-slate-700\">Constraints</th>\r\n                        <th className=\"px-4 py-3 border-b border-slate-200 dark:border-slate-700\">Description</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    {propertyEntries.map(([key, value]: [string, any]) => (\r\n                        <tr key={key} className=\"hover:bg-slate-50/80 dark:hover:bg-slate-800/50 transition-colors border-b border-slate-100 dark:border-slate-800 last:border-0\">\r\n                            <td className=\"px-4 py-4 align-top\">\r\n                                <div className=\"font-mono font-bold text-slate-900 dark:text-white flex items-center gap-1.5\">\r\n                                    {key}\r\n                                    {required.includes(key) && (\r\n                                        <span className=\"text-[10px] text-red-500 font-bold px-1.5 py-0.5 bg-red-50 dark:bg-red-900/20 rounded border border-red-100 dark:border-red-900/30\">REQ</span>\r\n                                    )}\r\n                                </div>\r\n                            </td>\r\n                            <td className=\"px-4 py-4 align-top\">\r\n                                <code className=\"text-[11px] px-1.5 py-0.5 bg-slate-100 dark:bg-slate-700 rounded text-slate-600 dark:text-slate-300\">\r\n                                    {value.type}\r\n                                </code>\r\n                            </td>\r\n                            <td className=\"px-4 py-4 align-top\">\r\n                                <div className=\"flex flex-wrap gap-1\">\r\n                                    {value.enum && (\r\n                                        <div className=\"w-full mb-1\">\r\n                                            <span className=\"text-[10px] text-slate-400 uppercase font-bold block mb-1\">Allowed Values:</span>\r\n                                            <div className=\"flex flex-wrap gap-1\">\r\n                                                {value.enum.map((v: string) => (\r\n                                                    <span key={v} className=\"text-[10px] px-1 bg-amber-50 dark:bg-amber-900/20 text-amber-600 dark:text-amber-400 border border-amber-100 dark:border-amber-900/30 rounded\">{v}</span>\r\n                                                ))}\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                    {value.pattern && (\r\n                                        <div className=\"w-full\">\r\n                                            <span className=\"text-[10px] text-slate-400 uppercase font-bold block mb-0.5\">Regex Pattern:</span>\r\n                                            <code className=\"text-[10px] text-indigo-500 font-mono break-all\">{value.pattern}</code>\r\n                                        </div>\r\n                                    )}\r\n                                    {value.format && <span className=\"text-[10px] px-1 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border border-blue-100 dark:border-blue-900/30 rounded uppercase\">{value.format}</span>}\r\n                                    {value.minimum !== undefined && <span className=\"text-[10px] px-1 bg-slate-50 dark:bg-slate-700 text-slate-500 rounded font-mono\">min: {value.minimum}</span>}\r\n                                    {value.maximum !== undefined && <span className=\"text-[10px] px-1 bg-slate-50 dark:bg-slate-700 text-slate-500 rounded font-mono\">max: {value.maximum}</span>}\r\n                                </div>\r\n                            </td>\r\n                            <td className=\"px-4 py-4 align-top text-slate-600 dark:text-slate-400 text-xs leading-relaxed\">\r\n                                {value.description || <span className=\"opacity-30 italic\">No description available</span>}\r\n                            </td>\r\n                        </tr>\r\n                    ))}\r\n                </tbody>\r\n            </table>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport const SchemaDocumentation: React.FC<SchemaDocumentationProps> = ({ schema, title }) => {\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n\r\n    if (!schema) {\r\n        return <div className=\"text-slate-500 italic\">Kein Schema vorhanden.</div>;\r\n    }\r\n\r\n    const target = schema.items || schema;\r\n    const properties = target.properties;\r\n    const required = target.required || [];\r\n\r\n    if (!properties) return null;\r\n\r\n    const propertyEntries = Object.entries(properties);\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            <div className=\"flex items-center justify-between gap-4\">\r\n                <div>\r\n                    <h3 className=\"text-sm font-semibold text-blue-700 dark:text-blue-300 uppercase tracking-wider mb-1 flex items-center gap-2\">\r\n                        <ShieldCheck className=\"w-4 h-4\" />\r\n                        {title || 'Validation Rules'}\r\n                    </h3>\r\n                    <p className=\"text-sm text-blue-600 dark:text-blue-400 italic\">\r\n                        {schema.description || 'Automatic documentation from JSON Schema.'}\r\n                    </p>\r\n                </div>\r\n                <button\r\n                    onClick={() => setIsModalOpen(true)}\r\n                    className=\"flex items-center gap-2 px-3 py-1.5 text-xs font-semibold bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors active:scale-95 shadow-sm\"\r\n                >\r\n                    <ExternalLink className=\"w-3.5 h-3.5\" />\r\n                    View Details\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n                {propertyEntries.filter(([key]) => required.includes(key)).slice(0, 4).map(([key, value]: [string, any]) => (\r\n                    <div key={key} className=\"text-xs p-2.5 rounded-lg bg-white/50 dark:bg-slate-900/50 border border-blue-200/50 dark:border-blue-800/30\">\r\n                        <div className=\"flex items-center justify-between mb-0.5\">\r\n                            <span className=\"font-bold text-blue-800 dark:text-blue-200\">{key}</span>\r\n                            <span className=\"text-[10px] uppercase font-bold text-blue-500/70\">{value.type}</span>\r\n                        </div>\r\n                        <p className=\"text-slate-500 line-clamp-1\">{value.description}</p>\r\n                    </div>\r\n                ))}\r\n                <div className=\"text-xs p-2.5 rounded-lg bg-blue-50/50 dark:bg-blue-900/20 border border-dashed border-blue-200 dark:border-blue-800/50 flex items-center justify-center text-blue-600 dark:text-blue-400 italic\">\r\n                    + {propertyEntries.length - Math.min(4, required.length)} more fields\r\n                </div>\r\n            </div>\r\n\r\n            <Modal\r\n                isOpen={isModalOpen}\r\n                onClose={() => setIsModalOpen(false)}\r\n                title={schema.title || 'Data Format Details'}\r\n            >\r\n                <div className=\"space-y-6\">\r\n                    <SchemaTable schema={schema} />\r\n                </div>\r\n            </Modal>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\SmartImport.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[497,500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[497,500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2845,2848],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2845,2848],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Upload, FileSpreadsheet, ChevronRight, AlertCircle, Trash2, Database, Table as TableIcon } from 'lucide-react';\r\nimport { analyzeExcelFile } from '../../lib/utils/excelParser';\r\nimport { SystemRepository } from '../../lib/repositories/SystemRepository';\r\n\r\ninterface TablePreview {\r\n    sheetName: string;\r\n    tableName: string;\r\n    columns: { name: string; type: string }[];\r\n    rows: any[];\r\n    isValid: boolean;\r\n    error?: string;\r\n}\r\n\r\nexport const SmartImport: React.FC = () => {\r\n    const { t } = useTranslation();\r\n    const [step, setStep] = useState<1 | 2 | 3>(1);\r\n    const [previews, setPreviews] = useState<TablePreview[]>([]);\r\n    const [isAnalyzing, setIsAnalyzing] = useState(false);\r\n    const [isImporting, setIsImporting] = useState(false);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        setIsAnalyzing(true);\r\n        try {\r\n            const results = await analyzeExcelFile(file);\r\n            const initialPreviews: TablePreview[] = results.map(res => ({\r\n                sheetName: res.sheetName,\r\n                tableName: res.suggestedTableName.startsWith('usr_') ? res.suggestedTableName : `usr_${res.suggestedTableName}`,\r\n                columns: res.columns,\r\n                rows: res.data,\r\n                isValid: res.isValid,\r\n                error: res.validationError\r\n            }));\r\n            setPreviews(initialPreviews);\r\n            setStep(2);\r\n        } catch (error) {\r\n            console.error('Analysis failed', error);\r\n            alert(t('datasource.smart_import.error_analyzing'));\r\n        } finally {\r\n            setIsAnalyzing(false);\r\n        }\r\n    };\r\n\r\n    const handleImport = async () => {\r\n        setIsImporting(true);\r\n        try {\r\n            for (const preview of previews) {\r\n                if (!preview.isValid) continue;\r\n\r\n                // 1. Create Table\r\n                const columnsSql = preview.columns\r\n                    .map(col => `\"${col.name}\" ${col.type}`)\r\n                    .join(', ');\r\n\r\n                await SystemRepository.executeRaw(`CREATE TABLE IF NOT EXISTS \"${preview.tableName}\" (${columnsSql});`);\r\n\r\n                // 2. Bulk Insert\r\n                const CHUNK_SIZE = 500;\r\n                for (let i = 0; i < preview.rows.length; i += CHUNK_SIZE) {\r\n                    await SystemRepository.bulkInsert(preview.tableName, preview.rows.slice(i, i + CHUNK_SIZE));\r\n                }\r\n            }\r\n            setStep(1);\r\n            setPreviews([]);\r\n            window.dispatchEvent(new Event('db-updated'));\r\n        } catch (error: any) {\r\n            alert(t('common.error') + ': ' + error.message);\r\n        } finally {\r\n            setIsImporting(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Step Indicator */}\r\n            <div className=\"flex items-center gap-4 px-2\">\r\n                {[\r\n                    { s: 1, label: t('datasource.smart_import.step_upload') },\r\n                    { s: 2, label: t('datasource.smart_import.step_config') },\r\n                    { s: 3, label: t('datasource.smart_import.step_import') }\r\n                ].map(({ s, label }) => (\r\n                    <React.Fragment key={s}>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className={`w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-black ${step >= s ? 'bg-blue-600 text-white' : 'bg-slate-200 text-slate-500'}`}>\r\n                                {s}\r\n                            </div>\r\n                            <span className={`text-[10px] font-bold uppercase tracking-wider ${step >= s ? 'text-slate-700' : 'text-slate-400'}`}>\r\n                                {label}\r\n                            </span>\r\n                        </div>\r\n                        {s < 3 && <ChevronRight className=\"w-4 h-4 text-slate-300\" />}\r\n                    </React.Fragment>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Content Area */}\r\n            <div className=\"min-h-[200px]\">\r\n                {step === 1 && (\r\n                    <div\r\n                        onClick={() => fileInputRef.current?.click()}\r\n                        className=\"group relative border-2 border-dashed border-slate-200 hover:border-blue-400 hover:bg-blue-50/50 rounded-2xl p-12 transition-all cursor-pointer text-center\"\r\n                    >\r\n                        <input\r\n                            type=\"file\"\r\n                            ref={fileInputRef}\r\n                            onChange={handleFileSelect}\r\n                            accept=\".xlsx,.xls,.csv\"\r\n                            className=\"hidden\"\r\n                        />\r\n                        <div className=\"flex flex-col items-center gap-4\">\r\n                            <div className=\"p-4 bg-blue-50 group-hover:bg-blue-100 rounded-2xl text-blue-600 transition-colors\">\r\n                                <Upload className=\"w-8 h-8\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm font-bold text-slate-700\">{t('datasource.smart_import.upload_label')}</p>\r\n                                <p className=\"text-xs text-slate-400 mt-1\">{t('datasource.smart_import.upload_hint')}</p>\r\n                            </div>\r\n                        </div>\r\n                        {isAnalyzing && (\r\n                            <div className=\"absolute inset-0 bg-white/80 flex items-center justify-center rounded-2xl z-10\">\r\n                                <div className=\"flex items-center gap-3 text-blue-600\">\r\n                                    <div className=\"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin\" />\r\n                                    <span className=\"text-xs font-bold\">{t('common.loading')}</span>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                {step === 2 && (\r\n                    <div className=\"space-y-4 animate-in fade-in slide-in-from-bottom-2 duration-300\">\r\n                        <div className=\"flex items-center justify-between mb-2\">\r\n                            <div>\r\n                                <h4 className=\"text-sm font-bold text-slate-700\">{t('datasource.smart_import.found_tables')}</h4>\r\n                                <p className=\"text-[10px] text-slate-400\">{t('datasource.smart_import.found_tables_hint')}</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-3\">\r\n                            {previews.map((preview, idx) => (\r\n                                <div key={idx} className={`p-4 rounded-xl border-2 transition-all ${preview.isValid ? 'bg-white border-slate-100 shadow-sm' : 'bg-red-50 border-red-100'}`}>\r\n                                    <div className=\"flex items-start justify-between gap-4\">\r\n                                        <div className=\"flex-1 space-y-3\">\r\n                                            <div className=\"flex items-center gap-4\">\r\n                                                <div className=\"flex-1\">\r\n                                                    <span className=\"text-[9px] font-black text-slate-400 uppercase\">{t('datasource.smart_import.sheet_label')} {preview.sheetName}</span>\r\n                                                    <div className=\"flex items-center gap-2 mt-1\">\r\n                                                        <TableIcon className=\"w-4 h-4 text-blue-500\" />\r\n                                                        <input\r\n                                                            value={preview.tableName}\r\n                                                            onChange={(e) => {\r\n                                                                const newPreviews = [...previews];\r\n                                                                newPreviews[idx].tableName = e.target.value;\r\n                                                                newPreviews[idx].isValid = e.target.value.length > 0 && !e.target.value.startsWith('sys_');\r\n                                                                setPreviews(newPreviews);\r\n                                                            }}\r\n                                                            className={`text-sm font-bold bg-transparent border-b-2 outline-none w-full ${preview.isValid ? 'border-blue-100 focus:border-blue-500' : 'border-red-300'}`}\r\n                                                            placeholder={t('datasource.smart_import.table_label')}\r\n                                                        />\r\n                                                    </div>\r\n                                                    {!preview.isValid && (\r\n                                                        <p className=\"text-[10px] text-red-500 mt-1 flex items-center gap-1\">\r\n                                                            <AlertCircle className=\"w-3 h-3\" /> {t('datasource.smart_import.invalid_prefix')}\r\n                                                        </p>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                                <div className=\"flex items-center gap-2 text-[10px] font-bold text-slate-500\">\r\n                                                    <Database className=\"w-3 h-3\" />\r\n                                                    {t('datasource.smart_import.columns_count', { count: preview.columns.length })}\r\n                                                </div>\r\n                                                <div className=\"flex items-center gap-2 text-[10px] font-bold text-slate-500\">\r\n                                                    <FileSpreadsheet className=\"w-3 h-3\" />\r\n                                                    {t('datasource.smart_import.rows_count', { count: preview.rows.length })}\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            {/* Preview Pill Chips */}\r\n                                            <div className=\"flex flex-wrap gap-1\">\r\n                                                {preview.columns.slice(0, 5).map(col => (\r\n                                                    <span key={col.name} className=\"px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-[9px] font-medium\">\r\n                                                        {col.name} <span className=\"opacity-50 font-mono\">({col.type})</span>\r\n                                                    </span>\r\n                                                ))}\r\n                                                {preview.columns.length > 5 && (\r\n                                                    <span className=\"px-2 py-0.5 bg-slate-100 text-slate-400 rounded text-[9px] font-medium\">{t('datasource.smart_import.more_columns', { count: preview.columns.length - 5 })}</span>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <button\r\n                                            onClick={() => setPreviews(previews.filter((_, i) => i !== idx))}\r\n                                            className=\"p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all\"\r\n                                        >\r\n                                            <Trash2 className=\"w-4 h-4\" />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center justify-between pt-4 border-t border-slate-100\">\r\n                            <button\r\n                                onClick={() => setStep(1)}\r\n                                className=\"px-4 py-2 text-slate-500 font-bold text-xs hover:bg-slate-100 rounded-lg transition-colors\"\r\n                            >\r\n                                {t('datasource.smart_import.back_btn')}\r\n                            </button>\r\n                            <button\r\n                                onClick={() => { setStep(3); handleImport(); }}\r\n                                disabled={previews.length === 0 || previews.some(p => !p.isValid) || isImporting}\r\n                                className=\"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 disabled:opacity-30 disabled:cursor-not-allowed text-white rounded-xl text-xs font-black shadow-lg shadow-blue-500/20 transition-all flex items-center gap-2\"\r\n                            >\r\n                                {t('datasource.smart_import.start_import')} <ChevronRight className=\"w-4 h-4\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {step === 3 && (\r\n                    <div className=\"flex flex-col items-center justify-center p-12 text-center space-y-4\">\r\n                        <div className=\"relative\">\r\n                            <div className=\"w-16 h-16 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin\" />\r\n                            <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                                <Database className=\"w-6 h-6 text-blue-600\" />\r\n                            </div>\r\n                        </div>\r\n                        <div>\r\n                            <h4 className=\"text-sm font-bold text-slate-700\">{t('datasource.smart_import.import_running')}</h4>\r\n                            <p className=\"text-xs text-slate-400 mt-1\">{t('common.loading')}</p>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\SqlAssistant.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\SystemHealthModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7901,7904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7901,7904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7983,7986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7983,7986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8035,8038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8035,8038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { HardDrive, Cpu, Info, RotateCw, CheckCircle, AlertTriangle } from 'lucide-react';\r\nimport { useAsync } from '../../hooks/useAsync';\r\nimport { Modal } from './Modal';\r\nimport { SystemRepository } from '../../lib/repositories/SystemRepository';\r\n\r\ninterface SystemHealthModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const SystemHealthModal: React.FC<SystemHealthModalProps> = ({ isOpen, onClose }) => {\r\n    const { t } = useTranslation();\r\n    const [activeTab, setActiveTab] = useState<'overview' | 'storage' | 'database'>('overview');\r\n    const [storageEst, setStorageEst] = useState<{ quota?: number, usage?: number }>({});\r\n\r\n    // Fetch Diagnostics on modal open\r\n    const { data: diagnostics, loading: diagLoading, refresh: refreshDiag } = useAsync(\r\n        () => SystemRepository.getDiagnostics(),\r\n        [isOpen]\r\n    );\r\n\r\n    const version = __APP_VERSION__;\r\n    const buildDate = __BUILD_DATE__;\r\n\r\n    // Check storage quota\r\n    useEffect(() => {\r\n        if (isOpen && navigator.storage && navigator.storage.estimate) {\r\n            navigator.storage.estimate().then(est => setStorageEst(est));\r\n        }\r\n    }, [isOpen]);\r\n\r\n    // Helper to format bytes\r\n    const formatBytes = (bytes?: number) => {\r\n        if (!bytes) return '0 B';\r\n        const k = 1024;\r\n        const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];\r\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\r\n    };\r\n\r\n    return (\r\n        <Modal\r\n            isOpen={isOpen}\r\n            onClose={onClose}\r\n            title={t('widgets.system_health.title')}\r\n        >\r\n            <div>\r\n                {/* Tabs */}\r\n                <div className=\"flex border-b border-slate-200 dark:border-slate-700 mb-6 sticky top-0 bg-white dark:bg-slate-800 z-10 -mx-6 px-6 pt-2\">\r\n                    <button\r\n                        onClick={() => setActiveTab('overview')}\r\n                        className={`pb-3 px-4 text-sm font-medium transition-colors relative ${activeTab === 'overview' ? 'text-blue-600 dark:text-blue-400' : 'text-slate-500 hover:text-slate-700 dark:hover:text-slate-300'}`}\r\n                    >\r\n                        {t('widgets.system_health.tab_overview')}\r\n                        {activeTab === 'overview' && <div className=\"absolute bottom-0 left-0 w-full h-0.5 bg-blue-600 dark:bg-blue-400 rounded-t-full\" />}\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveTab('storage')}\r\n                        className={`pb-3 px-4 text-sm font-medium transition-colors relative ${activeTab === 'storage' ? 'text-blue-600 dark:text-blue-400' : 'text-slate-500 hover:text-slate-700 dark:hover:text-slate-300'}`}\r\n                    >\r\n                        {t('widgets.system_health.tab_storage')}\r\n                        {activeTab === 'storage' && <div className=\"absolute bottom-0 left-0 w-full h-0.5 bg-blue-600 dark:bg-blue-400 rounded-t-full\" />}\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveTab('database')}\r\n                        className={`pb-3 px-4 text-sm font-medium transition-colors relative ${activeTab === 'database' ? 'text-blue-600 dark:text-blue-400' : 'text-slate-500 hover:text-slate-700 dark:hover:text-slate-300'}`}\r\n                    >\r\n                        {t('widgets.system_health.tab_database')}\r\n                        {activeTab === 'database' && <div className=\"absolute bottom-0 left-0 w-full h-0.5 bg-blue-600 dark:bg-blue-400 rounded-t-full\" />}\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"min-h-[300px]\">\r\n                    {/* OVERVIEW TAB */}\r\n                    {activeTab === 'overview' && (\r\n                        <div className=\"space-y-4 animate-in fade-in slide-in-from-bottom-2 duration-300\">\r\n                            <div className=\"bg-slate-50 dark:bg-slate-900/50 p-4 rounded-xl border border-slate-100 dark:border-slate-800\">\r\n                                <h4 className=\"text-sm font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2\">\r\n                                    <Cpu className=\"w-4 h-4 text-indigo-500\" />\r\n                                    {t('widgets.system_health.app_environment')}\r\n                                </h4>\r\n                                <div className=\"space-y-2 text-sm\">\r\n                                    <div className=\"flex justify-between border-b border-slate-200 dark:border-slate-700/50 pb-2\">\r\n                                        <span className=\"text-slate-500 dark:text-slate-400\">{t('widgets.system_health.version')}</span>\r\n                                        <span className=\"font-mono font-medium text-slate-900 dark:text-white\">{version}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between border-b border-slate-200 dark:border-slate-700/50 pb-2\">\r\n                                        <span className=\"text-slate-500 dark:text-slate-400\">{t('widgets.system_health.build_date')}</span>\r\n                                        <span className=\"font-mono font-medium text-slate-900 dark:text-white\">{buildDate}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between border-b border-slate-200 dark:border-slate-700/50 pb-2\">\r\n                                        <span className=\"text-slate-500 dark:text-slate-400\">{t('widgets.system_health.environment')}</span>\r\n                                        <span className=\"font-mono font-medium text-slate-900 dark:text-white uppercase text-xs bg-slate-200 dark:bg-slate-700 px-2 py-0.5 rounded\">{import.meta.env.MODE}</span>\r\n                                    </div>\r\n                                    <div className=\"flex flex-col gap-1 pb-1\">\r\n                                        <span className=\"text-slate-500 dark:text-slate-400\">{t('widgets.system_health.user_agent')}</span>\r\n                                        <div className=\"font-mono text-[10px] text-slate-500 dark:text-slate-400 break-all bg-slate-100 dark:bg-slate-900/50 p-2 rounded border border-slate-200 dark:border-slate-800/50\">\r\n                                            {navigator.userAgent}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"p-4 rounded-xl bg-blue-50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-900/30\">\r\n                                    <div className=\"text-xs text-blue-600 dark:text-blue-400 font-bold uppercase mb-1\">{t('widgets.system_health.cpu_cores')}</div>\r\n                                    <div className=\"text-2xl font-black text-blue-700 dark:text-blue-300\">\r\n                                        {navigator.hardwareConcurrency || '?'}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"p-4 rounded-xl bg-purple-50 dark:bg-purple-900/10 border border-purple-100 dark:border-purple-900/30\">\r\n                                    <div className=\"text-xs text-purple-600 dark:text-purple-400 font-bold uppercase mb-1\">{t('widgets.system_health.device_memory')}</div>\r\n                                    <div className=\"text-2xl font-black text-purple-700 dark:text-purple-300\" title={t('widgets.system_health.memory_limit_hint')}>\r\n                                        {(navigator as any).deviceMemory ?\r\n                                            `${(navigator as any).deviceMemory >= 8 ? ' ' : '~'}${(navigator as any).deviceMemory} GB`\r\n                                            : '?'}\r\n                                    </div>\r\n                                    <div className=\"text-[9px] text-purple-400 dark:text-purple-500 mt-1 leading-tight\">\r\n                                        {t('widgets.system_health.memory_limit_hint')}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* STORAGE TAB */}\r\n                    {activeTab === 'storage' && (\r\n                        <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-2 duration-300\">\r\n                            <div className=\"p-6 rounded-2xl bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 border border-slate-200 dark:border-slate-700 text-center\">\r\n                                <HardDrive className=\"w-12 h-12 text-slate-400 mx-auto mb-4\" />\r\n                                {storageEst.quota ? (\r\n                                    <>\r\n                                        <div className=\"text-xs font-bold text-slate-500 uppercase tracking-widest mb-1\">{t('widgets.system_health.used_storage')}</div>\r\n                                        <div className=\"text-3xl font-black text-slate-900 dark:text-white mb-4\">\r\n                                            {formatBytes(storageEst.usage)}\r\n                                        </div>\r\n\r\n                                        <div className=\"text-xs font-bold text-slate-400 uppercase tracking-widest mb-1\">{t('widgets.system_health.max_available')}</div>\r\n                                        <div className=\"text-sm text-slate-600 dark:text-slate-300 mb-6 font-mono\">\r\n                                            {formatBytes(storageEst.quota)}\r\n                                        </div>\r\n\r\n                                        {/* Progress Bar */}\r\n                                        <div className=\"relative h-2 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden max-w-xs mx-auto mb-2\">\r\n                                            <div\r\n                                                className=\"absolute top-0 left-0 h-full bg-blue-500 transition-all duration-1000\"\r\n                                                style={{ width: `${Math.min(100, Math.max(1, ((storageEst.usage || 0) / (storageEst.quota || 1)) * 100))}%` }}\r\n                                            />\r\n                                        </div>\r\n                                        <div className=\"text-[10px] text-slate-400\">\r\n                                            {t('widgets.system_health.quota_used', { percent: ((storageEst.usage || 0) / (storageEst.quota || 1) * 100).toFixed(6) })}\r\n                                        </div>\r\n                                    </>\r\n                                ) : (\r\n                                    <div className=\"text-slate-500 italic\">{t('widgets.system_health.no_storage_info')}</div>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"flex gap-4 p-4 bg-amber-50 dark:bg-amber-900/10 border border-amber-100 dark:border-amber-900/30 rounded-xl\">\r\n                                <Info className=\"w-5 h-5 text-amber-600 dark:text-amber-400 shrink-0 mt-0.5\" />\r\n                                <div className=\"text-xs text-amber-800 dark:text-amber-300\">\r\n                                    <p className=\"font-bold mb-1\">{t('widgets.system_health.opfs_title')}</p>\r\n                                    <p>\r\n                                        {t('widgets.system_health.opfs_description')}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* DATABASE TAB */}\r\n                    {activeTab === 'database' && (\r\n                        <div className=\"space-y-4 animate-in fade-in slide-in-from-bottom-2 duration-300\">\r\n                            {diagLoading ? (\r\n                                <div className=\"flex flex-col items-center justify-center py-12 text-slate-400\">\r\n                                    <RotateCw className=\"w-8 h-8 animate-spin mb-2\" />\r\n                                    <p>{t('widgets.system_health.analyzing_db')}</p>\r\n                                </div>\r\n                            ) : diagnostics ? (\r\n                                <>\r\n                                    <div className=\"grid grid-cols-2 gap-4\">\r\n                                        <div className=\"bg-emerald-50 dark:bg-emerald-900/10 p-4 rounded-xl border border-emerald-100 dark:border-emerald-900/30\">\r\n                                            <div className=\"text-xs text-emerald-600 dark:text-emerald-400 font-bold uppercase mb-1\">{t('widgets.system_health.db_size')}</div>\r\n                                            <div className=\"text-2xl font-black text-emerald-700 dark:text-emerald-300\">\r\n                                                {formatBytes(diagnostics.dbSize)}\r\n                                            </div>\r\n                                            <div className=\"text-[10px] text-emerald-600/70 mt-1 font-mono\">\r\n                                                {diagnostics.pageCount} Pages @ {diagnostics.pageSize} Bytes\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"bg-slate-50 dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 flex flex-col justify-center items-center text-center\">\r\n                                            <div className=\"flex items-center gap-2 text-green-600 dark:text-green-400 mb-1\">\r\n                                                <CheckCircle className=\"w-5 h-5\" />\r\n                                                <span className=\"font-bold\">{t('widgets.system_health.connected')}</span>\r\n                                            </div>\r\n                                            <div className=\"text-xs text-slate-400\">{t('widgets.system_health.worker_active')}</div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden\">\r\n                                        <div className=\"bg-slate-50 dark:bg-slate-800/50 px-4 py-2 border-b border-slate-200 dark:border-slate-700 text-xs font-bold text-slate-500 uppercase tracking-wider\">\r\n                                            {t('widgets.system_health.table_stats')}\r\n                                        </div>\r\n                                        <div className=\"divide-y divide-slate-100 dark:divide-slate-800 max-h-[400px] overflow-auto\">\r\n                                            {/* User Tables */}\r\n                                            {Object.entries(diagnostics.tableStats || {})\r\n                                                .filter(([table]) => !table.startsWith('sys_') && !table.startsWith('sqlite_'))\r\n                                                .length > 0 && (\r\n                                                    <div className=\"bg-blue-50/30 dark:bg-blue-900/10 px-4 py-1.5 text-[10px] font-bold text-blue-600 dark:text-blue-400 uppercase tracking-tight\">\r\n                                                        {t('widgets.system_health.user_tables')}\r\n                                                    </div>\r\n                                                )}\r\n                                            {Object.entries(diagnostics.tableStats || {})\r\n                                                .filter(([table]) => !table.startsWith('sys_') && !table.startsWith('sqlite_'))\r\n                                                .map(([table, count]) => (\r\n                                                    <div key={table} className=\"flex justify-between px-4 py-3 text-sm hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors\">\r\n                                                        <span className=\"font-mono text-slate-700 dark:text-slate-200\">{table}</span>\r\n                                                        <span className=\"font-bold text-slate-900 dark:text-white\">{(count as number).toLocaleString()}</span>\r\n                                                    </div>\r\n                                                ))}\r\n\r\n                                            {/* System Tables */}\r\n                                            <div className=\"bg-slate-100 dark:bg-slate-800/80 px-4 py-1.5 text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase tracking-tight\">\r\n                                                {t('widgets.system_health.system_tables')}\r\n                                            </div>\r\n                                            {Object.entries(diagnostics.tableStats || {})\r\n                                                .filter(([table]) => table.startsWith('sys_') || table.startsWith('sqlite_'))\r\n                                                .map(([table, count]) => (\r\n                                                    <div key={table} className=\"flex justify-between px-4 py-3 text-sm opacity-70 hover:opacity-100 transition-opacity\">\r\n                                                        <span className=\"font-mono text-slate-500 dark:text-slate-400 text-xs\">{table}</span>\r\n                                                        <span className=\"font-medium text-slate-700 dark:text-slate-300\">{(count as number).toLocaleString()}</span>\r\n                                                    </div>\r\n                                                ))}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"flex justify-end pt-2\">\r\n                                        <button\r\n                                            onClick={refreshDiag}\r\n                                            className=\"flex items-center gap-2 px-4 py-2 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-lg text-xs font-bold transition-colors\"\r\n                                        >\r\n                                            <RotateCw className=\"w-3.5 h-3.5\" />\r\n                                            {t('widgets.system_health.refresh_diag')}\r\n                                        </button>\r\n                                    </div>\r\n                                </>\r\n                            ) : (\r\n                                <div className=\"flex flex-col items-center justify-center py-12 text-red-400\">\r\n                                    <AlertTriangle className=\"w-8 h-8 mb-2\" />\r\n                                    <p>{t('widgets.system_health.diag_failed')}</p>\r\n                                    <button onClick={refreshDiag} className=\"mt-4 text-blue-500 underline text-sm\">{t('widgets.system_health.retry')}</button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </Modal>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\SystemStatus.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\VisualQueryBuilder.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'config.table'. Either include it or remove the dependency array.","line":63,"column":8,"nodeType":"ArrayExpression","endLine":63,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [config.table]","fix":{"range":[2080,2082],"text":"[config.table]"}}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":69,"column":17,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":69,"endColumn":52,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[2272,2307],"text":"// @ts-expect-error - PRAGMA info mapping"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`generateSQL` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\github\\litebistudio\\src\\app\\components\\VisualQueryBuilder.tsx:77:21\n  75 |     // SQL Generation\n  76 |     useEffect(() => {\n> 77 |         const sql = generateSQL(config);\n     |                     ^^^^^^^^^^^ `generateSQL` accessed before it is declared\n  78 |         onChange(sql, config);\n  79 |     }, [config, columns]);\n  80 |\n\nC:\\github\\litebistudio\\src\\app\\components\\VisualQueryBuilder.tsx:81:5\n   79 |     }, [config, columns]);\n   80 |\n>  81 |     const generateSQL = (cfg: QueryConfig): string => {\n      |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  82 |         if (!cfg.table) return '';\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  83 |\n      \n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 128 |         return sql;\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 129 |     };\n      | ^^^^^^^ `generateSQL` is declared here\n  130 |\n  131 |     const toggleColumn = (col: string) => {\n  132 |         setConfig(prev => ({","line":77,"column":21,"nodeType":null,"endLine":77,"endColumn":32},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'generateSQL' and 'onChange'. Either include them or remove the dependency array. If 'onChange' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":79,"column":8,"nodeType":"ArrayExpression","endLine":79,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [config, columns, generateSQL, onChange]","fix":{"range":[2585,2602],"text":"[config, columns, generateSQL, onChange]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5084,5087],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5084,5087],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":332,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17022,17025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17022,17025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Plus, Trash2, Filter, Layers, Database, Hash, Type, Calendar, Search, ChevronDown, ChevronUp } from 'lucide-react';\r\nimport { SystemRepository } from '../../lib/repositories/SystemRepository';\r\n\r\nexport interface QueryConfig {\r\n    table: string;\r\n    columns: string[];\r\n    filters: {\r\n        column: string;\r\n        operator: '=' | '!=' | '>' | '<' | 'contains' | 'is null' | 'is not null';\r\n        value: string;\r\n    }[];\r\n    filterLogic?: 'AND' | 'OR';\r\n    aggregations: {\r\n        column: string;\r\n        type: 'sum' | 'avg' | 'count' | 'min' | 'max';\r\n        alias?: string;\r\n    }[];\r\n    groupBy: string[];\r\n    orderBy: { column: string; direction: 'ASC' | 'DESC' }[];\r\n    limit: number;\r\n}\r\n\r\ninterface VisualQueryBuilderProps {\r\n    onChange: (sql: string, config: QueryConfig) => void;\r\n    initialConfig?: QueryConfig;\r\n}\r\n\r\nexport const VisualQueryBuilder: React.FC<VisualQueryBuilderProps> = ({ onChange, initialConfig }) => {\r\n    const [tables, setTables] = useState<string[]>([]);\r\n    const [columns, setColumns] = useState<{ name: string; type: string }[]>([]);\r\n    const [config, setConfig] = useState<QueryConfig>(initialConfig || {\r\n        table: '',\r\n        columns: [],\r\n        filters: [],\r\n        aggregations: [],\r\n        groupBy: [],\r\n        orderBy: [],\r\n        limit: 100,\r\n        filterLogic: 'AND'\r\n    });\r\n\r\n    // UI State\r\n    const [search, setSearch] = useState('');\r\n    const [openSections, setOpenSections] = useState<Record<string, boolean>>({\r\n        filters: true,\r\n        aggregations: false,\r\n        sorting: false\r\n    });\r\n\r\n    const toggleSection = (id: string) => {\r\n        setOpenSections(prev => ({ ...prev, [id]: !prev[id] }));\r\n    };\r\n\r\n    // Load tables\r\n    useEffect(() => {\r\n        SystemRepository.getTables().then(allTables => {\r\n            setTables(allTables);\r\n            if (!config.table && allTables.length > 0) {\r\n                setConfig(prev => ({ ...prev, table: allTables[0] }));\r\n            }\r\n        });\r\n    }, []);\r\n\r\n    // Load columns when table changes\r\n    useEffect(() => {\r\n        if (config.table) {\r\n            SystemRepository.getTableSchema(config.table).then(schema => {\r\n                // @ts-ignore - PRAGMA info mapping\r\n                setColumns(schema.map(c => ({ name: c.name, type: c.type.toLowerCase() })));\r\n            });\r\n        }\r\n    }, [config.table]);\r\n\r\n    // SQL Generation\r\n    useEffect(() => {\r\n        const sql = generateSQL(config);\r\n        onChange(sql, config);\r\n    }, [config, columns]);\r\n\r\n    const generateSQL = (cfg: QueryConfig): string => {\r\n        if (!cfg.table) return '';\r\n\r\n        let select = cfg.columns.length > 0 ? cfg.columns.join(', ') : '*';\r\n\r\n        if (cfg.aggregations.length > 0) {\r\n            const aggs = cfg.aggregations.map(a => `${a.type.toUpperCase()}(${a.column}) AS ${a.alias || `${a.type}_${a.column}`}`);\r\n            if (cfg.columns.length > 0) {\r\n                select = [...cfg.columns, ...aggs].join(', ');\r\n            } else {\r\n                select = aggs.join(', ');\r\n            }\r\n        }\r\n\r\n        let sql = `SELECT ${select} FROM ${cfg.table}`;\r\n\r\n        if (cfg.filters.length > 0) {\r\n            const filters = cfg.filters.map(f => {\r\n                let val = f.value;\r\n                if (f.operator === 'contains') return `${f.column} LIKE '%${val.replace(/'/g, \"''\")}%'`;\r\n                if (f.operator === 'is null') return `${f.column} IS NULL`;\r\n                if (f.operator === 'is not null') return `${f.column} IS NOT NULL`;\r\n\r\n                // Quote string values\r\n                const colType = columns.find(c => c.name === f.column)?.type || '';\r\n                if (colType.includes('char') || colType.includes('text')) {\r\n                    val = `'${val.replace(/'/g, \"''\")}'`;\r\n                }\r\n                return `${f.column} ${f.operator} ${val}`;\r\n            });\r\n            const logic = cfg.filterLogic || 'AND';\r\n            sql += ` WHERE ${filters.join(` ${logic} `)}`;\r\n        }\r\n\r\n        if (cfg.groupBy.length > 0) {\r\n            sql += ` GROUP BY ${cfg.groupBy.join(', ')}`;\r\n        }\r\n\r\n        if (cfg.orderBy.length > 0) {\r\n            const orders = cfg.orderBy.map(o => `${o.column} ${o.direction}`);\r\n            sql += ` ORDER BY ${orders.join(', ')}`;\r\n        }\r\n\r\n        if (cfg.limit) {\r\n            sql += ` LIMIT ${cfg.limit}`;\r\n        }\r\n\r\n        return sql;\r\n    };\r\n\r\n    const toggleColumn = (col: string) => {\r\n        setConfig(prev => ({\r\n            ...prev,\r\n            columns: prev.columns.includes(col)\r\n                ? prev.columns.filter(c => c !== col)\r\n                : [...prev.columns, col]\r\n        }));\r\n    };\r\n\r\n    const addFilter = () => {\r\n        if (columns.length === 0) return;\r\n        setConfig(prev => ({\r\n            ...prev,\r\n            filters: [...prev.filters, { column: columns[0].name, operator: '=', value: '' }]\r\n        }));\r\n    };\r\n\r\n    const updateFilter = (index: number, field: string, value: any) => {\r\n        setConfig(prev => {\r\n            const newFilters = [...prev.filters];\r\n            newFilters[index] = { ...newFilters[index], [field]: value };\r\n            return { ...prev, filters: newFilters };\r\n        });\r\n    };\r\n\r\n    const removeFilter = (index: number) => {\r\n        setConfig(prev => ({ ...prev, filters: prev.filters.filter((_, i) => i !== index) }));\r\n    };\r\n\r\n    const addAggregation = () => {\r\n        if (columns.length === 0) return;\r\n        setConfig(prev => ({\r\n            ...prev,\r\n            aggregations: [...prev.aggregations, { column: columns[0].name, type: 'sum' }]\r\n        }));\r\n    };\r\n\r\n    const removeAggregation = (index: number) => {\r\n        setConfig(prev => ({ ...prev, aggregations: prev.aggregations.filter((_, i) => i !== index) }));\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Table Selection */}\r\n            <div className=\"flex items-center gap-4 bg-slate-50 dark:bg-slate-900/50 p-4 rounded-xl border border-slate-200 dark:border-slate-800\">\r\n                <div className=\"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600\">\r\n                    <Database className=\"w-5 h-5\" />\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                    <label className=\"block text-[10px] font-black uppercase text-slate-400 mb-1\">Datenquelle / Tabelle</label>\r\n                    <select\r\n                        value={config.table}\r\n                        onChange={e => setConfig({ ...config, table: e.target.value, columns: [], filters: [], aggregations: [], groupBy: [] })}\r\n                        className=\"bg-transparent text-sm font-bold text-slate-900 dark:text-white outline-none w-full cursor-pointer\"\r\n                    >\r\n                        {tables.map(t => <option key={t} value={t}>{t}</option>)}\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Column Selection */}\r\n            <div className=\"space-y-3\">\r\n                <div className=\"flex items-center justify-between gap-4\">\r\n                    <h4 className=\"text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2\">\r\n                        <Layers className=\"w-4 h-4\" /> Spalten\r\n                    </h4>\r\n                    <div className=\"relative flex-1 max-w-[150px]\">\r\n                        <Search className=\"absolute left-2 top-1/2 -translate-y-1/2 w-3 h-3 text-slate-400\" />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Suchen...\"\r\n                            value={search}\r\n                            onChange={e => setSearch(e.target.value)}\r\n                            className=\"w-full pl-7 pr-2 py-1 text-[10px] bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-md outline-none focus:ring-1 focus:ring-blue-500\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex flex-wrap gap-1.5 max-h-[120px] overflow-y-auto pr-1 custom-scrollbar\">\r\n                    {columns.filter(c => c.name.toLowerCase().includes(search.toLowerCase())).map(col => {\r\n                        const isSelected = config.columns.includes(col.name);\r\n                        return (\r\n                            <button\r\n                                key={col.name}\r\n                                onClick={() => toggleColumn(col.name)}\r\n                                className={`\r\n                                    flex items-center gap-1.5 px-2 py-1 rounded-md text-[10px] font-medium border transition-all\r\n                                    ${isSelected\r\n                                        ? 'bg-blue-600 border-blue-600 text-white shadow-sm'\r\n                                        : 'bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-400 hover:border-blue-400'}\r\n                                `}\r\n                            >\r\n                                {col.type.includes('int') || col.type.includes('real') ? <Hash className=\"w-2.5 h-2.5 opacity-60\" /> : col.type.includes('date') ? <Calendar className=\"w-2.5 h-2.5 opacity-60\" /> : <Type className=\"w-2.5 h-2.5 opacity-60\" />}\r\n                                {col.name}\r\n                            </button>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"border-t border-slate-100 dark:border-slate-800 pt-4\">\r\n                <button\r\n                    onClick={() => toggleSection('filters')}\r\n                    className=\"w-full flex items-center justify-between mb-3 group\"\r\n                >\r\n                    <h4 className=\"text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2\">\r\n                        <Filter className=\"w-4 h-4\" /> Filter ({config.filters.length})\r\n                    </h4>\r\n                    {openSections.filters ? <ChevronUp className=\"w-4 h-4 text-slate-300 group-hover:text-slate-500\" /> : <ChevronDown className=\"w-4 h-4 text-slate-300 group-hover:text-slate-500\" />}\r\n                </button>\r\n\r\n                {openSections.filters && (\r\n                    <div className=\"space-y-2 animate-in fade-in slide-in-from-top-1 duration-200\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            {config.filters.length > 1 && (\r\n                                <div className=\"flex items-center p-0.5 bg-slate-100 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700\">\r\n                                    <button\r\n                                        onClick={() => setConfig({ ...config, filterLogic: 'AND' })}\r\n                                        className={`px-3 py-1 text-[9px] font-black rounded-md transition-all ${config.filterLogic === 'AND' ? 'bg-white dark:bg-slate-700 text-blue-600 shadow-sm' : 'text-slate-400 hover:text-slate-600'}`}\r\n                                    >\r\n                                        ALLE (UND)\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => setConfig({ ...config, filterLogic: 'OR' })}\r\n                                        className={`px-3 py-1 text-[9px] font-black rounded-md transition-all ${config.filterLogic === 'OR' ? 'bg-white dark:bg-slate-700 text-blue-600 shadow-sm' : 'text-slate-400 hover:text-slate-600'}`}\r\n                                    >\r\n                                        EINE (ODER)\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                            <div className=\"flex-1\" />\r\n                            <button onClick={addFilter} className=\"p-1 px-2 text-[10px] font-bold bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 text-slate-600 rounded flex items-center gap-1 transition-colors\">\r\n                                <Plus className=\"w-3 h-3\" /> Filter hinzufgen\r\n                            </button>\r\n                        </div>\r\n                        {config.filters.map((f, i) => (\r\n                            <div key={i} className=\"flex items-center gap-2\">\r\n                                <select\r\n                                    value={f.column}\r\n                                    onChange={e => updateFilter(i, 'column', e.target.value)}\r\n                                    className=\"flex-1 min-w-0 p-1.5 text-[10px] bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded outline-none focus:ring-1 focus:ring-blue-500\"\r\n                                >\r\n                                    {columns.map(c => <option key={c.name} value={c.name}>{c.name}</option>)}\r\n                                </select>\r\n                                <select\r\n                                    value={f.operator}\r\n                                    onChange={e => updateFilter(i, 'operator', e.target.value)}\r\n                                    className=\"w-20 p-1.5 text-[10px] bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded outline-none focus:ring-1 focus:ring-blue-500\"\r\n                                >\r\n                                    <option value=\"=\">=</option>\r\n                                    <option value=\"!=\">!=</option>\r\n                                    <option value=\">\">&gt;</option>\r\n                                    <option value=\"<\">&lt;</option>\r\n                                    <option value=\"contains\">enthlt</option>\r\n                                    <option value=\"is null\">ist leer</option>\r\n                                    <option value=\"is not null\">nicht leer</option>\r\n                                </select>\r\n                                {!f.operator.includes('null') && (\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={f.value}\r\n                                        onChange={e => updateFilter(i, 'value', e.target.value)}\r\n                                        placeholder=\"Wert...\"\r\n                                        className=\"flex-1 min-w-0 p-1.5 text-[10px] bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded outline-none focus:ring-1 focus:ring-blue-500\"\r\n                                    />\r\n                                )}\r\n                                <button onClick={() => removeFilter(i)} className=\"p-1.5 text-slate-300 hover:text-red-500 transition-colors\">\r\n                                    <Trash2 className=\"w-3.5 h-3.5\" />\r\n                                </button>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Aggregations */}\r\n            <div className=\"border-t border-slate-100 dark:border-slate-800 pt-4\">\r\n                <button\r\n                    onClick={() => toggleSection('aggregations')}\r\n                    className=\"w-full flex items-center justify-between mb-3 group\"\r\n                >\r\n                    <h4 className=\"text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2\">\r\n                        <Layers className=\"w-4 h-4\" /> Aggregation ({config.aggregations.length})\r\n                    </h4>\r\n                    {openSections.aggregations ? <ChevronUp className=\"w-4 h-4 text-slate-300 group-hover:text-slate-500\" /> : <ChevronDown className=\"w-4 h-4 text-slate-300 group-hover:text-slate-500\" />}\r\n                </button>\r\n\r\n                {openSections.aggregations && (\r\n                    <div className=\"space-y-3 animate-in fade-in slide-in-from-top-1 duration-200\">\r\n                        <div className=\"flex justify-end\">\r\n                            <button onClick={addAggregation} className=\"p-1 px-2 text-[10px] font-bold bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 text-slate-600 rounded flex items-center gap-1 transition-colors\">\r\n                                <Plus className=\"w-3 h-3\" /> Aggregation hinzufgen\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            {config.aggregations.map((a, i) => (\r\n                                <div key={i} className=\"flex items-center gap-2\">\r\n                                    <select\r\n                                        value={a.type}\r\n                                        onChange={e => {\r\n                                            const newAggs = [...config.aggregations];\r\n                                            newAggs[i].type = e.target.value as any;\r\n                                            setConfig({ ...config, aggregations: newAggs });\r\n                                        }}\r\n                                        className=\"w-20 p-1.5 text-[10px] bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded outline-none focus:ring-1 focus:ring-blue-500\"\r\n                                    >\r\n                                        <option value=\"sum\">Summe</option>\r\n                                        <option value=\"avg\">Durchschn.</option>\r\n                                        <option value=\"count\">Anzahl</option>\r\n                                        <option value=\"min\">Min</option>\r\n                                        <option value=\"max\">Max</option>\r\n                                    </select>\r\n                                    <span className=\"text-[9px] font-bold text-slate-400 uppercase\">von</span>\r\n                                    <select\r\n                                        value={a.column}\r\n                                        onChange={e => {\r\n                                            const newAggs = [...config.aggregations];\r\n                                            newAggs[i].column = e.target.value;\r\n                                            setConfig({ ...config, aggregations: newAggs });\r\n                                        }}\r\n                                        className=\"flex-1 p-1.5 text-[10px] bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded outline-none focus:ring-1 focus:ring-blue-500\"\r\n                                    >\r\n                                        {columns.map(c => <option key={c.name} value={c.name}>{c.name}</option>)}\r\n                                    </select>\r\n                                    <button onClick={() => removeAggregation(i)} className=\"p-1.5 text-slate-300 hover:text-red-500 transition-colors\">\r\n                                        <Trash2 className=\"w-3.5 h-3.5\" />\r\n                                    </button>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n\r\n                        {config.aggregations.length > 0 && (\r\n                            <div className=\"p-3 bg-slate-50 dark:bg-slate-900/40 rounded-lg border border-slate-100 dark:border-slate-800\">\r\n                                <label className=\"block text-[9px] font-black uppercase text-slate-400 mb-2\">Gruppieren nach</label>\r\n                                <div className=\"flex flex-wrap gap-1\">\r\n                                    {columns.map(col => {\r\n                                        const isGrouped = config.groupBy.includes(col.name);\r\n                                        return (\r\n                                            <button\r\n                                                key={col.name}\r\n                                                onClick={() => {\r\n                                                    setConfig(prev => ({\r\n                                                        ...prev,\r\n                                                        groupBy: isGrouped ? prev.groupBy.filter(c => c !== col.name) : [...prev.groupBy, col.name]\r\n                                                    }));\r\n                                                }}\r\n                                                className={`px-1.5 py-0.5 rounded text-[9px] font-bold transition-all ${isGrouped ? 'bg-slate-900 text-white shadow-sm' : 'bg-white dark:bg-slate-800 text-slate-500 border border-slate-200 dark:border-slate-700 hover:border-slate-300'}`}\r\n                                            >\r\n                                                {col.name}\r\n                                            </button>\r\n                                        );\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Sort & Limit */}\r\n            <div className=\"border-t border-slate-100 dark:border-slate-800 pt-4 pb-2\">\r\n                <button\r\n                    onClick={() => toggleSection('sorting')}\r\n                    className=\"w-full flex items-center justify-between mb-3 group\"\r\n                >\r\n                    <h4 className=\"text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2\">\r\n                        <Layers className=\"w-4 h-4\" /> Sortierung & Limit\r\n                    </h4>\r\n                    {openSections.sorting ? <ChevronUp className=\"w-4 h-4 text-slate-300 group-hover:text-slate-500\" /> : <ChevronDown className=\"w-4 h-4 text-slate-300 group-hover:text-slate-500\" />}\r\n                </button>\r\n\r\n                {openSections.sorting && (\r\n                    <div className=\"flex gap-4 animate-in fade-in slide-in-from-top-1 duration-200\">\r\n                        <div className=\"flex-1\">\r\n                            <label className=\"block text-[9px] font-black uppercase text-slate-400 mb-1\">LIMIT</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={config.limit}\r\n                                onChange={e => setConfig({ ...config, limit: parseInt(e.target.value, 10) || 0 })}\r\n                                className=\"w-full p-1.5 text-[10px] bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded outline-none focus:ring-1 focus:ring-blue-500\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"flex-1\">\r\n                            <label className=\"block text-[9px] font-black uppercase text-slate-400 mb-1\">Sortierung</label>\r\n                            <select\r\n                                value={config.orderBy[0]?.column || ''}\r\n                                onChange={e => setConfig({ ...config, orderBy: e.target.value ? [{ column: e.target.value, direction: 'DESC' }] : [] })}\r\n                                className=\"w-full p-1.5 text-[10px] bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded outline-none focus:ring-1 focus:ring-blue-500\"\r\n                            >\r\n                                <option value=\"\">Keine</option>\r\n                                {columns.map(c => <option key={c.name} value={c.name}>{c.name}</option>)}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\WidgetRenderer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1361,1364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1361,1364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3612,3615],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3612,3615],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4468,4471],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4468,4471],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has a missing dependency: 't'. Either include it or remove the dependency array.","line":98,"column":8,"nodeType":"ArrayExpression","endLine":98,"endColumn":29,"suggestions":[{"desc":"Update the dependencies array to be: [results, sql, t, title]","fix":{"range":[4547,4568],"text":"[results, sql, t, title]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":105,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4804,4807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4804,4807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":226,"column":184,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":187,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12408,12411],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12408,12411],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":242,"column":196,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":199,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14124,14127],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14124,14127],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":266,"column":184,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":187,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16611,16614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16611,16614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":304,"column":188,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":304,"endColumn":191,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19667,19670],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19667,19670],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":308,"column":188,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":308,"endColumn":191,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20104,20107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20104,20107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useAsync } from '../../hooks/useAsync';\r\nimport { SystemRepository } from '../../lib/repositories/SystemRepository';\r\nimport { DataTable } from '../../components/ui/DataTable';\r\nimport {\r\n    BarChart, Bar, LineChart, Line, AreaChart, Area, PieChart, Pie, Cell,\r\n    XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend,\r\n    ComposedChart, RadarChart, Radar, PolarGrid, PolarAngleAxis, PolarRadiusAxis,\r\n    ScatterChart, Scatter, LabelList\r\n} from 'recharts';\r\nimport { Loader2, AlertCircle, BarChart3 } from 'lucide-react';\r\nimport { RecordDetailModal } from './RecordDetailModal';\r\nimport { formatValue } from '../utils/formatUtils';\r\nimport { type WidgetConfig } from '../../types';\r\nimport { PivotTable } from './PivotTable';\r\n\r\ninterface FilterDef {\r\n    column: string;\r\n    operator: string;\r\n    value: string;\r\n}\r\n\r\ninterface WidgetRendererProps {\r\n    title: string;\r\n    sql: string;\r\n    config: WidgetConfig;\r\n    globalFilters?: FilterDef[];\r\n}\r\n\r\nconst COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8', '#82ca9d'];\r\n\r\nexport const WidgetRenderer: React.FC<WidgetRendererProps> = ({ title, sql, config, globalFilters }) => {\r\n    const { t } = useTranslation();\r\n    const { data: results, loading, error } = useAsync<any[]>(\r\n        async () => {\r\n            if (!sql) return [];\r\n            let effectiveSql = sql;\r\n\r\n            // Inject Global Filters\r\n            if (globalFilters && globalFilters.length > 0) {\r\n                const activeFilters = globalFilters.filter(f => f.column && (f.operator === 'is null' || f.value));\r\n                if (activeFilters.length > 0) {\r\n                    const whereClause = activeFilters.map(f => {\r\n                        const col = `\"${f.column.replace(/\"/g, '\"\"')}\"`;\r\n                        const val = typeof f.value === 'string' ? `'${f.value.replace(/'/g, \"''\")}'` : f.value;\r\n                        const op = f.operator === 'contains' ? 'LIKE' : (f.operator === 'is null' ? 'IS NULL' : f.operator);\r\n\r\n                        if (f.operator === 'is null') return `${col} IS NULL`;\r\n\r\n                        const finalVal = f.operator === 'contains' ? `'%${f.value}%'` : val;\r\n                        return `${col} ${op} ${finalVal}`;\r\n                    }).join(' AND ');\r\n\r\n                    if (effectiveSql.toUpperCase().includes('WHERE')) {\r\n                        effectiveSql = effectiveSql.replace(/WHERE/i, `WHERE (${whereClause}) AND `);\r\n                    } else if (effectiveSql.toUpperCase().includes('GROUP BY')) {\r\n                        effectiveSql = effectiveSql.replace(/GROUP BY/i, `WHERE ${whereClause} GROUP BY `);\r\n                    } else if (effectiveSql.toUpperCase().includes('ORDER BY')) {\r\n                        effectiveSql = effectiveSql.replace(/ORDER BY/i, `WHERE ${whereClause} ORDER BY `);\r\n                    } else if (effectiveSql.toUpperCase().includes('LIMIT')) {\r\n                        effectiveSql = effectiveSql.replace(/LIMIT/i, `WHERE ${whereClause} LIMIT `);\r\n                    } else {\r\n                        effectiveSql += ` WHERE ${whereClause}`;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return await SystemRepository.executeRaw(effectiveSql);\r\n        },\r\n        [sql, globalFilters]\r\n    );\r\n\r\n    const [isDetailOpen, setIsDetailOpen] = React.useState(false);\r\n    const [selectedItemIndex, setSelectedItemIndex] = React.useState(0);\r\n    const [dynamicSchema, setDynamicSchema] = React.useState<any>(null);\r\n\r\n    React.useEffect(() => {\r\n        if (results && results.length > 0) {\r\n            // Try to extract table name from SQL using simple regex for 'FROM table_name'\r\n            // This is best-effort.\r\n            const match = sql.match(/FROM\\s+([a-zA-Z0-9_]+)/i);\r\n            const tableName = match ? match[1] : 'Dataset';\r\n\r\n            const schema = {\r\n                title: title,\r\n                description: `${t('widgets.data_inspector.description')}: ${tableName}`,\r\n                type: 'object',\r\n                properties: Object.keys(results[0]).reduce((acc, key) => {\r\n                    const val = results[0][key];\r\n                    const type = typeof val === 'number' ? 'number' : 'string';\r\n                    acc[key] = { type, description: key };\r\n                    return acc;\r\n                }, {} as any)\r\n            };\r\n            setDynamicSchema(schema);\r\n        }\r\n    }, [results, sql, title]);\r\n\r\n    const columns = useMemo(() => {\r\n        if (!results || results.length === 0) return [];\r\n        return Object.keys(results[0]).map(key => ({\r\n            header: key,\r\n            accessor: key,\r\n            render: (item: any) => formatValue(item[key], key)\r\n        }));\r\n    }, [results]);\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"h-full flex items-center justify-center text-slate-400\">\r\n                <Loader2 className=\"w-6 h-6 animate-spin\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (error) {\r\n        return (\r\n            <div className=\"h-full flex items-center justify-center text-red-400 p-4 text-center\">\r\n                <div className=\"flex flex-col items-center gap-2\">\r\n                    <AlertCircle className=\"w-6 h-6\" />\r\n                    <span className=\"text-xs\">{error.message}</span>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!results || results.length === 0) {\r\n        return (\r\n            <div className=\"h-full flex items-center justify-center text-slate-400 text-sm\">\r\n                {t('common.no_data')}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-full bg-white dark:bg-slate-800 rounded-xl border border-slate-300 dark:border-slate-700/50 shadow-sm hover:shadow-xl hover:shadow-slate-200/50 dark:hover:shadow-none transition-all duration-500 overflow-hidden\">\r\n            <div className=\"flex items-center justify-between pt-2.5 pb-2.5 px-5 bg-slate-50/50 dark:bg-slate-900/20 border-b border-slate-200 dark:border-slate-800/50\">\r\n                <div className=\"flex items-center gap-3 min-w-0\">\r\n                    <div className=\"p-1.5 rounded-xl shrink-0 shadow-sm text-blue-600 bg-blue-50 dark:bg-blue-900/20 dark:text-blue-400\">\r\n                        <BarChart3 className=\"w-4 h-4\" />\r\n                    </div>\r\n                    <div className=\"min-w-0\">\r\n                        <h3 className=\"text-xs font-bold text-slate-800 dark:text-white truncate tracking-tight\">{title}</h3>\r\n                        <div className=\"h-0.5 w-4 bg-slate-200 dark:bg-slate-700 rounded-full mt-0.5\" />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div className=\"flex-1 min-h-0 p-2\">\r\n                {config.type === 'table' ? (\r\n                    <div className=\"h-full overflow-auto\">\r\n                        <DataTable\r\n                            columns={columns}\r\n                            data={results}\r\n                            onRowClick={(item) => {\r\n                                const idx = results.indexOf(item);\r\n                                setSelectedItemIndex(idx >= 0 ? idx : 0);\r\n                                setIsDetailOpen(true);\r\n                            }}\r\n                        />\r\n                    </div>\r\n                ) : config.type === 'pivot' ? (\r\n                    <PivotTable\r\n                        data={results}\r\n                        rows={config.pivotRows || []}\r\n                        cols={config.pivotCols || []}\r\n                        measures={config.pivotMeasures || []}\r\n                    />\r\n                ) : config.type === 'kpi' ? (\r\n                    <div className=\"h-full flex flex-col items-center justify-center p-4\">\r\n                        {results && results.length > 0 ? (() => {\r\n                            const val = results[0][Object.keys(results[0])[0]];\r\n                            const numVal = Number(val);\r\n\r\n                            // Evaluate rules\r\n                            let displayColor = 'text-slate-900 dark:text-white';\r\n                            if (config.rules && !isNaN(numVal)) {\r\n                                for (const rule of config.rules) {\r\n                                    let match = false;\r\n                                    switch (rule.operator) {\r\n                                        case '>': match = numVal > rule.value; break;\r\n                                        case '<': match = numVal < rule.value; break;\r\n                                        case '>=': match = numVal >= rule.value; break;\r\n                                        case '<=': match = numVal <= rule.value; break;\r\n                                        case '==': match = numVal === rule.value; break;\r\n                                    }\r\n                                    if (match) {\r\n                                        // Simple mapping or hex handling\r\n                                        if (rule.color === 'green') displayColor = 'text-emerald-500';\r\n                                        else if (rule.color === 'red') displayColor = 'text-rose-500';\r\n                                        else if (rule.color === 'yellow') displayColor = 'text-amber-500';\r\n                                        else if (rule.color === 'blue') displayColor = 'text-blue-500';\r\n                                        else displayColor = `text-[${rule.color}]`; // Fallback for HEX if supported by tailwind or via style\r\n                                        break;\r\n                                    }\r\n                                }\r\n                            }\r\n\r\n                            return (\r\n                                <div className=\"flex flex-col items-center text-center animate-in zoom-in-95 duration-500\">\r\n                                    <div className={`text-4xl md:text-5xl lg:text-6xl font-black tracking-widest break-all transition-colors duration-300 ${displayColor}`}>\r\n                                        {formatValue(val, Object.keys(results[0])[0])}\r\n                                    </div>\r\n                                    <div className=\"text-[10px] font-bold text-slate-400 uppercase tracking-[0.3em] mt-3\">{Object.keys(results[0])[0]}</div>\r\n                                </div>\r\n                            );\r\n                        })() : (\r\n                            <div className=\"text-slate-300 text-[10px] font-bold uppercase tracking-widest\">{t('common.no_data')}</div>\r\n                        )}\r\n                    </div>\r\n                ) : (\r\n                    <ResponsiveContainer width=\"100%\" height=\"100%\" minWidth={0}>\r\n                        {config.type === 'bar' ? (\r\n                            <BarChart data={results}>\r\n                                <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#e2e8f0\" />\r\n                                <XAxis dataKey={config.xAxis} axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#64748b' }} />\r\n                                <YAxis axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#64748b' }} tickFormatter={(val) => formatValue(val, (config.yAxes || [])[0])} />\r\n                                <Tooltip\r\n                                    contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgb(0 0 0 / 0.1)' }}\r\n                                    cursor={{ fill: '#f1f5f9' }}\r\n                                    formatter={(val, name) => [formatValue(val, name as string), name]}\r\n                                />\r\n                                <Legend verticalAlign=\"top\" height={36} iconType=\"circle\" wrapperStyle={{ fontSize: '10px', fontWeight: 'bold', textTransform: 'uppercase' }} />\r\n                                {(config.yAxes || (config.yAxis ? [config.yAxis] : [])).map((y, idx) => (\r\n                                    <Bar key={y} dataKey={y} fill={idx === 0 ? (config.color || COLORS[0]) : COLORS[idx % COLORS.length]} radius={[4, 4, 0, 0]}>\r\n                                        {config.showLabels && <LabelList dataKey={y} position=\"top\" style={{ fontSize: '10px', fontWeight: 'bold', fill: '#64748b' }} formatter={(val: any) => formatValue(val, y)} />}\r\n                                    </Bar>\r\n                                ))}\r\n                            </BarChart>\r\n                        ) : config.type === 'line' ? (\r\n                            <LineChart data={results}>\r\n                                <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#e2e8f0\" />\r\n                                <XAxis dataKey={config.xAxis} axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#64748b' }} />\r\n                                <YAxis axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#64748b' }} tickFormatter={(val) => formatValue(val, (config.yAxes || [])[0])} />\r\n                                <Tooltip\r\n                                    contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgb(0 0 0 / 0.1)' }}\r\n                                    formatter={(val, name) => [formatValue(val, name as string), name]}\r\n                                />\r\n                                <Legend verticalAlign=\"top\" height={36} iconType=\"circle\" wrapperStyle={{ fontSize: '10px', fontWeight: 'bold', textTransform: 'uppercase' }} />\r\n                                {(config.yAxes || (config.yAxis ? [config.yAxis] : [])).map((y, idx) => (\r\n                                    <Line key={y} type=\"monotone\" dataKey={y} stroke={idx === 0 ? (config.color || COLORS[0]) : COLORS[idx % COLORS.length]} strokeWidth={3} dot={{ r: 4 }} activeDot={{ r: 6 }}>\r\n                                        {config.showLabels && <LabelList dataKey={y} position=\"top\" offset={10} style={{ fontSize: '10px', fontWeight: 'bold', fill: '#64748b' }} formatter={(val: any) => formatValue(val, y)} />}\r\n                                    </Line>\r\n                                ))}\r\n                            </LineChart>\r\n                        ) : config.type === 'area' ? (\r\n                            <AreaChart data={results}>\r\n                                <defs>\r\n                                    {(config.yAxes || (config.yAxis ? [config.yAxis] : [])).map((y, idx) => (\r\n                                        <linearGradient key={`grad-${y}`} id={`color-${y}-${title.replace(/\\s+/g, '')}`} x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                            <stop offset=\"5%\" stopColor={idx === 0 ? (config.color || COLORS[0]) : COLORS[idx % COLORS.length]} stopOpacity={0.8} />\r\n                                            <stop offset=\"95%\" stopColor={idx === 0 ? (config.color || COLORS[0]) : COLORS[idx % COLORS.length]} stopOpacity={0} />\r\n                                        </linearGradient>\r\n                                    ))}\r\n                                </defs>\r\n                                <XAxis dataKey={config.xAxis} axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#64748b' }} />\r\n                                <YAxis axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#64748b' }} tickFormatter={(val) => formatValue(val, (config.yAxes || [])[0])} />\r\n                                <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#e2e8f0\" />\r\n                                <Tooltip\r\n                                    contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgb(0 0 0 / 0.1)' }}\r\n                                    formatter={(val, name) => [formatValue(val, name as string), name]}\r\n                                />\r\n                                <Legend verticalAlign=\"top\" height={36} iconType=\"circle\" wrapperStyle={{ fontSize: '10px', fontWeight: 'bold' }} />\r\n                                {(config.yAxes || (config.yAxis ? [config.yAxis] : [])).map((y, idx) => (\r\n                                    <Area key={y} type=\"monotone\" dataKey={y} stroke={idx === 0 ? (config.color || COLORS[0]) : COLORS[idx % COLORS.length]} strokeWidth={3} fillOpacity={1} fill={`url(#color-${y}-${title.replace(/\\s+/g, '')})`}>\r\n                                        {config.showLabels && <LabelList dataKey={y} position=\"top\" style={{ fontSize: '10px', fontWeight: 'bold', fill: '#64748b' }} formatter={(val: any) => formatValue(val, y)} />}\r\n                                    </Area>\r\n                                ))}\r\n                            </AreaChart>\r\n                        ) : config.type === 'pie' ? (\r\n                            <PieChart>\r\n                                <Pie\r\n                                    data={results}\r\n                                    cx=\"50%\"\r\n                                    cy=\"50%\"\r\n                                    labelLine={false}\r\n                                    label={({ name, percent }: { name?: string | number; percent?: number }) => `${name ?? ''} ${(percent ? percent * 100 : 0).toFixed(0)}%`}\r\n                                    outerRadius={80}\r\n                                    innerRadius={50}\r\n                                    paddingAngle={5}\r\n                                    dataKey={(config.yAxes || (config.yAxis ? [config.yAxis] : []))[0] || ''}\r\n                                    nameKey={config.xAxis!}\r\n                                >\r\n                                    {results.map((_entry, index) => (\r\n                                        <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} stroke=\"white\" strokeWidth={2} />\r\n                                    ))}\r\n                                </Pie>\r\n                                <Tooltip contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgb(0 0 0 / 0.1)' }} />\r\n                                <Legend verticalAlign=\"bottom\" height={36} iconSize={8} wrapperStyle={{ fontSize: '10px', fontWeight: 'bold' }} />\r\n                            </PieChart>\r\n                        ) : config.type === 'composed' ? (\r\n                            <ComposedChart data={results}>\r\n                                <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#e2e8f0\" />\r\n                                <XAxis dataKey={config.xAxis} axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#64748b' }} />\r\n                                <YAxis axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#64748b' }} tickFormatter={(val) => formatValue(val, (config.yAxes || [])[0])} />\r\n                                <Tooltip\r\n                                    contentStyle={{ borderRadius: '12px', border: 'none' }}\r\n                                    formatter={(val, name) => [formatValue(val, name as string), name]}\r\n                                />\r\n                                <Legend verticalAlign=\"top\" height={36} iconType=\"circle\" />\r\n                                {(config.yAxes || []).map((y, idx) => (\r\n                                    config.lineSeries?.includes(y) ? (\r\n                                        <Line key={y} type=\"monotone\" dataKey={y} stroke={COLORS[idx % COLORS.length]} strokeWidth={3}>\r\n                                            {config.showLabels && <LabelList dataKey={y} position=\"top\" style={{ fontSize: '10px', fontWeight: 'bold', fill: '#64748b' }} formatter={(val: any) => formatValue(val, y)} />}\r\n                                        </Line>\r\n                                    ) : (\r\n                                        <Bar key={y} dataKey={y} fill={COLORS[idx % COLORS.length]} radius={[4, 4, 0, 0]}>\r\n                                            {config.showLabels && <LabelList dataKey={y} position=\"top\" style={{ fontSize: '10px', fontWeight: 'bold', fill: '#64748b' }} formatter={(val: any) => formatValue(val, y)} />}\r\n                                        </Bar>\r\n                                    )\r\n                                ))}\r\n                            </ComposedChart>\r\n                        ) : config.type === 'radar' ? (\r\n                            <RadarChart cx=\"50%\" cy=\"50%\" outerRadius=\"80%\" data={results}>\r\n                                <PolarGrid stroke=\"#e2e8f0\" />\r\n                                <PolarAngleAxis dataKey={config.xAxis} tick={{ fontSize: 10, fill: '#64748b' }} />\r\n                                <PolarRadiusAxis angle={30} domain={[0, 'auto']} tick={{ fontSize: 8 }} />\r\n                                {(config.yAxes || []).map((y, idx) => (\r\n                                    <Radar key={y} name={y} dataKey={y} stroke={COLORS[idx % COLORS.length]} fill={COLORS[idx % COLORS.length]} fillOpacity={0.6} />\r\n                                ))}\r\n                                <Legend iconType=\"circle\" wrapperStyle={{ fontSize: '10px' }} />\r\n                                <Tooltip />\r\n                            </RadarChart>\r\n                        ) : config.type === 'scatter' ? (\r\n                            <ScatterChart>\r\n                                <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#e2e8f0\" />\r\n                                <XAxis type=\"number\" dataKey={config.xAxis} name={config.xAxis} axisLine={false} tickLine={false} tick={{ fontSize: 10 }} />\r\n                                <YAxis type=\"number\" dataKey={(config.yAxes || [])[0]} name={(config.yAxes || [])[0]} axisLine={false} tickLine={false} tick={{ fontSize: 10 }} />\r\n                                <Tooltip cursor={{ strokeDasharray: '3 3' }} />\r\n                                <Legend verticalAlign=\"top\" height={36} />\r\n                                <Scatter name={title} data={results} fill={config.color || COLORS[0]} />\r\n                            </ScatterChart>\r\n                        ) : config.type === 'pivot' ? (\r\n                            <PivotTable\r\n                                data={results}\r\n                                rows={config.pivotRows || []}\r\n                                cols={config.pivotCols || []}\r\n                                measures={config.pivotMeasures || []}\r\n                            />\r\n                        ) : null}\r\n                    </ResponsiveContainer>\r\n                )}\r\n            </div>\r\n\r\n            {results && results.length > 0 && (\r\n                <RecordDetailModal\r\n                    isOpen={isDetailOpen}\r\n                    onClose={() => setIsDetailOpen(false)}\r\n                    items={results}\r\n                    initialIndex={selectedItemIndex}\r\n                    title={title}\r\n                    schema={dynamicSchema}\r\n                    tableName={sql.match(/FROM\\s+([a-zA-Z0-9_]+)/i)?.[1]}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\dashboard\\ClockComponent.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[307,310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[307,310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Clock, Calendar } from 'lucide-react';\r\nimport { DashboardComponent } from '../ui/DashboardComponent';\r\n\r\nexport const ClockComponent: React.FC<{ onRemove?: () => void; dragHandleProps?: any; onClick?: () => void; targetView?: string }> = ({ onRemove, dragHandleProps, onClick, targetView }) => {\r\n    const { t, i18n } = useTranslation();\r\n    const [time, setTime] = useState(new Date());\r\n\r\n    useEffect(() => {\r\n        const timer = setInterval(() => setTime(new Date()), 1000);\r\n        return () => clearInterval(timer);\r\n    }, []);\r\n\r\n    const dateStr = useMemo(() => {\r\n        return new Intl.DateTimeFormat(i18n.language === 'de' ? 'de-DE' : 'en-US', {\r\n            weekday: 'long',\r\n            day: '2-digit',\r\n            month: 'long'\r\n        }).format(time);\r\n    }, [time, i18n.language]);\r\n\r\n    // Prominent Time formatting with timezone\r\n    const timeStr = time.toLocaleTimeString(i18n.language === 'de' ? 'de-DE' : 'en-US', { hour: '2-digit', minute: '2-digit' });\r\n    const timeZone = 'CET'; // Central European Time\r\n\r\n    return (\r\n        <DashboardComponent\r\n            title={t('widgets.clock.title')}\r\n            icon={Clock}\r\n            iconColor=\"indigo\"\r\n            onRemove={onRemove}\r\n            dragHandleProps={dragHandleProps}\r\n            onClick={onClick}\r\n            targetView={targetView}\r\n            backgroundIcon={Clock}\r\n        >\r\n            <div className=\"flex flex-col h-full items-center justify-center -mt-2\">\r\n                {/* Main Clock & Timezone */}\r\n                <div className=\"text-center group-hover:scale-110 transition-transform duration-700\">\r\n                    <div className=\"flex items-baseline justify-center gap-1.5\">\r\n                        <span className=\"text-6xl font-black text-slate-900 dark:text-white tracking-tighter tabular-nums leading-none\">\r\n                            {timeStr}\r\n                        </span>\r\n                        <span className=\"text-xs font-black text-indigo-500/80 dark:text-indigo-400/80 uppercase tracking-widest tabular-nums\">\r\n                            {timeZone}\r\n                        </span>\r\n                    </div>\r\n\r\n                    {/* Prominent Date below time */}\r\n                    <div className=\"mt-4 flex flex-col items-center\">\r\n                        <div className=\"h-px w-8 bg-slate-100 dark:bg-slate-800 mb-4\" />\r\n                        <div className=\"flex items-center gap-2 px-4 py-1.5 bg-slate-50 dark:bg-slate-900/40 rounded-2xl border border-slate-100 dark:border-slate-800/50\">\r\n                            <Calendar className=\"w-3.5 h-3.5 text-slate-400 flex-shrink-0\" />\r\n                            <span className=\"text-xs font-bold text-slate-600 dark:text-slate-300 tracking-tight whitespace-nowrap\">\r\n                                {dateStr}\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </DashboardComponent>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\dashboard\\DataInspectorComponent.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[479,482],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[479,482],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Search, Database, Table as TableIcon } from 'lucide-react';\r\nimport { SystemRepository } from '../../../lib/repositories/SystemRepository';\r\nimport { DashboardComponent } from '../ui/DashboardComponent';\r\nimport { Skeleton } from '../ui/Skeleton';\r\nimport { useAsync } from '../../../hooks/useAsync';\r\n\r\nexport const DataInspectorComponent: React.FC<{ onRemove?: () => void; dragHandleProps?: any; onClick?: () => void; targetView?: string }> = ({ onRemove, dragHandleProps, onClick, targetView }) => {\r\n    const { t } = useTranslation();\r\n    const { data: stats, loading, error } = useAsync<{ tables: number; records: number }>(\r\n        () => SystemRepository.getDatabaseStats(),\r\n        [],\r\n        { cacheKey: 'db-stats-tile', ttl: 10 * 60 * 1000 }\r\n    );\r\n\r\n    if (error) {\r\n        return (\r\n            <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-red-200 dark:border-red-900/50 p-4 h-full flex items-center justify-center text-center\">\r\n                <p className=\"text-red-500 font-bold text-[10px] uppercase\">{t('common.error')}</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const handleClick = () => {\r\n        if (onClick) onClick();\r\n        window.location.hash = '#/inspector';\r\n    };\r\n\r\n    return (\r\n        <DashboardComponent\r\n            title={t('widgets.data_inspector.title')}\r\n            icon={Search}\r\n            iconColor=\"indigo\"\r\n            onClick={onClick || handleClick}\r\n            onRemove={onRemove}\r\n            targetView={targetView}\r\n            dragHandleProps={dragHandleProps}\r\n            backgroundIcon={Search}\r\n            className=\"cursor-pointer\"\r\n            footerLeft={\r\n                <button\r\n                    onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        window.location.hash = '#/inspector';\r\n                    }}\r\n                    className=\"flex items-center gap-1.5 text-[10px] font-black text-slate-400 hover:text-indigo-600 uppercase tracking-widest transition-colors group/footer\"\r\n                >\r\n                    {t('widgets.data_inspector.details')}\r\n                    <Search className=\"w-3 h-3 transition-transform group-hover/footer:scale-110\" />\r\n                </button>\r\n            }\r\n        >\r\n            <div className=\"flex flex-col h-full items-center justify-around py-2\">\r\n                {/* Primary Metric: Total Records */}\r\n                <div className=\"text-center group-hover:scale-105 transition-transform duration-500\">\r\n                    <div className=\"flex items-center justify-center gap-1.5 text-[10px] font-black text-indigo-600 dark:text-indigo-400 uppercase tracking-widest mb-1\">\r\n                        <TableIcon className=\"w-3 h-3\" />\r\n                        <span>{t('widgets.data_inspector.records_total')}</span>\r\n                    </div>\r\n                    <div className=\"text-4xl font-black text-slate-900 dark:text-white tracking-tighter tabular-nums leading-none\">\r\n                        {loading || !stats ? <Skeleton className=\"h-8 w-20 mx-auto\" /> : stats.records.toLocaleString()}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Secondary Metric: Tables */}\r\n                <div className=\"w-full pt-4 border-t border-slate-200 dark:border-slate-800/50 text-center\">\r\n                    <div className=\"flex items-center justify-center gap-1.5 text-[10px] font-black text-indigo-500 dark:text-indigo-400 uppercase tracking-widest mb-1\">\r\n                        <Database className=\"w-3 h-3\" />\r\n                        <span>{t('widgets.data_inspector.tables')}</span>\r\n                    </div>\r\n                    <div className=\"text-2xl font-black text-slate-700 dark:text-slate-300 tabular-nums leading-none\">\r\n                        {loading || !stats ? '...' : stats.tables}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </DashboardComponent>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\dashboard\\DatabaseStatusComponent.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[373,376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[373,376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Database, Save, AlertCircle, Settings } from 'lucide-react';\r\nimport { DashboardComponent } from '../ui/DashboardComponent';\r\nimport { useBackupStatus } from '../../../hooks/useBackupStatus';\r\n\r\ninterface DatabaseStatusComponentProps {\r\n    onRemove?: () => void;\r\n    dragHandleProps?: any;\r\n    onClick?: () => void;\r\n    targetView?: string;\r\n    isOverlay?: boolean;\r\n}\r\n\r\nexport const DatabaseStatusComponent: React.FC<DatabaseStatusComponentProps> = ({\r\n    onRemove,\r\n    dragHandleProps,\r\n    onClick,\r\n    targetView,\r\n    isOverlay\r\n}) => {\r\n    const { t, i18n } = useTranslation();\r\n    const { lastBackup, changeCount, isBackupRecommended } = useBackupStatus();\r\n\r\n    const formatDate = (date: Date | null) => {\r\n        if (!date) return t('widgets.database_status.never');\r\n        return date.toLocaleString(i18n.language === 'de' ? 'de-DE' : 'en-US', {\r\n            day: '2-digit',\r\n            month: '2-digit',\r\n            year: 'numeric',\r\n            hour: '2-digit',\r\n            minute: '2-digit'\r\n        });\r\n    };\r\n\r\n    const handleNavigate = (e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n        window.location.hash = '#/datasource';\r\n    };\r\n\r\n    return (\r\n        <DashboardComponent\r\n            title={t('widgets.database_status.title')}\r\n            icon={Database}\r\n            iconColor={isBackupRecommended ? \"amber\" : \"emerald\"}\r\n            onRemove={onRemove}\r\n            dragHandleProps={dragHandleProps}\r\n            onClick={onClick}\r\n            targetView={targetView}\r\n            backgroundIcon={Database}\r\n            className={isOverlay ? \"opacity-90\" : \"\"}\r\n            footerLeft={\r\n                <button\r\n                    onClick={handleNavigate}\r\n                    className=\"flex items-center gap-1.5 text-[10px] font-black text-slate-400 hover:text-blue-600 uppercase tracking-widest transition-colors group/footer\"\r\n                >\r\n                    {t('widgets.database_status.data_management')}\r\n                    <Settings className=\"w-3 h-3 transition-transform group-hover/footer:rotate-90\" />\r\n                </button>\r\n            }\r\n        >\r\n            <div className=\"flex flex-col h-full items-center justify-around py-2\">\r\n                {/* Primary Metric: Last Backup */}\r\n                <div className=\"text-center\">\r\n                    <div className=\"flex items-center justify-center gap-1.5 text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-1\">\r\n                        <Save className=\"w-3 h-3\" />\r\n                        <span>{t('widgets.database_status.last_backup')}</span>\r\n                    </div>\r\n                    <div className=\"text-xl font-black text-slate-900 dark:text-white tracking-tight tabular-nums leading-none\">\r\n                        {formatDate(lastBackup)}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Secondary Metric: Modifications */}\r\n                <div className=\"w-full pt-4 border-t border-slate-100 dark:border-slate-800/50 text-center\">\r\n                    <div className={`flex items-center justify-center gap-1.5 text-[10px] font-black uppercase tracking-widest mb-1 ${isBackupRecommended ? 'text-amber-600 dark:text-amber-400' : 'text-emerald-600 dark:text-emerald-400'\r\n                        }`}>\r\n                        {isBackupRecommended ? <AlertCircle className=\"w-3 h-3\" /> : <Database className=\"w-3 h-3\" />}\r\n                        <span>{t('widgets.database_status.modifications')}</span>\r\n                    </div>\r\n                    <div className={`text-4xl font-black tabular-nums leading-none tracking-tighter ${isBackupRecommended ? 'text-amber-600 dark:text-amber-400' : 'text-slate-900 dark:text-white'\r\n                        }`}>\r\n                        {changeCount}\r\n                    </div>\r\n                    <div className=\"text-[9px] font-bold text-slate-400 uppercase tracking-tighter mt-1\">\r\n                        {t('widgets.database_status.records_since_backup')}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </DashboardComponent>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\dashboard\\SystemStatusComponent.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[356,359],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[356,359],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[983,986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[983,986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1043,1046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1043,1046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Activity, Zap, Cpu } from 'lucide-react';\r\nimport { DashboardComponent } from '../ui/DashboardComponent';\r\nimport { SystemHealthModal } from '../SystemHealthModal';\r\n\r\nexport const SystemStatusComponent: React.FC<{ onRemove?: () => void; dragHandleProps?: any; onClick?: () => void; targetView?: string }> = ({ onRemove, dragHandleProps, onClick, targetView }) => {\r\n    const { t } = useTranslation();\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n\r\n    const [memory, setMemory] = useState<{ used: number; total: number } | null>(null);\r\n    const [loadTime, setLoadTime] = useState<number | null>(null);\r\n\r\n    React.useEffect(() => {\r\n        const nav = performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming;\r\n        if (nav) setLoadTime(Math.round(nav.duration));\r\n\r\n        const updateMetrics = () => {\r\n            if ((performance as any).memory) {\r\n                const mem = (performance as any).memory;\r\n                setMemory({\r\n                    used: Math.round(mem.usedJSHeapSize / 1024 / 1024),\r\n                    total: Math.round(mem.jsHeapSizeLimit / 1024 / 1024)\r\n                });\r\n            }\r\n        };\r\n        updateMetrics();\r\n        const interval = setInterval(updateMetrics, 5000);\r\n        return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    const handleClick = () => {\r\n        setIsModalOpen(true);\r\n        if (onClick) onClick();\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <DashboardComponent\r\n                title={t('widgets.system_status.title')}\r\n                icon={Activity}\r\n                iconColor=\"emerald\"\r\n                onRemove={onRemove}\r\n                dragHandleProps={dragHandleProps}\r\n                onClick={handleClick}\r\n                targetView={targetView}\r\n                backgroundIcon={Activity}\r\n                className=\"cursor-pointer\"\r\n                footerLeft={\r\n                    <button\r\n                        onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            setIsModalOpen(true);\r\n                        }}\r\n                        className=\"flex items-center gap-1.5 text-[10px] font-black text-slate-400 hover:text-blue-600 uppercase tracking-widest transition-colors group/footer\"\r\n                    >\r\n                        {t('widgets.system_status.details')}\r\n                        <Activity className=\"w-3 h-3 transition-transform group-hover/footer:scale-110\" />\r\n                    </button>\r\n                }\r\n            >\r\n                <div className=\"flex flex-col h-full items-center justify-around py-2\">\r\n                    {/* Primary Metric: Memory */}\r\n                    <div className=\"text-center group-hover:scale-105 transition-transform duration-500\">\r\n                        <div className=\"flex items-center justify-center gap-1.5 text-[10px] font-black text-emerald-600 dark:text-emerald-400 uppercase tracking-widest mb-1\">\r\n                            <Cpu className=\"w-3 h-3\" />\r\n                            <span>{t('widgets.system_status.memory_usage')}</span>\r\n                        </div>\r\n                        <div className=\"text-4xl font-black text-slate-900 dark:text-white tracking-tighter tabular-nums leading-none\">\r\n                            {memory ? `${memory.used} MB` : '---'}\r\n                        </div>\r\n                        <div className=\"text-[9px] font-bold text-slate-400 uppercase tracking-tighter mt-1\">\r\n                            {t('widgets.system_status.heap_from', { total: memory ? memory.total : '---' })}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Secondary Metric: Load Time */}\r\n                    <div className=\"w-full pt-4 border-t border-slate-200 dark:border-slate-800/50 text-center\">\r\n                        <div className=\"flex items-center justify-center gap-1.5 text-[10px] font-black text-blue-500 dark:text-blue-400 uppercase tracking-widest mb-1\">\r\n                            <Zap className=\"w-3 h-3\" />\r\n                            <span>{t('widgets.system_status.load_time')}</span>\r\n                        </div>\r\n                        <div className=\"text-2xl font-black text-slate-700 dark:text-slate-300 tabular-nums leading-none\">\r\n                            {loadTime ? `${loadTime} ms` : '---'}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </DashboardComponent>\r\n\r\n            <SystemHealthModal\r\n                isOpen={isModalOpen}\r\n                onClose={() => setIsModalOpen(false)}\r\n            />\r\n        </>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\dashboard\\WorklistComponent.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[426,429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[426,429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { ClipboardList, AlertCircle, CheckCircle2, ArrowRight } from 'lucide-react';\r\nimport { SystemRepository } from '../../../lib/repositories/SystemRepository';\r\nimport { DashboardComponent } from '../ui/DashboardComponent';\r\n\r\ninterface WorklistStatusComponentProps {\r\n    onRemove?: () => void;\r\n    dragHandleProps?: any;\r\n    onClick?: () => void;\r\n    targetView?: string;\r\n    isOverlay?: boolean;\r\n}\r\n\r\nexport const WorklistComponent: React.FC<WorklistStatusComponentProps> = ({\r\n    onRemove,\r\n    dragHandleProps,\r\n    onClick,\r\n    targetView,\r\n    isOverlay\r\n}) => {\r\n    const { t } = useTranslation();\r\n    const [stats, setStats] = useState({ total: 0, pending: 0 });\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const loadStats = async () => {\r\n        try {\r\n            const list = await SystemRepository.getWorklist();\r\n            const total = list.length;\r\n            const pending = list.filter(item => item.status === 'pending' || !item.status).length;\r\n            setStats({ total, pending });\r\n        } catch (e) {\r\n            console.error('Failed to load worklist stats', e);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadStats();\r\n        window.addEventListener('db-updated', loadStats);\r\n        window.addEventListener('db-changed', loadStats);\r\n        return () => {\r\n            window.removeEventListener('db-updated', loadStats);\r\n            window.removeEventListener('db-changed', loadStats);\r\n        };\r\n    }, []);\r\n\r\n    const handleNavigate = (e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n        window.location.hash = '#/worklist';\r\n    };\r\n\r\n    return (\r\n        <DashboardComponent\r\n            title={t('widgets.worklist.title')}\r\n            icon={ClipboardList}\r\n            iconColor={stats.pending > 0 ? \"amber\" : \"emerald\"}\r\n            onRemove={onRemove}\r\n            dragHandleProps={dragHandleProps}\r\n            onClick={onClick}\r\n            targetView={targetView}\r\n            backgroundIcon={ClipboardList}\r\n            className={isOverlay ? \"opacity-90\" : \"\"}\r\n            footerLeft={\r\n                <button\r\n                    onClick={handleNavigate}\r\n                    className=\"flex items-center gap-1.5 text-[10px] font-black text-slate-400 hover:text-blue-600 uppercase tracking-widest transition-colors group/footer\"\r\n                >\r\n                    {t('widgets.worklist.open_list')}\r\n                    <ArrowRight className=\"w-3 h-3 transition-transform group-hover/footer:translate-x-1\" />\r\n                </button>\r\n            }\r\n        >\r\n            <div className=\"flex flex-col h-full items-center justify-around py-2\">\r\n                {/* Primary Metric: Pending Items */}\r\n                <div className=\"text-center\">\r\n                    <div className={`flex items-center justify-center gap-1.5 text-[10px] font-black uppercase tracking-widest mb-1 ${stats.pending > 0 ? 'text-amber-600 dark:text-amber-400' : 'text-emerald-600 dark:text-emerald-400'}`}>\r\n                        {stats.pending > 0 ? <AlertCircle className=\"w-3 h-3\" /> : <CheckCircle2 className=\"w-3 h-3\" />}\r\n                        <span>{stats.pending > 0 ? t('widgets.worklist.open_tasks') : t('widgets.worklist.all_done')}</span>\r\n                    </div>\r\n                    <div className={`text-4xl font-black tracking-tighter tabular-nums leading-none ${stats.pending > 0 ? 'text-amber-600 dark:text-amber-400' : 'text-slate-900 dark:text-white'}`}>\r\n                        {loading ? '---' : stats.pending}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Secondary Metric: Total Items */}\r\n                <div className=\"w-full pt-4 border-t border-slate-100 dark:border-slate-800/50 text-center\">\r\n                    <div className=\"flex items-center justify-center gap-1.5 text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-1\">\r\n                        <ClipboardList className=\"w-3 h-3\" />\r\n                        <span>{t('widgets.worklist.total_entries')}</span>\r\n                    </div>\r\n                    <div className=\"text-xl font-black text-slate-700 dark:text-slate-300 tabular-nums leading-none\">\r\n                        {loading ? '---' : stats.total}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </DashboardComponent>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\ui\\DashboardComponent.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[555,558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[555,558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { cn } from '../../../lib/utils';\r\nimport { X, GripVertical, type LucideIcon, Maximize2, ChevronRight } from 'lucide-react';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\ninterface DashboardComponentProps {\r\n    title: string;\r\n    icon: LucideIcon;\r\n    iconColor?: 'blue' | 'emerald' | 'rose' | 'amber' | 'indigo' | 'slate';\r\n    children: React.ReactNode;\r\n    onRemove?: () => void;\r\n    onClick?: () => void;\r\n    targetView?: string;\r\n    dragHandleProps?: any;\r\n    footerLeft?: React.ReactNode;\r\n    footerRight?: React.ReactNode;\r\n    className?: string;\r\n    backgroundIcon?: LucideIcon;\r\n}\r\n\r\nconst colorStyles = {\r\n    blue: 'text-blue-600 bg-blue-50 dark:bg-blue-900/20 dark:text-blue-400',\r\n    emerald: 'text-emerald-600 bg-emerald-50 dark:bg-emerald-900/20 dark:text-emerald-400',\r\n    rose: 'text-rose-600 bg-rose-50 dark:bg-rose-900/20 dark:text-rose-400',\r\n    amber: 'text-amber-600 bg-amber-50 dark:bg-amber-900/20 dark:text-amber-400',\r\n    indigo: 'text-indigo-600 bg-indigo-50 dark:bg-indigo-900/20 dark:text-indigo-400',\r\n    slate: 'text-slate-600 bg-slate-50 dark:bg-slate-900/20 dark:text-slate-400',\r\n};\r\n\r\nexport const DashboardComponent: React.FC<DashboardComponentProps> = ({\r\n    title,\r\n    icon: Icon,\r\n    iconColor = 'blue',\r\n    children,\r\n    onRemove,\r\n    onClick,\r\n    targetView,\r\n    dragHandleProps,\r\n    footerLeft,\r\n    footerRight,\r\n    className,\r\n    backgroundIcon: BackgroundIcon,\r\n}) => {\r\n    const { t } = useTranslation();\r\n    const navigate = useNavigate();\r\n\r\n    // Smart Footer Logic: If targetView is present and no footer is provided, show \"Detailansicht\"\r\n    const hasFooter = footerLeft || footerRight || targetView;\r\n    const effectiveFooterLeft = footerLeft || (targetView && !footerRight ? (\r\n        <button\r\n            onClick={(e) => { e.stopPropagation(); navigate(targetView); }}\r\n            className=\"flex items-center gap-1.5 text-[10px] font-black text-slate-400 hover:text-blue-600 uppercase tracking-widest transition-colors group/footer\"\r\n        >\r\n            {t('common.open_details')}\r\n            <ChevronRight className=\"w-3 h-3 transition-transform group-hover/footer:translate-x-0.5\" />\r\n        </button>\r\n    ) : null);\r\n\r\n    return (\r\n        <div className={cn(\r\n            \"group relative flex flex-col bg-white dark:bg-slate-800 rounded-xl border border-slate-300 dark:border-slate-700/50 shadow-sm hover:shadow-xl hover:shadow-slate-200/50 dark:hover:shadow-none transition-all duration-500 overflow-hidden h-full\",\r\n            onClick && \"cursor-pointer active:scale-[0.98]\",\r\n            className\r\n        )}>\r\n            {/* Background Decorative Icon */}\r\n            {BackgroundIcon && (\r\n                <div className=\"absolute -right-8 -bottom-8 text-slate-50/50 dark:text-slate-900/20 group-hover:text-slate-100/50 dark:group-hover:text-slate-900/40 transition-colors duration-500\">\r\n                    <BackgroundIcon size={160} strokeWidth={1} />\r\n                </div>\r\n            )}\r\n\r\n            {/* Header - Reduced padding (p-5 pb-4 -> pt-2.5 pb-2.5 px-5) */}\r\n            <div className=\"relative flex items-center justify-between pt-2.5 pb-2.5 px-5 bg-slate-50/50 dark:bg-slate-900/20 border-b border-slate-200 dark:border-slate-800/50\">\r\n                <div className=\"flex items-center gap-3 min-w-0\">\r\n                    <div className={cn(\"p-1.5 rounded-xl shrink-0 shadow-sm\", colorStyles[iconColor])}>\r\n                        <Icon className=\"w-4 h-4\" />\r\n                    </div>\r\n                    <div className=\"min-w-0\">\r\n                        <h3 className=\"text-xs font-bold text-slate-800 dark:text-white truncate tracking-tight\">{title}</h3>\r\n                        <div className=\"h-0.5 w-4 bg-slate-200 dark:bg-slate-700 rounded-full mt-0.5 group-hover:w-8 transition-all duration-500\" />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-all duration-300 translate-x-2 group-hover:translate-x-0\">\r\n                    {onClick && (\r\n                        <button\r\n                            onClick={(e) => { e.stopPropagation(); onClick(); }}\r\n                            className=\"p-1 text-slate-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors\"\r\n                            title={t('common.expand')}\r\n                        >\r\n                            <Maximize2 className=\"w-3.5 h-3.5\" />\r\n                        </button>\r\n                    )}\r\n                    <div\r\n                        {...dragHandleProps}\r\n                        className=\"p-1 text-slate-400 hover:text-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg cursor-grab active:cursor-grabbing transition-colors\"\r\n                    >\r\n                        <GripVertical className=\"w-3.5 h-3.5\" />\r\n                    </div>\r\n                    {onRemove && (\r\n                        <button\r\n                            onClick={(e) => { e.stopPropagation(); onRemove(); }}\r\n                            className=\"p-1 text-slate-400 hover:text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg transition-colors\"\r\n                            title={t('common.remove')}\r\n                        >\r\n                            <X className=\"w-3.5 h-3.5\" />\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Content Area - Adjusted padding for stability */}\r\n            <div\r\n                className=\"relative flex-1 p-4 px-5 pt-2 min-h-0\"\r\n                onClick={onClick}\r\n            >\r\n                {children}\r\n            </div>\r\n\r\n            {/* Footer Area (Optional or Automatic via targetView) */}\r\n            {hasFooter && (\r\n                <div className=\"relative p-3 px-5 border-t border-slate-200 dark:border-slate-800/50 bg-slate-50/50 dark:bg-slate-900/30 flex items-center justify-between min-h-[40px]\">\r\n                    <div className=\"flex-1 min-w-0\">{effectiveFooterLeft}</div>\r\n                    <div className=\"shrink-0\">{footerRight}</div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Subtle Hover Glow */}\r\n            <div className=\"absolute inset-0 pointer-events-none border border-transparent group-hover:border-blue-500/10 dark:group-hover:border-blue-400/10 rounded-3xl transition-colors\" />\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\ui\\ExportFAB.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\ui\\PageLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\ui\\PageSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\ui\\RecordComparison.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[765,768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[765,768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { AlertCircle, CheckCircle2, ArrowRight } from 'lucide-react';\r\nimport type { DataRecord } from '../../../types';\r\n\r\ninterface RecordComparisonProps {\r\n    leftItem: DataRecord;\r\n    rightItem: DataRecord;\r\n    leftLabel?: string;\r\n    rightLabel?: string;\r\n    excludeKeys?: string[];\r\n}\r\n\r\nexport const RecordComparison: React.FC<RecordComparisonProps> = ({\r\n    leftItem,\r\n    rightItem,\r\n    leftLabel = 'Source',\r\n    rightLabel = 'Target',\r\n    excludeKeys = []\r\n}) => {\r\n    // Get all unique keys from both items\r\n    const allKeys = Array.from(new Set([\r\n        ...Object.keys(leftItem || {}),\r\n        ...Object.keys(rightItem || {})\r\n    ])).filter(key => !excludeKeys.includes(key));\r\n\r\n    const formatValue = (val: any) => {\r\n        if (val === null || val === undefined || val === '') return '-';\r\n        if (typeof val === 'number') return val.toLocaleString();\r\n        return String(val);\r\n    };\r\n\r\n\r\n    return (\r\n        <div className=\"overflow-hidden border border-slate-200 dark:border-slate-700 rounded-xl bg-white dark:bg-slate-900 shadow-sm\">\r\n            <div className=\"grid grid-cols-[2fr,3fr,3fr] bg-slate-50 dark:bg-slate-800/50 border-b border-slate-200 dark:border-slate-700\">\r\n                <div className=\"px-4 py-3 text-[10px] font-black uppercase text-slate-500 tracking-wider\">Field</div>\r\n                <div className=\"px-4 py-3 text-[10px] font-black uppercase text-blue-600 tracking-wider border-l border-slate-100 dark:border-slate-700\">{leftLabel}</div>\r\n                <div className=\"px-4 py-3 text-[10px] font-black uppercase text-indigo-600 tracking-wider border-l border-slate-100 dark:border-slate-700\">{rightLabel}</div>\r\n            </div>\r\n\r\n            <div className=\"divide-y divide-slate-100 dark:divide-slate-800\">\r\n                {allKeys.sort().map(key => {\r\n                    const leftVal = leftItem?.[key];\r\n                    const rightVal = rightItem?.[key];\r\n                    const hasDiff = String(leftVal) !== String(rightVal);\r\n\r\n                    return (\r\n                        <div\r\n                            key={key}\r\n                            className={`grid grid-cols-[2fr,3fr,3fr] transition-colors ${hasDiff ? 'bg-amber-50/50 dark:bg-amber-900/10' : 'hover:bg-slate-50/30 dark:hover:bg-slate-800/30'}`}\r\n                        >\r\n                            <div className=\"px-4 py-3 text-xs font-bold text-slate-400 truncate flex items-center gap-2\">\r\n                                {key}\r\n                                {hasDiff && <AlertCircle className=\"w-3 h-3 text-amber-500 shrink-0\" />}\r\n                                {!hasDiff && <CheckCircle2 className=\"w-3 h-3 text-emerald-500/30 shrink-0\" />}\r\n                            </div>\r\n\r\n                            <div className={`px-4 py-3 text-sm font-medium border-l border-slate-100 dark:border-slate-800 break-all ${hasDiff ? 'text-amber-700 dark:text-amber-300' : 'text-slate-600 dark:text-slate-400'}`}>\r\n                                {formatValue(leftVal)}\r\n                            </div>\r\n\r\n                            <div className={`px-4 py-3 text-sm font-mono border-l border-slate-100 dark:border-slate-800 break-all flex items-center gap-2 ${hasDiff ? 'text-indigo-600 dark:text-indigo-400 font-black' : 'text-slate-600 dark:text-slate-400'}`}>\r\n                                {hasDiff && <ArrowRight className=\"w-3 h-3 text-amber-500 shrink-0\" />}\r\n                                {formatValue(rightVal)}\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\ui\\Skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\ui\\SummaryCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\components\\ui\\ViewHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\lib\\constants\\SqlSnippets.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\pages\\ComponentGridPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\pages\\SettingsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\pages\\SimplePage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\registry.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[645,648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[645,648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport type React from 'react';\r\nimport { ClockComponent } from './components/dashboard/ClockComponent';\r\nimport { DataInspectorComponent } from './components/dashboard/DataInspectorComponent';\r\nimport { SystemStatusComponent } from './components/dashboard/SystemStatusComponent';\r\nimport { DatabaseStatusComponent } from './components/dashboard/DatabaseStatusComponent';\r\nimport { WorklistComponent } from './components/dashboard/WorklistComponent';\r\nimport { Clock, Activity, HardDrive, Search, ClipboardList } from 'lucide-react';\r\nimport type { LucideIcon } from 'lucide-react';\r\n\r\nexport const COMPONENT_REGISTRY: Record<string, React.FC<any>> = {\r\n    'ClockComponent': ClockComponent,\r\n    'DataInspectorComponent': DataInspectorComponent,\r\n    'SystemStatusComponent': SystemStatusComponent,\r\n    'DatabaseStatusComponent': DatabaseStatusComponent,\r\n    'WorklistComponent': WorklistComponent\r\n};\r\n\r\nexport interface SystemWidgetMetadata {\r\n    id: string;\r\n    titleKey: string;\r\n    descriptionKey: string;\r\n    icon: LucideIcon;\r\n    defaultColSpan?: number;\r\n}\r\n\r\nexport const SYSTEM_WIDGETS: SystemWidgetMetadata[] = [\r\n    { id: 'SystemStatusComponent', titleKey: 'widgets.system_status.title', descriptionKey: 'widgets.system_status.description', icon: Activity, defaultColSpan: 1 },\r\n    { id: 'DataInspectorComponent', titleKey: 'widgets.data_inspector.title', descriptionKey: 'widgets.data_inspector.description', icon: Search, defaultColSpan: 1 },\r\n    { id: 'DatabaseStatusComponent', titleKey: 'widgets.database_status.title', descriptionKey: 'widgets.database_status.description', icon: HardDrive, defaultColSpan: 1 },\r\n    { id: 'ClockComponent', titleKey: 'widgets.clock.title', descriptionKey: 'widgets.clock.description', icon: Clock, defaultColSpan: 1 },\r\n    { id: 'WorklistComponent', titleKey: 'widgets.worklist.title', descriptionKey: 'widgets.worklist.description', icon: ClipboardList, defaultColSpan: 1 },\r\n];\r\n\r\nexport const getComponent = (name: string) => {\r\n    return COMPONENT_REGISTRY[name] || null;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\utils\\formatUtils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[331,334],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[331,334],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export const isCurrencyColumn = (col: string) => {\r\n    const lower = col.toLowerCase();\r\n    return lower.includes('price') || lower.includes('amount') || lower.includes('preis') || lower.includes('betrag') || lower.includes('summe') || lower.includes('kosten') || lower.includes('total');\r\n};\r\n\r\nexport const formatValue = (val: any, col?: string) => {\r\n    if (typeof val !== 'number') return val;\r\n    if (col && isCurrencyColumn(col)) {\r\n        return new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(val);\r\n    }\r\n    return new Intl.NumberFormat('de-DE').format(val);\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\views\\AboutView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\views\\CustomDashboardView.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2282,2285],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2282,2285],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 't'. Either include it or remove the dependency array.","line":93,"column":8,"nodeType":"ArrayExpression","endLine":93,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [t]","fix":{"range":[3769,3771],"text":"[t]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'activeDashboard'. Either include it or remove the dependency array.","line":126,"column":8,"nodeType":"ArrayExpression","endLine":126,"endColumn":67,"suggestions":[{"desc":"Update the dependencies array to be: [activeDashboardId, customWidgets, activeDashboard.layout, activeDashboard]","fix":{"range":[5049,5108],"text":"[activeDashboardId, customWidgets, activeDashboard.layout, activeDashboard]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":431,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":431,"endColumn":39}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { PageLayout } from '../components/ui/PageLayout';\r\nimport { SystemRepository } from '../../lib/repositories/SystemRepository';\r\nimport { useAsync } from '../../hooks/useAsync';\r\nimport { Plus, Layout, Trash2, Database, Star, Settings, Check, X, Edit2, Download, Maximize2, Filter } from 'lucide-react';\r\nimport { useReportExport } from '../../hooks/useReportExport';\r\nimport { WidgetRenderer } from '../components/WidgetRenderer';\r\nimport { Modal } from '../components/Modal';\r\nimport { getComponent, SYSTEM_WIDGETS } from '../registry';\r\nimport { COMPONENTS } from '../../config/components';\r\nimport { useDashboard } from '../../lib/context/DashboardContext';\r\n\r\ninterface FilterDef {\r\n    column: string;\r\n    operator: string;\r\n    value: string;\r\n}\r\n\r\ninterface SavedWidget {\r\n    id: string; // Either UUID for custom or 'sys_...' for system\r\n    type: 'custom' | 'system';\r\n    position?: number;\r\n}\r\n\r\ninterface DashboardDef {\r\n    id: string;\r\n    name: string;\r\n    layout: SavedWidget[];\r\n    is_default: boolean;\r\n    filters?: FilterDef[];\r\n}\r\n\r\nexport const CustomDashboardView: React.FC = () => {\r\n    const { t } = useTranslation();\r\n    // Dashboards State\r\n    const [dashboards, setDashboards] = useState<DashboardDef[]>([]);\r\n    const [activeDashboardId, setActiveDashboardId] = useState<string | null>(null);\r\n    const [isLoaded, setIsLoaded] = useState(false);\r\n\r\n    // Modals\r\n    const [isAddModalOpen, setIsAddModalOpen] = useState(false);\r\n    const [isManageModalOpen, setIsManageModalOpen] = useState(false);\r\n    const [activeTab, setActiveTab] = useState<'system' | 'custom'>('system');\r\n\r\n    // Edit State\r\n    const [editName, setEditName] = useState('');\r\n    const [isCreating, setIsCreating] = useState(false);\r\n\r\n    const [showFilters, setShowFilters] = useState(false);\r\n    const [suggestedColumns, setSuggestedColumns] = useState<string[]>([]);\r\n    const { visibleSidebarComponentIds, setVisibleSidebarComponentIds, togglePresentationMode } = useDashboard();\r\n    const { isExporting, exportToPdf } = useReportExport();\r\n\r\n    // Fetch custom widgets\r\n    const { data: customWidgets, refresh: refreshCustomWidgets } = useAsync<any[]>(\r\n        async () => {\r\n            return await SystemRepository.executeRaw('SELECT * FROM sys_user_widgets ORDER BY created_at DESC');\r\n        },\r\n        []\r\n    );\r\n\r\n    // Initial Load & Migration\r\n    useEffect(() => {\r\n        const init = async () => {\r\n            let dbDashboards = await SystemRepository.getDashboards();\r\n\r\n            // Migration from localStorage\r\n            const legacyLayout = localStorage.getItem('custom_dashboard_layout');\r\n            if (dbDashboards.length === 0) {\r\n                const defaultDash: DashboardDef = {\r\n                    id: crypto.randomUUID(),\r\n                    name: t('dashboard.default_name'),\r\n                    layout: legacyLayout ? JSON.parse(legacyLayout) : [],\r\n                    is_default: true\r\n                };\r\n                await SystemRepository.saveDashboard(defaultDash);\r\n                if (legacyLayout) localStorage.removeItem('custom_dashboard_layout');\r\n                dbDashboards = [defaultDash];\r\n            } else if (dbDashboards.length > 0) {\r\n                // Parse layouts from strings\r\n                dbDashboards = dbDashboards.map(d => ({\r\n                    ...d,\r\n                    layout: typeof d.layout === 'string' ? JSON.parse(d.layout) : d.layout\r\n                }));\r\n            }\r\n\r\n            setDashboards(dbDashboards);\r\n            setActiveDashboardId(dbDashboards[0].id);\r\n            setIsLoaded(true);\r\n        };\r\n        init();\r\n    }, []);\r\n\r\n    const activeDashboard = dashboards.find(d => d.id === activeDashboardId);\r\n\r\n    // Dynamic Column Scanner for Global Filters\r\n    useEffect(() => {\r\n        if (!activeDashboard || !customWidgets) return;\r\n\r\n        const scanColumns = async () => {\r\n            const dashboardWidgetIds = activeDashboard.layout.map(w => w.id);\r\n            const activeWidgets = customWidgets.filter(w => dashboardWidgetIds.includes(w.id));\r\n\r\n            const tables = new Set<string>();\r\n            activeWidgets.forEach(w => {\r\n                const match = w.sql_query.match(/FROM\\s+([a-zA-Z0-9_]+)/i);\r\n                if (match) tables.add(match[1]);\r\n            });\r\n\r\n            const allCols = new Set<string>();\r\n            for (const table of Array.from(tables)) {\r\n                try {\r\n                    const cols = await SystemRepository.getTableSchema(table);\r\n                    if (cols && Array.isArray(cols)) {\r\n                        cols.forEach(c => allCols.add(c.name));\r\n                    }\r\n                } catch (e) {\r\n                    console.error('Error fetching schema for table', table, e);\r\n                }\r\n            }\r\n            setSuggestedColumns(Array.from(allCols).sort());\r\n        };\r\n\r\n        scanColumns();\r\n    }, [activeDashboardId, customWidgets, activeDashboard?.layout]);\r\n\r\n    // Sync active dashboard to DB\r\n    const syncDashboard = async (updatedDash: DashboardDef) => {\r\n        await SystemRepository.saveDashboard(updatedDash);\r\n        setDashboards(prev => prev.map(d => d.id === updatedDash.id ? updatedDash : d));\r\n    };\r\n\r\n    const addToDashboard = async (id: string, type: 'custom' | 'system') => {\r\n        if (!activeDashboard) return;\r\n        if (activeDashboard.layout.find(w => w.id === id)) return;\r\n\r\n        const updated = {\r\n            ...activeDashboard,\r\n            layout: [...activeDashboard.layout, { id, type }]\r\n        };\r\n        await syncDashboard(updated);\r\n        setIsAddModalOpen(false);\r\n    };\r\n\r\n    const removeFromDashboard = async (id: string) => {\r\n        if (!activeDashboard) return;\r\n        const updated = {\r\n            ...activeDashboard,\r\n            layout: activeDashboard.layout.filter(w => w.id !== id)\r\n        };\r\n        await syncDashboard(updated);\r\n    };\r\n\r\n    const deleteCustomWidget = async (id: string) => {\r\n        if (confirm(t('dashboard.confirm_delete_report'))) {\r\n            await SystemRepository.executeRaw(`DELETE FROM sys_user_widgets WHERE id = '${id}'`);\r\n            refreshCustomWidgets();\r\n            removeFromDashboard(id);\r\n        }\r\n    };\r\n\r\n    const createDashboard = async () => {\r\n        if (!editName.trim()) return;\r\n        const newDash: DashboardDef = {\r\n            id: crypto.randomUUID(),\r\n            name: editName,\r\n            layout: [],\r\n            is_default: false\r\n        };\r\n        await SystemRepository.saveDashboard(newDash);\r\n        setDashboards([...dashboards, newDash]);\r\n        setActiveDashboardId(newDash.id);\r\n        setEditName('');\r\n        setIsCreating(false);\r\n    };\r\n\r\n    const removeDashboard = async (id: string) => {\r\n        if (dashboards.length <= 1) return;\r\n        if (!confirm(t('dashboard.delete_confirm'))) return;\r\n\r\n        await SystemRepository.deleteDashboard(id);\r\n        const filtered = dashboards.filter(d => d.id !== id);\r\n        setDashboards(filtered);\r\n        if (activeDashboardId === id) {\r\n            setActiveDashboardId(filtered[0].id);\r\n        }\r\n    };\r\n\r\n    if (!isLoaded) return null;\r\n\r\n    return (\r\n        <PageLayout\r\n            header={{\r\n                title: t('dashboard.title'),\r\n                subtitle: t('dashboard.subtitle'),\r\n                actions: (\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <button\r\n                            onClick={togglePresentationMode}\r\n                            className=\"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors border border-transparent hover:border-blue-100\"\r\n                            title={t('dashboard.presentation_mode')}\r\n                        >\r\n                            <Maximize2 className=\"w-5 h-5\" />\r\n                        </button>\r\n                        <button\r\n                            onClick={() => exportToPdf('dashboard-grid', `dashboard-${activeDashboard?.name || 'export'}`)}\r\n                            disabled={isExporting}\r\n                            className=\"flex items-center gap-2 px-3 py-2 bg-white border border-slate-200 text-slate-600 rounded-lg hover:bg-slate-50 transition-colors shadow-sm font-medium text-sm disabled:opacity-50\"\r\n                        >\r\n                            <Download className=\"w-4 h-4\" />\r\n                            {isExporting ? t('common.exporting') : t('common.export_pdf')}\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setShowFilters(!showFilters)}\r\n                            className={`p-2 rounded-lg transition-colors border ${showFilters ? 'bg-blue-50 border-blue-200 text-blue-600' : 'text-slate-400 hover:text-blue-600 hover:bg-blue-50 border-transparent hover:border-blue-100'}`}\r\n                            title={t('querybuilder.filter')}\r\n                        >\r\n                            <Filter className=\"w-5 h-5\" />\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setIsAddModalOpen(true)}\r\n                            className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-sm font-medium text-sm\"\r\n                        >\r\n                            <Plus className=\"w-4 h-4\" />\r\n                            {t('dashboard.add_title')}\r\n                        </button>\r\n                    </div>\r\n                )\r\n            }}\r\n        >\r\n            {/* Global Filter Bar */}\r\n            {showFilters && activeDashboard && (\r\n                <div className=\"mb-6 p-4 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl shadow-sm animate-in slide-in-from-top-2 duration-300\">\r\n                    <datalist id=\"suggested-columns\">\r\n                        {suggestedColumns.map(col => <option key={col} value={col} />)}\r\n                    </datalist>\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <div className=\"flex flex-col gap-1\">\r\n                            <h4 className=\"text-xs font-black uppercase text-slate-400 flex items-center gap-2\">\r\n                                <Filter className=\"w-3.5 h-3.5 text-blue-500\" /> {t('dashboard.filters_title')}\r\n                            </h4>\r\n                            <p className=\"text-[10px] text-slate-400\">{t('dashboard.filters_subtitle', 'Slicers that affect all dashboard charts simultaneously.')}</p>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            {/* Smart Filter Buttons based on detected columns */}\r\n                            {suggestedColumns.filter(c =>\r\n                                ['Year', 'FiscalYear', 'Date', 'Month', 'Category', 'Group', 'Type', 'Status'].some(key => c.toLowerCase().includes(key.toLowerCase()))\r\n                            ).slice(0, 3).map(col => (\r\n                                <button\r\n                                    key={col}\r\n                                    onClick={() => syncDashboard({ ...activeDashboard, filters: [...(activeDashboard.filters || []), { column: col, operator: '=', value: '' }] })}\r\n                                    className=\"px-2 py-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-[10px] font-bold text-slate-500 hover:text-blue-600 transition-colors\"\r\n                                >\r\n                                    + {col}\r\n                                </button>\r\n                            ))}\r\n                            <button\r\n                                onClick={() => syncDashboard({ ...activeDashboard, filters: [...(activeDashboard.filters || []), { column: '', operator: '=', value: '' }] })}\r\n                                className=\"px-3 py-1 bg-blue-600 text-white rounded text-[10px] font-bold shadow-sm shadow-blue-100 hover:bg-blue-700 transition-colors\"\r\n                            >\r\n                                {t('dashboard.add_filter')}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                        {(activeDashboard.filters || []).map((f, i) => (\r\n                            <div key={i} className=\"flex items-center gap-2 group animate-in slide-in-from-left-2 duration-200\" style={{ animationDelay: `${i * 50}ms` }}>\r\n                                <div className=\"flex-1 grid grid-cols-12 gap-2 p-1 bg-slate-50 dark:bg-slate-800/50 border border-slate-100 dark:border-slate-800 rounded-lg group-hover:border-slate-200 group-hover:bg-white dark:group-hover:bg-slate-800 transition-all\">\r\n                                    <input\r\n                                        placeholder={t('dashboard.filter_column')}\r\n                                        list=\"suggested-columns\"\r\n                                        className=\"col-span-4 p-1.5 text-[11px] bg-transparent outline-none font-bold text-slate-700 dark:text-slate-200\"\r\n                                        value={f.column}\r\n                                        onChange={e => {\r\n                                            const next = [...(activeDashboard.filters || [])];\r\n                                            next[i].column = e.target.value;\r\n                                            syncDashboard({ ...activeDashboard, filters: next });\r\n                                        }}\r\n                                    />\r\n                                    <select\r\n                                        className=\"col-span-3 p-1.5 text-[11px] bg-transparent outline-none border-l border-slate-100 dark:border-slate-800 text-slate-500 font-medium cursor-pointer\"\r\n                                        value={f.operator}\r\n                                        onChange={e => {\r\n                                            const next = [...(activeDashboard.filters || [])];\r\n                                            next[i].operator = e.target.value;\r\n                                            syncDashboard({ ...activeDashboard, filters: next });\r\n                                        }}\r\n                                    >\r\n                                        <option value=\"=\">=</option>\r\n                                        <option value=\"!=\">!=</option>\r\n                                        <option value=\">\">&gt;</option>\r\n                                        <option value=\"<\">&lt;</option>\r\n                                        <option value=\"contains\">{t('dashboard.op_contains')}</option>\r\n                                        <option value=\"is null\">{t('dashboard.op_is_null')}</option>\r\n                                    </select>\r\n                                    <input\r\n                                        placeholder={t('dashboard.filter_value')}\r\n                                        className=\"col-span-5 p-1.5 text-[11px] bg-transparent outline-none border-l border-slate-100 dark:border-slate-800 font-bold text-blue-600 dark:text-blue-400 placeholder:text-blue-200\"\r\n                                        value={f.value}\r\n                                        onChange={e => {\r\n                                            const next = [...(activeDashboard.filters || [])];\r\n                                            next[i].value = e.target.value;\r\n                                            syncDashboard({ ...activeDashboard, filters: next });\r\n                                        }}\r\n                                    />\r\n                                </div>\r\n                                <button\r\n                                    onClick={() => syncDashboard({ ...activeDashboard, filters: (activeDashboard.filters || []).filter((_, idx) => idx !== i) })}\r\n                                    className=\"p-1.5 text-slate-300 hover:text-red-500 transition-colors bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-lg shadow-sm\"\r\n                                >\r\n                                    <Trash2 className=\"w-3.5 h-3.5\" />\r\n                                </button>\r\n                            </div>\r\n                        ))}\r\n                        {(activeDashboard.filters || []).length === 0 && (\r\n                            <div className=\"py-8 text-center border-2 border-dashed border-slate-50 dark:border-slate-800 rounded-xl\">\r\n                                <Filter className=\"w-8 h-8 mx-auto mb-2 text-slate-200\" />\r\n                                <p className=\"text-[10px] font-black uppercase tracking-widest text-slate-300\">{t('dashboard.no_filters')}</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n            {/* Dashboard Tabs */}\r\n            <div className=\"mb-6 flex items-center justify-between border-b border-slate-200 dark:border-slate-800\">\r\n                <div className=\"flex items-center gap-1 overflow-x-auto no-scrollbar pb-px\">\r\n                    {dashboards.map(d => (\r\n                        <button\r\n                            key={d.id}\r\n                            onClick={() => setActiveDashboardId(d.id)}\r\n                            className={`px-4 py-2.5 text-sm font-bold transition-all border-b-2 whitespace-nowrap ${activeDashboardId === d.id\r\n                                ? 'text-blue-600 border-blue-600'\r\n                                : 'text-slate-400 border-transparent hover:text-slate-600'\r\n                                }`}\r\n                        >\r\n                            {d.name}\r\n                        </button>\r\n                    ))}\r\n                    <button\r\n                        onClick={() => { setIsCreating(true); setEditName(''); }}\r\n                        className=\"px-4 py-2.5 text-slate-400 hover:text-blue-600 transition-all border-b-2 border-transparent\"\r\n                        title={t('dashboard.new_dashboard_title')}\r\n                    >\r\n                        <Plus className=\"w-4 h-4\" />\r\n                    </button>\r\n                </div>\r\n\r\n                <button\r\n                    onClick={() => setIsManageModalOpen(true)}\r\n                    className=\"p-2 text-slate-400 hover:text-slate-600\"\r\n                    title={t('dashboard.manage_title')}\r\n                >\r\n                    <Settings className=\"w-4 h-4\" />\r\n                </button>\r\n            </div>\r\n\r\n            {/* Dashboard Name Editor (Inline Create) */}\r\n            {\r\n                isCreating && (\r\n                    <div className=\"mb-6 p-4 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-xl flex items-center gap-3\">\r\n                        <Layout className=\"w-5 h-5 text-slate-400\" />\r\n                        <input\r\n                            autoFocus\r\n                            type=\"text\"\r\n                            placeholder={t('dashboard.new_dashboard_placeholder')}\r\n                            className=\"flex-1 bg-transparent border-none outline-none font-bold text-slate-700 dark:text-slate-200\"\r\n                            value={editName}\r\n                            onChange={(e) => setEditName(e.target.value)}\r\n                            onKeyDown={(e) => e.key === 'Enter' && createDashboard()}\r\n                        />\r\n                        <div className=\"flex items-center gap-1\">\r\n                            <button onClick={createDashboard} className=\"p-1.5 text-green-600 hover:bg-green-50 rounded\"><Check className=\"w-4 h-4\" /></button>\r\n                            <button onClick={() => setIsCreating(false)} className=\"p-1.5 text-slate-400 hover:bg-slate-100 rounded\"><X className=\"w-4 h-4\" /></button>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            {\r\n                activeDashboard && activeDashboard.layout.length === 0 ? (\r\n                    <div className=\"flex flex-col items-center justify-center p-12 border-2 border-dashed border-slate-200 rounded-xl bg-slate-50 text-slate-400\">\r\n                        <Layout className=\"w-12 h-12 mb-4 opacity-50\" />\r\n                        <h3 className=\"font-bold text-lg text-slate-600\">{t('dashboard.empty_msg', { name: activeDashboard.name })}</h3>\r\n                        <p className=\"mb-4 text-sm text-center\">{t('dashboard.empty_hint')}</p>\r\n                        <button\r\n                            onClick={() => setIsAddModalOpen(true)}\r\n                            className=\"px-6 py-2 bg-white border border-slate-200 rounded-lg text-blue-600 font-bold hover:shadow-sm transition-all text-sm\"\r\n                        >\r\n                            {t('dashboard.add_title')}\r\n                        </button>\r\n                    </div>\r\n                ) : activeDashboard ? (\r\n                    <div id=\"dashboard-grid\" className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 auto-rows-[300px]\">\r\n                        {activeDashboard.layout.map((widgetRef, idx) => {\r\n                            // Render System Widget\r\n                            if (widgetRef.type === 'system') {\r\n                                const meta = SYSTEM_WIDGETS.find(w => w.id === widgetRef.id);\r\n                                if (!meta) return null;\r\n                                const Component = getComponent(meta.id);\r\n                                if (!Component) return null;\r\n\r\n                                return (\r\n                                    <div key={widgetRef.id + idx} className={`relative group h-full ${meta.defaultColSpan === 2 ? 'md:col-span-2' : ''}`}>\r\n                                        <div className=\"absolute top-2 right-2 z-10 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                            <button\r\n                                                onClick={(e) => { e.stopPropagation(); removeFromDashboard(widgetRef.id); }}\r\n                                                className=\"p-1.5 bg-white/90 backdrop-blur-sm border border-slate-200 rounded text-slate-400 hover:text-red-500 shadow-sm\"\r\n                                                title={t('common.remove')}\r\n                                            >\r\n                                                <Trash2 className=\"w-3 h-3\" />\r\n                                            </button>\r\n                                        </div>\r\n                                        <div className=\"h-full\">\r\n                                            <Component\r\n                                                onRemove={() => removeFromDashboard(widgetRef.id)}\r\n                                                targetView={COMPONENTS.find(c => c.component === meta.id)?.targetView}\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            }\r\n\r\n                            // Render Custom Widget\r\n                            const dbWidget = customWidgets?.find(w => w.id === widgetRef.id);\r\n                            if (!dbWidget) return null;\r\n\r\n                            let config;\r\n                            try {\r\n                                config = JSON.parse(dbWidget.visualization_config);\r\n                            } catch (e) {\r\n                                config = { type: 'table' };\r\n                            }\r\n\r\n                            return (\r\n                                <div key={widgetRef.id + idx} className=\"relative group md:col-span-1 xl:col-span-2 h-full\">\r\n                                    <div className=\"absolute top-2 right-2 z-10 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                        <button\r\n                                            onClick={() => removeFromDashboard(widgetRef.id)}\r\n                                            className=\"p-1.5 bg-white/90 backdrop-blur-sm border border-slate-200 rounded text-slate-400 hover:text-red-500 shadow-sm\"\r\n                                            title=\"Entfernen\"\r\n                                        >\r\n                                            <Trash2 className=\"w-3 h-3\" />\r\n                                        </button>\r\n                                    </div>\r\n                                    <WidgetRenderer\r\n                                        title={dbWidget.name}\r\n                                        sql={dbWidget.sql_query}\r\n                                        config={config}\r\n                                        globalFilters={activeDashboard.filters}\r\n                                    />\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                ) : null\r\n            }\r\n\r\n            {/* Manage Dashboards Modal */}\r\n            <Modal isOpen={isManageModalOpen} onClose={() => setIsManageModalOpen(false)} title={t('dashboard.manage_title')}>\r\n                <div className=\"space-y-3\">\r\n                    {dashboards.map(d => (\r\n                        <div key={d.id} className=\"flex items-center justify-between p-3 bg-white border border-slate-200 rounded-lg group\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <Layout className=\"w-4 h-4 text-slate-400\" />\r\n                                <span className=\"font-bold text-slate-700\">{d.name}</span>\r\n                                {d.is_default && <span className=\"text-[10px] bg-blue-50 text-blue-600 px-1.5 py-0.5 rounded font-black uppercase tracking-wider\">Default</span>}\r\n                            </div>\r\n                            <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                <button\r\n                                    onClick={() => {\r\n                                        const newName = prompt('Name fr Dashboard:', d.name);\r\n                                        if (newName && newName !== d.name) {\r\n                                            syncDashboard({ ...d, name: newName });\r\n                                        }\r\n                                    }}\r\n                                    className=\"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded\"\r\n                                >\r\n                                    <Edit2 className=\"w-3.5 h-3.5\" />\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => removeDashboard(d.id)}\r\n                                    disabled={dashboards.length <= 1}\r\n                                    className=\"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded disabled:opacity-30\"\r\n                                >\r\n                                    <Trash2 className=\"w-3.5 h-3.5\" />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                    <button\r\n                        onClick={() => { setIsManageModalOpen(false); setIsCreating(true); }}\r\n                        className=\"w-full p-3 border-2 border-dashed border-slate-100 rounded-lg text-slate-400 hover:text-blue-600 hover:border-blue-200 text-sm font-bold transition-all flex items-center justify-center gap-2\"\r\n                    >\r\n                        <Plus className=\"w-4 h-4\" /> Neues Dashboard\r\n                    </button>\r\n                </div>\r\n            </Modal>\r\n\r\n            {/* Add Widget Modal (Customized for active dashboard) */}\r\n            <Modal\r\n                isOpen={isAddModalOpen}\r\n                onClose={() => setIsAddModalOpen(false)}\r\n                title={t('dashboard.add_title')}\r\n            >\r\n                <div className=\"flex gap-4 mb-4 border-b border-slate-200\">\r\n                    <button\r\n                        onClick={() => setActiveTab('system')}\r\n                        className={`pb-2 text-sm font-bold ${activeTab === 'system' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-slate-400'}`}\r\n                    >\r\n                        {t('dashboard.system_widgets')}\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveTab('custom')}\r\n                        className={`pb-2 text-sm font-bold ${activeTab === 'custom' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-slate-400'}`}\r\n                    >\r\n                        {t('dashboard.custom_widgets')}\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"space-y-4 max-h-[60vh] overflow-y-auto min-h-[300px]\">\r\n                    {activeTab === 'system' && (\r\n                        <div className=\"grid grid-cols-1 gap-2\">\r\n                            {SYSTEM_WIDGETS.map(w => {\r\n                                const isAdded = activeDashboard?.layout.some(dw => dw.id === w.id);\r\n                                const componentConfig = COMPONENTS.find(c => c.component === w.id);\r\n                                const hasView = !!componentConfig?.targetView;\r\n                                const isPinned = hasView && visibleSidebarComponentIds.includes(componentConfig!.id);\r\n\r\n                                return (\r\n                                    <div key={w.id} className=\"flex items-center justify-between p-3 border border-slate-200 rounded-lg hover:bg-slate-50\">\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <div className=\"p-2 bg-slate-100 rounded-lg text-slate-500\">\r\n                                                <w.icon className=\"w-5 h-5\" />\r\n                                            </div>\r\n                                            <div>\r\n                                                <div className=\"font-bold text-slate-700\">{t(w.titleKey)}</div>\r\n                                                <div className=\"text-xs text-slate-400\">{t(w.descriptionKey)}</div>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            {/* Pin to Sidebar Toggle */}\r\n                                            {hasView && (\r\n                                                <button\r\n                                                    onClick={(e) => {\r\n                                                        e.stopPropagation();\r\n                                                        if (isPinned) {\r\n                                                            setVisibleSidebarComponentIds(visibleSidebarComponentIds.filter(id => id !== componentConfig!.id));\r\n                                                        } else {\r\n                                                            setVisibleSidebarComponentIds([...visibleSidebarComponentIds, componentConfig!.id]);\r\n                                                        }\r\n                                                    }}\r\n                                                    title={isPinned ? t('dashboard.unpin_sidebar') : t('dashboard.pin_sidebar')}\r\n                                                    className={`p-1.5 rounded-md border transition-all ${isPinned ? 'bg-amber-50 border-amber-200 text-amber-500' : 'bg-white border-slate-200 text-slate-300 hover:text-amber-400'}`}\r\n                                                >\r\n                                                    <Star className={`w-4 h-4 ${isPinned ? 'fill-current' : ''}`} />\r\n                                                </button>\r\n                                            )}\r\n\r\n                                            <button\r\n                                                onClick={() => addToDashboard(w.id, 'system')}\r\n                                                disabled={isAdded}\r\n                                                className={`px-3 py-1.5 text-xs font-bold rounded ${isAdded ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700 hover:bg-blue-200'}`}\r\n                                            >\r\n                                                {isAdded ? t('dashboard.active') : t('common.add')}\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    )}\r\n\r\n                    {activeTab === 'custom' && (\r\n                        <div className=\"grid grid-cols-1 gap-2\">\r\n                            {customWidgets && customWidgets.length > 0 ? customWidgets.map(w => {\r\n                                const isAdded = activeDashboard?.layout.some(dw => dw.id === w.id);\r\n                                return (\r\n                                    <div key={w.id} className=\"flex items-center justify-between p-3 border border-slate-200 rounded-lg hover:bg-slate-50\">\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <div className=\"p-2 bg-blue-50 rounded-lg text-blue-500\">\r\n                                                <Database className=\"w-5 h-5\" />\r\n                                            </div>\r\n                                            <div>\r\n                                                <div className=\"font-bold text-slate-700\">{w.name}</div>\r\n                                                <div className=\"text-xs text-slate-400 truncate max-w-[200px]\">{w.sql_query}</div>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"flex gap-2\">\r\n                                            <button\r\n                                                onClick={() => deleteCustomWidget(w.id)}\r\n                                                className=\"p-2 text-slate-400 hover:text-red-500\"\r\n                                                title={t('common.delete')}\r\n                                            >\r\n                                                <Trash2 className=\"w-4 h-4\" />\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={() => addToDashboard(w.id, 'custom')}\r\n                                                disabled={isAdded}\r\n                                                className={`px-3 py-1.5 text-xs font-bold rounded ${isAdded ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700 hover:bg-blue-200'}`}\r\n                                            >\r\n                                                {isAdded ? t('dashboard.active') : t('common.add')}\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            }) : (\r\n                                <p className=\"text-center text-slate-400 py-4\">{t('dashboard.no_reports')}</p>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </Modal>\r\n        </PageLayout >\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\views\\DataInspector.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1107,1110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1107,1110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1627,1630],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1627,1630],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'execute'. Either include it or remove the dependency array.","line":60,"column":8,"nodeType":"ArrayExpression","endLine":60,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [searchTerm, mode, execute]","fix":{"range":[2360,2378],"text":"[searchTerm, mode, execute]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2570,2573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2570,2573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3354,3357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3354,3357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useAsync } from '../../hooks/useAsync';\r\nimport { SystemRepository } from '../../lib/repositories/SystemRepository';\r\nimport { DataTable } from '../../components/ui/DataTable';\r\nimport { RecordDetailModal } from '../components/RecordDetailModal';\r\nimport { exportToExcel } from '../../lib/utils/exportUtils';\r\nimport { Download, RefreshCw, AlertCircle, Search, Database, Table as TableIcon, Code, Play } from 'lucide-react';\r\nimport { PageLayout } from '../components/ui/PageLayout';\r\n\r\ninterface DataInspectorProps {\r\n    onBack: () => void;\r\n}\r\n\r\nexport const DataInspector: React.FC<DataInspectorProps> = ({ onBack }) => {\r\n    const { t } = useTranslation();\r\n    const [mode, setMode] = useState<'table' | 'sql'>('table');\r\n    const [inputSql, setInputSql] = useState(''); // Textarea content\r\n\r\n    // Table Mode State\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [selectedTable, setSelectedTable] = useState('');\r\n    const [selectedItem, setSelectedItem] = useState<any>(null);\r\n    const limit = 500;\r\n\r\n    // Fetch available tables\r\n    const { data: tables } = useAsync<string[]>(\r\n        async () => {\r\n            const availableTables = await SystemRepository.getTables();\r\n            if (availableTables.length > 0 && !selectedTable) {\r\n                setSelectedTable(availableTables[0]);\r\n            }\r\n            return availableTables;\r\n        },\r\n        []\r\n    );\r\n\r\n    // Main Data Fetching\r\n    const { data: items, loading, error, refresh: execute } = useAsync<any[]>(\r\n        async () => {\r\n            if (mode === 'table') {\r\n                if (!selectedTable) return [];\r\n                return await SystemRepository.inspectTable(selectedTable, limit, searchTerm);\r\n            } else {\r\n                if (!inputSql) return []; // Don't run empty SQL\r\n                return await SystemRepository.executeRaw(inputSql);\r\n            }\r\n        },\r\n        [mode, selectedTable] // Auto-run when mode or table changes\r\n    );\r\n\r\n    // Debounced search for table mode\r\n    useEffect(() => {\r\n        if (mode === 'table') {\r\n            const timer = setTimeout(() => {\r\n                execute();\r\n            }, 500);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [searchTerm, mode]); // Re-run when searchTerm changes\r\n\r\n    const handleRunSql = () => {\r\n        if (!inputSql) return;\r\n        execute();\r\n    };\r\n\r\n    // Generate Columns dynamically\r\n    const columns: any[] = React.useMemo(() => {\r\n        if (!items || items.length === 0) return [];\r\n\r\n        const keys = Object.keys(items[0]);\r\n        return keys.map(key => {\r\n            const isAmount = key.toLowerCase().includes('amount') || key.toLowerCase().includes('price');\r\n            const isId = key.toLowerCase().includes('id');\r\n            const sampleVal = items[0][key];\r\n            const isNumeric = typeof sampleVal === 'number';\r\n\r\n            return {\r\n                header: key,\r\n                accessor: key,\r\n                align: isNumeric ? 'right' : 'left',\r\n                className: isId ? 'font-mono text-[10px] text-slate-400' :\r\n                    (key === 'Period' || key === 'PostingDate' ? 'font-mono' : ''),\r\n                render: isAmount ? (item: any) => (\r\n                    <span className={item[key] < 0 ? 'text-red-500' : 'text-slate-900 dark:text-slate-100'}>\r\n                        {new Intl.NumberFormat('de-DE', {\r\n                            style: 'currency',\r\n                            currency: (item.Currency as string) || 'EUR'\r\n                        }).format((item[key] as number) || 0)}\r\n                    </span>\r\n                ) : undefined\r\n            };\r\n        });\r\n    }, [items]);\r\n\r\n    const now = new Date();\r\n    const footerText = `${t('common.loading').replace('...', '')} ${now.toLocaleDateString('de-DE')}, ${now.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })}`;\r\n\r\n    return (\r\n        <PageLayout\r\n            header={{\r\n                title: t('sidebar.data_inspector'),\r\n                subtitle: t('datainspector.subtitle', { count: items?.length || 0, mode: mode === 'table' ? selectedTable : t('datainspector.sql_mode') }),\r\n                onBack,\r\n                actions: (\r\n                    <>\r\n                        {/* Mode Toggle */}\r\n                        <div className=\"flex items-center bg-slate-100 dark:bg-slate-800 p-1 rounded-lg\">\r\n                            <button\r\n                                onClick={() => {\r\n                                    setMode('table');\r\n                                    execute();\r\n                                }}\r\n                                className={`px-3 py-1.5 rounded-md text-sm font-medium transition-all flex items-center gap-2 ${mode === 'table' ? 'bg-white dark:bg-slate-700 shadow text-blue-600 dark:text-blue-400' : 'text-slate-500 hover:text-slate-700 dark:hover:text-slate-300'}`}\r\n                            >\r\n                                <TableIcon className=\"w-4 h-4\" />\r\n                                {t('datainspector.table_mode')}\r\n                            </button>\r\n                            <button\r\n                                onClick={() => {\r\n                                    setMode('sql');\r\n                                    if (!inputSql) setInputSql(`SELECT * FROM ${selectedTable} LIMIT 10`);\r\n                                }}\r\n                                className={`px-3 py-1.5 rounded-md text-sm font-medium transition-all flex items-center gap-2 ${mode === 'sql' ? 'bg-white dark:bg-slate-700 shadow text-blue-600 dark:text-blue-400' : 'text-slate-500 hover:text-slate-700 dark:hover:text-slate-300'}`}\r\n                            >\r\n                                <Code className=\"w-4 h-4\" />\r\n                                {t('datainspector.sql_mode')}\r\n                            </button>\r\n                        </div>\r\n\r\n                        {/* Refresh */}\r\n                        <button\r\n                            onClick={execute}\r\n                            className=\"h-10 w-10 flex items-center justify-center bg-white dark:bg-slate-800 text-slate-500 dark:text-slate-400 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 hover:text-slate-700 dark:hover:text-slate-200 transition-all\"\r\n                            title={t('datainspector.refresh_title')}\r\n                        >\r\n                            <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\r\n                        </button>\r\n\r\n                        {/* Export */}\r\n                        <button\r\n                            onClick={() => {\r\n                                if (!items || items.length === 0) return;\r\n                                const timestamp = new Date().toISOString().slice(0, 10);\r\n                                exportToExcel(items, `export_${timestamp}`, \"Export\");\r\n                            }}\r\n                            className=\"h-10 flex items-center gap-2 px-4 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 text-sm font-semibold rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 transition-all\"\r\n                        >\r\n                            <Download className=\"w-4 h-4\" />\r\n                            <span className=\"hidden sm:inline\">{t('datainspector.export_excel')}</span>\r\n                        </button>\r\n                    </>\r\n                ),\r\n            }}\r\n            footer={footerText}\r\n            breadcrumbs={[\r\n                { label: 'Data Inspector' }\r\n            ]}\r\n            fillHeight\r\n        >\r\n            {/* Loading Bar at Top */}\r\n            <div className=\"fixed top-0 left-0 w-full h-[3px] bg-blue-100 dark:bg-blue-900/30 z-[100] overflow-hidden\">\r\n                {loading && (\r\n                    <div className=\"h-full bg-blue-600 dark:bg-blue-400 animate-pulse\" style={{ width: '40%' }} />\r\n                )}\r\n            </div>\r\n\r\n            {/* Controls Row: Selection or SQL Editor */}\r\n            {mode === 'table' ? (\r\n                <div className=\"flex bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 items-center justify-between shadow-sm flex-shrink-0\">\r\n                    <div className=\"flex items-center gap-4 flex-1\">\r\n                        <div className=\"relative\">\r\n                            <select\r\n                                value={selectedTable}\r\n                                onChange={(e) => {\r\n                                    setSelectedTable(e.target.value);\r\n                                    setSearchTerm('');\r\n                                }}\r\n                                className=\"appearance-none pl-10 pr-10 py-2 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer text-sm font-medium\"\r\n                            >\r\n                                {tables?.map(t => (\r\n                                    <option key={t} value={t}>{t}</option>\r\n                                ))}\r\n                            </select>\r\n                            <Database className=\"absolute left-3 top-2.5 w-4 h-4 text-slate-400 pointer-events-none\" />\r\n                            <div className=\"absolute right-3 top-3.5 w-2 h-2 border-r-2 border-b-2 border-slate-400 rotate-45 pointer-events-none\" />\r\n                        </div>\r\n\r\n                        <div className=\"relative max-w-md w-full ml-4\">\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder={t('datainspector.search_placeholder')}\r\n                                value={searchTerm}\r\n                                onChange={(e) => setSearchTerm(e.target.value)}\r\n                                className=\"w-full pl-10 pr-4 py-2 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                            />\r\n                            <Search className=\"absolute left-3 top-2.5 w-4 h-4 text-slate-400\" />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"text-xs text-slate-400 font-medium\">\r\n                        {t('datainspector.auto_limit', { limit })}\r\n                    </div>\r\n                </div>\r\n            ) : (\r\n                <div className=\"flex flex-col gap-2 bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm ring-1 ring-slate-900/5 flex-shrink-0\">\r\n                    <div className=\"relative\">\r\n                        <textarea\r\n                            value={inputSql}\r\n                            onChange={(e) => setInputSql(e.target.value)}\r\n                            placeholder={t('datainspector.sql_placeholder')}\r\n                            className=\"w-full h-24 p-4 font-mono text-sm bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none text-slate-800 dark:text-slate-200\"\r\n                        />\r\n                        <div className=\"absolute bottom-4 right-4 flex gap-2\">\r\n                            <button\r\n                                onClick={() => setInputSql('')}\r\n                                className=\"px-3 py-1 text-xs text-slate-500 hover:text-slate-700 dark:hover:text-slate-300\"\r\n                            >\r\n                                {t('datainspector.clear_sql')}\r\n                            </button>\r\n                            <button\r\n                                onClick={handleRunSql}\r\n                                className=\"flex items-center gap-2 px-4 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium shadow-sm transition-colors\"\r\n                            >\r\n                                {loading ? <RefreshCw className=\"w-3 h-3 animate-spin\" /> : <Play className=\"w-3 h-3 fill-current\" />}\r\n                                {t('datainspector.run_sql')}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"flex-1 bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden flex flex-col min-h-0 relative\">\r\n                {/* Opaque loading overlay when refreshing results */}\r\n                {loading && items && items.length > 0 && (\r\n                    <div className=\"absolute inset-0 bg-white/40 dark:bg-slate-800/40 z-10 flex items-center justify-center backdrop-blur-[1px]\">\r\n                        <div className=\"bg-white dark:bg-slate-900 p-4 rounded-full shadow-xl border border-slate-100 dark:border-slate-700\">\r\n                            <RefreshCw className=\"w-8 h-8 text-blue-600 dark:text-blue-400 animate-spin\" />\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"flex-1 overflow-hidden flex flex-col relative min-h-0\">\r\n                    {loading && !items ? (\r\n                        <div className=\"flex-1 flex items-center justify-center p-12 text-center text-slate-400 animate-pulse\">\r\n                            <div className=\"flex flex-col items-center gap-4\">\r\n                                <Search className=\"w-12 h-12 opacity-20\" />\r\n                                <p className=\"text-lg\">{t('common.loading')}</p>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <DataTable\r\n                            data={items || []}\r\n                            columns={columns}\r\n                            searchTerm=\"\"\r\n                            emptyMessage={mode === 'sql' && !inputSql ? t('datainspector.empty_sql') : t('common.no_data')}\r\n                            onRowClick={(item) => setSelectedItem(item)}\r\n                        />\r\n                    )}\r\n                </div>\r\n                <div className=\"px-4 py-2 border-t border-slate-100 dark:border-slate-700 text-[10px] flex justify-between items-center text-slate-400 bg-slate-50/50 dark:bg-slate-900/50\">\r\n                    <div className=\"font-medium\">\r\n                        {mode === 'table' ? t('datainspector.auto_limit', { limit }) : t('datainspector.sql_mode')}\r\n                    </div>\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <span className=\"flex items-center gap-1\"><Database className=\"w-3 h-3\" /> LiteBI Studio DB</span>\r\n                        <span className=\"font-medium\">{t('common.results_count', { count: items?.length || 0 })}</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Universal Record Detail Modal */}\r\n            <RecordDetailModal\r\n                isOpen={!!selectedItem}\r\n                onClose={() => setSelectedItem(null)}\r\n                items={items || []}\r\n                initialIndex={items && selectedItem ? Math.max(0, items.indexOf(selectedItem)) : 0}\r\n                title={t('common.details')}\r\n                tableName={selectedTable}\r\n                schema={undefined}\r\n            />\r\n\r\n            {/* Error Toast / Floating Alert */}\r\n            {\r\n                error && (\r\n                    <div className=\"absolute bottom-8 left-1/2 -translate-x-1/2 bg-red-100 dark:bg-red-900/50 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 animate-in slide-in-from-bottom-2 fade-in\">\r\n                        <AlertCircle className=\"w-5 h-5 shrink-0\" />\r\n                        <div className=\"flex flex-col\">\r\n                            <p className=\"text-sm font-bold\">{t('datainspector.sql_error')}</p>\r\n                            <p className=\"text-xs opacity-90\">{String(error)}</p>\r\n                        </div>\r\n                        <button onClick={execute} className=\"ml-auto p-1.5 hover:bg-red-200 dark:hover:bg-red-800 rounded-md transition-colors\">\r\n                            <RefreshCw className=\"w-4 h-4\" />\r\n                        </button>\r\n                    </div>\r\n                )\r\n            }\r\n        </PageLayout >\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\views\\DatasourceView.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1657,1660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1657,1660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3343,3346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3343,3346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5865,5868],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5865,5868],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6310,6313],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6310,6313],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":153,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6743,6746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6743,6746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":400,"column":101,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":400,"endColumn":104,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23989,23992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23989,23992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":403,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":403,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24138,24141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24138,24141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":442,"column":62,"nodeType":"Identifier","messageId":"unusedVar","endLine":442,"endColumn":65},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":453,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":453,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27892,27895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27892,27895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Info, Database, Upload, Table as TableIcon, Plus, Trash2, AlertTriangle, RefreshCw } from 'lucide-react';\r\nimport { ExcelImport, type ImportConfig } from '../components/ExcelImport';\r\nimport { SmartImport } from '../components/SmartImport';\r\nimport { SchemaTable } from '../components/SchemaDocumentation';\r\nimport { Modal } from '../components/Modal';\r\nimport { PageLayout } from '../components/ui/PageLayout';\r\nimport { MappingManager } from '../components/MappingManager';\r\nimport { useBackupStatus } from '../../hooks/useBackupStatus';\r\nimport { SystemRepository } from '../../lib/repositories/SystemRepository';\r\nimport { useAsync } from '../../hooks/useAsync';\r\nimport { encryptBuffer, decryptBuffer } from '../../lib/utils/crypto';\r\nimport { Lock, Unlock } from 'lucide-react';\r\n\r\ninterface DatasourceViewProps {\r\n    onImportComplete: () => void;\r\n}\r\n\r\nexport const DatasourceView: React.FC<DatasourceViewProps> = ({ onImportComplete }) => {\r\n    const { t, i18n } = useTranslation();\r\n    const now = new Date();\r\n    const footerText = t('settings.last_update', {\r\n        date: now.toLocaleDateString(i18n.language === 'de' ? 'de-DE' : 'en-US'),\r\n        time: now.toLocaleTimeString(i18n.language === 'de' ? 'de-DE' : 'en-US', { hour: '2-digit', minute: '2-digit' })\r\n    });\r\n\r\n    // Tab State\r\n    const [activeTab, setActiveTab] = useState<'import' | 'structure' | 'system'>('import');\r\n\r\n    // Import State\r\n    const [selectedTable, setSelectedTable] = useState<string>('');\r\n    const [tableSchema, setTableSchema] = useState<any>(null);\r\n    const [isSchemaOpen, setIsSchemaOpen] = useState(false);\r\n\r\n    // Schema Manager State\r\n    const [isCreateModalOpen, setIsCreateModalOpen] = useState(false);\r\n    const [newTableName, setNewTableName] = useState('');\r\n    const [sqlMode, setSqlMode] = useState(false);\r\n    const [customSql, setCustomSql] = useState('CREATE TABLE usr_my_table (\\n    id INTEGER PRIMARY KEY,\\n    name TEXT,\\n    amount REAL\\n);');\r\n    const [createColumns, setCreateColumns] = useState<{ name: string, type: string }[]>([{ name: 'id', type: 'INTEGER PRIMARY KEY' }]);\r\n\r\n    const { isBackupRecommended, changeCount, markBackupComplete } = useBackupStatus();\r\n\r\n    // Backup State\r\n    const [useEncryption, setUseEncryption] = useState(false);\r\n    const [backupPassword, setBackupPassword] = useState('');\r\n\r\n    // Fetch Tables\r\n    const { data: tables, refresh: refreshTables } = useAsync<string[]>(\r\n        () => SystemRepository.getTables(),\r\n        []\r\n    );\r\n\r\n    // Filter Tables\r\n    const isSystemTable = (name: string) => name.startsWith('sys_') || name === 'sqlite_sequence';\r\n    const userTables = tables?.filter((t: string) => !isSystemTable(t)) || [];\r\n    const systemTables = tables?.filter((t: string) => isSystemTable(t)) || [];\r\n\r\n    // Load Schema for selected table (Generic Import)\r\n    useEffect(() => {\r\n        const loadSchema = async () => {\r\n            if (!selectedTable) {\r\n                setTableSchema(null);\r\n                return;\r\n            }\r\n\r\n            // Dynamic Schema\r\n            try {\r\n                const columns = await SystemRepository.getTableSchema(selectedTable);\r\n                const properties: Record<string, any> = {};\r\n                columns.forEach(col => {\r\n                    properties[col.name] = {\r\n                        type: col.type.toUpperCase().includes('INT') || col.type.toUpperCase().includes('REAL') ? 'number' : 'string',\r\n                        description: col.type\r\n                    };\r\n                });\r\n                setTableSchema({\r\n                    title: selectedTable,\r\n                    description: t('datasource.records_label', { name: selectedTable }),\r\n                    properties,\r\n                    required: columns.filter(c => c.notnull).map(c => c.name)\r\n                });\r\n            } catch (e) {\r\n                console.error(\"Failed to load schema\", e);\r\n                setTableSchema(null);\r\n            }\r\n        };\r\n        loadSchema();\r\n    }, [selectedTable, tables, t]); // Reload schema when table selection OR table list changes (e.g. after migration/drop)\r\n\r\n    // Build Import Config\r\n    const getImportConfig = (): ImportConfig | undefined => {\r\n        if (!selectedTable || !tableSchema) return undefined;\r\n\r\n        return {\r\n            key: `import_${selectedTable}`,\r\n            entityLabel: t('datasource.records_label', { name: selectedTable }),\r\n            schema: tableSchema,\r\n            validate: () => true,\r\n            getValidationErrors: () => [],\r\n            importFn: async (data) => {\r\n                const CHUNK_SIZE = 500;\r\n                for (let i = 0; i < data.length; i += CHUNK_SIZE) {\r\n                    await SystemRepository.bulkInsert(selectedTable, data.slice(i, i + CHUNK_SIZE));\r\n                }\r\n            },\r\n            clearFn: async () => {\r\n                await SystemRepository.executeRaw(`DELETE FROM ${selectedTable}`);\r\n            }\r\n        };\r\n    };\r\n\r\n    const activeConfig = getImportConfig();\r\n\r\n    // Table Actions\r\n    const handleCreateTable = async () => {\r\n        try {\r\n            if (sqlMode) {\r\n                await SystemRepository.executeRaw(customSql);\r\n            } else {\r\n                const cols = createColumns.map(c => `${c.name} ${c.type}`).join(', ');\r\n                const sql = `CREATE TABLE ${newTableName} (${cols})`;\r\n                await SystemRepository.executeRaw(sql);\r\n            }\r\n            setIsCreateModalOpen(false);\r\n            refreshTables();\r\n            setNewTableName('');\r\n            setCreateColumns([{ name: 'id', type: 'INTEGER PRIMARY KEY' }]);\r\n            alert(t('datasource.table_created'));\r\n        } catch (error: any) {\r\n            alert(t('common.error') + ': ' + error.message);\r\n        }\r\n    };\r\n\r\n    const handleDropTable = async (tableName: string) => {\r\n        if (!confirm(t('datasource.drop_confirm', { name: tableName }))) return;\r\n        try {\r\n            await SystemRepository.executeRaw(`DROP TABLE ${tableName}`);\r\n            refreshTables();\r\n            if (selectedTable === tableName) setSelectedTable('');\r\n        } catch (error: any) {\r\n            alert(t('common.error') + ': ' + error.message);\r\n        }\r\n    };\r\n\r\n    const handleClearTable = async (tableName: string) => {\r\n        if (!confirm(t('datasource.clear_confirm', { name: tableName }))) return;\r\n        try {\r\n            await SystemRepository.executeRaw(`DELETE FROM ${tableName}`);\r\n            refreshTables();\r\n            alert(t('datasource.cleared_success'));\r\n        } catch (error: any) {\r\n            alert(t('common.error') + ': ' + error.message);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <PageLayout\r\n            header={{\r\n                title: t('sidebar.datasource'),\r\n                subtitle: t('datasource.subtitle'),\r\n                onBack: () => window.history.back(),\r\n                actions: (\r\n                    <div className=\"flex bg-slate-100 dark:bg-slate-700 p-1 rounded-lg\">\r\n                        <button\r\n                            onClick={() => setActiveTab('import')}\r\n                            className={`px-3 py-1.5 text-xs font-bold rounded-md transition-all ${activeTab === 'import' ? 'bg-white dark:bg-slate-600 shadow text-blue-600 dark:text-blue-300' : 'text-slate-500 hover:text-slate-700'}`}\r\n                        >\r\n                            <span className=\"flex items-center gap-2\"><Upload className=\"w-3 h-3\" /> {t('datasource.tab_import')}</span>\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setActiveTab('structure')}\r\n                            className={`px-3 py-1.5 text-xs font-bold rounded-md transition-all ${activeTab === 'structure' ? 'bg-white dark:bg-slate-600 shadow text-blue-600 dark:text-blue-300' : 'text-slate-500 hover:text-slate-700'}`}\r\n                        >\r\n                            <span className=\"flex items-center gap-2\"><TableIcon className=\"w-3 h-3\" /> {t('datasource.tab_structure')}</span>\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setActiveTab('system')}\r\n                            className={`px-3 py-1.5 text-xs font-bold rounded-md transition-all ${activeTab === 'system' ? 'bg-white dark:bg-slate-600 shadow text-blue-600 dark:text-blue-300' : 'text-slate-500 hover:text-slate-700'}`}\r\n                        >\r\n                            <span className=\"flex items-center gap-2\"><Database className=\"w-3 h-3\" /> {t('datasource.tab_system')}</span>\r\n                        </button>\r\n                    </div>\r\n                )\r\n            }}\r\n            footer={footerText}\r\n        >\r\n            <div className=\"max-w-4xl space-y-6 mx-auto\">\r\n\r\n                {/* --- TAB: IMPORT (Smart & Generic) --- */}\r\n                {activeTab === 'import' && (\r\n                    <div className=\"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n\r\n                        {/* 1. Smart Import (New Tables) */}\r\n                        <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm\">\r\n                            <div className=\"flex items-center gap-3 mb-6\">\r\n                                <div className=\"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600\">\r\n                                    <Plus className=\"w-5 h-5\" />\r\n                                </div>\r\n                                <div>\r\n                                    <h3 className=\"text-sm font-bold text-slate-700 dark:text-slate-200 uppercase tracking-widest\">{t('datasource.smart_import_title')}</h3>\r\n                                    <p className=\"text-xs text-slate-400\">{t('datasource.smart_import_hint')}</p>\r\n                                </div>\r\n                            </div>\r\n                            <SmartImport />\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <div className=\"h-px bg-slate-200 dark:bg-slate-700 flex-1\" />\r\n                            <span className=\"text-xs font-bold text-slate-400 uppercase\">{t('datasource.or_separator')}</span>\r\n                            <div className=\"h-px bg-slate-200 dark:bg-slate-700 flex-1\" />\r\n                        </div>\r\n\r\n                        {/* 2. Generic Import (Append Data) */}\r\n                        <div className=\"bg-slate-50 dark:bg-slate-800/50 rounded-2xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm\">\r\n                            <div className=\"flex items-center justify-between mb-6\">\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <div className=\"p-2 bg-white dark:bg-slate-700 rounded-lg text-slate-600 dark:text-slate-300 shadow-sm\">\r\n                                        <Database className=\"w-5 h-5\" />\r\n                                    </div>\r\n                                    <div>\r\n                                        <h3 className=\"text-sm font-bold text-slate-700 dark:text-slate-200 uppercase tracking-widest\">{t('datasource.append_data_title')}</h3>\r\n                                        <p className=\"text-xs text-slate-400\">{t('datasource.append_data_hint')}</p>\r\n                                    </div>\r\n                                </div>\r\n                                <MappingManager />\r\n                            </div>\r\n\r\n                            <div className=\"mb-6\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <select\r\n                                        value={selectedTable}\r\n                                        onChange={e => setSelectedTable(e.target.value)}\r\n                                        className=\"w-full md:w-1/2 p-2.5 bg-white border border-slate-200 rounded-lg text-sm font-medium text-slate-700 outline-none focus:ring-2 focus:ring-blue-500\"\r\n                                    >\r\n                                        <option value=\"\" disabled>{t('datasource.select_target_table')}</option>\r\n                                        {tables?.filter((t: string) => !isSystemTable(t)).map((t: string) => (\r\n                                            <option key={t} value={t}>{t}</option>\r\n                                        ))}\r\n                                    </select>\r\n                                    <button onClick={() => refreshTables()} className=\"p-2.5 bg-white border border-slate-200 text-slate-400 hover:text-blue-600 rounded-lg\">\r\n                                        <RefreshCw className=\"w-5 h-5\" />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {selectedTable && (\r\n                                <ExcelImport\r\n                                    key={selectedTable}\r\n                                    onImportComplete={onImportComplete}\r\n                                    config={activeConfig}\r\n                                />\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* --- TAB: STRUCTURE (Schema & Tables) --- */}\r\n                {activeTab === 'structure' && (\r\n                    <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n                        {/* Custom Tables Manager */}\r\n                        <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm\">\r\n                            <div className=\"flex items-center justify-between mb-6\">\r\n                                <div>\r\n                                    <h3 className=\"text-sm font-semibold text-slate-500 uppercase tracking-wider flex items-center gap-2\">\r\n                                        <TableIcon className=\"w-4 h-4\" /> {t('datasource.user_tables')}\r\n                                    </h3>\r\n                                    <p className=\"text-xs text-slate-400 mt-1\">{t('datasource.user_tables_hint')}</p>\r\n                                </div>\r\n                                <button\r\n                                    onClick={() => setIsCreateModalOpen(true)}\r\n                                    className=\"flex items-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs font-bold transition-colors shadow-sm\"\r\n                                >\r\n                                    <Plus className=\"w-4 h-4\" /> {t('datasource.new_table')}\r\n                                </button>\r\n                            </div>\r\n\r\n                            {userTables.length === 0 ? (\r\n                                <div className=\"p-8 text-center border-2 border-dashed border-slate-200 rounded-xl bg-slate-50\">\r\n                                    <p className=\"text-slate-400 text-sm\">{t('datasource.no_user_tables')}</p>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                    {userTables.map((t_name: string) => (\r\n                                        <div key={t_name} className=\"p-4 bg-slate-50 border border-slate-200 rounded-xl flex items-center justify-between group\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <div className=\"p-2 bg-white rounded-lg shadow-sm text-blue-600\">\r\n                                                    <TableIcon className=\"w-4 h-4\" />\r\n                                                </div>\r\n                                                <span className=\"font-bold text-slate-700\">{t_name}</span>\r\n                                            </div>\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <button\r\n                                                    onClick={() => { setSelectedTable(t_name); setIsSchemaOpen(true); }}\r\n                                                    className=\"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors\"\r\n                                                    title={t('datasource.show_schema')}\r\n                                                >\r\n                                                    <Info className=\"w-4 h-4\" />\r\n                                                </button>\r\n                                                <button\r\n                                                    onClick={() => { setSelectedTable(t_name); setActiveTab('import'); }}\r\n                                                    className=\"p-1.5 text-slate-400 hover:text-green-600 hover:bg-green-50 rounded transition-colors\"\r\n                                                    title={t('datasource.append_data_short')}\r\n                                                >\r\n                                                    <Upload className=\"w-4 h-4\" />\r\n                                                </button>\r\n                                                <button\r\n                                                    onClick={() => handleDropTable(t_name)}\r\n                                                    className=\"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors\"\r\n                                                    title={t('common.delete')}\r\n                                                >\r\n                                                    <Trash2 className=\"w-4 h-4\" />\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* System Tables Read-Only */}\r\n                        <div className=\"bg-slate-100 dark:bg-slate-800/50 rounded-2xl p-6\">\r\n                            <h3 className=\"text-xs font-bold text-slate-400 uppercase tracking-widest mb-4\">{t('datasource.system_tables')}</h3>\r\n                            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n                                {systemTables.map((t_name: string) => (\r\n                                    <button\r\n                                        key={t_name}\r\n                                        onClick={() => { setSelectedTable(t_name); setIsSchemaOpen(true); }}\r\n                                        className=\"px-3 py-2 bg-white/50 border border-slate-200/50 rounded text-xs font-mono text-slate-500 hover:bg-white hover:text-blue-600 text-left transition-colors\"\r\n                                    >\r\n                                        {t_name}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* --- TAB: SYSTEM (Maintenace & Backup) --- */}\r\n                {activeTab === 'system' && (\r\n                    <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n                        {/* Backup Section */}\r\n                        <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm\">\r\n                            <h3 className=\"text-sm font-semibold text-slate-500 uppercase tracking-wider mb-4\">{t('datasource.backup_restore')}</h3>\r\n\r\n                            {isBackupRecommended && (\r\n                                <div className=\"mb-4 p-3 bg-amber-50 text-amber-800 rounded-lg border border-amber-200 text-xs flex items-center gap-2\">\r\n                                    <AlertTriangle className=\"w-4 h-4\" />\r\n                                    <span>{t('datasource.backup_recommended', { count: changeCount })}</span>\r\n                                </div>\r\n                            )}\r\n\r\n                            <div className=\"space-y-4\">\r\n                                {/* Encryption Toggle */}\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <button\r\n                                        onClick={() => setUseEncryption(!useEncryption)}\r\n                                        className={`flex-1 p-3 rounded-xl border flex items-center gap-3 transition-all ${useEncryption ? 'bg-emerald-50 border-emerald-200 ring-1 ring-emerald-500' : 'bg-slate-50 border-slate-200'}`}\r\n                                    >\r\n                                        <div className={`p-2 rounded-lg ${useEncryption ? 'bg-emerald-100 text-emerald-600' : 'bg-slate-200 text-slate-500'}`}>\r\n                                            {useEncryption ? <Lock className=\"w-4 h-4\" /> : <Unlock className=\"w-4 h-4\" />}\r\n                                        </div>\r\n                                        <div className=\"text-left\">\r\n                                            <div className={`text-sm font-bold ${useEncryption ? 'text-emerald-900' : 'text-slate-600'}`}>\r\n                                                {useEncryption ? t('datasource.encryption_active') : t('datasource.encryption_standard')}\r\n                                            </div>\r\n                                            <div className=\"text-xs text-slate-400\">\r\n                                                {useEncryption ? t('datasource.encryption_active_hint') : t('datasource.encryption_standard_hint')}\r\n                                            </div>\r\n                                        </div>\r\n                                    </button>\r\n                                </div>\r\n\r\n                                {useEncryption && (\r\n                                    <div className=\"animate-in fade-in slide-in-from-top-2\">\r\n                                        <input\r\n                                            type=\"password\"\r\n                                            placeholder={t('datasource.backup_password_placeholder')}\r\n                                            value={backupPassword}\r\n                                            onChange={e => setBackupPassword(e.target.value)}\r\n                                            className=\"w-full p-3 bg-white border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-emerald-500\"\r\n                                            autoFocus\r\n                                        />\r\n                                    </div>\r\n                                )}\r\n\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 pt-2\">\r\n                                    <button\r\n                                        onClick={async () => {\r\n                                            if (useEncryption && backupPassword.length < 4) {\r\n                                                alert(t('datasource.backup_password_error'));\r\n                                                return;\r\n                                            }\r\n\r\n                                            const { exportDatabase } = await import('../../lib/db');\r\n                                            let bytes = await exportDatabase();\r\n\r\n                                            if (useEncryption) {\r\n                                                bytes = new Uint8Array(await encryptBuffer(bytes as any, backupPassword));\r\n                                            }\r\n\r\n                                            const blob = new Blob([bytes as any], { type: 'application/x-sqlite3' });\r\n                                            const url = URL.createObjectURL(blob);\r\n                                            const a = document.createElement('a');\r\n                                            a.href = url;\r\n                                            a.download = `backup_${new Date().toISOString().split('T')[0]}${useEncryption ? '_secure' : ''}.sqlite3`;\r\n                                            a.click();\r\n                                            markBackupComplete();\r\n                                            if (useEncryption) setBackupPassword('');\r\n                                        }}\r\n                                        className={`flex items-center justify-center gap-2 p-3 border rounded-lg text-sm font-bold transition-colors ${useEncryption ? 'bg-emerald-600 border-emerald-700 text-white hover:bg-emerald-700' : 'bg-slate-50 border-slate-200 text-slate-700 hover:bg-slate-100'}`}\r\n                                    >\r\n                                        <Database className=\"w-4 h-4\" />\r\n                                        {useEncryption ? t('datasource.save_backup_secure') : t('datasource.save_backup_standard')}\r\n                                    </button>\r\n\r\n                                    <div className=\"relative\">\r\n                                        <input\r\n                                            type=\"file\"\r\n                                            accept=\".sqlite3\"\r\n                                            className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\"\r\n                                            onChange={async (e) => {\r\n                                                const file = e.target.files?.[0];\r\n                                                if (!file) return;\r\n\r\n                                                const buffer = await file.arrayBuffer();\r\n                                                const header = new Uint8Array(buffer.slice(0, 16));\r\n                                                const headerString = new TextDecoder().decode(header);\r\n                                                const isSqlite = headerString.startsWith('SQLite format 3');\r\n\r\n                                                let finalBuffer = buffer;\r\n\r\n                                                if (!isSqlite) {\r\n                                                    // Assume encrypted\r\n                                                    const pwd = prompt(t('datasource.restore_encrypted_prompt'));\r\n                                                    if (!pwd) return;\r\n\r\n                                                    try {\r\n                                                        const decrypted = await decryptBuffer(buffer, pwd);\r\n                                                        finalBuffer = decrypted;\r\n                                                    } catch (err) {\r\n                                                        alert(t('datasource.restore_failed'));\r\n                                                        return;\r\n                                                    }\r\n                                                }\r\n\r\n                                                if (confirm(t('datasource.restore_confirm'))) {\r\n                                                    try {\r\n                                                        const { importDatabase } = await import('../../lib/db');\r\n                                                        await importDatabase(finalBuffer);\r\n                                                        window.location.reload();\r\n                                                    } catch (err: any) { alert(t('common.error') + ': ' + err.message); }\r\n                                                }\r\n                                            }}\r\n                                        />\r\n                                        <button className=\"w-full flex items-center justify-center gap-2 p-3 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg text-sm font-bold text-slate-700 transition-colors pointer-events-none\">\r\n                                            <Upload className=\"w-4 h-4 text-amber-500\" /> {t('datasource.restore_backup')}\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Danger Zone */}\r\n                        <div className=\"bg-red-50/50 dark:bg-red-900/10 border border-red-200 dark:border-red-900/30 rounded-2xl p-6\">\r\n                            <div className=\"flex items-center gap-3 mb-6\">\r\n                                <div className=\"p-2 bg-red-100 dark:bg-red-900/30 rounded-lg text-red-600\">\r\n                                    <AlertTriangle className=\"w-5 h-5\" />\r\n                                </div>\r\n                                <div>\r\n                                    <h3 className=\"text-sm font-bold text-red-900 dark:text-red-100 uppercase tracking-widest\">{t('datasource.danger_zone')}</h3>\r\n                                    <p className=\"text-xs text-red-700/70 dark:text-red-300/60\">{t('datasource.danger_zone_hint')}</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                {/* Clear Data Card */}\r\n                                <div className=\"bg-white dark:bg-slate-900 border border-red-100 dark:border-red-900/20 rounded-xl p-4 shadow-sm\">\r\n                                    <h4 className=\"text-xs font-black text-slate-400 uppercase mb-3\">{t('datasource.clear_reset')}</h4>\r\n                                    <div className=\"space-y-3\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <select\r\n                                                id=\"clear-table-select\"\r\n                                                className=\"flex-1 p-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs outline-none\"\r\n                                                defaultValue=\"\"\r\n                                            >\r\n                                                <option value=\"\" disabled>{t('datasource.select_target_table')}</option>\r\n                                                {tables?.map((table_n: string) => <option key={table_n} value={table_n}>{table_n}</option>)}\r\n                                            </select>\r\n                                            <button\r\n                                                onClick={() => {\r\n                                                    const select = document.getElementById('clear-table-select') as HTMLSelectElement;\r\n                                                    if (select.value) handleClearTable(select.value);\r\n                                                }}\r\n                                                className=\"px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded font-bold text-xs transition-colors\"\r\n                                            >\r\n                                                {t('datasource.clear_btn')}\r\n                                            </button>\r\n                                        </div>\r\n                                        <p className=\"text-[10px] text-slate-400 italic\">{t('datasource.clear_reset_hint')}</p>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Drop Table Card */}\r\n                                <div className=\"bg-white dark:bg-slate-900 border border-red-100 dark:border-red-900/20 rounded-xl p-4 shadow-sm\">\r\n                                    <h4 className=\"text-xs font-black text-slate-400 uppercase mb-3\">{t('datasource.drop_table_title')}</h4>\r\n                                    <div className=\"space-y-3\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <select\r\n                                                id=\"drop-table-select\"\r\n                                                className=\"flex-1 p-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs outline-none\"\r\n                                                defaultValue=\"\"\r\n                                            >\r\n                                                <option value=\"\" disabled>{t('datasource.select_target_table')}</option>\r\n                                                {userTables.map((table_n: string) => <option key={table_n} value={table_n}>{table_n}</option>)}\r\n                                            </select>\r\n                                            <button\r\n                                                onClick={() => {\r\n                                                    const select = document.getElementById('drop-table-select') as HTMLSelectElement;\r\n                                                    if (select.value) handleDropTable(select.value);\r\n                                                }}\r\n                                                disabled={userTables.length === 0}\r\n                                                className=\"px-3 py-2 bg-red-900 hover:bg-black text-white rounded font-bold text-xs transition-colors disabled:opacity-30 disabled:cursor-not-allowed\"\r\n                                            >\r\n                                                {t('datasource.drop_btn')}\r\n                                            </button>\r\n                                        </div>\r\n                                        <p className=\"text-[10px] text-slate-400 italic\">{t('datasource.drop_table_hint')}</p>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Modals outside tabs */}\r\n                <Modal isOpen={isCreateModalOpen} onClose={() => setIsCreateModalOpen(false)} title={t('datasource.create_table_title')}>\r\n                    <div className=\"space-y-4 max-h-[60vh] overflow-y-auto\">\r\n                        <div className=\"flex gap-2 mb-4 bg-slate-100 p-1 rounded-lg w-fit\">\r\n                            <button onClick={() => setSqlMode(false)} className={`px-3 py-1 text-xs font-bold rounded ${!sqlMode ? 'bg-white shadow text-blue-600' : 'text-slate-500'}`}>{t('datasource.assistant')}</button>\r\n                            <button onClick={() => setSqlMode(true)} className={`px-3 py-1 text-xs font-bold rounded ${sqlMode ? 'bg-white shadow text-blue-600' : 'text-slate-500'}`}>SQL</button>\r\n                        </div>\r\n\r\n                        {sqlMode ? (\r\n                            <textarea\r\n                                value={customSql} onChange={e => setCustomSql(e.target.value)}\r\n                                className=\"w-full h-40 font-mono text-sm p-3 bg-slate-900 text-white rounded-lg\"\r\n                            />\r\n                        ) : (\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"text-xs font-bold text-slate-500 uppercase\">{t('datasource.name_label')}</label>\r\n                                    <input value={newTableName} onChange={e => setNewTableName(e.target.value)} className=\"w-full p-2 border rounded\" placeholder=\"usr_tabelle\" />\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-xs font-bold text-slate-500 uppercase\">{t('datasource.columns_label')}</label>\r\n                                    {createColumns.map((col, idx) => (\r\n                                        <div key={idx} className=\"flex gap-2\">\r\n                                            <input value={col.name} onChange={e => {\r\n                                                const newCols = [...createColumns]; newCols[idx].name = e.target.value; setCreateColumns(newCols);\r\n                                            }} className=\"flex-1 p-2 border rounded text-sm\" placeholder={t('datasource.name_label')} />\r\n                                            <select value={col.type} onChange={e => {\r\n                                                const newCols = [...createColumns]; newCols[idx].type = e.target.value; setCreateColumns(newCols);\r\n                                            }} className=\"w-32 p-2 border rounded text-sm\">\r\n                                                <option value=\"TEXT\">TEXT</option>\r\n                                                <option value=\"INTEGER\">INTEGER</option>\r\n                                                <option value=\"REAL\">REAL</option>\r\n                                                <option value=\"INTEGER PRIMARY KEY\">ID (PK)</option>\r\n                                            </select>\r\n                                            <button onClick={() => setCreateColumns(createColumns.filter((_, i) => i !== idx))} className=\"text-red-500\"><Trash2 className=\"w-4 h-4\" /></button>\r\n                                        </div>\r\n                                    ))}\r\n                                    <button onClick={() => setCreateColumns([...createColumns, { name: '', type: 'TEXT' }])} className=\"text-xs text-blue-600 font-bold flex items-center gap-1\">{t('datasource.add_column')}</button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                        <div className=\"flex justify-end gap-2 pt-4\">\r\n                            <button onClick={handleCreateTable} className=\"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-bold\">{t('datasource.create_btn')}</button>\r\n                        </div>\r\n                    </div>\r\n                </Modal>\r\n\r\n                <Modal isOpen={isSchemaOpen} onClose={() => setIsSchemaOpen(false)} title={tableSchema?.title || selectedTable}>\r\n                    {tableSchema ? <SchemaTable schema={tableSchema} /> : <div className=\"p-4 text-center\">{t('datasource.schema_not_available')}</div>}\r\n                </Modal>\r\n\r\n            </div>\r\n        </PageLayout >\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\views\\QueryBuilderView.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1904,1907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1904,1907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3062,3065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3062,3065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3291,3294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3291,3294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4341,4344],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4341,4344],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5389,5392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5389,5392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5568,5571],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5568,5571],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":167,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7182,7185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7182,7185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":188,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7850,7853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7850,7853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":411,"column":194,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":411,"endColumn":197,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30638,30641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30638,30641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":448,"column":116,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":448,"endColumn":119,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34704,34707],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34704,34707],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":475,"column":108,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":475,"endColumn":111,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37264,37267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37264,37267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo, useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { PageLayout } from '../components/ui/PageLayout';\r\nimport { SystemRepository } from '../../lib/repositories/SystemRepository';\r\nimport {\r\n    Play, Save, BarChart2, Table as TableIcon, TrendingUp, AlertCircle,\r\n    Layout, Maximize2, Minimize2, Settings, History, Folder, Trash2,\r\n    Edit3, X, Check, Download\r\n} from 'lucide-react';\r\nimport { useReportExport } from '../../hooks/useReportExport';\r\nimport { DataTable } from '../../components/ui/DataTable';\r\nimport { Modal } from '../components/Modal';\r\nimport {\r\n    BarChart, Bar, LineChart, Line, AreaChart, Area, PieChart, Pie, Cell,\r\n    XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend,\r\n    ComposedChart, RadarChart, Radar, PolarGrid, PolarAngleAxis, PolarRadiusAxis,\r\n    ScatterChart, Scatter, LabelList\r\n} from 'recharts';\r\nimport { formatValue } from '../utils/formatUtils';\r\nimport { type WidgetConfig } from '../../types';\r\nimport { VisualQueryBuilder, type QueryConfig } from '../components/VisualQueryBuilder';\r\nimport { useLocalStorage } from '../../hooks/useLocalStorage';\r\nimport { useDashboard } from '../../lib/context/DashboardContext';\r\nimport { RecordDetailModal } from '../components/RecordDetailModal';\r\nimport { useAsync } from '../../hooks/useAsync';\r\nimport { SqlAssistant } from '../components/SqlAssistant';\r\nimport { PivotTable } from '../components/PivotTable';\r\n\r\ntype VisualizationType = 'table' | 'bar' | 'line' | 'area' | 'pie' | 'kpi' | 'composed' | 'radar' | 'scatter' | 'pivot';\r\n\r\nconst COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8', '#82ca9d'];\r\n\r\nexport const QueryBuilderView: React.FC = () => {\r\n    const { t } = useTranslation();\r\n    const [sql, setSql] = useState('SELECT * FROM sqlite_master LIMIT 10');\r\n    const [results, setResults] = useState<any[]>([]);\r\n    const [error, setError] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Mode State\r\n    const [builderMode, setBuilderMode] = useState<'sql' | 'visual'>('visual');\r\n    const [sidebarTab, setSidebarTab] = useState<'query' | 'vis' | 'archive'>('query');\r\n    const [isMaximized, setIsMaximized] = useState(false);\r\n    const [queryConfig, setQueryConfig] = useLocalStorage<QueryConfig | undefined>('query_builder_config', undefined);\r\n\r\n    // Visualization State\r\n    const [visType, setVisType] = useState<VisualizationType>('table');\r\n    const [visConfig, setVisConfig] = useState<WidgetConfig>({ type: 'table', color: '#3b82f6' });\r\n\r\n    // Active Widget State\r\n    const [activeWidgetId, setActiveWidgetId] = useState<string | null>(null);\r\n\r\n    // Save Widget State\r\n    const [saveModalOpen, setSaveModalOpen] = useState(false);\r\n    const [widgetName, setWidgetName] = useState('');\r\n\r\n    // Detail View State\r\n    const [detailModalOpen, setDetailModalOpen] = useState(false);\r\n    const [selectedItemIndex, setSelectedItemIndex] = useState(0);\r\n    const [activeSchema, setActiveSchema] = useState<any>(null);\r\n    const { isExporting, exportToPdf } = useReportExport();\r\n    const { togglePresentationMode } = useDashboard();\r\n\r\n    // Fetch saved widgets\r\n    const { data: savedWidgets, refresh: refreshWidgets } = useAsync<any[]>(\r\n        async () => await SystemRepository.getUserWidgets(),\r\n        []\r\n    );\r\n\r\n    // Auto-Schema Generation\r\n    useEffect(() => {\r\n        const tableName = queryConfig?.table;\r\n        if (!tableName) {\r\n            setActiveSchema(null);\r\n            return;\r\n        }\r\n        SystemRepository.getTableSchema(tableName).then(cols => {\r\n            if (cols && cols.length > 0) {\r\n                const dynamicSchema = {\r\n                    title: `Tabelle: ${tableName}`,\r\n                    description: `Automatisch generiertes Schema fr die Tabelle \"${tableName}\".`,\r\n                    type: 'object',\r\n                    properties: cols.reduce((acc, col) => {\r\n                        acc[col.name] = {\r\n                            type: col.type.toLowerCase().includes('int') || col.type.toLowerCase().includes('real') ? 'number' : 'string',\r\n                            description: `Feld: ${col.name} (Typ: ${col.type})`\r\n                        };\r\n                        return acc;\r\n                    }, {} as any)\r\n                };\r\n                setActiveSchema(dynamicSchema);\r\n            }\r\n        });\r\n    }, [queryConfig?.table]);\r\n\r\n    const handleRun = async (overrideSql?: string) => {\r\n        setLoading(true);\r\n        setError('');\r\n        try {\r\n            const sqlToExecute = overrideSql || sql;\r\n            const data = await SystemRepository.executeRaw(sqlToExecute);\r\n            setResults(data);\r\n            if (data.length > 0) {\r\n                const numericCols = Object.keys(data[0]).filter(k => typeof data[0][k] === 'number');\r\n                const textCols = Object.keys(data[0]).filter(k => typeof data[0][k] === 'string');\r\n\r\n                if (!visConfig.xAxis) {\r\n                    setVisConfig(prev => ({\r\n                        ...prev,\r\n                        xAxis: textCols[0] || Object.keys(data[0])[0],\r\n                        yAxes: prev.yAxes?.length ? prev.yAxes : (numericCols.length > 0 ? [numericCols[0]] : [])\r\n                    }));\r\n                }\r\n            }\r\n        } catch (err: any) {\r\n            setError(err.message);\r\n            setResults([]);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const loadWidget = (widget: any) => {\r\n        setActiveWidgetId(widget.id);\r\n        setWidgetName(widget.name);\r\n        setSql(widget.sql_query);\r\n\r\n        try {\r\n            const visualConfig = JSON.parse(widget.visualization_config);\r\n            setVisType(visualConfig.type || 'table');\r\n            setVisConfig(visualConfig);\r\n\r\n            if (widget.visual_builder_config) {\r\n                const qConfig = JSON.parse(widget.visual_builder_config);\r\n                setQueryConfig(qConfig);\r\n                setBuilderMode('visual');\r\n            } else {\r\n                setBuilderMode('sql');\r\n            }\r\n        } catch (e) {\r\n            console.error('Error parsing widget config', e);\r\n        }\r\n\r\n        setSidebarTab('query');\r\n        setTimeout(() => handleRun(widget.sql_query), 100);\r\n    };\r\n\r\n    const handleSaveWidget = async () => {\r\n        if (!widgetName) return;\r\n        try {\r\n            const widget = {\r\n                id: activeWidgetId || crypto.randomUUID(),\r\n                name: widgetName,\r\n                description: '',\r\n                sql_query: sql,\r\n                visualization_config: { ...visConfig, type: visType },\r\n                visual_builder_config: builderMode === 'visual' ? queryConfig : null\r\n            };\r\n\r\n            await SystemRepository.saveUserWidget(widget);\r\n\r\n            setSaveModalOpen(false);\r\n            if (!activeWidgetId) setWidgetName('');\r\n            refreshWidgets();\r\n            alert(activeWidgetId ? t('querybuilder.success_update') : t('querybuilder.success_save'));\r\n            setActiveWidgetId(widget.id);\r\n        } catch (err: any) {\r\n            alert(t('querybuilder.error_save') + err.message);\r\n        }\r\n    };\r\n\r\n    const deleteWidget = async (id: string) => {\r\n        if (confirm(t('dashboard.confirm_delete_report'))) {\r\n            await SystemRepository.deleteUserWidget(id);\r\n            refreshWidgets();\r\n            if (activeWidgetId === id) {\r\n                setActiveWidgetId(null);\r\n                setWidgetName('');\r\n            }\r\n        }\r\n    };\r\n\r\n    const columns = useMemo(() => {\r\n        if (results.length === 0) return [];\r\n        return Object.keys(results[0]).map(key => ({\r\n            header: key,\r\n            accessor: key,\r\n            render: (item: any) => formatValue(item[key], key)\r\n        }));\r\n    }, [results]);\r\n\r\n    const resultColumns = results.length > 0 ? Object.keys(results[0]) : [];\r\n\r\n    return (\r\n        <PageLayout\r\n            header={{\r\n                title: t('sidebar.query_builder'),\r\n                subtitle: t('querybuilder.subtitle'),\r\n                actions: (\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <button\r\n                            onClick={togglePresentationMode}\r\n                            className=\"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors border border-transparent hover:border-blue-100\"\r\n                            title={t('dashboard.presentation_mode')}\r\n                        >\r\n                            <Maximize2 className=\"w-5 h-5\" />\r\n                        </button>\r\n                        <button\r\n                            onClick={() => exportToPdf('query-visualization', `report-${widgetName || 'query'}`)}\r\n                            disabled={isExporting || results.length === 0}\r\n                            className=\"flex items-center gap-2 px-3 py-2 bg-white border border-slate-200 text-slate-600 rounded-lg hover:bg-slate-50 transition-colors shadow-sm font-medium text-sm disabled:opacity-50\"\r\n                        >\r\n                            <Download className=\"w-4 h-4\" />\r\n                            {isExporting ? t('common.exporting') : t('common.export_pdf')}\r\n                        </button>\r\n                        {activeWidgetId && (\r\n                            <button\r\n                                onClick={() => setActiveWidgetId(null)}\r\n                                className=\"px-4 py-2 text-slate-400 hover:text-slate-600 font-medium text-sm transition-colors\"\r\n                            >\r\n                                {t('querybuilder.new_report')}\r\n                            </button>\r\n                        )}\r\n                        <button\r\n                            onClick={() => setSaveModalOpen(true)}\r\n                            disabled={results.length === 0}\r\n                            className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-sm font-medium text-sm disabled:opacity-50\"\r\n                        >\r\n                            <Save className=\"w-4 h-4\" />\r\n                            {activeWidgetId ? t('querybuilder.update_widget') : t('querybuilder.save_as_widget')}\r\n                        </button>\r\n                    </div>\r\n                )\r\n            }}\r\n        >\r\n            <div className=\"flex flex-col gap-6 h-[calc(100vh-140px)]\">\r\n                <div className=\"flex-1 flex gap-6 min-h-0 overflow-hidden relative\">\r\n                    {/* Sidebar */}\r\n                    <div className={`${isMaximized ? 'hidden' : 'w-full lg:w-96'} flex flex-col gap-4 h-full overflow-hidden transition-all duration-300`}>\r\n                        <div className=\"flex bg-slate-100 dark:bg-slate-900/50 p-1 rounded-xl\">\r\n                            <button onClick={() => setSidebarTab('archive')} className={`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-[11px] font-black uppercase transition-all ${sidebarTab === 'archive' ? 'bg-white dark:bg-slate-800 text-blue-600 shadow-sm' : 'text-slate-400 hover:text-slate-600'}`}>\r\n                                <Folder className=\"w-4 h-4\" /> {t('querybuilder.archive')}\r\n                            </button>\r\n                            <button onClick={() => setSidebarTab('query')} className={`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-[11px] font-black uppercase transition-all ${sidebarTab === 'query' ? 'bg-white dark:bg-slate-800 text-blue-600 shadow-sm' : 'text-slate-400 hover:text-slate-600'}`}>\r\n                                <History className=\"w-4 h-4\" /> {t('querybuilder.query')}\r\n                            </button>\r\n                            <button onClick={() => setSidebarTab('vis')} className={`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-[11px] font-black uppercase transition-all ${sidebarTab === 'vis' ? 'bg-white dark:bg-slate-800 text-blue-600 shadow-sm' : 'text-slate-400 hover:text-slate-600'}`}>\r\n                                <Settings className=\"w-4 h-4\" /> {t('querybuilder.graph')}\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"flex-1 overflow-y-auto pr-2 custom-scrollbar space-y-4\">\r\n                            {sidebarTab === 'archive' ? (\r\n                                <div className=\"space-y-2 animate-in fade-in duration-300\">\r\n                                    <h3 className=\"text-[10px] font-black uppercase text-slate-400 px-2 py-1 flex items-center justify-between\">\r\n                                        {t('querybuilder.saved_reports')}\r\n                                        <span className=\"bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded text-[9px]\">{savedWidgets?.length || 0}</span>\r\n                                    </h3>\r\n                                    <div className=\"space-y-1\">\r\n                                        {savedWidgets?.map(w => (\r\n                                            <div key={w.id} className={`group p-3 rounded-lg border flex flex-col gap-1 transition-all cursor-pointer ${activeWidgetId === w.id ? 'bg-blue-50 border-blue-200 ring-1 ring-blue-100' : 'bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800 hover:border-blue-200'}`} onClick={() => loadWidget(w)}>\r\n                                                <div className=\"flex items-center justify-between\">\r\n                                                    <span className=\"font-bold text-slate-700 dark:text-slate-200 text-sm truncate\">{w.name}</span>\r\n                                                    <button onClick={(e) => { e.stopPropagation(); deleteWidget(w.id); }} className=\"opacity-0 group-hover:opacity-100 p-1 text-slate-400 hover:text-red-500 rounded transition-all\"><Trash2 className=\"w-3.5 h-3.5\" /></button>\r\n                                                </div>\r\n                                                <div className=\"flex items-center gap-2 text-[10px]\">\r\n                                                    <span className=\"text-slate-400 truncate max-w-[150px] font-mono\">{w.sql_query}</span>\r\n                                                    <span className=\"ml-auto text-blue-400 flex items-center gap-1 font-bold italic\">{JSON.parse(w.visualization_config).type.toUpperCase()}</span>\r\n                                                </div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            ) : sidebarTab === 'query' ? (\r\n                                <div className=\"space-y-4\">\r\n                                    {activeWidgetId && (\r\n                                        <div className=\"p-3 bg-amber-50 border border-amber-200 rounded-lg text-amber-700 flex items-center justify-between\">\r\n                                            <div className=\"flex items-center gap-2 overflow-hidden\">\r\n                                                <Edit3 className=\"w-4 h-4\" />\r\n                                                <span className=\"text-xs font-bold truncate\">{t('querybuilder.editing', { name: widgetName })}</span>\r\n                                            </div>\r\n                                            <button onClick={() => setActiveWidgetId(null)} className=\"p-1 hover:bg-amber-100 rounded text-amber-500\"><X className=\"w-3.5 h-3.5\" /></button>\r\n                                        </div>\r\n                                    )}\r\n                                    <div className=\"bg-white dark:bg-slate-900 p-1 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm flex\">\r\n                                        <button onClick={() => setBuilderMode('visual')} className={`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-[10px] font-bold uppercase transition-all ${builderMode === 'visual' ? 'bg-blue-50 dark:bg-blue-900/30 text-blue-600' : 'text-slate-400 hover:text-slate-600'}`}>\r\n                                            <Layout className=\"w-3.5 h-3.5\" /> {t('querybuilder.visual_builder')}\r\n                                        </button>\r\n                                        <button onClick={() => setBuilderMode('sql')} className={`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-[10px] font-bold uppercase transition-all ${builderMode === 'sql' ? 'bg-slate-900 dark:bg-slate-800 text-slate-100' : 'text-slate-400 hover:text-slate-600'}`}>\r\n                                            <span className=\"font-mono text-[10px]\">SQL</span> {t('querybuilder.direct_editor')}\r\n                                        </button>\r\n                                    </div>\r\n                                    <div className=\"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm space-y-2\">\r\n                                        {builderMode === 'sql' ? (\r\n                                            <>\r\n                                                <div className=\"flex items-center justify-between\">\r\n                                                    <label className=\"text-[10px] font-black uppercase text-slate-400\">{t('querybuilder.sql_query')}</label>\r\n                                                    <SqlAssistant\r\n                                                        tableName={queryConfig?.table}\r\n                                                        columns={results.length > 0 ? Object.keys(results[0]).map(c => ({ name: c, type: typeof results[0][c] })) : []}\r\n                                                        onSelectSnippet={snippet => setSql(prev => prev + '\\n' + snippet)}\r\n                                                    />\r\n                                                </div>\r\n                                                <textarea value={sql} onChange={e => setSql(e.target.value)} className=\"w-full h-64 font-mono text-xs p-3 bg-slate-900 text-slate-100 rounded-lg outline-none resize-none\" placeholder=\"SELECT * FROM...\" />\r\n                                            </>\r\n                                        ) : (\r\n                                            <VisualQueryBuilder initialConfig={queryConfig} onChange={(newSql, newConfig) => { setSql(newSql); setQueryConfig(newConfig); }} />\r\n                                        )}\r\n                                        <div className=\"flex justify-between items-center pt-2 border-t border-slate-50 dark:border-slate-800\">\r\n                                            <div className=\"flex items-center gap-2 px-3 py-1.5 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-lg\">\r\n                                                <span className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">{t('querybuilder.labels')}:</span>\r\n                                                <button onClick={() => setVisConfig({ ...visConfig, showLabels: !visConfig.showLabels })} className={`px-2 py-0.5 rounded text-[10px] font-black uppercase transition-all ${visConfig.showLabels ? \"bg-blue-600 text-white\" : \"bg-slate-200 text-slate-500\"}`}>\r\n                                                    {visConfig.showLabels ? t('querybuilder.label_on') : t('querybuilder.label_off')}\r\n                                                </button>\r\n                                            </div>\r\n                                            <button onClick={() => handleRun()} disabled={loading} className=\"flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold text-xs shadow-md disabled:opacity-50\">\r\n                                                <Play className=\"w-3.5 h-3.5\" /> {loading ? t('common.loading') : t('querybuilder.apply')}\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                    {error && <div className=\"bg-red-50 text-red-600 text-[10px] p-3 rounded-lg border border-red-100 flex items-start gap-2 font-mono break-all\"><AlertCircle className=\"w-3.5 h-3.5 flex-shrink-0 mt-0.5\" />{error}</div>}\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm space-y-4 animate-in slide-in-from-right-4 duration-300\">\r\n                                    <h3 className=\"text-xs font-black uppercase text-slate-400 flex items-center gap-2\"><Layout className=\"w-3.5 h-3.5 text-blue-500\" />{t('querybuilder.graph_type')}</h3>\r\n                                    <div className=\"grid grid-cols-3 gap-2\">\r\n                                        {[\r\n                                            { id: 'table', icon: TableIcon, label: t('querybuilder.table') },\r\n                                            { id: 'bar', icon: BarChart2, label: t('querybuilder.bar') },\r\n                                            { id: 'line', icon: TrendingUp, label: t('querybuilder.line') },\r\n                                            { id: 'area', icon: Layout, label: t('querybuilder.area') },\r\n                                            { id: 'pie', icon: Layout, label: t('querybuilder.pie') },\r\n                                            { id: 'kpi', icon: Layout, label: t('querybuilder.kpi') },\r\n                                            { id: 'composed', icon: Layout, label: t('querybuilder.composed') },\r\n                                            { id: 'radar', icon: Layout, label: t('querybuilder.radar') },\r\n                                            { id: 'scatter', icon: Layout, label: t('querybuilder.scatter') },\r\n                                            { id: 'pivot', icon: Layout, label: t('querybuilder.pivot') },\r\n                                        ].map(type => (\r\n                                            <button key={type.id} onClick={() => setVisType(type.id as VisualizationType)} className={`p-2 rounded-lg flex flex-col items-center justify-center gap-1 border transition-all ${visType === type.id ? 'bg-blue-50 dark:bg-blue-900/30 border-blue-200 text-blue-600 shadow-sm' : 'bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-400 hover:border-slate-300'}`}>\r\n                                                <type.icon className=\"w-4 h-4\" />\r\n                                                <span className=\"text-[9px] uppercase font-black\">{type.label}</span>\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n\r\n                                    {(visType !== 'table' && visType !== 'pivot' && results.length > 0) && (\r\n                                        <div className=\"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300\">\r\n                                            <div>\r\n                                                <label className=\"block text-left text-[10px] font-black uppercase text-slate-400 mb-1\">{t('querybuilder.x_axis')}</label>\r\n                                                <select value={visConfig.xAxis || ''} onChange={e => setVisConfig({ ...visConfig, xAxis: e.target.value })} className=\"w-full p-2 border border-slate-200 rounded text-[11px] bg-white outline-none\">\r\n                                                    <option value=\"\">{t('querybuilder.select_column')}</option>\r\n                                                    {resultColumns.map(col => <option key={col} value={col}>{col}</option>)}\r\n                                                </select>\r\n                                            </div>\r\n                                            <div>\r\n                                                <label className=\"block text-left text-[10px] font-black uppercase text-slate-400 mb-1\">{t('querybuilder.y_axes')}</label>\r\n                                                <div className=\"flex flex-wrap gap-1 mb-2\">\r\n                                                    {(visConfig.yAxes || []).map(y => (\r\n                                                        <span key={y} className=\"px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px] font-bold flex items-center gap-1\">\r\n                                                            {y}\r\n                                                            <button onClick={() => setVisConfig({ ...visConfig, yAxes: (visConfig.yAxes || []).filter(axis => axis !== y) })}><X className=\"w-2.5 h-2.5\" /></button>\r\n                                                        </span>\r\n                                                    ))}\r\n                                                </div>\r\n                                                <select onChange={e => { if (!e.target.value) return; setVisConfig({ ...visConfig, yAxes: [...(visConfig.yAxes || []), e.target.value] }); e.target.value = ''; }} className=\"w-full p-2 border border-slate-200 rounded text-[11px] bg-white outline-none\">\r\n                                                    <option value=\"\">{t('querybuilder.add_y_axis')}</option>\r\n                                                    {resultColumns.filter(c => !(visConfig.yAxes || []).includes(c)).map(col => <option key={col} value={col}>{col}</option>)}\r\n                                                </select>\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    {(visType === 'pivot' && results.length > 0) && (\r\n                                        <div className=\"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300\">\r\n                                            <div>\r\n                                                <label className=\"block text-left text-[10px] font-black uppercase text-slate-400 mb-1\">{t('querybuilder.pivot_rows')}</label>\r\n                                                <div className=\"flex flex-wrap gap-1 mb-2\">\r\n                                                    {(visConfig.pivotRows || []).map(r => (\r\n                                                        <span key={r} className=\"px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px] font-bold flex items-center gap-1\">\r\n                                                            {r}\r\n                                                            <button onClick={() => setVisConfig({ ...visConfig, pivotRows: (visConfig.pivotRows || []).filter(row => row !== r) })}><X className=\"w-2.5 h-2.5\" /></button>\r\n                                                        </span>\r\n                                                    ))}\r\n                                                </div>\r\n                                                <select onChange={e => { if (!e.target.value) return; setVisConfig({ ...visConfig, pivotRows: [...(visConfig.pivotRows || []), e.target.value] }); e.target.value = ''; }} className=\"w-full p-2 border border-slate-200 rounded text-[11px] bg-white outline-none\">\r\n                                                    <option value=\"\">{t('querybuilder.pivot_add_row')}</option>\r\n                                                    {resultColumns.filter(c => !(visConfig.pivotRows || []).includes(c)).map(col => <option key={col} value={col}>{col}</option>)}\r\n                                                </select>\r\n                                            </div>\r\n                                            <div>\r\n                                                <label className=\"block text-left text-[10px] font-black uppercase text-slate-400 mb-1\">{t('querybuilder.pivot_cols')}</label>\r\n                                                <div className=\"flex flex-wrap gap-1 mb-2\">\r\n                                                    {(visConfig.pivotCols || []).map(c => (\r\n                                                        <span key={c} className=\"px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded text-[10px] font-bold flex items-center gap-1\">\r\n                                                            {c}\r\n                                                            <button onClick={() => setVisConfig({ ...visConfig, pivotCols: (visConfig.pivotCols || []).filter(col => col !== c) })}><X className=\"w-2.5 h-2.5\" /></button>\r\n                                                        </span>\r\n                                                    ))}\r\n                                                </div>\r\n                                                <select onChange={e => { if (!e.target.value) return; setVisConfig({ ...visConfig, pivotCols: [...(visConfig.pivotCols || []), e.target.value] }); e.target.value = ''; }} className=\"w-full p-2 border border-slate-200 rounded text-[11px] bg-white outline-none\">\r\n                                                    <option value=\"\">{t('querybuilder.pivot_add_col')}</option>\r\n                                                    {resultColumns.filter(c => !(visConfig.pivotCols || []).includes(c)).map(col => <option key={col} value={col}>{col}</option>)}\r\n                                                </select>\r\n                                            </div>\r\n                                            <div>\r\n                                                <label className=\"block text-left text-[10px] font-black uppercase text-slate-400 mb-2\">{t('querybuilder.pivot_measures')}</label>\r\n                                                <div className=\"space-y-2\">\r\n                                                    {(visConfig.pivotMeasures || []).map((m, idx) => (\r\n                                                        <div key={idx} className=\"flex items-center gap-1 bg-slate-50 dark:bg-slate-800/50 p-2 rounded border border-slate-100\">\r\n                                                            <span className=\"text-[10px] font-bold text-slate-600 truncate flex-1\">{m.field}</span>\r\n                                                            <select value={m.agg} onChange={e => { const next = [...(visConfig.pivotMeasures || [])]; next[idx] = { ...m, agg: e.target.value as any }; setVisConfig({ ...visConfig, pivotMeasures: next }); }} className=\"bg-transparent text-[10px] font-bold text-blue-600 outline-none\">\r\n                                                                <option value=\"sum\">{t('querybuilder.pivot_agg_sum')}</option>\r\n                                                                <option value=\"count\">{t('querybuilder.pivot_agg_count')}</option>\r\n                                                                <option value=\"avg\">{t('querybuilder.pivot_agg_avg')}</option>\r\n                                                                <option value=\"min\">{t('querybuilder.pivot_agg_min')}</option>\r\n                                                                <option value=\"max\">{t('querybuilder.pivot_agg_max')}</option>\r\n                                                            </select>\r\n                                                            <button onClick={() => setVisConfig({ ...visConfig, pivotMeasures: (visConfig.pivotMeasures || []).filter((_, i) => i !== idx) })} className=\"text-slate-300 hover:text-red-500\"><X className=\"w-3\" /></button>\r\n                                                        </div>\r\n                                                    ))}\r\n                                                    <select onChange={e => { if (!e.target.value) return; setVisConfig({ ...visConfig, pivotMeasures: [...(visConfig.pivotMeasures || []), { field: e.target.value, agg: 'sum' }] }); e.target.value = ''; }} className=\"w-full p-2 border border-slate-200 rounded text-[11px] bg-white outline-none\">\r\n                                                        <option value=\"\">{t('querybuilder.pivot_add_measure')}</option>\r\n                                                        {resultColumns.map(col => <option key={col} value={col}>{col}</option>)}\r\n                                                    </select>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    {(visType === 'kpi' && results.length > 0) && (\r\n                                        <div className=\"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300\">\r\n                                            <div className=\"flex items-center justify-between\">\r\n                                                <h4 className=\"text-[10px] font-black uppercase text-slate-400\">{t('querybuilder.kpi_rules')}</h4>\r\n                                                <button\r\n                                                    onClick={() => setVisConfig({ ...visConfig, rules: [...(visConfig.rules || []), { operator: '>', value: 0, color: 'green' }] })}\r\n                                                    className=\"p-1 px-2 bg-blue-50 text-blue-600 rounded text-[9px] font-bold hover:bg-blue-100 transition-colors\"\r\n                                                >\r\n                                                    + {t('querybuilder.add_rule')}\r\n                                                </button>\r\n                                            </div>\r\n                                            <div className=\"space-y-2\">\r\n                                                {(visConfig.rules || []).map((rule, idx) => (\r\n                                                    <div key={idx} className=\"flex items-center gap-1.5 p-2 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-100 dark:border-slate-800\">\r\n                                                        <select\r\n                                                            value={rule.operator}\r\n                                                            onChange={e => {\r\n                                                                const next = [...(visConfig.rules || [])];\r\n                                                                next[idx] = { ...rule, operator: e.target.value as any };\r\n                                                                setVisConfig({ ...visConfig, rules: next });\r\n                                                            }}\r\n                                                            className=\"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded p-1 text-[10px] outline-none\"\r\n                                                        >\r\n                                                            <option value=\">\">&gt;</option>\r\n                                                            <option value=\"<\">&lt;</option>\r\n                                                            <option value=\">=\">&gt;=</option>\r\n                                                            <option value=\"<=\">&lt;=</option>\r\n                                                            <option value=\"==\">==</option>\r\n                                                        </select>\r\n                                                        <input\r\n                                                            type=\"number\"\r\n                                                            value={rule.value}\r\n                                                            onChange={e => {\r\n                                                                const next = [...(visConfig.rules || [])];\r\n                                                                next[idx] = { ...rule, value: Number(e.target.value) };\r\n                                                                setVisConfig({ ...visConfig, rules: next });\r\n                                                            }}\r\n                                                            className=\"w-16 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded p-1 text-[10px] outline-none\"\r\n                                                        />\r\n                                                        <div className=\"flex gap-1\">\r\n                                                            {['green', 'yellow', 'red', 'blue'].map(c => (\r\n                                                                <button\r\n                                                                    key={c}\r\n                                                                    onClick={() => {\r\n                                                                        const next = [...(visConfig.rules || [])];\r\n                                                                        next[idx] = { ...rule, color: c as any };\r\n                                                                        setVisConfig({ ...visConfig, rules: next });\r\n                                                                    }}\r\n                                                                    className={`w-4 h-4 rounded-full border-2 ${rule.color === c ? 'border-slate-400 scale-110' : 'border-transparent opacity-40 hover:opacity-100'}`}\r\n                                                                    style={{ backgroundColor: c === 'green' ? '#10b981' : c === 'red' ? '#f43f5e' : c === 'yellow' ? '#fbbf24' : '#3b82f6' }}\r\n                                                                />\r\n                                                            ))}\r\n                                                        </div>\r\n                                                        <button\r\n                                                            onClick={() => setVisConfig({ ...visConfig, rules: (visConfig.rules || []).filter((_, i) => i !== idx) })}\r\n                                                            className=\"ml-auto text-slate-300 hover:text-red-500\"\r\n                                                        >\r\n                                                            <X className=\"w-3.5 h-3.5\" />\r\n                                                        </button>\r\n                                                    </div>\r\n                                                ))}\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Preview Area */}\r\n                    <div id=\"query-visualization\" className=\"flex-1 bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden flex flex-col h-full relative\">\r\n                        <div className=\"p-3 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-slate-50/50 dark:bg-slate-900/50\">\r\n                            <h3 className=\"text-[10px] font-black text-slate-400 uppercase tracking-wider\">{t('querybuilder.preview', { count: results.length })}</h3>\r\n                            <button onClick={() => setIsMaximized(!isMaximized)} className=\"p-1.5 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-md text-slate-400 transition-all flex items-center gap-1.5 shadow-sm bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700\">\r\n                                {isMaximized ? <Minimize2 className=\"w-3.5 h-3.5\" /> : <Maximize2 className=\"w-3.5 h-3.5\" />}\r\n                                <span className=\"text-[9px] font-black uppercase tracking-widest\">{isMaximized ? t('querybuilder.centered') : t('querybuilder.focus')}</span>\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"flex-1 overflow-auto p-4 min-h-0 container-scrollbar\">\r\n                            {results.length === 0 ? (\r\n                                <div className=\"h-full flex flex-col items-center justify-center text-slate-300\">\r\n                                    <Play className=\"w-12 h-12 mb-4 opacity-10\" />\r\n                                    <p className=\"text-xs font-black uppercase tracking-widest text-center whitespace-pre-wrap\">{t('querybuilder.no_data_prompt')}</p>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"h-full w-full flex flex-col\">\r\n                                    {visType === 'table' ? (\r\n                                        <DataTable columns={columns} data={results} onRowClick={item => { setSelectedItemIndex(results.indexOf(item)); setDetailModalOpen(true); }} />\r\n                                    ) : visType === 'pivot' ? (\r\n                                        <PivotTable data={results} rows={visConfig.pivotRows || []} cols={visConfig.pivotCols || []} measures={visConfig.pivotMeasures || []} />\r\n                                    ) : visType === 'kpi' ? (() => {\r\n                                        const val = results[0][Object.keys(results[0])[0]];\r\n                                        const numVal = Number(val);\r\n                                        let displayColor = 'text-slate-900 dark:text-white';\r\n                                        if (visConfig.rules && !isNaN(numVal)) {\r\n                                            for (const rule of visConfig.rules) {\r\n                                                let match = false;\r\n                                                switch (rule.operator) {\r\n                                                    case '>': match = numVal > rule.value; break;\r\n                                                    case '<': match = numVal < rule.value; break;\r\n                                                    case '>=': match = numVal >= rule.value; break;\r\n                                                    case '<=': match = numVal <= rule.value; break;\r\n                                                    case '==': match = numVal === rule.value; break;\r\n                                                }\r\n                                                if (match) {\r\n                                                    if (rule.color === 'green') displayColor = 'text-emerald-500';\r\n                                                    else if (rule.color === 'red') displayColor = 'text-rose-500';\r\n                                                    else if (rule.color === 'yellow') displayColor = 'text-amber-500';\r\n                                                    else if (rule.color === 'blue') displayColor = 'text-blue-500';\r\n                                                    break;\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                        return (\r\n                                            <div className=\"flex-1 flex flex-col items-center justify-center p-8 animate-in zoom-in-95 duration-500\">\r\n                                                <div className={`text-6xl lg:text-8xl font-black tracking-widest break-all transition-colors duration-300 ${displayColor}`}>{formatValue(val, Object.keys(results[0])[0])}</div>\r\n                                                <div className=\"text-xs font-bold text-slate-400 mt-6 uppercase tracking-[0.4em] font-mono\">{(visConfig.yAxes || [])[0] || Object.keys(results[0])[0]}</div>\r\n                                            </div>\r\n                                        );\r\n                                    })() : (\r\n                                        <ResponsiveContainer width=\"100%\" height=\"100%\" minWidth={0}>\r\n                                            {visType === 'bar' ? (\r\n                                                <BarChart data={results}>\r\n                                                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#f1f5f9\" />\r\n                                                    <XAxis dataKey={visConfig.xAxis} axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#94a3b8', fontWeight: 'bold' }} />\r\n                                                    <YAxis axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#94a3b8', fontWeight: 'bold' }} tickFormatter={val => formatValue(val, (visConfig.yAxes || [])[0])} />\r\n                                                    <Tooltip contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgb(0 0 0 / 0.1)' }} cursor={{ fill: '#f8fafc' }} formatter={(val, name) => [formatValue(val, name as string), name]} />\r\n                                                    <Legend verticalAlign=\"top\" height={36} iconType=\"circle\" wrapperStyle={{ fontSize: '10px', fontWeight: 'bold' }} />\r\n                                                    {(visConfig.yAxes || []).map((y, idx) => (\r\n                                                        <Bar key={y} dataKey={y} fill={idx === 0 ? (visConfig.color || COLORS[0]) : COLORS[idx % COLORS.length]} radius={[4, 4, 0, 0]}>\r\n                                                            {visConfig.showLabels && <LabelList dataKey={y} position=\"top\" style={{ fontSize: '10px', fontWeight: 'bold', fill: '#64748b' }} formatter={val => formatValue(val, y)} />}\r\n                                                        </Bar>\r\n                                                    ))}\r\n                                                </BarChart>\r\n                                            ) : visType === 'line' ? (\r\n                                                <LineChart data={results}>\r\n                                                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#f1f5f9\" />\r\n                                                    <XAxis dataKey={visConfig.xAxis} axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#94a3b8', fontWeight: 'bold' }} />\r\n                                                    <YAxis axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#94a3b8', fontWeight: 'bold' }} tickFormatter={val => formatValue(val, (visConfig.yAxes || [])[0])} />\r\n                                                    <Tooltip contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgb(0 0 0 / 0.1)' }} formatter={(val, name) => [formatValue(val, name as string), name]} />\r\n                                                    <Legend verticalAlign=\"top\" height={36} iconType=\"circle\" />\r\n                                                    {(visConfig.yAxes || []).map((y, idx) => (\r\n                                                        <Line key={y} type=\"monotone\" dataKey={y} stroke={idx === 0 ? (visConfig.color || COLORS[0]) : COLORS[idx % COLORS.length]} strokeWidth={3} dot={{ r: 4 }} activeDot={{ r: 6 }}>\r\n                                                            {visConfig.showLabels && <LabelList dataKey={y} position=\"top\" offset={10} style={{ fontSize: '10px', fontWeight: 'bold', fill: '#64748b' }} formatter={val => formatValue(val, y)} />}\r\n                                                        </Line>\r\n                                                    ))}\r\n                                                </LineChart>\r\n                                            ) : visType === 'area' ? (\r\n                                                <AreaChart data={results}>\r\n                                                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#f1f5f9\" />\r\n                                                    <XAxis dataKey={visConfig.xAxis} axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#94a3b8', fontWeight: 'bold' }} />\r\n                                                    <YAxis axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#94a3b8', fontWeight: 'bold' }} tickFormatter={val => formatValue(val, (visConfig.yAxes || [])[0])} />\r\n                                                    <Tooltip contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgb(0 0 0 / 0.1)' }} formatter={(val, name) => [formatValue(val, name as string), name]} />\r\n                                                    <Legend verticalAlign=\"top\" height={36} iconType=\"circle\" wrapperStyle={{ fontSize: '10px', fontWeight: 'bold' }} />\r\n                                                    {(visConfig.yAxes || []).map((y, idx) => (\r\n                                                        <Area key={y} type=\"monotone\" dataKey={y} stroke={idx === 0 ? (visConfig.color || COLORS[0]) : COLORS[idx % COLORS.length]} fill={idx === 0 ? (visConfig.color || COLORS[0]) : COLORS[idx % COLORS.length]} fillOpacity={0.2} strokeWidth={2}>\r\n                                                            {visConfig.showLabels && <LabelList dataKey={y} position=\"top\" style={{ fontSize: '10px', fontWeight: 'bold', fill: '#64748b' }} formatter={val => formatValue(val, y)} />}\r\n                                                        </Area>\r\n                                                    ))}\r\n                                                </AreaChart>\r\n                                            ) : visType === 'pie' ? (\r\n                                                <PieChart>\r\n                                                    <Pie\r\n                                                        data={results}\r\n                                                        cx=\"50%\" cy=\"50%\"\r\n                                                        labelLine={false}\r\n                                                        label={({ name, percent }) => `${name} ${((percent || 0) * 100).toFixed(0)}%`}\r\n                                                        outerRadius={120}\r\n                                                        innerRadius={80}\r\n                                                        paddingAngle={5}\r\n                                                        dataKey={(visConfig.yAxes || [])[0] || ''}\r\n                                                        nameKey={visConfig.xAxis!}\r\n                                                    >\r\n                                                        {results.map((_e, i) => <Cell key={`cell-${i}`} fill={COLORS[i % COLORS.length]} />)}\r\n                                                    </Pie>\r\n                                                    <Tooltip contentStyle={{ borderRadius: '12px', border: 'none' }} />\r\n                                                    <Legend layout=\"vertical\" align=\"right\" verticalAlign=\"middle\" iconType=\"circle\" wrapperStyle={{ fontSize: '10px', fontWeight: 'bold' }} />\r\n                                                </PieChart>\r\n                                            ) : visType === 'composed' ? (\r\n                                                <ComposedChart data={results}>\r\n                                                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#f1f5f9\" />\r\n                                                    <XAxis dataKey={visConfig.xAxis} axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#94a3b8', fontWeight: 'bold' }} />\r\n                                                    <YAxis axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#94a3b8', fontWeight: 'bold' }} tickFormatter={val => formatValue(val, (visConfig.yAxes || [])[0])} />\r\n                                                    <Tooltip contentStyle={{ borderRadius: '12px', border: 'none' }} formatter={(val, name) => [formatValue(val, name as string), name]} />\r\n                                                    <Legend verticalAlign=\"top\" height={36} wrapperStyle={{ fontSize: '10px', fontWeight: 'bold' }} />\r\n                                                    {(visConfig.yAxes || []).map((y, idx) => (\r\n                                                        idx === 0 ? (\r\n                                                            <Bar key={y} dataKey={y} fill={COLORS[0]} radius={[4, 4, 0, 0]}>\r\n                                                                {visConfig.showLabels && <LabelList dataKey={y} position=\"top\" style={{ fontSize: '10px', fontWeight: 'bold', fill: '#64748b' }} formatter={val => formatValue(val, y)} />}\r\n                                                            </Bar>\r\n                                                        ) : (\r\n                                                            <Line key={y} type=\"monotone\" dataKey={y} stroke={COLORS[idx % COLORS.length]} strokeWidth={3}>\r\n                                                                {visConfig.showLabels && <LabelList dataKey={y} position=\"top\" style={{ fontSize: '10px', fontWeight: 'bold', fill: '#64748b' }} formatter={val => formatValue(val, y)} />}\r\n                                                            </Line>\r\n                                                        )\r\n                                                    ))}\r\n                                                </ComposedChart>\r\n                                            ) : visType === 'radar' ? (\r\n                                                <RadarChart cx=\"50%\" cy=\"50%\" outerRadius=\"80%\" data={results}>\r\n                                                    <PolarGrid stroke=\"#e2e8f0\" />\r\n                                                    <PolarAngleAxis dataKey={visConfig.xAxis} tick={{ fontSize: 10, fill: '#94a3b8', fontWeight: 'bold' }} />\r\n                                                    <PolarRadiusAxis angle={30} domain={[0, 'auto']} tick={{ fontSize: 10, fill: '#94a3b8' }} />\r\n                                                    {(visConfig.yAxes || []).map((y, idx) => (\r\n                                                        <Radar key={y} name={y} dataKey={y} stroke={COLORS[idx % COLORS.length]} fill={COLORS[idx % COLORS.length]} fillOpacity={0.6} />\r\n                                                    ))}\r\n                                                    <Legend iconType=\"circle\" wrapperStyle={{ fontSize: '10px', fontWeight: 'bold' }} />\r\n                                                    <Tooltip contentStyle={{ borderRadius: '12px', border: 'none' }} />\r\n                                                </RadarChart>\r\n                                            ) : visType === 'scatter' ? (\r\n                                                <ScatterChart>\r\n                                                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#f1f5f9\" />\r\n                                                    <XAxis type=\"number\" dataKey={visConfig.xAxis} name={visConfig.xAxis} axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#94a3b8', fontWeight: 'bold' }} />\r\n                                                    <YAxis type=\"number\" dataKey={(visConfig.yAxes || [])[0]} name={(visConfig.yAxes || [])[0]} axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#94a3b8', fontWeight: 'bold' }} />\r\n                                                    <Tooltip cursor={{ strokeDasharray: '3 3' }} />\r\n                                                    <Legend verticalAlign=\"top\" height={36} iconType=\"circle\" wrapperStyle={{ fontSize: '10px', fontWeight: 'bold' }} />\r\n                                                    <Scatter name={widgetName || 'Scatter'} data={results} fill={visConfig.color || COLORS[0]} />\r\n                                                </ScatterChart>\r\n                                            ) : null}\r\n                                        </ResponsiveContainer>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <Modal isOpen={saveModalOpen} onClose={() => setSaveModalOpen(false)} title={activeWidgetId ? t('querybuilder.update_title') : t('querybuilder.save_title')}>\r\n                <div className=\"space-y-4\">\r\n                    <div className=\"bg-blue-50 p-4 rounded-xl border border-blue-100 flex items-center gap-3\">\r\n                        <Folder className=\"w-8 h-8 text-blue-500\" />\r\n                        <div>\r\n                            <p className=\"text-[10px] font-black uppercase text-blue-400\">{t('querybuilder.archive_name')}</p>\r\n                            <input autoFocus value={widgetName} onChange={e => setWidgetName(e.target.value)} placeholder={t('querybuilder.archive_placeholder')} className=\"w-full bg-transparent border-none outline-none font-bold text-blue-900 placeholder:text-blue-200\" />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2 pt-2\">\r\n                        {activeWidgetId && (\r\n                            <button onClick={() => { setActiveWidgetId(null); handleSaveWidget(); }} className=\"px-4 py-2 text-xs font-bold text-slate-500 hover:bg-slate-100 rounded-lg flex items-center gap-2\">\r\n                                {t('querybuilder.save_new')}\r\n                            </button>\r\n                        )}\r\n                        <button onClick={handleSaveWidget} disabled={!widgetName} className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold text-xs shadow-lg flex items-center gap-2\">\r\n                            <Check className=\"w-4 h-4\" /> {t('common.save')}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </Modal>\r\n\r\n            <RecordDetailModal\r\n                isOpen={detailModalOpen}\r\n                onClose={() => setDetailModalOpen(false)}\r\n                items={results}\r\n                initialIndex={selectedItemIndex}\r\n                tableName={queryConfig?.table}\r\n                schema={activeSchema}\r\n            />\r\n        </PageLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\views\\ReportPackView.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadPacks` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\github\\litebistudio\\src\\app\\views\\ReportPackView.tsx:31:9\n  29 |\n  30 |     useEffect(() => {\n> 31 |         loadPacks();\n     |         ^^^^^^^^^ `loadPacks` accessed before it is declared\n  32 |     }, []);\n  33 |\n  34 |     const loadPacks = async () => {\n\nC:\\github\\litebistudio\\src\\app\\views\\ReportPackView.tsx:34:5\n  32 |     }, []);\n  33 |\n> 34 |     const loadPacks = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 35 |         const data = await SystemRepository.getReportPacks();\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 36 |         setPacks(data);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 37 |         if (data.length > 0 && !activePackId) setActivePackId(data[0].id);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 38 |     };\n     | ^^^^^^^ `loadPacks` is declared here\n  39 |\n  40 |     const activePack = packs.find(p => p.id === activePackId);\n  41 |","line":31,"column":9,"nodeType":null,"endLine":31,"endColumn":18},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPacks'. Either include it or remove the dependency array.","line":32,"column":8,"nodeType":"ArrayExpression","endLine":32,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [loadPacks]","fix":{"range":[1405,1407],"text":"[loadPacks]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":269,"column":108,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":269,"endColumn":111,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15907,15910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15907,15910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":284,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":284,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17276,17279],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17276,17279],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":308,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":308,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19131,19134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19131,19134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { PageLayout } from '../components/ui/PageLayout';\r\nimport { SystemRepository } from '../../lib/repositories/SystemRepository';\r\nimport { useAsync } from '../../hooks/useAsync';\r\nimport {\r\n    Plus, FileText, Trash2, Download,\r\n    Layout, Database, ChevronRight, Settings,\r\n    BookOpen, User, MoveUp, MoveDown\r\n} from 'lucide-react';\r\nimport { useReportExport } from '../../hooks/useReportExport';\r\nimport { WidgetRenderer } from '../components/WidgetRenderer';\r\nimport { Modal } from '../components/Modal';\r\nimport { type ReportPack, type ReportPackItem } from '../../types';\r\n\r\nexport const ReportPackView: React.FC = () => {\r\n    const { t } = useTranslation();\r\n    const [packs, setPacks] = useState<ReportPack[]>([]);\r\n    const [activePackId, setActivePackId] = useState<string | null>(null);\r\n    const [isEditModalOpen, setIsEditModalOpen] = useState(false);\r\n    const [isAddPickerOpen, setIsAddPickerOpen] = useState(false);\r\n\r\n    // Export State\r\n    const { isExporting, exportProgress, exportPackageToPdf } = useReportExport();\r\n\r\n    // Data \r\n    const { data: allDashboards } = useAsync(() => SystemRepository.getDashboards(), []);\r\n    const { data: allWidgets } = useAsync(() => SystemRepository.getUserWidgets(), []);\r\n\r\n    useEffect(() => {\r\n        loadPacks();\r\n    }, []);\r\n\r\n    const loadPacks = async () => {\r\n        const data = await SystemRepository.getReportPacks();\r\n        setPacks(data);\r\n        if (data.length > 0 && !activePackId) setActivePackId(data[0].id);\r\n    };\r\n\r\n    const activePack = packs.find(p => p.id === activePackId);\r\n\r\n    const handleSave = async (pack: ReportPack) => {\r\n        await SystemRepository.saveReportPack(pack);\r\n        loadPacks();\r\n    };\r\n\r\n    const createPack = () => {\r\n        const newPack: ReportPack = {\r\n            id: crypto.randomUUID(),\r\n            name: t('reports.new_pack_name'),\r\n            description: '',\r\n            config: {\r\n                coverTitle: t('reports.new_pack_name'),\r\n                coverSubtitle: new Date().toLocaleDateString(undefined, { month: 'long', year: 'numeric' }),\r\n                author: 'LiteBI Studio',\r\n                showTOC: true,\r\n                items: []\r\n            }\r\n        };\r\n        handleSave(newPack);\r\n        setActivePackId(newPack.id);\r\n    };\r\n\r\n    const deletePack = async (id: string) => {\r\n        if (confirm(t('common.confirm_delete'))) {\r\n            await SystemRepository.deleteReportPack(id);\r\n            loadPacks();\r\n            if (activePackId === id) setActivePackId(null);\r\n        }\r\n    };\r\n\r\n    const moveItem = (idx: number, direction: 'up' | 'down') => {\r\n        if (!activePack) return;\r\n        const items = [...activePack.config.items];\r\n        const nextIdx = direction === 'up' ? idx - 1 : idx + 1;\r\n        if (nextIdx < 0 || nextIdx >= items.length) return;\r\n\r\n        [items[idx], items[nextIdx]] = [items[nextIdx], items[idx]];\r\n        handleSave({ ...activePack, config: { ...activePack.config, items } });\r\n    };\r\n\r\n    const removeItem = (idx: number) => {\r\n        if (!activePack) return;\r\n        const items = activePack.config.items.filter((_, i) => i !== idx);\r\n        handleSave({ ...activePack, config: { ...activePack.config, items } });\r\n    };\r\n\r\n    const addItem = (item: ReportPackItem) => {\r\n        if (!activePack) return;\r\n        handleSave({\r\n            ...activePack,\r\n            config: { ...activePack.config, items: [...activePack.config.items, item] }\r\n        });\r\n        setIsAddPickerOpen(false);\r\n    };\r\n\r\n    const handleRunExport = async () => {\r\n        if (!activePack) return;\r\n\r\n        const exportItems = activePack.config.items.map(item => {\r\n            if (item.type === 'dashboard') {\r\n                const dash = allDashboards?.find(d => d.id === item.id);\r\n                return {\r\n                    elementId: `export-dash-${item.id}`,\r\n                    title: dash?.name || 'Dashboard',\r\n                    orientation: 'landscape' as const\r\n                };\r\n            } else {\r\n                const widget = allWidgets?.find(w => w.id === item.id);\r\n                return {\r\n                    elementId: `export-widget-${item.id}`,\r\n                    title: widget?.name || 'Widget',\r\n                    orientation: 'landscape' as const\r\n                };\r\n            }\r\n        });\r\n\r\n        await exportPackageToPdf(\r\n            activePack.name,\r\n            exportItems,\r\n            {\r\n                title: activePack.config.coverTitle,\r\n                subtitle: activePack.config.coverSubtitle,\r\n                author: activePack.config.author\r\n            }\r\n        );\r\n    };\r\n\r\n    return (\r\n        <PageLayout\r\n            header={{\r\n                title: t('reports.title', 'Report Packages'),\r\n                subtitle: t('reports.subtitle', 'Build and export multi-page management reports.'),\r\n                actions: (\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <button\r\n                            onClick={createPack}\r\n                            className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-sm font-medium text-sm\"\r\n                        >\r\n                            <Plus className=\"w-4 h-4\" /> {t('common.add')}\r\n                        </button>\r\n                    </div>\r\n                )\r\n            }}\r\n        >\r\n            <div className=\"grid grid-cols-12 gap-6 h-[calc(100vh-140px)]\">\r\n                {/* Sidebar: List of Packs */}\r\n                <div className=\"col-span-3 border-r border-slate-200 dark:border-slate-800 pr-6 overflow-y-auto custom-scrollbar\">\r\n                    <div className=\"space-y-2\">\r\n                        {packs.map(p => (\r\n                            <div\r\n                                key={p.id}\r\n                                onClick={() => setActivePackId(p.id)}\r\n                                className={`group flex items-center justify-between p-3 rounded-xl cursor-pointer transition-all border ${activePackId === p.id\r\n                                    ? 'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800 text-blue-700 dark:text-blue-300 shadow-sm'\r\n                                    : 'bg-white dark:bg-slate-900 border-slate-100 dark:border-slate-800 text-slate-600 dark:text-slate-400 hover:border-slate-200 dark:hover:border-slate-700'\r\n                                    }`}\r\n                            >\r\n                                <div className=\"flex items-center gap-3 overflow-hidden\">\r\n                                    <FileText className={`w-4 h-4 shrink-0 ${activePackId === p.id ? 'text-blue-500' : 'text-slate-400'}`} />\r\n                                    <span className=\"font-bold text-sm truncate\">{p.name}</span>\r\n                                </div>\r\n                                <button\r\n                                    onClick={(e) => { e.stopPropagation(); deletePack(p.id); }}\r\n                                    className=\"p-1 opacity-0 group-hover:opacity-100 text-slate-300 hover:text-red-500 transition-all\"\r\n                                >\r\n                                    <Trash2 className=\"w-3.5 h-3.5\" />\r\n                                </button>\r\n                            </div>\r\n                        ))}\r\n                        {packs.length === 0 && (\r\n                            <div className=\"text-center py-12 border-2 border-dashed border-slate-100 dark:border-slate-800 rounded-2xl\">\r\n                                <FileText className=\"w-8 h-8 mx-auto mb-2 text-slate-200\" />\r\n                                <p className=\"text-[10px] font-black uppercase tracking-widest text-slate-300\">{t('reports.no_packages')}</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Main: Active Pack Content */}\r\n                <div className=\"col-span-9 flex flex-col gap-6 overflow-hidden\">\r\n                    {activePack ? (\r\n                        <>\r\n                            {/* Toolbar */}\r\n                            <div className=\"flex items-center justify-between bg-white dark:bg-slate-900 p-4 border border-slate-200 dark:border-slate-800 rounded-2xl shadow-sm shrink-0\">\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <div className=\"w-10 h-10 bg-blue-50 dark:bg-blue-900/20 rounded-xl flex items-center justify-center text-blue-600\">\r\n                                        <BookOpen className=\"w-5 h-5\" />\r\n                                    </div>\r\n                                    <div>\r\n                                        <h3 className=\"font-bold text-slate-800 dark:text-white leading-tight\">{activePack.name}</h3>\r\n                                        <p className=\"text-xs text-slate-400\">{activePack.config.items.length} {t('reports.pages', 'Pages')}</p>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <button\r\n                                        onClick={() => setIsEditModalOpen(true)}\r\n                                        className=\"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors\"\r\n                                        title={t('common.settings')}\r\n                                    >\r\n                                        <Settings className=\"w-5 h-5\" />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={handleRunExport}\r\n                                        disabled={isExporting || activePack.config.items.length === 0}\r\n                                        className={`flex items-center gap-2 px-4 py-2 bg-slate-900 dark:bg-white text-white dark:text-slate-900 rounded-lg hover:opacity-90 transition-all font-bold text-sm shadow-lg shadow-slate-200 dark:shadow-none disabled:opacity-50 disabled:cursor-not-allowed`}\r\n                                    >\r\n                                        <Download className=\"w-4 h-4\" />\r\n                                        {isExporting ? `${exportProgress}%` : t('reports.export_batch')}\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Content & Hidden Capture Area */}\r\n                            <div className=\"flex-1 overflow-y-auto custom-scrollbar p-1\">\r\n                                <div className=\"space-y-3\">\r\n                                    {activePack.config.items.map((item, idx) => {\r\n                                        const meta = item.type === 'dashboard'\r\n                                            ? allDashboards?.find(d => d.id === item.id)\r\n                                            : allWidgets?.find(w => w.id === item.id);\r\n\r\n                                        if (!meta) return null;\r\n\r\n                                        return (\r\n                                            <div key={idx} className=\"flex items-center gap-4 p-4 bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 rounded-xl group hover:shadow-md transition-all\">\r\n                                                <div className=\"flex flex-col gap-1 items-center\">\r\n                                                    <button onClick={() => moveItem(idx, 'up')} className=\"text-slate-300 hover:text-blue-500 disabled:opacity-0\" disabled={idx === 0}><MoveUp className=\"w-3.5 h-3.5\" /></button>\r\n                                                    <div className=\"w-6 h-6 bg-slate-50 dark:bg-slate-800 rounded flex items-center justify-center text-[10px] font-black text-slate-400\">{idx + 1}</div>\r\n                                                    <button onClick={() => moveItem(idx, 'down')} className=\"text-slate-300 hover:text-blue-500 disabled:opacity-0\" disabled={idx === activePack.config.items.length - 1}><MoveDown className=\"w-3.5 h-3.5\" /></button>\r\n                                                </div>\r\n                                                <div className=\"w-10 h-10 bg-slate-100 dark:bg-slate-800 rounded-lg flex items-center justify-center\">\r\n                                                    {item.type === 'dashboard' ? <Layout className=\"w-5 h-5 text-slate-400\" /> : <Database className=\"w-5 h-5 text-slate-400\" />}\r\n                                                </div>\r\n                                                <div className=\"flex-1\">\r\n                                                    <div className=\"text-sm font-bold text-slate-700 dark:text-slate-200\">{meta.name}</div>\r\n                                                    <div className=\"text-[10px] font-black uppercase tracking-widest text-slate-400\">{item.type}</div>\r\n                                                </div>\r\n                                                <button\r\n                                                    onClick={() => removeItem(idx)}\r\n                                                    className=\"p-2 text-slate-200 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all\"\r\n                                                >\r\n                                                    <Trash2 className=\"w-4 h-4\" />\r\n                                                </button>\r\n                                            </div>\r\n                                        );\r\n                                    })}\r\n\r\n                                    <button\r\n                                        onClick={() => setIsAddPickerOpen(true)}\r\n                                        className=\"w-full py-4 border-2 border-dashed border-slate-100 dark:border-slate-800 rounded-2xl text-slate-400 hover:text-blue-600 hover:border-blue-200 hover:bg-blue-50/10 transition-all flex items-center justify-center gap-2 text-sm font-bold\"\r\n                                    >\r\n                                        <Plus className=\"w-4 h-4\" /> {t('reports.add_page', 'Add Page')}\r\n                                    </button>\r\n                                </div>\r\n\r\n                                {/* HIDDEN CAPTURE GHOSTS (Required for html2canvas to find them) */}\r\n                                <div className=\"fixed -left-[10000px] top-0 opacity-0 pointer-events-none w-[1400px]\">\r\n                                    {activePack.config.items.map((item, idx) => {\r\n                                        if (item.type === 'dashboard') {\r\n                                            const dash = allDashboards?.find(d => d.id === item.id);\r\n                                            if (!dash) return null;\r\n                                            return (\r\n                                                <div key={`ghost-dash-${idx}`} id={`export-dash-${item.id}`} className=\"bg-white p-10 min-h-[1000px]\">\r\n                                                    <div className=\"mb-10 flex items-center justify-between border-b pb-4\">\r\n                                                        <h1 className=\"text-3xl font-black text-slate-800\">{dash.name}</h1>\r\n                                                        <span className=\"text-sm text-slate-400 font-mono\">{t('reports.page')} {idx + 1}</span>\r\n                                                    </div>\r\n                                                    <div className=\"grid grid-cols-2 gap-10\">\r\n                                                        {Array.isArray(dash.layout) && dash.layout.map((w: any) => {\r\n                                                            const wMeta = allWidgets?.find(rw => rw.id === w.id);\r\n                                                            if (!wMeta) return null;\r\n                                                            let vConfig = {};\r\n                                                            try {\r\n                                                                vConfig = typeof wMeta.visualization_config === 'string'\r\n                                                                    ? JSON.parse(wMeta.visualization_config)\r\n                                                                    : wMeta.visualization_config;\r\n                                                            } catch (e) { console.error('Error parsing widget config in pack export', e); }\r\n\r\n                                                            return (\r\n                                                                <div key={w.id} className=\"h-[400px]\">\r\n                                                                    <WidgetRenderer\r\n                                                                        title={wMeta.name}\r\n                                                                        sql={wMeta.sql_query}\r\n                                                                        config={vConfig as any}\r\n                                                                    />\r\n                                                                </div>\r\n                                                            );\r\n                                                        })}\r\n                                                    </div>\r\n                                                </div>\r\n                                            );\r\n                                        } else {\r\n                                            const widget = allWidgets?.find(w => w.id === item.id);\r\n                                            if (!widget) return null;\r\n                                            let vConfig = {};\r\n                                            try {\r\n                                                vConfig = typeof widget.visualization_config === 'string'\r\n                                                    ? JSON.parse(widget.visualization_config)\r\n                                                    : widget.visualization_config;\r\n                                            } catch (e) { console.error('Error parsing widget config in pack export', e); }\r\n\r\n                                            return (\r\n                                                <div key={`ghost-widget-${idx}`} id={`export-widget-${item.id}`} className=\"bg-white p-10 min-h-[1000px] flex flex-col items-center justify-center\">\r\n                                                    <div className=\"w-full max-w-4xl h-[600px]\">\r\n                                                        <WidgetRenderer\r\n                                                            title={widget.name}\r\n                                                            sql={widget.sql_query}\r\n                                                            config={vConfig as any}\r\n                                                        />\r\n                                                    </div>\r\n                                                </div>\r\n                                            );\r\n                                        }\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"flex-1 flex flex-col items-center justify-center text-slate-400\">\r\n                            <BookOpen className=\"w-16 h-16 mb-4 opacity-20\" />\r\n                            <p className=\"text-sm font-bold uppercase tracking-[0.4em]\">{t('reports.select_pack')}</p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Config Modal */}\r\n            <Modal isOpen={isEditModalOpen} onClose={() => setIsEditModalOpen(false)} title={t('reports.pack_settings', 'Package Settings')}>\r\n                {activePack && (\r\n                    <div className=\"space-y-6\">\r\n                        <section className=\"space-y-3\">\r\n                            <label className=\"text-[10px] font-black uppercase text-slate-400 tracking-wider\">{t('reports.general')}</label>\r\n                            <input\r\n                                className=\"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border-none rounded-xl font-bold outline-none focus:ring-2 focus:ring-blue-500\"\r\n                                value={activePack.name}\r\n                                onChange={e => handleSave({ ...activePack, name: e.target.value })}\r\n                                placeholder={t('reports.pack_name_placeholder')}\r\n                            />\r\n                        </section>\r\n\r\n                        <section className=\"space-y-3\">\r\n                            <label className=\"text-[10px] font-black uppercase text-slate-400 tracking-wider\">{t('reports.cover_page')}</label>\r\n                            <div className=\"space-y-3 p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"flex items-center gap-2 text-[11px] font-bold text-slate-500\"><FileText className=\"w-3 h-3\" /> {t('reports.title_label')}</div>\r\n                                    <input\r\n                                        className=\"w-full bg-white dark:bg-slate-900 px-3 py-1.5 rounded-lg text-sm border border-slate-100 dark:border-slate-700 outline-none\"\r\n                                        value={activePack.config.coverTitle}\r\n                                        onChange={e => handleSave({ ...activePack, config: { ...activePack.config, coverTitle: e.target.value } })}\r\n                                    />\r\n                                </div>\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"flex items-center gap-2 text-[11px] font-bold text-slate-500\"><ChevronRight className=\"w-3 h-3\" /> {t('reports.subtitle_label')}</div>\r\n                                    <input\r\n                                        className=\"w-full bg-white dark:bg-slate-900 px-3 py-1.5 rounded-lg text-sm border border-slate-100 dark:border-slate-700 outline-none\"\r\n                                        value={activePack.config.coverSubtitle || ''}\r\n                                        onChange={e => handleSave({ ...activePack, config: { ...activePack.config, coverSubtitle: e.target.value } })}\r\n                                    />\r\n                                </div>\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"flex items-center gap-2 text-[11px] font-bold text-slate-500\"><User className=\"w-3 h-3\" /> {t('reports.author')}</div>\r\n                                    <input\r\n                                        className=\"w-full bg-white dark:bg-slate-900 px-3 py-1.5 rounded-lg text-sm border border-slate-100 dark:border-slate-700 outline-none\"\r\n                                        value={activePack.config.author || ''}\r\n                                        onChange={e => handleSave({ ...activePack, config: { ...activePack.config, author: e.target.value } })}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </section>\r\n\r\n                        <div className=\"flex justify-end pt-4 border-t border-slate-100 dark:border-slate-800\">\r\n                            <button\r\n                                onClick={() => setIsEditModalOpen(false)}\r\n                                className=\"px-6 py-2 bg-slate-900 text-white dark:bg-white dark:text-slate-900 rounded-xl font-bold text-sm\"\r\n                            >\r\n                                {t('common.save')}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </Modal>\r\n\r\n            {/* Picker Modal */}\r\n            <Modal isOpen={isAddPickerOpen} onClose={() => setIsAddPickerOpen(false)} title={t('reports.pick_content', 'Add Page')}>\r\n                <div className=\"space-y-6\">\r\n                    <div>\r\n                        <h4 className=\"text-[10px] font-black uppercase text-slate-400 mb-2\">{t('dashboard.dashboards')}</h4>\r\n                        <div className=\"grid grid-cols-1 gap-1.5\">\r\n                            {allDashboards?.map(d => (\r\n                                <button\r\n                                    key={d.id}\r\n                                    onClick={() => addItem({ type: 'dashboard', id: d.id })}\r\n                                    className=\"flex items-center gap-3 p-3 text-left bg-slate-50 dark:bg-slate-800 hover:bg-blue-50 dark:hover:bg-blue-900/40 rounded-xl transition-all border border-transparent hover:border-blue-200 group\"\r\n                                >\r\n                                    <Layout className=\"w-4 h-4 text-slate-400 group-hover:text-blue-500\" />\r\n                                    <span className=\"text-sm font-bold text-slate-700 dark:text-slate-200\">{d.name}</span>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <h4 className=\"text-[10px] font-black uppercase text-slate-400 mb-2\">{t('dashboard.reports')}</h4>\r\n                        <div className=\"grid grid-cols-1 gap-1.5 max-h-[300px] overflow-y-auto custom-scrollbar\">\r\n                            {allWidgets?.map(w => (\r\n                                <button\r\n                                    key={w.id}\r\n                                    onClick={() => addItem({ type: 'widget', id: w.id })}\r\n                                    className=\"flex items-center gap-3 p-3 text-left bg-slate-50 dark:bg-slate-800 hover:bg-blue-50 dark:hover:bg-blue-900/40 rounded-xl transition-all border border-transparent hover:border-blue-200 group\"\r\n                                >\r\n                                    <Database className=\"w-4 h-4 text-slate-400 group-hover:text-blue-500\" />\r\n                                    <span className=\"text-sm font-bold text-slate-700 dark:text-slate-200\">{w.name}</span>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </Modal>\r\n        </PageLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\views\\SettingsView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\app\\views\\WorklistView.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[572,575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[572,575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[815,818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[815,818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[877,880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[877,880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\github\\litebistudio\\src\\app\\views\\WorklistView.tsx:35:9\n  33 |\n  34 |     useEffect(() => {\n> 35 |         loadWorklist();\n     |         ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  36 |         window.addEventListener('db-updated', loadWorklist);\n  37 |         window.addEventListener('db-changed', loadWorklist);\n  38 |         return () => {","line":35,"column":9,"nodeType":null,"endLine":35,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2017,2020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2017,2020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { ClipboardList, Trash2, ExternalLink, AlertCircle, CheckCircle2, Circle, Clock, Tag, Search, MessageSquare } from 'lucide-react';\r\nimport { SystemRepository } from '../../lib/repositories/SystemRepository';\r\nimport { PageLayout } from '../components/ui/PageLayout';\r\nimport { RecordDetailModal } from '../components/RecordDetailModal';\r\n\r\nexport const WorklistView: React.FC = () => {\r\n    const { t } = useTranslation();\r\n    const [items, setItems] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [filter, setFilter] = useState('all');\r\n    const [search, setSearch] = useState('');\r\n\r\n    // Detail Modal State\r\n    const [selectedItem, setSelectedItem] = useState<any>(null);\r\n    const [sourceData, setSourceData] = useState<any[]>([]);\r\n    const [isDetailOpen, setIsDetailOpen] = useState(false);\r\n\r\n    const loadWorklist = async () => {\r\n        setLoading(true);\r\n        const data = await SystemRepository.getWorklist();\r\n\r\n        // Add existence check for each item\r\n        const enriched = await Promise.all(data.map(async (item) => {\r\n            const exists = await SystemRepository.checkRecordExists(item.source_table, item.source_id);\r\n            return { ...item, _exists: exists };\r\n        }));\r\n\r\n        setItems(enriched);\r\n        setLoading(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadWorklist();\r\n        window.addEventListener('db-updated', loadWorklist);\r\n        window.addEventListener('db-changed', loadWorklist);\r\n        return () => {\r\n            window.removeEventListener('db-updated', loadWorklist);\r\n            window.removeEventListener('db-changed', loadWorklist);\r\n        };\r\n    }, []);\r\n\r\n    const handleRemove = async (id: number) => {\r\n        await SystemRepository.executeRaw('DELETE FROM sys_worklist WHERE id = ?', [id]);\r\n        loadWorklist();\r\n    };\r\n\r\n    const handleOpenDetail = async (item: any) => {\r\n        const results = await SystemRepository.executeRaw(\r\n            `SELECT * FROM \"${item.source_table}\" WHERE id = ?`,\r\n            [item.source_id]\r\n        );\r\n\r\n        if (results.length > 0) {\r\n            setSourceData(results);\r\n            setSelectedItem(item);\r\n            setIsDetailOpen(true);\r\n        } else {\r\n            // Even if deleted, maybe show the worklist item info? \r\n            // For now, if source record is gone, we can still show the modal if we have a way to handle missing data.\r\n            // But RecordDetailModal expects source data.\r\n            setSourceData([{ id: item.source_id, _deleted: true, ...item }]);\r\n            setSelectedItem(item);\r\n            setIsDetailOpen(true);\r\n        }\r\n    };\r\n\r\n    const getStatusIcon = (status: string) => {\r\n        switch (status) {\r\n            case 'done': return <CheckCircle2 className=\"w-4 h-4 text-emerald-500\" />;\r\n            case 'in_progress': return <Clock className=\"w-4 h-4 text-blue-500\" />;\r\n            case 'error': return <AlertCircle className=\"w-4 h-4 text-rose-500\" />;\r\n            case 'obsolete': return <Circle className=\"w-4 h-4 text-slate-400 opacity-50\" />;\r\n            default: return <Circle className=\"w-4 h-4 text-amber-500\" />;\r\n        }\r\n    };\r\n\r\n    const filteredItems = items\r\n        .filter(item => filter === 'all' || item.status === filter)\r\n        .filter(item =>\r\n            item.display_label?.toLowerCase().includes(search.toLowerCase()) ||\r\n            item.source_table?.toLowerCase().includes(search.toLowerCase()) ||\r\n            item.comment?.toLowerCase().includes(search.toLowerCase())\r\n        );\r\n\r\n    return (\r\n        <PageLayout\r\n            header={{\r\n                title: t('sidebar.worklist'),\r\n                subtitle: t('worklist.subtitle'),\r\n                onBack: () => window.history.back()\r\n            }}\r\n        >\r\n            <div className=\"max-w-5xl mx-auto space-y-6\">\r\n                {/* Filters & Search */}\r\n                <div className=\"flex flex-wrap items-center justify-between gap-4 bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <div className=\"relative\">\r\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400\" />\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder={t('common.search')}\r\n                                value={search}\r\n                                onChange={e => setSearch(e.target.value)}\r\n                                className=\"pl-10 pr-4 py-2 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-blue-500/20 w-64 text-sm font-medium\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"flex items-center gap-1 p-1 bg-slate-50 dark:bg-slate-900/50 rounded-lg border border-slate-200 dark:border-slate-700\">\r\n                            {[\r\n                                { id: 'all', label: t('worklist.filter_all') },\r\n                                { id: 'pending', label: t('worklist.filter_pending') },\r\n                                { id: 'in_progress', label: t('worklist.filter_in_prog') },\r\n                                { id: 'done', label: t('worklist.filter_done') }\r\n                            ].map(f => (\r\n                                <button\r\n                                    key={f.id}\r\n                                    onClick={() => setFilter(f.id)}\r\n                                    className={`px-3 py-1 text-[10px] font-black rounded-md transition-all ${filter === f.id ? 'bg-white dark:bg-slate-700 text-blue-600 shadow-sm' : 'text-slate-400 hover:text-slate-600'}`}\r\n                                >\r\n                                    {f.label.toUpperCase()}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"text-[10px] font-bold text-slate-400 uppercase tracking-widest\">\r\n                        {t('worklist.found_count', { count: filteredItems.length })}\r\n                    </div>\r\n                </div>\r\n\r\n                {loading ? (\r\n                    <div className=\"flex flex-col items-center justify-center py-20 animate-pulse\">\r\n                        <div className=\"w-12 h-12 bg-slate-200 dark:bg-slate-800 rounded-full mb-4\" />\r\n                        <div className=\"h-4 w-32 bg-slate-200 dark:bg-slate-800 rounded mb-2\" />\r\n                        <div className=\"h-3 w-48 bg-slate-200 dark:bg-slate-800 rounded opacity-50\" />\r\n                    </div>\r\n                ) : filteredItems.length === 0 ? (\r\n                    <div className=\"flex flex-col items-center justify-center py-20 bg-white dark:bg-slate-800/50 rounded-2xl border-2 border-dashed border-slate-200 dark:border-slate-800\">\r\n                        <div className=\"p-4 bg-slate-50 dark:bg-slate-900 rounded-full mb-4\">\r\n                            <ClipboardList className=\"w-8 h-8 text-slate-300\" />\r\n                        </div>\r\n                        <h3 className=\"text-sm font-bold text-slate-900 dark:text-white mb-1\">{t('worklist.empty_msg')}</h3>\r\n                        <p className=\"text-xs text-slate-500 max-w-xs text-center\">\r\n                            {t('worklist.empty_hint')}\r\n                        </p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"grid grid-cols-1 gap-3\">\r\n                        {filteredItems.map(item => (\r\n                            <div\r\n                                key={item.id}\r\n                                className={`\r\n                                    group flex items-center gap-4 p-4 bg-white dark:bg-slate-800/80 rounded-xl border transition-all hover:border-blue-300 dark:hover:border-blue-900 shadow-sm\r\n                                    ${!item._exists ? 'border-red-200 dark:border-red-900/40 bg-red-50/10' : 'border-slate-200 dark:border-slate-700'}\r\n                                `}\r\n                            >\r\n                                <div className=\"shrink-0\">\r\n                                    {getStatusIcon(item.status)}\r\n                                </div>\r\n\r\n                                <div className=\"flex-1 min-w-0\" onClick={() => handleOpenDetail(item)}>\r\n                                    <div className=\"flex items-center gap-2 mb-1\">\r\n                                        <h4 className=\"text-sm font-bold text-slate-900 dark:text-white truncate cursor-pointer hover:text-blue-600 transition-colors\">\r\n                                            {item.display_label || t('worklist.entry_id', { id: item.source_id })}\r\n                                        </h4>\r\n                                        {!item._exists && (\r\n                                            <span className=\"flex items-center gap-1 px-1.5 py-0.5 bg-red-100 dark:bg-red-900/30 text-[9px] font-black text-red-600 dark:text-red-400 rounded uppercase tracking-tighter shadow-sm animate-pulse\">\r\n                                                <AlertCircle className=\"w-2.5 h-2.5\" /> {t('common.deleted')}\r\n                                            </span>\r\n                                        )}\r\n                                        <span className=\"px-1.5 py-0.5 bg-slate-100 dark:bg-slate-700/50 text-[9px] font-bold text-slate-500 rounded uppercase tracking-wider\">\r\n                                            {item.source_table}\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-4 text-[11px] text-slate-500\">\r\n                                        <span className=\"flex items-center gap-1\">\r\n                                            <Tag className=\"w-3 h-3 opacity-60\" /> {item.display_context}\r\n                                        </span>\r\n                                        {item.comment && (\r\n                                            <span className=\"flex items-center gap-1 text-blue-600 dark:text-blue-400 italic\">\r\n                                                <MessageSquare className=\"w-3 h-3 opacity-60\" /> {t('worklist.comment_present')}\r\n                                            </span>\r\n                                        )}\r\n                                        <span className=\"flex items-center gap-1 ml-auto opacity-40\">\r\n                                            {new Date(item.created_at).toLocaleDateString()}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"flex items-center gap-2 shrink-0 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                    <button\r\n                                        onClick={() => handleOpenDetail(item)}\r\n                                        className=\"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-all\"\r\n                                        title={t('worklist.details_btn')}\r\n                                    >\r\n                                        <ExternalLink className=\"w-4 h-4\" />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => handleRemove(item.id)}\r\n                                        className=\"p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all\"\r\n                                        title={t('worklist.remove_btn')}\r\n                                    >\r\n                                        <Trash2 className=\"w-4 h-4\" />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {isDetailOpen && selectedItem && (\r\n                <RecordDetailModal\r\n                    isOpen={isDetailOpen}\r\n                    onClose={() => setIsDetailOpen(false)}\r\n                    items={sourceData}\r\n                    initialIndex={0}\r\n                    tableName={selectedItem.source_table}\r\n                    title={selectedItem.display_label}\r\n                />\r\n            )}\r\n        </PageLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\components\\ui\\Card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\components\\ui\\DataTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[183,186],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[183,186],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2030,2033],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2030,2033],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2231,2234],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2231,2234],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2711,2714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2711,2714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2743,2746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2743,2746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2966,2969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2966,2969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3022,3025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3022,3025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":235,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11681,11684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11681,11684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport { Search, Filter, X } from 'lucide-react';\r\n\r\nexport interface Column<T> {\r\n    header: string;\r\n    accessor: keyof T | ((item: T) => any);\r\n    render?: (item: T) => React.ReactNode;\r\n    align?: 'left' | 'center' | 'right';\r\n    className?: string;\r\n    width?: string;\r\n}\r\n\r\ninterface DataTableProps<T> {\r\n    data: T[];\r\n    columns: Column<T>[];\r\n    searchTerm?: string;\r\n    searchFields?: (keyof T)[];\r\n    emptyMessage?: string;\r\n    onRowClick?: (item: T) => void;\r\n}\r\n\r\nexport function DataTable<T>({\r\n    data,\r\n    columns,\r\n    searchTerm = '',\r\n    searchFields = [],\r\n    emptyMessage = 'No items found',\r\n    onRowClick\r\n}: DataTableProps<T>) {\r\n\r\n    const headerRef = React.useRef<HTMLDivElement>(null);\r\n    const bodyRef = React.useRef<HTMLDivElement>(null);\r\n    const [sortConfig, setSortConfig] = React.useState<{ key: keyof T | string; direction: 'asc' | 'desc' } | null>(null);\r\n    const [filters, setFilters] = React.useState<Record<string, string>>({});\r\n    const [showFilters, setShowFilters] = React.useState(false);\r\n\r\n    const filteredData = useMemo(() => {\r\n        let processed = data;\r\n\r\n        // 1. Global Search\r\n        if (searchTerm) {\r\n            const lowerSearch = searchTerm.toLowerCase();\r\n            processed = processed.filter(item =>\r\n                searchFields.some(field => {\r\n                    const val = item[field];\r\n                    return (String(val ?? '').toLowerCase()).includes(lowerSearch);\r\n                })\r\n            );\r\n        }\r\n\r\n        // 2. Column Filters\r\n        if (Object.keys(filters).length > 0) {\r\n            processed = processed.filter(item => {\r\n                return Object.entries(filters).every(([key, filterValue]) => {\r\n                    if (!filterValue) return true;\r\n\r\n                    const col = columns.find(c => (typeof c.accessor === 'string' ? c.accessor : c.header) === key);\r\n                    if (!col) return true;\r\n\r\n                    let itemValue: any;\r\n                    if (typeof col.accessor === 'function') {\r\n                        itemValue = col.accessor(item);\r\n                    } else {\r\n                        itemValue = (item as any)[col.accessor];\r\n                    }\r\n\r\n                    return String(itemValue ?? '').toLowerCase().includes(filterValue.toLowerCase());\r\n                });\r\n            });\r\n        }\r\n\r\n        // 3. Sort\r\n        if (sortConfig) {\r\n            processed = [...processed].sort((a, b) => {\r\n                const col = columns.find(c => c.accessor === sortConfig.key || (typeof c.accessor === 'string' && c.accessor === sortConfig.key));\r\n\r\n                let valA: any;\r\n                let valB: any;\r\n\r\n                if (col && typeof col.accessor === 'function') {\r\n                    valA = col.accessor(a);\r\n                    valB = col.accessor(b);\r\n                } else {\r\n                    valA = (a as any)[sortConfig.key];\r\n                    valB = (b as any)[sortConfig.key];\r\n                }\r\n\r\n                if (valA === valB) return 0;\r\n                if (valA === null || valA === undefined) return 1;\r\n                if (valB === null || valB === undefined) return -1;\r\n\r\n                const compareResult = valA < valB ? -1 : 1;\r\n                return sortConfig.direction === 'asc' ? compareResult : -compareResult;\r\n            });\r\n        }\r\n\r\n        return processed;\r\n    }, [data, searchTerm, searchFields, sortConfig, columns, filters]);\r\n\r\n    const handleScroll = () => {\r\n        if (headerRef.current && bodyRef.current) {\r\n            headerRef.current.scrollLeft = bodyRef.current.scrollLeft;\r\n        }\r\n    };\r\n\r\n    const requestSort = (col: Column<T>) => {\r\n        const key = typeof col.accessor === 'string' ? col.accessor : col.header;\r\n\r\n        let direction: 'asc' | 'desc' = 'asc';\r\n        if (sortConfig && sortConfig.key === key && sortConfig.direction === 'asc') {\r\n            direction = 'desc';\r\n        }\r\n        setSortConfig({ key, direction });\r\n    };\r\n\r\n    const handleFilterChange = (key: string, value: string) => {\r\n        setFilters(prev => ({\r\n            ...prev,\r\n            [key]: value\r\n        }));\r\n    };\r\n\r\n    const renderColGroup = () => (\r\n        <colgroup>\r\n            {columns.map((col, i) => (\r\n                <col key={i} style={{ width: col.width || '150px', minWidth: col.width || '150px' }} />\r\n            ))}\r\n        </colgroup>\r\n    );\r\n\r\n    return (\r\n        <div className=\"flex flex-col flex-1 overflow-hidden h-full relative border rounded-lg border-slate-300 dark:border-slate-700\">\r\n            {/* Header Table (Static Vertical, Scrolls Horizontal) */}\r\n            <div\r\n                ref={headerRef}\r\n                className=\"overflow-hidden flex-none bg-slate-50 dark:bg-slate-900 border-b border-slate-300 dark:border-slate-700\"\r\n            >\r\n                <table className=\"w-full text-sm text-left table-fixed\">\r\n                    {renderColGroup()}\r\n                    <thead className=\"text-[10px] text-slate-400 uppercase font-bold text-left\">\r\n                        <tr>\r\n                            {columns.map((col, i) => {\r\n                                const key = typeof col.accessor === 'string' ? col.accessor : col.header;\r\n                                const isSorted = sortConfig?.key === key;\r\n\r\n                                return (\r\n                                    <th\r\n                                        key={i}\r\n                                        className={`px-4 py-3 truncate cursor-pointer select-none hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors ${col.align === 'right' ? 'text-right' : col.align === 'center' ? 'text-center' : 'text-left'} ${col.className || ''}`}\r\n                                        title={col.header}\r\n                                        onClick={() => requestSort(col)}\r\n                                    >\r\n                                        <div className={`flex items-center gap-1.5 ${col.align === 'right' ? 'justify-end' : col.align === 'center' ? 'justify-center' : 'justify-start'}`}>\r\n                                            {/* Filter Toggle in First Column */}\r\n                                            {i === 0 && (\r\n                                                <button\r\n                                                    onClick={(e) => {\r\n                                                        e.stopPropagation();\r\n                                                        setShowFilters(!showFilters);\r\n                                                    }}\r\n                                                    className={`p-1 rounded hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors mr-2 ${showFilters || Object.keys(filters).length > 0 ? 'text-blue-600 bg-blue-100 dark:bg-blue-900/40' : 'text-slate-500 hover:text-slate-700'}`}\r\n                                                    title=\"Toggle Column Filters\"\r\n                                                >\r\n                                                    <Filter className=\"w-4 h-4\" />\r\n                                                </button>\r\n                                            )}\r\n\r\n                                            <span className=\"truncate\">{col.header}</span>\r\n\r\n                                            {isSorted && (\r\n                                                <span className=\"text-blue-500 text-[9px]\">\r\n                                                    {sortConfig.direction === 'asc' ? '' : ''}\r\n                                                </span>\r\n                                            )}\r\n                                        </div>\r\n                                    </th>\r\n                                )\r\n                            })}\r\n                        </tr>\r\n                        {/* Filter Row */}\r\n                        {showFilters && (\r\n                            <tr className=\"bg-slate-100/50 dark:bg-slate-800/50\">\r\n                                {columns.map((col, i) => {\r\n                                    const key = typeof col.accessor === 'string' ? col.accessor : col.header;\r\n                                    return (\r\n                                        <th key={i} className=\"px-2 py-1\">\r\n                                            <div className=\"relative flex items-center\">\r\n                                                <input\r\n                                                    type=\"text\"\r\n                                                    value={filters[key as string] || ''}\r\n                                                    onChange={(e) => handleFilterChange(key as string, e.target.value)}\r\n                                                    onClick={(e) => e.stopPropagation()}\r\n                                                    placeholder={`Filter ${col.header}...`}\r\n                                                    className=\"w-full px-2 py-1 text-[10px] font-normal border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-900 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-1 focus:ring-blue-500 placeholder:text-slate-300\"\r\n                                                />\r\n                                                {filters[key as string] && (\r\n                                                    <button\r\n                                                        onClick={(e) => {\r\n                                                            e.stopPropagation();\r\n                                                            handleFilterChange(key as string, '');\r\n                                                        }}\r\n                                                        className=\"absolute right-1 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200\"\r\n                                                    >\r\n                                                        <X className=\"w-3 h-3\" />\r\n                                                    </button>\r\n                                                )}\r\n                                            </div>\r\n                                        </th>\r\n                                    );\r\n                                })}\r\n                            </tr>\r\n                        )}\r\n                    </thead>\r\n                </table>\r\n            </div>\r\n\r\n            {/* Body Table (Scrolls Vertical & Horizontal) */}\r\n            <div\r\n                ref={bodyRef}\r\n                onScroll={handleScroll}\r\n                className=\"flex-1 overflow-auto bg-white dark:bg-slate-800\"\r\n            >\r\n                <table className=\"w-full text-sm text-left table-fixed\">\r\n                    {renderColGroup()}\r\n                    <tbody className=\"divide-y divide-slate-200 dark:divide-slate-700\">\r\n                        {filteredData.map((item, rowIndex) => (\r\n                            <tr\r\n                                key={rowIndex}\r\n                                onClick={() => onRowClick && onRowClick(item)}\r\n                                className={`transition-colors group ${onRowClick ? 'cursor-pointer hover:bg-blue-50 dark:hover:bg-blue-900/20' : 'hover:bg-slate-50 dark:hover:bg-slate-700/30'}`}\r\n                            >\r\n                                {columns.map((col, colIndex) => {\r\n                                    const value = typeof col.accessor === 'function'\r\n                                        ? col.accessor(item)\r\n                                        : (item as any)[col.accessor];\r\n\r\n                                    return (\r\n                                        <td\r\n                                            key={colIndex}\r\n                                            className={`px-4 py-3 truncate ${col.align === 'right' ? 'text-right' : col.align === 'center' ? 'text-center' : 'text-left'} ${col.className || ''}`}\r\n                                            title={typeof value === 'string' ? value : undefined}\r\n                                        >\r\n                                            {col.render ? col.render(item) : value}\r\n                                        </td>\r\n                                    );\r\n                                })}\r\n                            </tr>\r\n                        ))}\r\n                        {filteredData.length === 0 && (\r\n                            <tr>\r\n                                <td colSpan={columns.length} className=\"px-6 py-20 text-center text-slate-400\">\r\n                                    <Search className=\"w-12 h-12 mx-auto mb-4 opacity-10\" />\r\n                                    <p className=\"text-lg\">{emptyMessage}</p>\r\n                                </td>\r\n                            </tr>\r\n                        )}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\config\\components.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\hooks\\useAsync.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'asyncFunction' and 'data'. Either include them or remove the dependency array. If 'asyncFunction' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":91,"column":8,"nodeType":"ArrayExpression","endLine":91,"endColumn":41,"suggestions":[{"desc":"Update the dependencies array to be: [version, cacheKey, ttl, data, asyncFunction]","fix":{"range":[2965,2998],"text":"[version, cacheKey, ttl, data, asyncFunction]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a spread element in its dependency array. This means we can't statically verify whether you've passed the correct dependencies.","line":91,"column":9,"nodeType":"SpreadElement","endLine":91,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { queryCache } from '../lib/cache';\r\n\r\ninterface UseAsyncOptions {\r\n    cacheKey?: string;\r\n    ttl?: number; // Time to live in ms\r\n    keepPreviousData?: boolean;\r\n}\r\n\r\nexport function useAsync<T>(\r\n    asyncFunction: () => Promise<T>,\r\n    deps: React.DependencyList = [],\r\n    options: UseAsyncOptions = {}\r\n) {\r\n    const { cacheKey, ttl } = options;\r\n\r\n    // Initialize state from cache if available\r\n    const [data, setData] = useState<T | null>(() => {\r\n        if (cacheKey) {\r\n            const cached = queryCache.get<T>(cacheKey);\r\n            return cached || null;\r\n        }\r\n        return null;\r\n    });\r\n\r\n    // Loading is true only if we have no data and no error\r\n    const [loading, setLoading] = useState(() => {\r\n        if (cacheKey && queryCache.get(cacheKey)) return false;\r\n        return true;\r\n    });\r\n\r\n    const [error, setError] = useState<Error | null>(null);\r\n    const [version, setVersion] = useState(0);\r\n    const lastFetchId = useRef(0);\r\n\r\n    const refresh = useCallback(() => {\r\n        setVersion(v => v + 1);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        let mounted = true;\r\n        const fetchId = ++lastFetchId.current;\r\n\r\n        const execute = async () => {\r\n            try {\r\n                // If we have cached data, we don't need to set loading to true immediately\r\n                // This creates the \"stale-while-revalidate\" effect\r\n                if (!data || !cacheKey) {\r\n                    setLoading(true);\r\n                }\r\n\r\n                const result = await asyncFunction();\r\n\r\n                if (mounted && fetchId === lastFetchId.current) {\r\n                    setData(result);\r\n                    setError(null);\r\n\r\n                    // Update cache\r\n                    if (cacheKey) {\r\n                        queryCache.set(cacheKey, result, ttl);\r\n                    }\r\n                }\r\n            } catch (err) {\r\n                if (mounted && fetchId === lastFetchId.current) {\r\n                    setError(err instanceof Error ? err : new Error(String(err)));\r\n                }\r\n            } finally {\r\n                if (mounted && fetchId === lastFetchId.current) {\r\n                    setLoading(false);\r\n                }\r\n            }\r\n        };\r\n\r\n        // If we have a cache key, check if we need to fetch at all or just revalidate\r\n        // For now, simpler SWR: always fetch to revalidate\r\n        execute();\r\n\r\n        const handleDbUpdate = () => {\r\n            // Invalidate cache on massive DB updates to force UI refresh\r\n            if (cacheKey) {\r\n                queryCache.invalidate(cacheKey);\r\n            }\r\n            execute();\r\n        };\r\n        window.addEventListener('db-updated', handleDbUpdate);\r\n\r\n        return () => {\r\n            mounted = false;\r\n            window.removeEventListener('db-updated', handleDbUpdate);\r\n        };\r\n    }, [...deps, version, cacheKey, ttl]);\r\n\r\n    return { data, loading, error, refresh };\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\hooks\\useBackupStatus.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\hooks\\useLocalStorage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\hooks\\useQuery.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'params' and 'ttl'. Either include them or remove the dependency array.","line":94,"column":8,"nodeType":"ArrayExpression","endLine":94,"endColumn":58,"suggestions":[{"desc":"Update the dependencies array to be: [query, version, cacheKey, params, ttl]","fix":{"range":[2904,2954],"text":"[query, version, cacheKey, params, ttl]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":94,"column":16,"nodeType":"CallExpression","endLine":94,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { runQuery, initDB } from '../lib/db';\r\nimport { queryCache } from '../lib/cache';\r\nimport type { DbRow } from '../types';\r\n\r\nexport interface UseQueryOptions {\r\n    cacheKey?: string;\r\n    ttl?: number;\r\n}\r\n\r\nexport function useQuery<T = DbRow>(\r\n    query: string,\r\n    params: (string | number | null | undefined)[] = [],\r\n    options: UseQueryOptions = {}\r\n) {\r\n    const { cacheKey, ttl } = options;\r\n\r\n    // Initialize with cached data if available\r\n    const [data, setData] = useState<T[]>(() => {\r\n        if (cacheKey) {\r\n            return queryCache.get<T[]>(cacheKey) || [];\r\n        }\r\n        return [];\r\n    });\r\n\r\n    const [loading, setLoading] = useState(!cacheKey || !queryCache.get(cacheKey));\r\n    const [error, setError] = useState<Error | null>(null);\r\n    const [version, setVersion] = useState(0);\r\n\r\n    const refresh = useCallback(() => {\r\n        setVersion(v => v + 1);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        let mounted = true;\r\n\r\n        const fetchData = async () => {\r\n            if (!query || query.trim() === '') {\r\n                if (mounted) {\r\n                    setData([]);\r\n                    setLoading(false);\r\n                }\r\n                return;\r\n            }\r\n\r\n            try {\r\n                // Only show loading if we don't have cached data\r\n                if (!cacheKey || !queryCache.get(cacheKey)) {\r\n                    setLoading(true);\r\n                }\r\n\r\n                await initDB();\r\n                const result = await runQuery(query, params);\r\n\r\n                if (mounted) {\r\n                    setData(result as T[]);\r\n                    setError(null);\r\n                    if (cacheKey) {\r\n                        queryCache.set(cacheKey, result, ttl);\r\n                    }\r\n                }\r\n            } catch (err: unknown) {\r\n                if (mounted) {\r\n                    setError(err instanceof Error ? err : new Error(String(err)));\r\n                }\r\n            } finally {\r\n                if (mounted) {\r\n                    setLoading(false);\r\n                }\r\n            }\r\n        };\r\n\r\n        fetchData();\r\n\r\n        // If caching is enabled, subscribe to cache updates\r\n        let unsubscribe: (() => void) | undefined;\r\n        if (cacheKey) {\r\n            unsubscribe = queryCache.subscribe(cacheKey, () => {\r\n                const cached = queryCache.get<T[]>(cacheKey);\r\n                if (cached && mounted) {\r\n                    setData(cached);\r\n                }\r\n            });\r\n        }\r\n\r\n        const handleDbUpdate = () => fetchData();\r\n        window.addEventListener('db-updated', handleDbUpdate);\r\n\r\n        return () => {\r\n            mounted = false;\r\n            window.removeEventListener('db-updated', handleDbUpdate);\r\n            if (unsubscribe) unsubscribe();\r\n        };\r\n    }, [query, JSON.stringify(params), version, cacheKey]);\r\n\r\n    return { data, loading, error, refresh };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\hooks\\useReportExport.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\hooks\\useTheme.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\cache.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[206,209],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[206,209],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"type CacheEntry<T> = {\r\n    data: T;\r\n    timestamp: number;\r\n    ttl: number; // Time to live in ms\r\n};\r\n\r\ntype Listener = () => void;\r\n\r\nclass QueryCache {\r\n    private cache = new Map<string, CacheEntry<any>>();\r\n    private listeners = new Map<string, Set<Listener>>();\r\n\r\n    set<T>(key: string, data: T, ttl: number = 60 * 1000) { // Default 1 minute TTL\r\n        this.cache.set(key, {\r\n            data,\r\n            timestamp: Date.now(),\r\n            ttl\r\n        });\r\n        this.notify(key);\r\n    }\r\n\r\n    get<T>(key: string): T | null {\r\n        const entry = this.cache.get(key);\r\n        if (!entry) return null;\r\n\r\n        if (Date.now() - entry.timestamp > entry.ttl) {\r\n            this.cache.delete(key);\r\n            return null;\r\n        }\r\n\r\n        return entry.data as T;\r\n    }\r\n\r\n    invalidate(key: string) {\r\n        this.cache.delete(key);\r\n        this.notify(key);\r\n    }\r\n\r\n    /**\r\n     * Subscribe to changes for a specific key (or global if key is '*')\r\n     */\r\n    subscribe(key: string, listener: Listener): () => void {\r\n        const set = this.listeners.get(key) || new Set();\r\n        set.add(listener);\r\n        this.listeners.set(key, set);\r\n\r\n        return () => {\r\n            const s = this.listeners.get(key);\r\n            if (s) {\r\n                s.delete(listener);\r\n                if (s.size === 0) {\r\n                    this.listeners.delete(key);\r\n                }\r\n            }\r\n        };\r\n    }\r\n\r\n    private notify(key: string) {\r\n        // Notify specific listeners\r\n        this.listeners.get(key)?.forEach(l => l());\r\n        // Notify global listeners (if we had any pattern matching, but for now simple)\r\n    }\r\n\r\n    // Debug helper\r\n    getStats() {\r\n        return {\r\n            size: this.cache.size,\r\n            keys: Array.from(this.cache.keys())\r\n        };\r\n    }\r\n}\r\n\r\nexport const queryCache = new QueryCache();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\context\\DashboardContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2470,2473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2470,2473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":130,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":130,"endColumn":26}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, type ReactNode } from 'react';\r\nimport { useLocalStorage } from '../../hooks/useLocalStorage';\r\nimport { COMPONENTS } from '../../config/components';\r\n\r\ninterface DashboardContextType {\r\n    visibleComponentIds: string[];\r\n    setVisibleComponentIds: (ids: string[] | ((prev: string[]) => string[])) => void;\r\n    visibleSidebarComponentIds: string[];\r\n    setVisibleSidebarComponentIds: (ids: string[] | ((prev: string[]) => string[])) => void;\r\n    componentOrder: string[];\r\n    setComponentOrder: (order: string[] | ((prev: string[]) => string[])) => void;\r\n    isSidebarCollapsed: boolean;\r\n    setSidebarCollapsed: (collapsed: boolean | ((prev: boolean) => boolean)) => void;\r\n    changeCount: number;\r\n    lastBackup: string | null;\r\n    markBackupComplete: () => void;\r\n    isLocked: boolean;\r\n    lockApp: () => void;\r\n    unlockApp: () => void;\r\n    isPresentationMode: boolean;\r\n    togglePresentationMode: () => void;\r\n}\r\n\r\nconst DashboardContext = createContext<DashboardContextType | undefined>(undefined);\r\n\r\nexport const DashboardProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\r\n    const GRID_SIZE = 60;\r\n    const initialOrder = Array.from({ length: GRID_SIZE }, (_, i) => `slot-${i}`);\r\n    COMPONENTS.forEach((component, i) => {\r\n        if (i < GRID_SIZE) initialOrder[i] = component.id;\r\n    });\r\n\r\n    // Merge existing components into the slots at initialization\r\n    const [visibleComponentIds, setVisibleComponentIds] = useLocalStorage<string[]>('visibleComponentIds', COMPONENTS.map(t => t.id));\r\n    const [visibleSidebarComponentIds, setVisibleSidebarComponentIds] = useLocalStorage<string[]>('visibleSidebarComponentIds', COMPONENTS.filter(t => t.targetView).map(t => t.id));\r\n    const [componentOrder, setComponentOrder] = useLocalStorage<string[]>('componentOrder', initialOrder);\r\n    const [isSidebarCollapsed, setSidebarCollapsed] = useLocalStorage<boolean>('isSidebarCollapsed', false);\r\n\r\n    // Backup State\r\n    const [lastBackup, setLastBackup] = useLocalStorage<string | null>('litebistudio_last_backup', null);\r\n    const [changeCount, setChangeCount] = useLocalStorage<number>('litebistudio_changes_since_backup', 0);\r\n\r\n    const markBackupComplete = React.useCallback(() => {\r\n        setLastBackup(new Date().toISOString());\r\n        setChangeCount(0);\r\n    }, [setLastBackup, setChangeCount]);\r\n\r\n    React.useEffect(() => {\r\n        const handleDbChange = (e: any) => {\r\n            const detail = e.detail || {};\r\n            if (detail.type === 'restore') {\r\n                setChangeCount(0);\r\n                setLastBackup(new Date().toISOString());\r\n            } else if (detail.type === 'clear') {\r\n                setChangeCount((prev: number) => prev + 1);\r\n            } else {\r\n                setChangeCount((prev: number) => prev + (detail.count || 1));\r\n            }\r\n        };\r\n\r\n        window.addEventListener('db-changed', handleDbChange);\r\n        return () => window.removeEventListener('db-changed', handleDbChange);\r\n    }, [setChangeCount, setLastBackup]);\r\n\r\n    // Sync state if new components are added, but preserve slots\r\n    React.useEffect(() => {\r\n        const allComponentIds = COMPONENTS.map(t => t.id);\r\n        const missingComponents = allComponentIds.filter(id => !componentOrder.includes(id));\r\n\r\n        if (missingComponents.length > 0) {\r\n            setComponentOrder(prev => {\r\n                const next = [...prev];\r\n                let missingIdx = 0;\r\n                // Try to fill empty slots first\r\n                for (let i = 0; i < next.length && missingIdx < missingComponents.length; i++) {\r\n                    if (next[i].startsWith('slot-')) {\r\n                        next[i] = missingComponents[missingIdx++];\r\n                    }\r\n                }\r\n                // If no slots left, append\r\n                return [...next, ...missingComponents.slice(missingIdx)];\r\n            });\r\n            setVisibleComponentIds(prev => [...new Set([...prev, ...missingComponents])]);\r\n\r\n            // Also sync sidebar items for components that have a view\r\n            const missingSidebarComponents = missingComponents.filter(id => COMPONENTS.find(t => t.id === id)?.targetView);\r\n            if (missingSidebarComponents.length > 0) {\r\n                setVisibleSidebarComponentIds(prev => [...new Set([...prev, ...missingSidebarComponents])]);\r\n            }\r\n        }\r\n    }, [componentOrder, setComponentOrder, visibleComponentIds, setVisibleComponentIds, setVisibleSidebarComponentIds]);\r\n\r\n    // Lock State\r\n    const [isLocked, setIsLocked] = React.useState<boolean>(() => {\r\n        // Init locked if PIN exists\r\n        return !!localStorage.getItem('litebistudio_app_pin');\r\n    });\r\n\r\n    const lockApp = React.useCallback(() => setIsLocked(true), []);\r\n    const unlockApp = React.useCallback(() => setIsLocked(false), []);\r\n\r\n    // Presentation Mode\r\n    const [isPresentationMode, setIsPresentationMode] = React.useState(false);\r\n    const togglePresentationMode = React.useCallback(() => setIsPresentationMode(prev => !prev), []);\r\n\r\n    return (\r\n        <DashboardContext.Provider value={{\r\n            visibleComponentIds,\r\n            setVisibleComponentIds,\r\n            visibleSidebarComponentIds,\r\n            setVisibleSidebarComponentIds,\r\n            componentOrder,\r\n            setComponentOrder,\r\n            isSidebarCollapsed,\r\n            setSidebarCollapsed,\r\n            changeCount,\r\n            lastBackup,\r\n            markBackupComplete,\r\n            isLocked,\r\n            lockApp,\r\n            unlockApp,\r\n            isPresentationMode,\r\n            togglePresentationMode\r\n        }}>\r\n            {children}\r\n        </DashboardContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useDashboard = () => {\r\n    const context = useContext(DashboardContext);\r\n    if (!context) {\r\n        throw new Error('useDashboard must be used within a DashboardProvider');\r\n    }\r\n    return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\context\\ThemeContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":50,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":50,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useEffect, type ReactNode } from 'react';\r\nimport { useLocalStorage } from '../../hooks/useLocalStorage';\r\n\r\nexport type ThemeMode = 'light' | 'dark' | 'system';\r\n\r\ninterface ThemeContextType {\r\n    theme: ThemeMode;\r\n    setTheme: (theme: ThemeMode) => void;\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\r\n\r\nexport const ThemeProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\r\n    const [theme, setTheme] = useLocalStorage<ThemeMode>('theme', 'system');\r\n\r\n    useEffect(() => {\r\n        const root = window.document.documentElement;\r\n\r\n        const removeOldTheme = () => {\r\n            root.classList.remove('light', 'dark');\r\n        };\r\n\r\n        const applyTheme = (t: ThemeMode) => {\r\n            removeOldTheme();\r\n            if (t === 'system') {\r\n                const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\r\n                root.classList.add(systemTheme);\r\n                return;\r\n            }\r\n            root.classList.add(t);\r\n        };\r\n\r\n        applyTheme(theme);\r\n\r\n        if (theme === 'system') {\r\n            const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n            const handleChange = () => applyTheme('system');\r\n            mediaQuery.addEventListener('change', handleChange);\r\n            return () => mediaQuery.removeEventListener('change', handleChange);\r\n        }\r\n    }, [theme]);\r\n\r\n    return (\r\n        <ThemeContext.Provider value={{ theme, setTheme }}>\r\n            {children}\r\n        </ThemeContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useThemeContext = () => {\r\n    const context = useContext(ThemeContext);\r\n    if (!context) {\r\n        throw new Error('useThemeContext must be used within a ThemeProvider');\r\n    }\r\n    return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\db.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":124,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3683,3686],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3683,3686],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3810,3813],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3810,3813],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4146,4149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4146,4149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[306,309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[306,309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[334,337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[334,337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import DBWorker from './db.worker?worker';\r\nimport type { DbRow } from '../types';\r\n\r\nlet worker: Worker | null = null;\r\nlet workerReadyPromise: Promise<Worker> | null = null;\r\nlet msgId = 0;\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nconst pending = new Map<number, { resolve: (val: any) => void, reject: (err: any) => void }>();\r\n\r\nconst channel = new BroadcastChannel('litebistudio_db_v1');\r\nconst conflictListeners = new Set<(hasConflict: boolean) => void>();\r\n\r\nlet hasConflict = false;\r\n\r\nchannel.onmessage = (event) => {\r\n    if (event.data === 'PING') {\r\n        channel.postMessage('PONG');\r\n    } else if (event.data === 'PONG') {\r\n        processTabConflict();\r\n    }\r\n};\r\n\r\nfunction processTabConflict() {\r\n    if (hasConflict) return;\r\n    hasConflict = true;\r\n    console.warn('[DB] Tab conflict detected! Access restricted to one tab.');\r\n    conflictListeners.forEach(l => l(true));\r\n}\r\n\r\nexport function onTabConflict(callback: (hasConflict: boolean) => void) {\r\n    conflictListeners.add(callback);\r\n    if (hasConflict) {\r\n        callback(true);\r\n    }\r\n    return () => {\r\n        conflictListeners.delete(callback);\r\n    };\r\n}\r\n\r\nchannel.postMessage('PING');\r\n\r\nfunction getWorker(): Promise<Worker> {\r\n    if (!workerReadyPromise) {\r\n        workerReadyPromise = new Promise((resolveWorker) => {\r\n            navigator.locks.request('litebistudio_db_lifecycle', async () => {\r\n                const w = new DBWorker();\r\n                w.onmessage = (e) => {\r\n                    const { id, result, error } = e.data;\r\n                    if (pending.has(id)) {\r\n                        const { resolve, reject } = pending.get(id)!;\r\n                        pending.delete(id);\r\n                        if (error) reject(new Error(error));\r\n                        else resolve(result);\r\n                    }\r\n                };\r\n                worker = w;\r\n                resolveWorker(w);\r\n                await new Promise(() => { });\r\n            });\r\n        });\r\n    }\r\n    return workerReadyPromise;\r\n}\r\n\r\nwindow.addEventListener('beforeunload', () => {\r\n    if (worker) {\r\n        worker.postMessage({ type: 'CLOSE' });\r\n    }\r\n});\r\n\r\nif (import.meta.hot) {\r\n    import.meta.hot.dispose(() => {\r\n        if (worker) {\r\n            worker.postMessage({ type: 'CLOSE' });\r\n        }\r\n        channel.close();\r\n    });\r\n}\r\n\r\nfunction send<T>(type: string, payload?: Record<string, unknown> | DbRow[] | ArrayBuffer): Promise<T> {\r\n    return getWorker().then(w => {\r\n        return new Promise((resolve, reject) => {\r\n            const id = ++msgId;\r\n            pending.set(id, { resolve, reject });\r\n            w.postMessage({ id, type, payload });\r\n        });\r\n    });\r\n}\r\n\r\nexport function notifyDbChange(count: number = 1, type: string = 'insert') {\r\n    window.dispatchEvent(new CustomEvent('db-changed', {\r\n        detail: { type, count }\r\n    }));\r\n}\r\n\r\nexport function initDB() {\r\n    return send<boolean>('INIT').then(() => { });\r\n}\r\n\r\nexport async function runQuery(sql: string, bind?: (string | number | null | undefined)[]): Promise<DbRow[]> {\r\n    await initDB();\r\n    return send<DbRow[]>('EXEC', { sql, bind });\r\n}\r\n\r\nexport async function clearDatabase() {\r\n    await initDB();\r\n    return send('CLEAR');\r\n}\r\n\r\nexport async function clearTable(tableName: string) {\r\n    await initDB();\r\n    return send('CLEAR_TABLE', { tableName });\r\n}\r\n\r\nexport async function exportDatabase(): Promise<Uint8Array> {\r\n    await initDB();\r\n    return send<Uint8Array>('EXPORT');\r\n}\r\n\r\nexport async function importDatabase(buffer: ArrayBuffer) {\r\n    await send('IMPORT', buffer);\r\n}\r\n\r\nexport async function loadDemoData(data?: any) {\r\n    await initDB();\r\n    return send<number>('LOAD_DEMO', data);\r\n}\r\n\r\nexport async function exportDemoData(): Promise<any> {\r\n    await initDB();\r\n    return send('EXPORT_DEMO_DATA');\r\n}\r\n\r\nexport async function initSchema() {\r\n    await initDB();\r\n    return send('INIT_SCHEMA');\r\n}\r\n\r\nexport async function getDiagnostics() {\r\n    await initDB();\r\n    return send('GET_DIAGNOSTICS');\r\n}\r\n\r\nexport function genericBulkInsert(tableName: string, records: any[]): Promise<number> {\r\n    return send<number>('GENERIC_BULK_INSERT', { tableName, records });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\db.worker.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[172,175],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[172,175],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[198,201],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[198,201],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[282,285],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[282,285],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[354,357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[354,357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'isRetrying' is never reassigned. Use 'const' instead.","line":20,"column":17,"nodeType":"Identifier","messageId":"useConst","endLine":20,"endColumn":27,"fix":{"range":[605,628],"text":"const isRetrying = false;"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[725,728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[725,728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1079,1082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1079,1082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1820,1823],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1820,1823],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2001,2004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2001,2004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2561,2564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2561,2564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2738,2741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2738,2741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":109,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":109,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":124,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4953,4956],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4953,4956],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":155,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6050,6053],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6050,6053],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":203,"column":17,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":203,"endColumn":40,"suggestions":[{"messageId":"addBrackets","fix":{"range":[7473,7822],"text":"{ if (!db) await initDB();\r\n                const rows: any[] = [];\r\n                db.exec({\r\n                    sql: payload.sql,\r\n                    bind: payload.bind,\r\n                    rowMode: 'object',\r\n                    callback: (row: any) => rows.push(row)\r\n                });\r\n                result = rows;\r\n                break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":203,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7527,7530],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7527,7530],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":208,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7723,7726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7723,7726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":233,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8499,8502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8499,8502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":237,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8765,8768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8765,8768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":253,"column":17,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":253,"endColumn":58,"suggestions":[{"messageId":"addBrackets","fix":{"range":[9283,9642],"text":"{ if (!db) await initDB();\r\n                const cleanTableName = payload.tableName;\r\n                if (!/^[a-z0-9_]+$/i.test(cleanTableName)) {\r\n                    throw new Error(`Invalid table name: ${cleanTableName}`);\r\n                }\r\n                db.exec(`DELETE FROM ${cleanTableName};`);\r\n                result = true;\r\n                break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":269,"column":17,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":269,"endColumn":44,"suggestions":[{"messageId":"addBrackets","fix":{"range":[9931,10734],"text":"{ if (!db) await initDB();\r\n                const exportData: any = {};\r\n                const tables: any[] = [];\r\n                db.exec({\r\n                    sql: \"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'\",\r\n                    rowMode: 'object',\r\n                    callback: (row: any) => tables.push(row.name)\r\n                });\r\n                for (const t of tables) {\r\n                    const rows: any[] = [];\r\n                    db.exec({\r\n                        sql: `SELECT * FROM ${t}`,\r\n                        rowMode: 'object',\r\n                        callback: (row: any) => rows.push(row)\r\n                    });\r\n                    exportData[t] = rows;\r\n                }\r\n                result = exportData;\r\n                break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":269,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":269,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9991,9994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9991,9994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":270,"column":17,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":270,"endColumn":42,"suggestions":[{"messageId":"addBrackets","fix":{"range":[9931,10734],"text":"{ if (!db) await initDB();\r\n                const exportData: any = {};\r\n                const tables: any[] = [];\r\n                db.exec({\r\n                    sql: \"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'\",\r\n                    rowMode: 'object',\r\n                    callback: (row: any) => tables.push(row.name)\r\n                });\r\n                for (const t of tables) {\r\n                    const rows: any[] = [];\r\n                    db.exec({\r\n                        sql: `SELECT * FROM ${t}`,\r\n                        rowMode: 'object',\r\n                        callback: (row: any) => rows.push(row)\r\n                    });\r\n                    exportData[t] = rows;\r\n                }\r\n                result = exportData;\r\n                break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":270,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":270,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10032,10035],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10032,10035],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":274,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10256,10259],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10256,10259],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":277,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10383,10386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10383,10386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":281,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10563,10566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10563,10566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":305,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":305,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11242,11245],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11242,11245],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":316,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":316,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11600,11603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11600,11603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":320,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":320,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11776,11779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11776,11779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":346,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":346,"endColumn":23}],"suppressedMessages":[],"errorCount":31,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import sqlite3InitModule from '@sqlite.org/sqlite-wasm';\r\nimport schemaSql from '../datasets/schema.sql?raw';\r\nimport viewsSql from '../datasets/views.sql?raw';\r\n\r\nlet db: any = null;\r\nlet sqlite3: any = null;\r\nlet initPromise: Promise<void> | null = null;\r\n\r\nconst log = (...args: any[]) => console.log('[DB Worker]', ...args);\r\nconst error = (...args: any[]) => console.error('[DB Worker]', ...args);\r\n\r\nasync function initDB() {\r\n    if (db) return;\r\n    if (initPromise) return initPromise;\r\n\r\n    initPromise = (async () => {\r\n        try {\r\n            log('Initializing SQLite...');\r\n\r\n            let isRetrying = false;\r\n            const config = {\r\n                print: log,\r\n                printErr: (...args: any[]) => {\r\n                    const msg = args.join(' ');\r\n                    if (isRetrying && (msg.includes('OPFS asyncer') || msg.includes('GetSyncHandleError'))) {\r\n                        return;\r\n                    }\r\n                    error(...args);\r\n                },\r\n            };\r\n\r\n            sqlite3 = await (sqlite3InitModule as any)(config);\r\n\r\n            if (sqlite3.oo1.OpfsDb) {\r\n                try {\r\n                    db = new sqlite3.oo1.OpfsDb('/litebistudio.sqlite3');\r\n                    log('Opened OPFS database');\r\n                } catch (e) {\r\n                    error('OPFS unavailable, falling back to memory', e);\r\n                    db = new sqlite3.oo1.DB(':memory:');\r\n                }\r\n            } else {\r\n                log('OPFS not supported, using memory');\r\n                db = new sqlite3.oo1.DB(':memory:');\r\n            }\r\n\r\n            // Initialize infrastructure schema\r\n            db.exec(schemaSql);\r\n\r\n            // Migration: sys_user_widgets -> visual_builder_config\r\n            try {\r\n                const columns: any[] = [];\r\n                db.exec({\r\n                    sql: \"PRAGMA table_info(sys_user_widgets)\",\r\n                    rowMode: 'object',\r\n                    callback: (row: any) => columns.push(row.name)\r\n                });\r\n                if (columns.length > 0 && !columns.includes('visual_builder_config')) {\r\n                    db.exec(\"ALTER TABLE sys_user_widgets ADD COLUMN visual_builder_config TEXT\");\r\n                    log('Migrated sys_user_widgets: Added visual_builder_config');\r\n                }\r\n            } catch (e) {\r\n                error('Migration failed for sys_user_widgets', e);\r\n            }\r\n\r\n            // Migration: sys_worklist enhancements\r\n            try {\r\n                const columns: any[] = [];\r\n                db.exec({\r\n                    sql: \"PRAGMA table_info(sys_worklist)\",\r\n                    rowMode: 'object',\r\n                    callback: (row: any) => columns.push(row.name)\r\n                });\r\n                if (columns.length > 0) {\r\n                    if (!columns.includes('comment')) {\r\n                        db.exec(\"ALTER TABLE sys_worklist ADD COLUMN comment TEXT\");\r\n                        log('Migrated sys_worklist: Added comment');\r\n                    }\r\n                    if (!columns.includes('updated_at')) {\r\n                        // SQLite doesn't allow CURRENT_TIMESTAMP as a default when adding a column via ALTER TABLE\r\n                        db.exec(\"ALTER TABLE sys_worklist ADD COLUMN updated_at TIMESTAMP\");\r\n                        db.exec(\"UPDATE sys_worklist SET updated_at = CURRENT_TIMESTAMP WHERE updated_at IS NULL\");\r\n                        log('Migrated sys_worklist: Added updated_at');\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                error('Migration failed for sys_worklist', e);\r\n            }\r\n\r\n            // Migration: sys_report_packs\r\n            try {\r\n                db.exec(`\r\n                    CREATE TABLE IF NOT EXISTS sys_report_packs (\r\n                        id TEXT PRIMARY KEY,\r\n                        name TEXT NOT NULL,\r\n                        description TEXT,\r\n                        config TEXT, -- JSON string of ReportPackConfig\r\n                        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\r\n                        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n                    );\r\n                `);\r\n            } catch (e) {\r\n                error('Migration failed for sys_report_packs', e);\r\n            }\r\n\r\n            // Views might depend on tables that don't exist yet, we should probably wrap this or make it on-demand\r\n            try {\r\n                db.exec(viewsSql);\r\n            } catch (e) {\r\n                log('Warning: views.sql execution partially or fully failed (expected if source tables are missing)');\r\n            }\r\n\r\n            log('Generic Schema initialized');\r\n        } catch (e) {\r\n            error('Initialization failed', e);\r\n            initPromise = null;\r\n            throw e;\r\n        }\r\n    })();\r\n\r\n    return initPromise;\r\n}\r\n\r\nasync function loadDemoData(demoContent?: any) {\r\n    if (!demoContent) {\r\n        log('No demo data provided for generic loader.');\r\n        return 0;\r\n    }\r\n\r\n    try {\r\n        db.exec('BEGIN TRANSACTION');\r\n\r\n        let totalRecords = 0;\r\n        for (const [tableName, records] of Object.entries(demoContent)) {\r\n            if (Array.isArray(records) && records.length > 0) {\r\n                // Determine if table exists\r\n                const tableExists = db.selectValue(\"SELECT count(*) FROM sqlite_master WHERE type='table' AND name=?\", [tableName]);\r\n                if (tableExists) {\r\n                    genericBulkInsert(tableName, records, false); // false = use existing transaction\r\n                    totalRecords += records.length;\r\n                }\r\n            }\r\n        }\r\n\r\n        db.exec('COMMIT');\r\n        log(`Demo data loaded successfully: ${totalRecords} records across multiple tables.`);\r\n        return totalRecords;\r\n    } catch (e) {\r\n        db.exec('ROLLBACK');\r\n        error('Failed to load demo data', e);\r\n        throw e;\r\n    }\r\n}\r\n\r\nfunction genericBulkInsert(tableName: string, records: any[], wrapInTransaction: boolean = true) {\r\n    if (records.length === 0) return;\r\n    if (!/^[a-z0-9_]+$/i.test(tableName)) {\r\n        throw new Error(`Invalid table name: ${tableName}`);\r\n    }\r\n\r\n    const keys = Object.keys(records[0]);\r\n    const placeholders = keys.map(() => '?').join(', ');\r\n    const columns = keys.map(k => `\"${k}\"`).join(', ');\r\n    const sql = `INSERT INTO ${tableName} (${columns}) VALUES (${placeholders})`;\r\n\r\n    if (wrapInTransaction) db.exec('BEGIN TRANSACTION');\r\n    try {\r\n        const stmt = db.prepare(sql);\r\n        try {\r\n            for (const record of records) {\r\n                const values = keys.map(k => {\r\n                    const val = record[k];\r\n                    return val === undefined ? null : val;\r\n                });\r\n                stmt.bind(values);\r\n                stmt.step();\r\n                stmt.reset();\r\n            }\r\n        } finally {\r\n            stmt.finalize();\r\n        }\r\n        if (wrapInTransaction) db.exec('COMMIT');\r\n    } catch (e) {\r\n        if (wrapInTransaction) db.exec('ROLLBACK');\r\n        throw e;\r\n    }\r\n}\r\n\r\nasync function handleMessage(e: MessageEvent) {\r\n    const { id, type, payload } = e.data;\r\n\r\n    try {\r\n        let result;\r\n\r\n        switch (type) {\r\n            case 'INIT':\r\n                await initDB();\r\n                result = true;\r\n                break;\r\n\r\n            case 'EXEC':\r\n                if (!db) await initDB();\r\n                const rows: any[] = [];\r\n                db.exec({\r\n                    sql: payload.sql,\r\n                    bind: payload.bind,\r\n                    rowMode: 'object',\r\n                    callback: (row: any) => rows.push(row)\r\n                });\r\n                result = rows;\r\n                break;\r\n\r\n            case 'GET_DIAGNOSTICS':\r\n                if (!db) await initDB();\r\n                result = getDiagnostics();\r\n                break;\r\n\r\n            case 'EXPORT':\r\n                if (!db) await initDB();\r\n                result = sqlite3.capi.sqlite3_js_db_export(db.pointer);\r\n                break;\r\n\r\n            case 'IMPORT':\r\n                await importDatabase(payload);\r\n                result = true;\r\n                break;\r\n\r\n            case 'CLEAR':\r\n                if (!db) await initDB();\r\n                try {\r\n                    db.exec('BEGIN TRANSACTION');\r\n                    // Get all user tables\r\n                    const tables: any[] = [];\r\n                    db.exec({\r\n                        sql: \"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' AND name NOT LIKE 'sys_%'\",\r\n                        rowMode: 'object',\r\n                        callback: (row: any) => tables.push(row.name)\r\n                    });\r\n                    for (const t of tables) {\r\n                        db.exec(`DELETE FROM ${t};`);\r\n                    }\r\n                    db.exec('COMMIT');\r\n                    log('Database cleared (all user tables)');\r\n                } catch (err) {\r\n                    db.exec('ROLLBACK');\r\n                    throw err;\r\n                }\r\n                result = true;\r\n                break;\r\n\r\n            case 'CLEAR_TABLE':\r\n                if (!db) await initDB();\r\n                const cleanTableName = payload.tableName;\r\n                if (!/^[a-z0-9_]+$/i.test(cleanTableName)) {\r\n                    throw new Error(`Invalid table name: ${cleanTableName}`);\r\n                }\r\n                db.exec(`DELETE FROM ${cleanTableName};`);\r\n                result = true;\r\n                break;\r\n\r\n            case 'GENERIC_BULK_INSERT':\r\n                if (!db) await initDB();\r\n                genericBulkInsert(payload.tableName, payload.records);\r\n                result = payload.records.length;\r\n                break;\r\n\r\n            case 'EXPORT_DEMO_DATA':\r\n                if (!db) await initDB();\r\n                const exportData: any = {};\r\n                const tables: any[] = [];\r\n                db.exec({\r\n                    sql: \"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'\",\r\n                    rowMode: 'object',\r\n                    callback: (row: any) => tables.push(row.name)\r\n                });\r\n                for (const t of tables) {\r\n                    const rows: any[] = [];\r\n                    db.exec({\r\n                        sql: `SELECT * FROM ${t}`,\r\n                        rowMode: 'object',\r\n                        callback: (row: any) => rows.push(row)\r\n                    });\r\n                    exportData[t] = rows;\r\n                }\r\n                result = exportData;\r\n                break;\r\n\r\n            case 'LOAD_DEMO':\r\n                if (!db) await initDB();\r\n                result = await loadDemoData(payload);\r\n                break;\r\n\r\n            case 'CLOSE':\r\n                if (db) {\r\n                    log('Closing database...');\r\n                    db.close();\r\n                    db = null;\r\n                }\r\n                result = true;\r\n                self.close();\r\n                break;\r\n        }\r\n\r\n        self.postMessage({ id, result });\r\n    } catch (error: any) {\r\n        self.postMessage({ id, error: error.message });\r\n    }\r\n}\r\n\r\nfunction getDiagnostics() {\r\n    const pageCount = db.selectValue('PRAGMA page_count') as number;\r\n    const pageSize = db.selectValue('PRAGMA page_size') as number;\r\n    const dbSize = pageCount * pageSize;\r\n\r\n    const tableStats: Record<string, number> = {};\r\n    const tables: any[] = [];\r\n    db.exec({\r\n        sql: \"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'\",\r\n        rowMode: 'object',\r\n        callback: (row: any) => tables.push(row.name)\r\n    });\r\n\r\n    for (const table of tables) {\r\n        tableStats[table] = db.selectValue(`SELECT count(*) FROM \"${table}\"`);\r\n    }\r\n\r\n    return {\r\n        dbSize,\r\n        pageCount,\r\n        pageSize,\r\n        tableStats\r\n    };\r\n}\r\n\r\nasync function importDatabase(buffer: ArrayBuffer) {\r\n    if (db) {\r\n        db.close();\r\n        db = null;\r\n    }\r\n\r\n    if (sqlite3.oo1.OpfsDb) {\r\n        try {\r\n            const root = await navigator.storage.getDirectory();\r\n            try {\r\n                await root.removeEntry('litebistudio.sqlite3');\r\n            } catch (e) { /* ignore */ }\r\n\r\n            const fileHandle = await root.getFileHandle('litebistudio.sqlite3', { create: true });\r\n            const writable = await fileHandle.createWritable();\r\n            await writable.write(buffer);\r\n            await writable.close();\r\n        } catch (e) {\r\n            error('Import failed', e);\r\n            throw e;\r\n        }\r\n    }\r\n}\r\n\r\nself.onmessage = handleMessage;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\i18n.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\repositories\\SettingsRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\repositories\\SystemRepository.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[812,815],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[812,815],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1095,1098],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1095,1098],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1396,1399],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1396,1399],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1600,1603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1600,1603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2502,2505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2502,2505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2518,2521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2518,2521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3089,3092],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3089,3092],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3381,3384],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3381,3384],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3525,3528],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3525,3528],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4777,4780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4777,4780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5080,5083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5080,5083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":141,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6076,6079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6076,6079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6378,6381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6378,6381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":171,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7327,7330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7327,7330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7607,7610],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7607,7610],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":203,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":203,"endColumn":19}],"suppressedMessages":[],"errorCount":16,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { runQuery, notifyDbChange } from '../db';\r\nimport type { TableColumn } from '../../types';\r\nimport { isValidIdentifier } from '../utils';\r\n\r\nexport const SystemRepository = {\r\n    async getDatabaseStats(): Promise<{ tables: number; records: number }> {\r\n        const tables = await this.getTables();\r\n        let totalRecords = 0;\r\n        for (const table of tables) {\r\n            const countResult = await runQuery(`SELECT count(*) as count FROM \"${table}\"`);\r\n            totalRecords += (countResult[0]?.count as number) || 0;\r\n        }\r\n        return { tables: tables.length, records: totalRecords };\r\n    },\r\n\r\n    async getTotalRecordCount(): Promise<number> {\r\n        const stats = await this.getDatabaseStats();\r\n        return stats.records;\r\n    },\r\n\r\n    async getDiagnostics(): Promise<any> {\r\n        return await import('../db').then(m => m.getDiagnostics());\r\n    },\r\n\r\n    async getTables(): Promise<string[]> {\r\n        const result = await runQuery(\"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'\");\r\n        return result.map((r: any) => r.name as string);\r\n    },\r\n\r\n    async getTableSchema(tableName: string): Promise<TableColumn[]> {\r\n        return await runQuery(`PRAGMA table_info(${tableName})`) as unknown as TableColumn[];\r\n    },\r\n\r\n    async inspectTable(tableName: string, limit: number, searchTerm?: string): Promise<any[]> {\r\n        if (!isValidIdentifier(tableName)) {\r\n            throw new Error(`Invalid table name: ${tableName}`);\r\n        }\r\n        let sql = `SELECT * FROM ${tableName}`;\r\n        const params: any[] = [];\r\n\r\n        if (searchTerm) {\r\n            const schema = await this.getTableSchema(tableName);\r\n            const searchFilter = schema\r\n                .filter(col => col.type.toUpperCase().includes('TEXT') || col.name.toLowerCase().includes('id') || col.name.toLowerCase().includes('name'))\r\n                .map(col => `${col.name} LIKE '%' || ? || '%'`)\r\n                .join(' OR ');\r\n\r\n            if (searchFilter) {\r\n                sql += ` WHERE ${searchFilter}`;\r\n                params.push(...Array(schema.filter(col => col.type.toUpperCase().includes('TEXT') || col.name.toLowerCase().includes('id') || col.name.toLowerCase().includes('name')).length).fill(searchTerm));\r\n            }\r\n        }\r\n\r\n        sql += ` ORDER BY rowid DESC LIMIT ?`;\r\n        params.push(limit);\r\n\r\n        return await runQuery(sql, params);\r\n    },\r\n\r\n    async executeRaw(sql: string, bind?: any[]): Promise<any[]> {\r\n        const result = await runQuery(sql, bind);\r\n\r\n        // Simple heuristic to detect write operations\r\n        const upperSql = sql.trim().toUpperCase();\r\n        if (upperSql.startsWith('INSERT') ||\r\n            upperSql.startsWith('UPDATE') ||\r\n            upperSql.startsWith('DELETE') ||\r\n            upperSql.startsWith('DROP') ||\r\n            upperSql.startsWith('CREATE') ||\r\n            upperSql.startsWith('ALTER')) {\r\n            notifyDbChange();\r\n        }\r\n\r\n        return result;\r\n    },\r\n\r\n    async bulkInsert(tableName: string, records: any[]): Promise<number> {\r\n        const { genericBulkInsert } = await import('../db');\r\n        const count = await genericBulkInsert(tableName, records);\r\n        notifyDbChange(count);\r\n        return count;\r\n    },\r\n\r\n    // User Widgets (Generic BI)\r\n    async getUserWidgets(): Promise<any[]> {\r\n        return await runQuery('SELECT * FROM sys_user_widgets ORDER BY created_at DESC');\r\n    },\r\n\r\n    async saveUserWidget(widget: any): Promise<void> {\r\n        const existing = await runQuery('SELECT id FROM sys_user_widgets WHERE id = ?', [widget.id]);\r\n        if (existing.length > 0) {\r\n            await runQuery(\r\n                'UPDATE sys_user_widgets SET name = ?, description = ?, sql_query = ?, visualization_config = ?, visual_builder_config = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?',\r\n                [widget.name, widget.description, widget.sql_query, JSON.stringify(widget.visualization_config), JSON.stringify(widget.visual_builder_config), widget.id]\r\n            );\r\n        } else {\r\n            await runQuery(\r\n                'INSERT INTO sys_user_widgets (id, name, description, sql_query, visualization_config, visual_builder_config) VALUES (?, ?, ?, ?, ?, ?)',\r\n                [widget.id, widget.name, widget.description, widget.sql_query, JSON.stringify(widget.visualization_config), JSON.stringify(widget.visual_builder_config)]\r\n            );\r\n        }\r\n        notifyDbChange();\r\n    },\r\n\r\n    async deleteUserWidget(id: string): Promise<void> {\r\n        await runQuery('DELETE FROM sys_user_widgets WHERE id = ?', [id]);\r\n        notifyDbChange();\r\n    },\r\n\r\n    // Dashboards (Multi-Dashboard Support)\r\n    async getDashboards(): Promise<any[]> {\r\n        const result = await runQuery('SELECT * FROM sys_dashboards ORDER BY created_at ASC');\r\n        return result.map(r => ({\r\n            ...r,\r\n            layout: typeof r.layout === 'string' ? JSON.parse(r.layout) : r.layout\r\n        }));\r\n    },\r\n\r\n    async saveDashboard(dashboard: any): Promise<void> {\r\n        const existing = await runQuery('SELECT id FROM sys_dashboards WHERE id = ?', [dashboard.id]);\r\n        if (existing.length > 0) {\r\n            await runQuery(\r\n                'UPDATE sys_dashboards SET name = ?, layout = ?, is_default = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?',\r\n                [dashboard.name, JSON.stringify(dashboard.layout), dashboard.is_default ? 1 : 0, dashboard.id]\r\n            );\r\n        } else {\r\n            await runQuery(\r\n                'INSERT INTO sys_dashboards (id, name, layout, is_default) VALUES (?, ?, ?, ?)',\r\n                [dashboard.id, dashboard.name, JSON.stringify(dashboard.layout), dashboard.is_default ? 1 : 0]\r\n            );\r\n        }\r\n        notifyDbChange();\r\n    },\r\n\r\n    async deleteDashboard(id: string): Promise<void> {\r\n        await runQuery('DELETE FROM sys_dashboards WHERE id = ?', [id]);\r\n        notifyDbChange();\r\n    },\r\n\r\n    // Report Packages\r\n    async getReportPacks(): Promise<any[]> {\r\n        const result = await runQuery('SELECT * FROM sys_report_packs ORDER BY created_at DESC');\r\n        return result.map(r => ({\r\n            ...r,\r\n            config: typeof r.config === 'string' ? JSON.parse(r.config) : r.config\r\n        }));\r\n    },\r\n\r\n    async saveReportPack(pack: any): Promise<void> {\r\n        const existing = await runQuery('SELECT id FROM sys_report_packs WHERE id = ?', [pack.id]);\r\n        if (existing.length > 0) {\r\n            await runQuery(\r\n                'UPDATE sys_report_packs SET name = ?, description = ?, config = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?',\r\n                [pack.name, pack.description, JSON.stringify(pack.config), pack.id]\r\n            );\r\n        } else {\r\n            await runQuery(\r\n                'INSERT INTO sys_report_packs (id, name, description, config) VALUES (?, ?, ?, ?)',\r\n                [pack.id, pack.name, pack.description, JSON.stringify(pack.config)]\r\n            );\r\n        }\r\n        notifyDbChange();\r\n    },\r\n\r\n    async deleteReportPack(id: string): Promise<void> {\r\n        await runQuery('DELETE FROM sys_report_packs WHERE id = ?', [id]);\r\n        notifyDbChange();\r\n    },\r\n\r\n    // Worklist Management\r\n    async getWorklist(): Promise<any[]> {\r\n        return await runQuery('SELECT * FROM sys_worklist ORDER BY created_at DESC');\r\n    },\r\n\r\n    async updateWorklistItem(id: number | string, data: { status?: string; comment?: string }): Promise<void> {\r\n        const fields: string[] = [];\r\n        const params: any[] = [];\r\n\r\n        if (data.status !== undefined) {\r\n            fields.push('status = ?');\r\n            params.push(data.status);\r\n        }\r\n        if (data.comment !== undefined) {\r\n            fields.push('comment = ?');\r\n            params.push(data.comment);\r\n        }\r\n\r\n        if (fields.length === 0) return;\r\n\r\n        fields.push('updated_at = CURRENT_TIMESTAMP');\r\n        params.push(Number(id)); // Force number for ID consistency\r\n\r\n        const sql = `UPDATE sys_worklist SET ${fields.join(', ')} WHERE id = ?`;\r\n        await runQuery(sql, params);\r\n        notifyDbChange();\r\n    },\r\n\r\n    async checkRecordExists(tableName: string, id: string | number): Promise<boolean> {\r\n        if (!isValidIdentifier(tableName)) return false;\r\n        try {\r\n            const result = await runQuery(`SELECT 1 FROM \"${tableName}\" WHERE id = ?`, [id]);\r\n            return result.length > 0;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\transformers.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[168,171],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[168,171],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[176,179],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[176,179],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[439,442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[439,442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1016,1019],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1016,1019],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1245,1248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1245,1248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1869,1872],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1869,1872],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2465,2468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2465,2468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2945,2948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2945,2948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3808,3811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3808,3811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":109,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4033,4036],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4033,4036],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4265,4268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4265,4268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4500,4503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4500,4503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":133,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4991,4994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4991,4994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":146,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5600,5603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5600,5603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":157,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5956,5959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5956,5959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { parse, format, isValid } from 'date-fns';\r\n\r\nexport interface Transformer {\r\n    id: string;\r\n    label: string;\r\n    description: string;\r\n    apply: (value: any) => any;\r\n}\r\n\r\nexport const transformers: Record<string, Transformer[]> = {\r\n    'Period': [\r\n        {\r\n            id: 'MMM.YYYY',\r\n            label: 'MMM.YYYY (e.g. 001.2025)',\r\n            description: 'Converts 001.2025 to 2025-01',\r\n            apply: (value: any) => {\r\n                if (typeof value !== 'string') return value;\r\n                const match = value.match(/^(\\d{3})\\.(\\d{4})$/);\r\n                if (match) {\r\n                    const month = parseInt(match[1], 10);\r\n                    const year = match[2];\r\n                    return `${year}-${month.toString().padStart(2, '0')}`;\r\n                }\r\n                return value;\r\n            }\r\n        },\r\n        {\r\n            id: 'YYYY-MM',\r\n            label: 'YYYY-MM (ISO)',\r\n            description: 'Standard ISO format',\r\n            apply: (value: any) => value // Identity\r\n        },\r\n        {\r\n            id: 'MM.YYYY',\r\n            label: 'MM.YYYY / MM-YYYY (e.g. 01.2025)',\r\n            description: 'Converts 01.2025 or 01-2025 to 2025-01',\r\n            apply: (value: any) => {\r\n                if (typeof value !== 'string') return value;\r\n                const match = String(value).trim().match(/^(\\d{1,2})[.-](\\d{4})$/);\r\n                if (match) {\r\n                    const month = parseInt(match[1], 10);\r\n                    const year = match[2];\r\n                    return `${year}-${month.toString().padStart(2, '0')}`;\r\n                }\r\n                return value;\r\n            }\r\n        }\r\n    ],\r\n    'PostingDate': [\r\n        {\r\n            id: 'DD.MM.YYYY',\r\n            label: 'DD.MM.YYYY',\r\n            description: 'German date format',\r\n            apply: (value: any) => {\r\n                if (typeof value !== 'string') return value;\r\n                // Basic check to avoid re-parsing ISO\r\n                if (value.match(/^\\d{4}-\\d{2}-\\d{2}$/)) return value;\r\n\r\n                const parsed = parse(value, 'dd.MM.yyyy', new Date());\r\n                if (isValid(parsed)) {\r\n                    return format(parsed, 'yyyy-MM-dd');\r\n                }\r\n                return value;\r\n            }\r\n        },\r\n        {\r\n            id: 'MM/DD/YYYY',\r\n            label: 'MM/DD/YYYY',\r\n            description: 'US date format',\r\n            apply: (value: any) => {\r\n                if (typeof value !== 'string') return value;\r\n                const parsed = parse(value, 'MM/dd/yyyy', new Date());\r\n                if (isValid(parsed)) {\r\n                    return format(parsed, 'yyyy-MM-dd');\r\n                }\r\n                return value;\r\n            }\r\n        },\r\n        {\r\n            id: 'ExcelSerial',\r\n            label: 'Excel Serial Number',\r\n            description: 'Number like 45321',\r\n            apply: (value: any) => {\r\n                // If value is number or numeric string\r\n                const num = Number(value);\r\n                if (!isNaN(num) && num > 20000) { // arbitrary lower bound check\r\n                    // Excel base date: Dec 30 1899\r\n                    const date = new Date((num - 25569) * 86400 * 1000);\r\n                    return format(date, 'yyyy-MM-dd');\r\n                }\r\n                return value;\r\n            }\r\n        }\r\n    ],\r\n    // Text Transformers\r\n    ...['VendorName', 'VendorId', 'DocumentId', 'CostCenter', 'Category', 'SubCategory', 'Service', 'System', 'Description'].reduce((acc, field) => ({\r\n        ...acc,\r\n        [field]: [\r\n            {\r\n                id: 'Trim',\r\n                label: 'Trim Whitespace',\r\n                description: 'Removes leading and trailing spaces',\r\n                apply: (value: any) => String(value || '').trim()\r\n            },\r\n            {\r\n                id: 'UpperCase',\r\n                label: 'UPPER CASE',\r\n                description: 'Converts to uppercase',\r\n                apply: (value: any) => String(value || '').toUpperCase()\r\n            },\r\n            {\r\n                id: 'LowerCase',\r\n                label: 'lower case',\r\n                description: 'Converts to lowercase',\r\n                apply: (value: any) => String(value || '').toLowerCase()\r\n            },\r\n            {\r\n                id: 'TitleCase',\r\n                label: 'Title Case',\r\n                description: 'Capitalize First Letters',\r\n                apply: (value: any) => String(value || '').replace(/\\w\\S*/g, (txt) => txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase())\r\n            }\r\n        ]\r\n    }), {}),\r\n    // Numeric Transformers\r\n    ...['Amount', 'UnitPrice', 'Quantity'].reduce((acc, field) => ({\r\n        ...acc,\r\n        [field]: [\r\n            {\r\n                id: 'ParseDeCurrency',\r\n                label: 'German Currency (1.234,56)',\r\n                description: 'Parses 1.234,56 to 1234.56',\r\n                apply: (value: any) => {\r\n                    if (typeof value === 'number') return value;\r\n                    if (!value) return 0;\r\n                    // Remove dots, replace comma with dot\r\n                    const clean = String(value).replace(/\\./g, '').replace(',', '.');\r\n                    const num = parseFloat(clean);\r\n                    return isNaN(num) ? 0 : num;\r\n                }\r\n            },\r\n            {\r\n                id: 'CleanNumber',\r\n                label: 'Clean Number (Remove Symbols)',\r\n                description: 'Keep only digits, dots and minus',\r\n                apply: (value: any) => {\r\n                    if (typeof value === 'number') return value;\r\n                    const clean = String(value).replace(/[^0-9.-]/g, '');\r\n                    const num = parseFloat(clean);\r\n                    return isNaN(num) ? 0 : num;\r\n                }\r\n            }\r\n        ]\r\n    }), {})\r\n};\r\n\r\nexport const applyTransform = (value: any, transformId: string, fieldType: string) => {\r\n    const list = transformers[fieldType];\r\n    if (!list) return value;\r\n    const transformer = list.find(t => t.id === transformId);\r\n    return transformer ? transformer.apply(value) : value;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\utils\\cn.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\utils\\crypto.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1166,1169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1166,1169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export function generateSalt(length = 16): string {\r\n    const array = new Uint8Array(length);\r\n    crypto.getRandomValues(array);\r\n    return Array.from(array).map(b => b.toString(16).padStart(2, '0')).join('');\r\n}\r\n\r\nexport async function hashPin(pin: string, salt?: string): Promise<string> {\r\n    const encoder = new TextEncoder();\r\n    // Prepend salt if provided to ensure unique hashes even for identical PINs\r\n    const data = encoder.encode(salt ? salt + pin : pin);\r\n    const hashBuffer = await crypto.subtle.digest('SHA-256', data);\r\n    const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\r\n}\r\n\r\nasync function getKeyMaterial(password: string): Promise<CryptoKey> {\r\n    const enc = new TextEncoder();\r\n    return crypto.subtle.importKey(\r\n        \"raw\",\r\n        enc.encode(password),\r\n        { name: \"PBKDF2\" },\r\n        false,\r\n        [\"deriveBits\", \"deriveKey\"]\r\n    );\r\n}\r\n\r\nasync function getKey(keyMaterial: CryptoKey, salt: Uint8Array): Promise<CryptoKey> {\r\n    return crypto.subtle.deriveKey(\r\n        {\r\n            \"name\": \"PBKDF2\",\r\n            salt: salt as any,\r\n            \"iterations\": 100000,\r\n            \"hash\": \"SHA-256\"\r\n        },\r\n        keyMaterial,\r\n        { \"name\": \"AES-GCM\", \"length\": 256 },\r\n        true,\r\n        [\"encrypt\", \"decrypt\"]\r\n    );\r\n}\r\n\r\nexport async function encryptBuffer(data: BufferSource, password: string): Promise<ArrayBuffer> {\r\n    const salt = crypto.getRandomValues(new Uint8Array(16));\r\n    const iv = crypto.getRandomValues(new Uint8Array(12));\r\n\r\n    const keyMaterial = await getKeyMaterial(password);\r\n    const key = await getKey(keyMaterial, salt);\r\n\r\n    const encrypted = await crypto.subtle.encrypt(\r\n        {\r\n            name: \"AES-GCM\",\r\n            iv: iv\r\n        },\r\n        key,\r\n        data\r\n    );\r\n\r\n    // Combine: Salt (16) + IV (12) + Data\r\n    const result = new Uint8Array(salt.byteLength + iv.byteLength + encrypted.byteLength);\r\n    result.set(salt, 0);\r\n    result.set(iv, salt.byteLength);\r\n    result.set(new Uint8Array(encrypted), salt.byteLength + iv.byteLength);\r\n\r\n    return result.buffer;\r\n}\r\n\r\nexport async function decryptBuffer(data: BufferSource, password: string): Promise<ArrayBuffer> {\r\n    const view = data instanceof Uint8Array ? data : new Uint8Array(data as ArrayBuffer);\r\n    const salt = view.slice(0, 16);\r\n    const iv = view.slice(16, 28);\r\n    const ciphertext = view.slice(28);\r\n\r\n    const keyMaterial = await getKeyMaterial(password);\r\n    const key = await getKey(keyMaterial, salt);\r\n\r\n    return crypto.subtle.decrypt(\r\n        {\r\n            name: \"AES-GCM\",\r\n            iv: iv\r\n        },\r\n        key,\r\n        ciphertext\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\utils\\dateUtils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\utils\\dateUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\utils\\excelParser.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[292,295],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[292,295],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1281,1284],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1281,1284],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1371,1374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1371,1374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4362,4365],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4362,4365],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as XLSX from 'xlsx';\r\n\r\nexport interface ColumnDefinition {\r\n    name: string;\r\n    type: 'TEXT' | 'INTEGER' | 'REAL';\r\n}\r\n\r\nexport interface SheetAnalysis {\r\n    sheetName: string;\r\n    suggestedTableName: string;\r\n    columns: ColumnDefinition[];\r\n    rowCount: number;\r\n    data: any[];\r\n    isValid: boolean;\r\n    validationError?: string;\r\n}\r\n\r\nexport async function analyzeExcelFile(file: File): Promise<SheetAnalysis[]> {\r\n    return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n        reader.onload = (e) => {\r\n            try {\r\n                const data = new Uint8Array(e.target?.result as ArrayBuffer);\r\n                const workbook = XLSX.read(data, { type: 'array', cellDates: true });\r\n                const analyses: SheetAnalysis[] = [];\r\n\r\n                for (const sheetName of workbook.SheetNames) {\r\n                    const sheet = workbook.Sheets[sheetName];\r\n                    const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });\r\n\r\n                    if (!jsonData || jsonData.length < 2) {\r\n                        continue; // Skip empty sheets or sheets without data rows\r\n                    }\r\n\r\n                    // Extract Headers\r\n                    const headers = (jsonData[0] as any[]).map(h => String(h).trim());\r\n                    const rows = jsonData.slice(1) as any[][];\r\n\r\n                    // Sanitize Table Name\r\n                    let suggestedTableName = sheetName.toLowerCase()\r\n                        .replace(/[^a-z0-9_]/g, '_')\r\n                        .replace(/^_+|_+$/g, '')\r\n                        .replace(/_+/g, '_');\r\n\r\n                    let validationError: string | undefined = undefined;\r\n                    let isValid = true;\r\n\r\n                    // 1. Validate Identifier compliance\r\n                    if (!/^[a-z][a-z0-9_]*$/.test(suggestedTableName)) {\r\n                        // Fix: prepending 'tbl_' if it starts with digit or is empty\r\n                        if (/^[0-9]/.test(suggestedTableName)) {\r\n                            suggestedTableName = 'tbl_' + suggestedTableName;\r\n                        } else if (suggestedTableName === '') {\r\n                            suggestedTableName = 'tbl_unnamed';\r\n                        }\r\n                    }\r\n\r\n                    // 2. Validate Reserved Prefix\r\n                    if (suggestedTableName.startsWith('sys_')) {\r\n                        isValid = false;\r\n                        validationError = \"Tabellennamen drfen nicht mit 'sys_' beginnen (reserviert).\";\r\n                    }\r\n\r\n                    // Infer Types\r\n                    const columns: ColumnDefinition[] = headers.map((header, index) => {\r\n                        let isInt = true;\r\n                        let isReal = true;\r\n                        let hasData = false;\r\n\r\n                        // Check first 100 rows for type inference\r\n                        const sampleLimit = Math.min(rows.length, 100);\r\n                        for (let i = 0; i < sampleLimit; i++) {\r\n                            const val = rows[i][index];\r\n                            if (val === undefined || val === null || val === '') continue;\r\n\r\n                            hasData = true;\r\n                            const num = Number(val);\r\n\r\n                            if (isNaN(num)) {\r\n                                isInt = false;\r\n                                isReal = false;\r\n                                break;\r\n                            }\r\n\r\n                            if (!Number.isInteger(num)) {\r\n                                isInt = false;\r\n                            }\r\n                        }\r\n\r\n                        let type: 'TEXT' | 'INTEGER' | 'REAL' = 'TEXT';\r\n                        if (hasData) {\r\n                            if (isInt) type = 'INTEGER';\r\n                            else if (isReal) type = 'REAL';\r\n                        }\r\n\r\n                        // Sanitize column name\r\n                        const cleanHeader = header.toLowerCase().replace(/[^a-z0-9_]/g, '_');\r\n\r\n                        return { name: cleanHeader, type };\r\n                    });\r\n\r\n                    // Prepare Data (Full Dataset with Sanitized Keys)\r\n                    const data = rows.map(row => {\r\n                        const obj: any = {};\r\n                        columns.forEach((col, i) => {\r\n                            let val = row[i];\r\n                            if (val instanceof Date) {\r\n                                val = val.toISOString();\r\n                            } else if (typeof val === 'object' && val !== null) {\r\n                                val = JSON.stringify(val);\r\n                            }\r\n                            obj[col.name] = val;\r\n                        });\r\n                        return obj;\r\n                    });\r\n\r\n                    analyses.push({\r\n                        sheetName,\r\n                        suggestedTableName,\r\n                        columns,\r\n                        rowCount: rows.length,\r\n                        data, // Full data for import\r\n                        isValid,\r\n                        validationError\r\n                    });\r\n                }\r\n\r\n                resolve(analyses);\r\n            } catch (err) {\r\n                reject(err);\r\n            }\r\n        };\r\n        reader.onerror = (err) => reject(err);\r\n        reader.readAsArrayBuffer(file);\r\n    });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\utils\\exportUtils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\utils\\exportUtils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[327,330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[327,330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as XLSX from 'xlsx';\r\n\r\n/**\r\n * Exports an array of objects to an Excel file.\r\n * @param data - The data to export (array of objects).\r\n * @param fileName - The name of the output file (without extension).\r\n * @param sheetName - The name of the worksheet (default: \"Sheet1\").\r\n */\r\nexport const exportToExcel = (data: any[], fileName: string, sheetName: string = \"Sheet1\") => {\r\n    const ws = XLSX.utils.json_to_sheet(data);\r\n    const wb = XLSX.utils.book_new();\r\n    XLSX.utils.book_append_sheet(wb, ws, sheetName);\r\n    const fullFileName = fileName.endsWith('.xlsx') ? fileName : `${fileName}.xlsx`;\r\n    XLSX.writeFile(wb, fullFileName);\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\utils\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\utils\\security.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\validators\\systems-validator.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\lib\\validators\\worklist-validator.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\router.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\test\\setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2176,2179],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2176,2179],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"//  Component Types \r\n\r\nexport type ComponentSize = 'small' | 'medium' | 'large';\r\n\r\nexport interface ComponentConfig {\r\n    id: string;\r\n    title: string;\r\n    component: string;\r\n    targetView?: string;\r\n    defaultSize: ComponentSize;\r\n}\r\n\r\n//  Data Record (Generalized) \r\n\r\nexport interface DataRecord {\r\n    id: number;\r\n    /** Index signature for dynamic key field access */\r\n    [key: string]: string | number | boolean | null | undefined;\r\n}\r\n\r\n//  Anomaly (extends DataRecord with scoring) \r\n\r\nexport interface Anomaly extends DataRecord {\r\n    RiskScore: number;\r\n    AnomalyType: 'Cost Drift' | 'New Item' | 'Data Quality' | 'Review';\r\n}\r\n\r\n//  Systems \r\n\r\nexport type SystemStatus = 'online' | 'offline' | 'unknown';\r\n\r\nexport interface SystemRecord {\r\n    id: number;\r\n    name: string;\r\n    url: string | null;\r\n    status: SystemStatus;\r\n    category: string | null;\r\n    is_favorite: number; // SQLite boolean\r\n    sort_order: number;\r\n}\r\n\r\n//  Worklist \r\n\r\nexport type WorklistStatus = 'open' | 'ok' | 'error' | 'clarification';\r\n\r\nexport interface WorklistEntry {\r\n    id: number;\r\n    source_table: string;\r\n    source_id: number;\r\n    display_label: string | null;\r\n    display_context: string | null;\r\n    added_at: string;\r\n    status: WorklistStatus;\r\n}\r\n\r\n//  KPI \r\n\r\nexport interface KpiRecord {\r\n    metric: string;\r\n    value: number;\r\n    unit: string;\r\n    category: string;\r\n    date: string;\r\n    period: string;\r\n}\r\n\r\nexport interface DataSummary {\r\n    total_count: number;\r\n    latest_date: string;\r\n    unit?: string;\r\n}\r\n\r\n//  Settings \r\n\r\nexport interface SettingRecord {\r\n    key: string;\r\n    value: string | null;\r\n}\r\n\r\n//  Utility \r\n\r\n\r\nexport interface TableColumn {\r\n    cid: number;\r\n    name: string;\r\n    type: string;\r\n    notnull: number;\r\n    dflt_value: any;\r\n    pk: number;\r\n}\r\n\r\n//  Reporting & Dashboards \r\n\r\nexport interface AlertRule {\r\n    operator: '>' | '<' | '>=' | '<=' | '==';\r\n    value: number;\r\n    color: string;\r\n}\r\n\r\nexport interface WidgetConfig {\r\n    type: 'table' | 'bar' | 'line' | 'area' | 'pie' | 'kpi' | 'composed' | 'radar' | 'scatter' | 'pivot';\r\n    xAxis?: string;\r\n    yAxes?: string[];\r\n    yAxis?: string;\r\n    color?: string;\r\n    showLabels?: boolean;\r\n    barSeries?: string[];\r\n    lineSeries?: string[];\r\n    rules?: AlertRule[];\r\n    pivotRows?: string[];\r\n    pivotCols?: string[];\r\n    pivotMeasures?: { field: string, agg: 'sum' | 'count' | 'avg' | 'min' | 'max' }[];\r\n}\r\n\r\n//  Report Packages \r\n\r\nexport interface ReportPackItem {\r\n    type: 'dashboard' | 'widget';\r\n    id: string;\r\n}\r\n\r\nexport interface ReportPackConfig {\r\n    coverTitle: string;\r\n    coverSubtitle?: string;\r\n    author?: string;\r\n    showTOC: boolean;\r\n    items: ReportPackItem[];\r\n}\r\n\r\nexport interface ReportPack {\r\n    id: string;\r\n    name: string;\r\n    description: string;\r\n    config: ReportPackConfig;\r\n    created_at?: string;\r\n    updated_at?: string;\r\n}\r\n\r\n/** Generic database row  use sparingly, prefer specific types */\r\nexport type DbRow = Record<string, unknown>;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\github\\litebistudio\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]