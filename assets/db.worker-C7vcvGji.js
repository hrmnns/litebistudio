(function(){"use strict";async function Bt(D={}){var J,l=D,ne=!!globalThis.window,qe=!!globalThis.WorkerGlobalScope;globalThis.process?.versions?.node&&globalThis.process?.type;var ye="./this.program",we=self.location.href,Ue="";function Me(e){return l.locateFile?l.locateFile(e,Ue):Ue+e}var Le,He;if(ne||qe){try{Ue=new URL(".",we).href}catch{}qe&&(He=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),Le=async e=>{var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw new Error(t.status+" : "+t.url)}}var z=console.log.bind(console),ue=console.error.bind(console),ce,Te=!1,Ge,Xe,Re,xe,$e,Ne,Fe,nt,rn=!1;function sn(){var e=pt.buffer;Re=new Int8Array(e),$e=new Int16Array(e),xe=new Uint8Array(e),Ne=new Int32Array(e),Fe=new Uint32Array(e),nt=new BigInt64Array(e),new BigUint64Array(e)}function Fn(){if(l.wasmMemory)pt=l.wasmMemory;else{var e=l.INITIAL_MEMORY||8388608;pt=new WebAssembly.Memory({initial:e/65536,maximum:32768})}sn()}function Cn(){if(l.preRun)for(typeof l.preRun=="function"&&(l.preRun=[l.preRun]);l.preRun.length;)Gn(l.preRun.shift());on(ln)}function Mn(){rn=!0,!l.noFSInit&&!c.initialized&&c.init(),wt.__wasm_call_ctors(),c.ignorePermissions=!1}function Dn(){if(l.postRun)for(typeof l.postRun=="function"&&(l.postRun=[l.postRun]);l.postRun.length;)Hn(l.postRun.shift());on(an)}function _t(e){l.onAbort?.(e),e="Aborted("+e+")",ue(e),Te=!0,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw Xe?.(t),t}var Ht;function jn(){return l.locateFile?Me("sqlite3.wasm"):new URL("/litebistudio/assets/sqlite3-DGXXSD5r.wasm",self.location.href).href}function Un(e){if(e==Ht&&ce)return new Uint8Array(ce);if(He)return He(e);throw"both async and sync fetching of the wasm failed"}async function Bn(e){if(!ce)try{var t=await Le(e);return new Uint8Array(t)}catch{}return Un(e)}async function zn(e,t){try{var o=await Bn(e);return await WebAssembly.instantiate(o,t)}catch(i){ue(`failed to asynchronously prepare wasm: ${i}`),_t(i)}}async function Wn(e,t,o){if(!e)try{var i=fetch(t,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(i,o)}catch(n){ue(`wasm streaming compile failed: ${n}`),ue("falling back to ArrayBuffer instantiation")}return zn(t,o)}function Qn(){return{env:vn,wasi_snapshot_preview1:vn}}async function Vn(){function e(i,n){return wt=i.exports,Xr(wt),wt}function t(i){return e(i.instance)}var o=Qn();return l.instantiateWasm?new Promise((i,n)=>{l.instantiateWasm(o,(s,r)=>{i(e(s))})}):(Ht??=jn(),t(await Wn(ce,Ht,o)))}var on=e=>{for(;e.length>0;)e.shift()(l)},an=[],Hn=e=>an.push(e),ln=[],Gn=e=>ln.push(e),pt,Be={isAbs:e=>e.charAt(0)==="/",splitPath:e=>/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1),normalizeArray:(e,t)=>{for(var o=0,i=e.length-1;i>=0;i--){var n=e[i];n==="."?e.splice(i,1):n===".."?(e.splice(i,1),o++):o&&(e.splice(i,1),o--)}if(t)for(;o;o--)e.unshift("..");return e},normalize:e=>{var t=Be.isAbs(e),o=e.slice(-1)==="/";return e=Be.normalizeArray(e.split("/").filter(i=>!!i),!t).join("/"),!e&&!t&&(e="."),e&&o&&(e+="/"),(t?"/":"")+e},dirname:e=>{var t=Be.splitPath(e),o=t[0],i=t[1];return!o&&!i?".":(i&&(i=i.slice(0,-1)),o+i)},basename:e=>e&&e.match(/([^\/]+|\/)\/*$/)[1],join:(...e)=>Be.normalize(e.join("/")),join2:(e,t)=>Be.normalize(e+"/"+t)},$n=()=>e=>crypto.getRandomValues(e),cn=e=>{(cn=$n())(e)},St={resolve:(...e)=>{for(var t="",o=!1,i=e.length-1;i>=-1&&!o;i--){var n=i>=0?e[i]:c.cwd();if(typeof n!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";t=n+"/"+t,o=Be.isAbs(n)}return t=Be.normalizeArray(t.split("/").filter(s=>!!s),!o).join("/"),(o?"/":"")+t||"."},relative:(e,t)=>{e=St.resolve(e).slice(1),t=St.resolve(t).slice(1);function o(I){for(var Z=0;Z<I.length&&I[Z]==="";Z++);for(var R=I.length-1;R>=0&&I[R]==="";R--);return Z>R?[]:I.slice(Z,R-Z+1)}for(var i=o(e.split("/")),n=o(t.split("/")),s=Math.min(i.length,n.length),r=s,u=0;u<s;u++)if(i[u]!==n[u]){r=u;break}for(var P=[],u=r;u<i.length;u++)P.push("..");return P=P.concat(n.slice(r)),P.join("/")}},un=new TextDecoder,_n=(e,t,o,i)=>{for(var n=t+o;e[t]&&!(t>=n);)++t;return t},Nt=(e,t=0,o,i)=>{var n=_n(e,t,o);return un.decode(e.buffer?e.subarray(t,n):new Uint8Array(e.slice(t,n)))},Gt=[],Mt=e=>{for(var t=0,o=0;o<e.length;++o){var i=e.charCodeAt(o);i<=127?t++:i<=2047?t+=2:i>=55296&&i<=57343?(t+=4,++o):t+=3}return t},fn=(e,t,o,i)=>{if(!(i>0))return 0;for(var n=o,s=o+i-1,r=0;r<e.length;++r){var u=e.codePointAt(r);if(u<=127){if(o>=s)break;t[o++]=u}else if(u<=2047){if(o+1>=s)break;t[o++]=192|u>>6,t[o++]=128|u&63}else if(u<=65535){if(o+2>=s)break;t[o++]=224|u>>12,t[o++]=128|u>>6&63,t[o++]=128|u&63}else{if(o+3>=s)break;t[o++]=240|u>>18,t[o++]=128|u>>12&63,t[o++]=128|u>>6&63,t[o++]=128|u&63,r++}}return t[o]=0,o-n},$t=(e,t,o)=>{var i=Mt(e)+1,n=new Array(i),s=fn(e,n,0,n.length);return n.length=s,n},Xn=()=>{if(!Gt.length){var e=null;if(globalThis.window?.prompt&&(e=window.prompt("Input: "),e!==null&&(e+=`
`)),!e)return null;Gt=$t(e)}return Gt.shift()},bt={ttys:[],init(){},shutdown(){},register(e,t){bt.ttys[e]={input:[],output:[],ops:t},c.registerDevice(e,bt.stream_ops)},stream_ops:{open(e){var t=bt.ttys[e.node.rdev];if(!t)throw new c.ErrnoError(43);e.tty=t,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,t,o,i,n){if(!e.tty||!e.tty.ops.get_char)throw new c.ErrnoError(60);for(var s=0,r=0;r<i;r++){var u;try{u=e.tty.ops.get_char(e.tty)}catch{throw new c.ErrnoError(29)}if(u===void 0&&s===0)throw new c.ErrnoError(6);if(u==null)break;s++,t[o+r]=u}return s&&(e.node.atime=Date.now()),s},write(e,t,o,i,n){if(!e.tty||!e.tty.ops.put_char)throw new c.ErrnoError(60);try{for(var s=0;s<i;s++)e.tty.ops.put_char(e.tty,t[o+s])}catch{throw new c.ErrnoError(29)}return i&&(e.node.mtime=e.node.ctime=Date.now()),s}},default_tty_ops:{get_char(e){return Xn()},put_char(e,t){t===null||t===10?(z(Nt(e.output)),e.output=[]):t!=0&&e.output.push(t)},fsync(e){e.output?.length>0&&(z(Nt(e.output)),e.output=[])},ioctl_tcgets(e){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(e,t,o){return 0},ioctl_tiocgwinsz(e){return[24,80]}},default_tty1_ops:{put_char(e,t){t===null||t===10?(ue(Nt(e.output)),e.output=[]):t!=0&&e.output.push(t)},fsync(e){e.output?.length>0&&(ue(Nt(e.output)),e.output=[])}}},Kn=(e,t)=>xe.fill(0,e,e+t),dn=(e,t)=>Math.ceil(e/t)*t,pn=e=>{e=dn(e,65536);var t=qn(65536,e);return t&&Kn(t,e),t},Ae={ops_table:null,mount(e){return Ae.createNode(null,"/",16895,0)},createNode(e,t,o,i){if(c.isBlkdev(o)||c.isFIFO(o))throw new c.ErrnoError(63);Ae.ops_table||={dir:{node:{getattr:Ae.node_ops.getattr,setattr:Ae.node_ops.setattr,lookup:Ae.node_ops.lookup,mknod:Ae.node_ops.mknod,rename:Ae.node_ops.rename,unlink:Ae.node_ops.unlink,rmdir:Ae.node_ops.rmdir,readdir:Ae.node_ops.readdir,symlink:Ae.node_ops.symlink},stream:{llseek:Ae.stream_ops.llseek}},file:{node:{getattr:Ae.node_ops.getattr,setattr:Ae.node_ops.setattr},stream:{llseek:Ae.stream_ops.llseek,read:Ae.stream_ops.read,write:Ae.stream_ops.write,mmap:Ae.stream_ops.mmap,msync:Ae.stream_ops.msync}},link:{node:{getattr:Ae.node_ops.getattr,setattr:Ae.node_ops.setattr,readlink:Ae.node_ops.readlink},stream:{}},chrdev:{node:{getattr:Ae.node_ops.getattr,setattr:Ae.node_ops.setattr},stream:c.chrdev_stream_ops}};var n=c.createNode(e,t,o,i);return c.isDir(n.mode)?(n.node_ops=Ae.ops_table.dir.node,n.stream_ops=Ae.ops_table.dir.stream,n.contents={}):c.isFile(n.mode)?(n.node_ops=Ae.ops_table.file.node,n.stream_ops=Ae.ops_table.file.stream,n.usedBytes=0,n.contents=null):c.isLink(n.mode)?(n.node_ops=Ae.ops_table.link.node,n.stream_ops=Ae.ops_table.link.stream):c.isChrdev(n.mode)&&(n.node_ops=Ae.ops_table.chrdev.node,n.stream_ops=Ae.ops_table.chrdev.stream),n.atime=n.mtime=n.ctime=Date.now(),e&&(e.contents[t]=n,e.atime=e.mtime=e.ctime=n.atime),n},getFileDataAsTypedArray(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage(e,t){var o=e.contents?e.contents.length:0;if(!(o>=t)){t=Math.max(t,o*(o<1024*1024?2:1.125)>>>0),o!=0&&(t=Math.max(t,256));var i=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(i.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,t){if(e.usedBytes!=t)if(t==0)e.contents=null,e.usedBytes=0;else{var o=e.contents;e.contents=new Uint8Array(t),o&&e.contents.set(o.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr(e){var t={};return t.dev=c.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,c.isDir(e.mode)?t.size=4096:c.isFile(e.mode)?t.size=e.usedBytes:c.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.atime),t.mtime=new Date(e.mtime),t.ctime=new Date(e.ctime),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr(e,t){for(const o of["mode","atime","mtime","ctime"])t[o]!=null&&(e[o]=t[o]);t.size!==void 0&&Ae.resizeFileStorage(e,t.size)},lookup(e,t){throw Ae.doesNotExistError||(Ae.doesNotExistError=new c.ErrnoError(44),Ae.doesNotExistError.stack="<generic error, no stack>"),Ae.doesNotExistError},mknod(e,t,o,i){return Ae.createNode(e,t,o,i)},rename(e,t,o){var i;try{i=c.lookupNode(t,o)}catch{}if(i){if(c.isDir(e.mode))for(var n in i.contents)throw new c.ErrnoError(55);c.hashRemoveNode(i)}delete e.parent.contents[e.name],t.contents[o]=e,e.name=o,t.ctime=t.mtime=e.parent.ctime=e.parent.mtime=Date.now()},unlink(e,t){delete e.contents[t],e.ctime=e.mtime=Date.now()},rmdir(e,t){for(var o in c.lookupNode(e,t).contents)throw new c.ErrnoError(55);delete e.contents[t],e.ctime=e.mtime=Date.now()},readdir(e){return[".","..",...Object.keys(e.contents)]},symlink(e,t,o){var i=Ae.createNode(e,t,41471,0);return i.link=o,i},readlink(e){if(!c.isLink(e.mode))throw new c.ErrnoError(28);return e.link}},stream_ops:{read(e,t,o,i,n){var s=e.node.contents;if(n>=e.node.usedBytes)return 0;var r=Math.min(e.node.usedBytes-n,i);if(r>8&&s.subarray)t.set(s.subarray(n,n+r),o);else for(var u=0;u<r;u++)t[o+u]=s[n+u];return r},write(e,t,o,i,n,s){if(t.buffer===Re.buffer&&(s=!1),!i)return 0;var r=e.node;if(r.mtime=r.ctime=Date.now(),t.subarray&&(!r.contents||r.contents.subarray)){if(s)return r.contents=t.subarray(o,o+i),r.usedBytes=i,i;if(r.usedBytes===0&&n===0)return r.contents=t.slice(o,o+i),r.usedBytes=i,i;if(n+i<=r.usedBytes)return r.contents.set(t.subarray(o,o+i),n),i}if(Ae.expandFileStorage(r,n+i),r.contents.subarray&&t.subarray)r.contents.set(t.subarray(o,o+i),n);else for(var u=0;u<i;u++)r.contents[n+u]=t[o+u];return r.usedBytes=Math.max(r.usedBytes,n+i),i},llseek(e,t,o){var i=t;if(o===1?i+=e.position:o===2&&c.isFile(e.node.mode)&&(i+=e.node.usedBytes),i<0)throw new c.ErrnoError(28);return i},mmap(e,t,o,i,n){if(!c.isFile(e.node.mode))throw new c.ErrnoError(43);var s,r,u=e.node.contents;if(!(n&2)&&u&&u.buffer===Re.buffer)r=!1,s=u.byteOffset;else{if(r=!0,s=pn(t),!s)throw new c.ErrnoError(48);u&&((o>0||o+t<u.length)&&(u.subarray?u=u.subarray(o,o+t):u=Array.prototype.slice.call(u,o,o+t)),Re.set(u,s))}return{ptr:s,allocated:r}},msync(e,t,o,i,n){return Ae.stream_ops.write(e,t,0,i,o,!1),0}}},Jn=e=>{var t={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[e];if(typeof t>"u")throw new Error(`Unknown file open mode: ${e}`);return t},Xt=(e,t)=>{var o=0;return e&&(o|=365),t&&(o|=146),o},Yn=async e=>{var t=await Le(e);return new Uint8Array(t)},Zn=(...e)=>c.createDataFile(...e),yt=0,xt=null,er=e=>{if(yt--,l.monitorRunDependencies?.(yt),yt==0&&xt){var t=xt;xt=null,t()}},tr=e=>{yt++,l.monitorRunDependencies?.(yt)},hn=[],nr=async(e,t)=>{typeof Browser<"u"&&Browser.init();for(var o of hn)if(o.canHandle(t))return o.handle(e,t);return e},mn=async(e,t,o,i,n,s,r,u)=>{var P=t?St.resolve(Be.join2(e,t)):e;tr();try{var I=o;typeof o=="string"&&(I=await Yn(o)),I=await nr(I,P),u?.(),s||Zn(e,t,I,i,n,r)}finally{er()}},rr=(e,t,o,i,n,s,r,u,P,I)=>{mn(e,t,o,i,n,u,P,I).then(s).catch(r)},c={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,filesystems:null,syncFSRequests:0,readFiles:{},ErrnoError:class{name="ErrnoError";constructor(e){this.errno=e}},FSStream:class{shared={};get object(){return this.node}set object(e){this.node=e}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(e){this.shared.flags=e}get position(){return this.shared.position}set position(e){this.shared.position=e}},FSNode:class{node_ops={};stream_ops={};readMode=365;writeMode=146;mounted=null;constructor(e,t,o,i){e||(e=this),this.parent=e,this.mount=e.mount,this.id=c.nextInode++,this.name=t,this.mode=o,this.rdev=i,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(e){e?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(e){e?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return c.isDir(this.mode)}get isDevice(){return c.isChrdev(this.mode)}},lookupPath(e,t={}){if(!e)throw new c.ErrnoError(44);t.follow_mount??=!0,Be.isAbs(e)||(e=c.cwd()+"/"+e);e:for(var o=0;o<40;o++){for(var i=e.split("/").filter(I=>!!I),n=c.root,s="/",r=0;r<i.length;r++){var u=r===i.length-1;if(u&&t.parent)break;if(i[r]!=="."){if(i[r]===".."){if(s=Be.dirname(s),c.isRoot(n)){e=s+"/"+i.slice(r+1).join("/"),o--;continue e}else n=n.parent;continue}s=Be.join2(s,i[r]);try{n=c.lookupNode(n,i[r])}catch(I){if(I?.errno===44&&u&&t.noent_okay)return{path:s};throw I}if(c.isMountpoint(n)&&(!u||t.follow_mount)&&(n=n.mounted.root),c.isLink(n.mode)&&(!u||t.follow)){if(!n.node_ops.readlink)throw new c.ErrnoError(52);var P=n.node_ops.readlink(n);Be.isAbs(P)||(P=Be.dirname(s)+"/"+P),e=P+"/"+i.slice(r+1).join("/");continue e}}}return{path:s,node:n}}throw new c.ErrnoError(32)},getPath(e){for(var t;;){if(c.isRoot(e)){var o=e.mount.mountpoint;return t?o[o.length-1]!=="/"?`${o}/${t}`:o+t:o}t=t?`${e.name}/${t}`:e.name,e=e.parent}},hashName(e,t){for(var o=0,i=0;i<t.length;i++)o=(o<<5)-o+t.charCodeAt(i)|0;return(e+o>>>0)%c.nameTable.length},hashAddNode(e){var t=c.hashName(e.parent.id,e.name);e.name_next=c.nameTable[t],c.nameTable[t]=e},hashRemoveNode(e){var t=c.hashName(e.parent.id,e.name);if(c.nameTable[t]===e)c.nameTable[t]=e.name_next;else for(var o=c.nameTable[t];o;){if(o.name_next===e){o.name_next=e.name_next;break}o=o.name_next}},lookupNode(e,t){var o=c.mayLookup(e);if(o)throw new c.ErrnoError(o);for(var i=c.hashName(e.id,t),n=c.nameTable[i];n;n=n.name_next){var s=n.name;if(n.parent.id===e.id&&s===t)return n}return c.lookup(e,t)},createNode(e,t,o,i){var n=new c.FSNode(e,t,o,i);return c.hashAddNode(n),n},destroyNode(e){c.hashRemoveNode(e)},isRoot(e){return e===e.parent},isMountpoint(e){return!!e.mounted},isFile(e){return(e&61440)===32768},isDir(e){return(e&61440)===16384},isLink(e){return(e&61440)===40960},isChrdev(e){return(e&61440)===8192},isBlkdev(e){return(e&61440)===24576},isFIFO(e){return(e&61440)===4096},isSocket(e){return(e&49152)===49152},flagsToPermissionString(e){var t=["r","w","rw"][e&3];return e&512&&(t+="w"),t},nodePermissions(e,t){return c.ignorePermissions?0:t.includes("r")&&!(e.mode&292)||t.includes("w")&&!(e.mode&146)||t.includes("x")&&!(e.mode&73)?2:0},mayLookup(e){if(!c.isDir(e.mode))return 54;var t=c.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate(e,t){if(!c.isDir(e.mode))return 54;try{return c.lookupNode(e,t),20}catch{}return c.nodePermissions(e,"wx")},mayDelete(e,t,o){var i;try{i=c.lookupNode(e,t)}catch(s){return s.errno}var n=c.nodePermissions(e,"wx");if(n)return n;if(o){if(!c.isDir(i.mode))return 54;if(c.isRoot(i)||c.getPath(i)===c.cwd())return 10}else if(c.isDir(i.mode))return 31;return 0},mayOpen(e,t){return e?c.isLink(e.mode)?32:c.isDir(e.mode)&&(c.flagsToPermissionString(t)!=="r"||t&576)?31:c.nodePermissions(e,c.flagsToPermissionString(t)):44},checkOpExists(e,t){if(!e)throw new c.ErrnoError(t);return e},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=c.MAX_OPEN_FDS;e++)if(!c.streams[e])return e;throw new c.ErrnoError(33)},getStreamChecked(e){var t=c.getStream(e);if(!t)throw new c.ErrnoError(8);return t},getStream:e=>c.streams[e],createStream(e,t=-1){return e=Object.assign(new c.FSStream,e),t==-1&&(t=c.nextfd()),e.fd=t,c.streams[t]=e,e},closeStream(e){c.streams[e]=null},dupStream(e,t=-1){var o=c.createStream(e,t);return o.stream_ops?.dup?.(o),o},doSetAttr(e,t,o){var i=e?.stream_ops.setattr,n=i?e:t;i??=t.node_ops.setattr,c.checkOpExists(i,63),i(n,o)},chrdev_stream_ops:{open(e){e.stream_ops=c.getDevice(e.node.rdev).stream_ops,e.stream_ops.open?.(e)},llseek(){throw new c.ErrnoError(70)}},major:e=>e>>8,minor:e=>e&255,makedev:(e,t)=>e<<8|t,registerDevice(e,t){c.devices[e]={stream_ops:t}},getDevice:e=>c.devices[e],getMounts(e){for(var t=[],o=[e];o.length;){var i=o.pop();t.push(i),o.push(...i.mounts)}return t},syncfs(e,t){typeof e=="function"&&(t=e,e=!1),c.syncFSRequests++,c.syncFSRequests>1&&ue(`warning: ${c.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var o=c.getMounts(c.root.mount),i=0;function n(u){return c.syncFSRequests--,t(u)}function s(u){if(u)return s.errored?void 0:(s.errored=!0,n(u));++i>=o.length&&n(null)}for(var r of o)r.type.syncfs?r.type.syncfs(r,e,s):s(null)},mount(e,t,o){var i=o==="/",n=!o,s;if(i&&c.root)throw new c.ErrnoError(10);if(!i&&!n){var r=c.lookupPath(o,{follow_mount:!1});if(o=r.path,s=r.node,c.isMountpoint(s))throw new c.ErrnoError(10);if(!c.isDir(s.mode))throw new c.ErrnoError(54)}var u={type:e,opts:t,mountpoint:o,mounts:[]},P=e.mount(u);return P.mount=u,u.root=P,i?c.root=P:s&&(s.mounted=u,s.mount&&s.mount.mounts.push(u)),P},unmount(e){var t=c.lookupPath(e,{follow_mount:!1});if(!c.isMountpoint(t.node))throw new c.ErrnoError(28);var o=t.node,i=o.mounted,n=c.getMounts(i);for(var[s,r]of Object.entries(c.nameTable))for(;r;){var u=r.name_next;n.includes(r.mount)&&c.destroyNode(r),r=u}o.mounted=null;var P=o.mount.mounts.indexOf(i);o.mount.mounts.splice(P,1)},lookup(e,t){return e.node_ops.lookup(e,t)},mknod(e,t,o){var i=c.lookupPath(e,{parent:!0}).node,n=Be.basename(e);if(!n)throw new c.ErrnoError(28);if(n==="."||n==="..")throw new c.ErrnoError(20);var s=c.mayCreate(i,n);if(s)throw new c.ErrnoError(s);if(!i.node_ops.mknod)throw new c.ErrnoError(63);return i.node_ops.mknod(i,n,t,o)},statfs(e){return c.statfsNode(c.lookupPath(e,{follow:!0}).node)},statfsStream(e){return c.statfsNode(e.node)},statfsNode(e){var t={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:c.nextInode,ffree:c.nextInode-1,fsid:42,flags:2,namelen:255};return e.node_ops.statfs&&Object.assign(t,e.node_ops.statfs(e.mount.opts.root)),t},create(e,t=438){return t&=4095,t|=32768,c.mknod(e,t,0)},mkdir(e,t=511){return t&=1023,t|=16384,c.mknod(e,t,0)},mkdirTree(e,t){var o=e.split("/"),i="";for(var n of o)if(n){(i||Be.isAbs(e))&&(i+="/"),i+=n;try{c.mkdir(i,t)}catch(s){if(s.errno!=20)throw s}}},mkdev(e,t,o){return typeof o>"u"&&(o=t,t=438),t|=8192,c.mknod(e,t,o)},symlink(e,t){if(!St.resolve(e))throw new c.ErrnoError(44);var o=c.lookupPath(t,{parent:!0}).node;if(!o)throw new c.ErrnoError(44);var i=Be.basename(t),n=c.mayCreate(o,i);if(n)throw new c.ErrnoError(n);if(!o.node_ops.symlink)throw new c.ErrnoError(63);return o.node_ops.symlink(o,i,e)},rename(e,t){var o=Be.dirname(e),i=Be.dirname(t),n=Be.basename(e),s=Be.basename(t),r=c.lookupPath(e,{parent:!0}),u=r.node,P;if(r=c.lookupPath(t,{parent:!0}),P=r.node,!u||!P)throw new c.ErrnoError(44);if(u.mount!==P.mount)throw new c.ErrnoError(75);var I=c.lookupNode(u,n),Z=St.relative(e,i);if(Z.charAt(0)!==".")throw new c.ErrnoError(28);if(Z=St.relative(t,o),Z.charAt(0)!==".")throw new c.ErrnoError(55);var R;try{R=c.lookupNode(P,s)}catch{}if(I!==R){var X=c.isDir(I.mode),p=c.mayDelete(u,n,X);if(p)throw new c.ErrnoError(p);if(p=R?c.mayDelete(P,s,X):c.mayCreate(P,s),p)throw new c.ErrnoError(p);if(!u.node_ops.rename)throw new c.ErrnoError(63);if(c.isMountpoint(I)||R&&c.isMountpoint(R))throw new c.ErrnoError(10);if(P!==u&&(p=c.nodePermissions(u,"w"),p))throw new c.ErrnoError(p);c.hashRemoveNode(I);try{u.node_ops.rename(I,P,s),I.parent=P}catch(B){throw B}finally{c.hashAddNode(I)}}},rmdir(e){var t=c.lookupPath(e,{parent:!0}).node,o=Be.basename(e),i=c.lookupNode(t,o),n=c.mayDelete(t,o,!0);if(n)throw new c.ErrnoError(n);if(!t.node_ops.rmdir)throw new c.ErrnoError(63);if(c.isMountpoint(i))throw new c.ErrnoError(10);t.node_ops.rmdir(t,o),c.destroyNode(i)},readdir(e){var t=c.lookupPath(e,{follow:!0}).node;return c.checkOpExists(t.node_ops.readdir,54)(t)},unlink(e){var t=c.lookupPath(e,{parent:!0}).node;if(!t)throw new c.ErrnoError(44);var o=Be.basename(e),i=c.lookupNode(t,o),n=c.mayDelete(t,o,!1);if(n)throw new c.ErrnoError(n);if(!t.node_ops.unlink)throw new c.ErrnoError(63);if(c.isMountpoint(i))throw new c.ErrnoError(10);t.node_ops.unlink(t,o),c.destroyNode(i)},readlink(e){var t=c.lookupPath(e).node;if(!t)throw new c.ErrnoError(44);if(!t.node_ops.readlink)throw new c.ErrnoError(28);return t.node_ops.readlink(t)},stat(e,t){var o=c.lookupPath(e,{follow:!t}).node;return c.checkOpExists(o.node_ops.getattr,63)(o)},fstat(e){var t=c.getStreamChecked(e),o=t.node,i=t.stream_ops.getattr,n=i?t:o;return i??=o.node_ops.getattr,c.checkOpExists(i,63),i(n)},lstat(e){return c.stat(e,!0)},doChmod(e,t,o,i){c.doSetAttr(e,t,{mode:o&4095|t.mode&-4096,ctime:Date.now(),dontFollow:i})},chmod(e,t,o){var i;typeof e=="string"?i=c.lookupPath(e,{follow:!o}).node:i=e,c.doChmod(null,i,t,o)},lchmod(e,t){c.chmod(e,t,!0)},fchmod(e,t){var o=c.getStreamChecked(e);c.doChmod(o,o.node,t,!1)},doChown(e,t,o){c.doSetAttr(e,t,{timestamp:Date.now(),dontFollow:o})},chown(e,t,o,i){var n;typeof e=="string"?n=c.lookupPath(e,{follow:!i}).node:n=e,c.doChown(null,n,i)},lchown(e,t,o){c.chown(e,t,o,!0)},fchown(e,t,o){var i=c.getStreamChecked(e);c.doChown(i,i.node,!1)},doTruncate(e,t,o){if(c.isDir(t.mode))throw new c.ErrnoError(31);if(!c.isFile(t.mode))throw new c.ErrnoError(28);var i=c.nodePermissions(t,"w");if(i)throw new c.ErrnoError(i);c.doSetAttr(e,t,{size:o,timestamp:Date.now()})},truncate(e,t){if(t<0)throw new c.ErrnoError(28);var o;typeof e=="string"?o=c.lookupPath(e,{follow:!0}).node:o=e,c.doTruncate(null,o,t)},ftruncate(e,t){var o=c.getStreamChecked(e);if(t<0||(o.flags&2097155)===0)throw new c.ErrnoError(28);c.doTruncate(o,o.node,t)},utime(e,t,o){var i=c.lookupPath(e,{follow:!0}).node;c.checkOpExists(i.node_ops.setattr,63)(i,{atime:t,mtime:o})},open(e,t,o=438){if(e==="")throw new c.ErrnoError(44);t=typeof t=="string"?Jn(t):t,t&64?o=o&4095|32768:o=0;var i,n;if(typeof e=="object")i=e;else{n=e.endsWith("/");var s=c.lookupPath(e,{follow:!(t&131072),noent_okay:!0});i=s.node,e=s.path}var r=!1;if(t&64)if(i){if(t&128)throw new c.ErrnoError(20)}else{if(n)throw new c.ErrnoError(31);i=c.mknod(e,o|511,0),r=!0}if(!i)throw new c.ErrnoError(44);if(c.isChrdev(i.mode)&&(t&=-513),t&65536&&!c.isDir(i.mode))throw new c.ErrnoError(54);if(!r){var u=c.mayOpen(i,t);if(u)throw new c.ErrnoError(u)}t&512&&!r&&c.truncate(i,0),t&=-131713;var P=c.createStream({node:i,path:c.getPath(i),flags:t,seekable:!0,position:0,stream_ops:i.stream_ops,ungotten:[],error:!1});return P.stream_ops.open&&P.stream_ops.open(P),r&&c.chmod(i,o&511),l.logReadFiles&&!(t&1)&&(e in c.readFiles||(c.readFiles[e]=1)),P},close(e){if(c.isClosed(e))throw new c.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(t){throw t}finally{c.closeStream(e.fd)}e.fd=null},isClosed(e){return e.fd===null},llseek(e,t,o){if(c.isClosed(e))throw new c.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new c.ErrnoError(70);if(o!=0&&o!=1&&o!=2)throw new c.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,o),e.ungotten=[],e.position},read(e,t,o,i,n){if(i<0||n<0)throw new c.ErrnoError(28);if(c.isClosed(e))throw new c.ErrnoError(8);if((e.flags&2097155)===1)throw new c.ErrnoError(8);if(c.isDir(e.node.mode))throw new c.ErrnoError(31);if(!e.stream_ops.read)throw new c.ErrnoError(28);var s=typeof n<"u";if(!s)n=e.position;else if(!e.seekable)throw new c.ErrnoError(70);var r=e.stream_ops.read(e,t,o,i,n);return s||(e.position+=r),r},write(e,t,o,i,n,s){if(i<0||n<0)throw new c.ErrnoError(28);if(c.isClosed(e))throw new c.ErrnoError(8);if((e.flags&2097155)===0)throw new c.ErrnoError(8);if(c.isDir(e.node.mode))throw new c.ErrnoError(31);if(!e.stream_ops.write)throw new c.ErrnoError(28);e.seekable&&e.flags&1024&&c.llseek(e,0,2);var r=typeof n<"u";if(!r)n=e.position;else if(!e.seekable)throw new c.ErrnoError(70);var u=e.stream_ops.write(e,t,o,i,n,s);return r||(e.position+=u),u},mmap(e,t,o,i,n){if((i&2)!==0&&(n&2)===0&&(e.flags&2097155)!==2)throw new c.ErrnoError(2);if((e.flags&2097155)===1)throw new c.ErrnoError(2);if(!e.stream_ops.mmap)throw new c.ErrnoError(43);if(!t)throw new c.ErrnoError(28);return e.stream_ops.mmap(e,t,o,i,n)},msync(e,t,o,i,n){return e.stream_ops.msync?e.stream_ops.msync(e,t,o,i,n):0},ioctl(e,t,o){if(!e.stream_ops.ioctl)throw new c.ErrnoError(59);return e.stream_ops.ioctl(e,t,o)},readFile(e,t={}){t.flags=t.flags||0,t.encoding=t.encoding||"binary",t.encoding!=="utf8"&&t.encoding!=="binary"&&_t(`Invalid encoding type "${t.encoding}"`);var o=c.open(e,t.flags),i=c.stat(e).size,n=new Uint8Array(i);return c.read(o,n,0,i,0),t.encoding==="utf8"&&(n=Nt(n)),c.close(o),n},writeFile(e,t,o={}){o.flags=o.flags||577;var i=c.open(e,o.flags,o.mode);typeof t=="string"&&(t=new Uint8Array($t(t))),ArrayBuffer.isView(t)?c.write(i,t,0,t.byteLength,void 0,o.canOwn):_t("Unsupported data type"),c.close(i)},cwd:()=>c.currentPath,chdir(e){var t=c.lookupPath(e,{follow:!0});if(t.node===null)throw new c.ErrnoError(44);if(!c.isDir(t.node.mode))throw new c.ErrnoError(54);var o=c.nodePermissions(t.node,"x");if(o)throw new c.ErrnoError(o);c.currentPath=t.path},createDefaultDirectories(){c.mkdir("/tmp"),c.mkdir("/home"),c.mkdir("/home/web_user")},createDefaultDevices(){c.mkdir("/dev"),c.registerDevice(c.makedev(1,3),{read:()=>0,write:(i,n,s,r,u)=>r,llseek:()=>0}),c.mkdev("/dev/null",c.makedev(1,3)),bt.register(c.makedev(5,0),bt.default_tty_ops),bt.register(c.makedev(6,0),bt.default_tty1_ops),c.mkdev("/dev/tty",c.makedev(5,0)),c.mkdev("/dev/tty1",c.makedev(6,0));var e=new Uint8Array(1024),t=0,o=()=>(t===0&&(cn(e),t=e.byteLength),e[--t]);c.createDevice("/dev","random",o),c.createDevice("/dev","urandom",o),c.mkdir("/dev/shm"),c.mkdir("/dev/shm/tmp")},createSpecialDirectories(){c.mkdir("/proc");var e=c.mkdir("/proc/self");c.mkdir("/proc/self/fd"),c.mount({mount(){var t=c.createNode(e,"fd",16895,73);return t.stream_ops={llseek:Ae.stream_ops.llseek},t.node_ops={lookup(o,i){var n=+i,s=c.getStreamChecked(n),r={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>s.path},id:n+1};return r.parent=r,r},readdir(){return Array.from(c.streams.entries()).filter(([o,i])=>i).map(([o,i])=>o.toString())}},t}},{},"/proc/self/fd")},createStandardStreams(e,t,o){e?c.createDevice("/dev","stdin",e):c.symlink("/dev/tty","/dev/stdin"),t?c.createDevice("/dev","stdout",null,t):c.symlink("/dev/tty","/dev/stdout"),o?c.createDevice("/dev","stderr",null,o):c.symlink("/dev/tty1","/dev/stderr"),c.open("/dev/stdin",0),c.open("/dev/stdout",1),c.open("/dev/stderr",1)},staticInit(){c.nameTable=new Array(4096),c.mount(Ae,{},"/"),c.createDefaultDirectories(),c.createDefaultDevices(),c.createSpecialDirectories(),c.filesystems={MEMFS:Ae}},init(e,t,o){c.initialized=!0,e??=l.stdin,t??=l.stdout,o??=l.stderr,c.createStandardStreams(e,t,o)},quit(){c.initialized=!1;for(var e of c.streams)e&&c.close(e)},findObject(e,t){var o=c.analyzePath(e,t);return o.exists?o.object:null},analyzePath(e,t){try{var o=c.lookupPath(e,{follow:!t});e=o.path}catch{}var i={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var o=c.lookupPath(e,{parent:!0});i.parentExists=!0,i.parentPath=o.path,i.parentObject=o.node,i.name=Be.basename(e),o=c.lookupPath(e,{follow:!t}),i.exists=!0,i.path=o.path,i.object=o.node,i.name=o.node.name,i.isRoot=o.path==="/"}catch(n){i.error=n.errno}return i},createPath(e,t,o,i){e=typeof e=="string"?e:c.getPath(e);for(var n=t.split("/").reverse();n.length;){var s=n.pop();if(s){var r=Be.join2(e,s);try{c.mkdir(r)}catch(u){if(u.errno!=20)throw u}e=r}}return r},createFile(e,t,o,i,n){var s=Be.join2(typeof e=="string"?e:c.getPath(e),t),r=Xt(i,n);return c.create(s,r)},createDataFile(e,t,o,i,n,s){var r=t;e&&(e=typeof e=="string"?e:c.getPath(e),r=t?Be.join2(e,t):e);var u=Xt(i,n),P=c.create(r,u);if(o){if(typeof o=="string"){for(var I=new Array(o.length),Z=0,R=o.length;Z<R;++Z)I[Z]=o.charCodeAt(Z);o=I}c.chmod(P,u|146);var X=c.open(P,577);c.write(X,o,0,o.length,0,s),c.close(X),c.chmod(P,u)}},createDevice(e,t,o,i){var n=Be.join2(typeof e=="string"?e:c.getPath(e),t),s=Xt(!!o,!!i);c.createDevice.major??=64;var r=c.makedev(c.createDevice.major++,0);return c.registerDevice(r,{open(u){u.seekable=!1},close(u){i?.buffer?.length&&i(10)},read(u,P,I,Z,R){for(var X=0,p=0;p<Z;p++){var B;try{B=o()}catch{throw new c.ErrnoError(29)}if(B===void 0&&X===0)throw new c.ErrnoError(6);if(B==null)break;X++,P[I+p]=B}return X&&(u.node.atime=Date.now()),X},write(u,P,I,Z,R){for(var X=0;X<Z;X++)try{i(P[I+X])}catch{throw new c.ErrnoError(29)}return Z&&(u.node.mtime=u.node.ctime=Date.now()),X}}),c.mkdev(n,s,r)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if(globalThis.XMLHttpRequest)_t("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");else try{e.contents=He(e.url)}catch{throw new c.ErrnoError(29)}},createLazyFile(e,t,o,i,n){class s{lengthKnown=!1;chunks=[];get(R){if(!(R>this.length-1||R<0)){var X=R%this.chunkSize,p=R/this.chunkSize|0;return this.getter(p)[X]}}setDataGetter(R){this.getter=R}cacheLength(){var R=new XMLHttpRequest;R.open("HEAD",o,!1),R.send(null),R.status>=200&&R.status<300||R.status===304||_t("Couldn't load "+o+". Status: "+R.status);var X=Number(R.getResponseHeader("Content-length")),p,B=(p=R.getResponseHeader("Accept-Ranges"))&&p==="bytes",F=(p=R.getResponseHeader("Content-Encoding"))&&p==="gzip",ie=1024*1024;B||(ie=X);var y=(C,Q)=>{C>Q&&_t("invalid range ("+C+", "+Q+") or no bytes requested!"),Q>X-1&&_t("only "+X+" bytes available! programmer error!");var T=new XMLHttpRequest;return T.open("GET",o,!1),X!==ie&&T.setRequestHeader("Range","bytes="+C+"-"+Q),T.responseType="arraybuffer",T.overrideMimeType&&T.overrideMimeType("text/plain; charset=x-user-defined"),T.send(null),T.status>=200&&T.status<300||T.status===304||_t("Couldn't load "+o+". Status: "+T.status),T.response!==void 0?new Uint8Array(T.response||[]):$t(T.responseText||"")},b=this;b.setDataGetter(C=>{var Q=C*ie,T=(C+1)*ie-1;return T=Math.min(T,X-1),typeof b.chunks[C]>"u"&&(b.chunks[C]=y(Q,T)),typeof b.chunks[C]>"u"&&_t("doXHR failed!"),b.chunks[C]}),(F||!X)&&(ie=X=1,X=this.getter(0).length,ie=X,z("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=X,this._chunkSize=ie,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(globalThis.XMLHttpRequest){qe||_t("Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc");var r={isDevice:!1,contents:new s}}else var r={isDevice:!1,url:o};var u=c.createFile(e,t,r,i,n);r.contents?u.contents=r.contents:r.url&&(u.contents=null,u.url=r.url),Object.defineProperties(u,{usedBytes:{get:function(){return this.contents.length}}});var P={};for(const[Z,R]of Object.entries(u.stream_ops))P[Z]=(...X)=>(c.forceLoadFile(u),R(...X));function I(Z,R,X,p,B){var F=Z.node.contents;if(B>=F.length)return 0;var ie=Math.min(F.length-B,p);if(F.slice)for(var y=0;y<ie;y++)R[X+y]=F[B+y];else for(var y=0;y<ie;y++)R[X+y]=F.get(B+y);return ie}return P.read=(Z,R,X,p,B)=>(c.forceLoadFile(u),I(Z,R,X,p,B)),P.mmap=(Z,R,X,p,B)=>{c.forceLoadFile(u);var F=pn(R);if(!F)throw new c.ErrnoError(48);return I(Z,Re,F,R,X),{ptr:F,allocated:!0}},u.stream_ops=P,u}},sr=(e,t,o)=>{if(!e)return"";var i=_n(xe,e,t);return un.decode(xe.subarray(e,i))},Pe={calculateAt(e,t,o){if(Be.isAbs(t))return t;var i;if(e===-100?i=c.cwd():i=Pe.getStreamFromFD(e).path,t.length==0){if(!o)throw new c.ErrnoError(44);return i}return i+"/"+t},writeStat(e,t){Fe[e>>2]=t.dev,Fe[e+4>>2]=t.mode,Fe[e+8>>2]=t.nlink,Fe[e+12>>2]=t.uid,Fe[e+16>>2]=t.gid,Fe[e+20>>2]=t.rdev,nt[e+24>>3]=BigInt(t.size),Ne[e+32>>2]=4096,Ne[e+36>>2]=t.blocks;var o=t.atime.getTime(),i=t.mtime.getTime(),n=t.ctime.getTime();return nt[e+40>>3]=BigInt(Math.floor(o/1e3)),Fe[e+48>>2]=o%1e3*1e3*1e3,nt[e+56>>3]=BigInt(Math.floor(i/1e3)),Fe[e+64>>2]=i%1e3*1e3*1e3,nt[e+72>>3]=BigInt(Math.floor(n/1e3)),Fe[e+80>>2]=n%1e3*1e3*1e3,nt[e+88>>3]=BigInt(t.ino),0},writeStatFs(e,t){Fe[e+4>>2]=t.bsize,Fe[e+60>>2]=t.bsize,nt[e+8>>3]=BigInt(t.blocks),nt[e+16>>3]=BigInt(t.bfree),nt[e+24>>3]=BigInt(t.bavail),nt[e+32>>3]=BigInt(t.files),nt[e+40>>3]=BigInt(t.ffree),Fe[e+48>>2]=t.fsid,Fe[e+64>>2]=t.flags,Fe[e+56>>2]=t.namelen},doMsync(e,t,o,i,n){if(!c.isFile(t.node.mode))throw new c.ErrnoError(43);if(i&2)return 0;var s=xe.slice(e,e+o);c.msync(t,s,n,o,i)},getStreamFromFD(e){return c.getStreamChecked(e)},varargs:void 0,getStr(e){return sr(e)}};function ir(e,t){try{return e=Pe.getStr(e),c.chmod(e,t),0}catch(o){if(typeof c>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}function or(e,t,o,i){try{if(t=Pe.getStr(t),t=Pe.calculateAt(e,t),o&-8)return-28;var n=c.lookupPath(t,{follow:!0}).node;if(!n)return-44;var s="";return o&4&&(s+="r"),o&2&&(s+="w"),o&1&&(s+="x"),s&&c.nodePermissions(n,s)?-2:0}catch(r){if(typeof c>"u"||r.name!=="ErrnoError")throw r;return-r.errno}}function ar(e,t){try{return c.fchmod(e,t),0}catch(o){if(typeof c>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}function lr(e,t,o){try{return c.fchown(e,t,o),0}catch(i){if(typeof c>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}var Dt=()=>{var e=Ne[+Pe.varargs>>2];return Pe.varargs+=4,e},Tt=Dt;function cr(e,t,o){Pe.varargs=o;try{var i=Pe.getStreamFromFD(e);switch(t){case 0:var n=Dt();if(n<0)return-28;for(;c.streams[n];)n++;return c.dupStream(i,n).fd;case 1:case 2:return 0;case 3:return i.flags;case 4:var n=Dt();return i.flags|=n,0;case 12:var n=Tt(),s=0;return $e[n+s>>1]=2,0;case 13:case 14:return 0}return-28}catch(r){if(typeof c>"u"||r.name!=="ErrnoError")throw r;return-r.errno}}function ur(e,t){try{return Pe.writeStat(t,c.fstat(e))}catch(o){if(typeof c>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}var _r=9007199254740992,fr=-9007199254740992,Pt=e=>e<fr||e>_r?NaN:Number(e);function dr(e,t){t=Pt(t);try{return isNaN(t)?-61:(c.ftruncate(e,t),0)}catch(o){if(typeof c>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}var Et=(e,t,o)=>fn(e,xe,t,o);function pr(e,t){try{if(t===0)return-28;var o=c.cwd(),i=Mt(o)+1;return t<i?-68:(Et(o,e,t),i)}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}function hr(e,t,o){Pe.varargs=o;try{var i=Pe.getStreamFromFD(e);switch(t){case 21509:return i.tty?0:-59;case 21505:if(!i.tty)return-59;if(i.tty.ops.ioctl_tcgets){var n=i.tty.ops.ioctl_tcgets(i),R=Tt();Ne[R>>2]=n.c_iflag||0,Ne[R+4>>2]=n.c_oflag||0,Ne[R+8>>2]=n.c_cflag||0,Ne[R+12>>2]=n.c_lflag||0;for(var s=0;s<32;s++)Re[R+s+17]=n.c_cc[s]||0;return 0}return 0;case 21510:case 21511:case 21512:return i.tty?0:-59;case 21506:case 21507:case 21508:if(!i.tty)return-59;if(i.tty.ops.ioctl_tcsets){for(var R=Tt(),r=Ne[R>>2],u=Ne[R+4>>2],P=Ne[R+8>>2],I=Ne[R+12>>2],Z=[],s=0;s<32;s++)Z.push(Re[R+s+17]);return i.tty.ops.ioctl_tcsets(i.tty,t,{c_iflag:r,c_oflag:u,c_cflag:P,c_lflag:I,c_cc:Z})}return 0;case 21519:if(!i.tty)return-59;var R=Tt();return Ne[R>>2]=0,0;case 21520:return i.tty?-28:-59;case 21537:case 21531:var R=Tt();return c.ioctl(i,t,R);case 21523:if(!i.tty)return-59;if(i.tty.ops.ioctl_tiocgwinsz){var X=i.tty.ops.ioctl_tiocgwinsz(i.tty),R=Tt();$e[R>>1]=X[0],$e[R+2>>1]=X[1]}return 0;case 21524:return i.tty?0:-59;case 21515:return i.tty?0:-59;default:return-28}}catch(p){if(typeof c>"u"||p.name!=="ErrnoError")throw p;return-p.errno}}function mr(e,t){try{return e=Pe.getStr(e),Pe.writeStat(t,c.lstat(e))}catch(o){if(typeof c>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}function gr(e,t,o){try{return t=Pe.getStr(t),t=Pe.calculateAt(e,t),c.mkdir(t,o,0),0}catch(i){if(typeof c>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}function br(e,t,o,i){try{t=Pe.getStr(t);var n=i&256,s=i&4096;return i=i&-6401,t=Pe.calculateAt(e,t,s),Pe.writeStat(o,n?c.lstat(t):c.stat(t))}catch(r){if(typeof c>"u"||r.name!=="ErrnoError")throw r;return-r.errno}}function yr(e,t,o,i){Pe.varargs=i;try{t=Pe.getStr(t),t=Pe.calculateAt(e,t);var n=i?Dt():0;return c.open(t,o,n).fd}catch(s){if(typeof c>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}function Er(e,t,o,i){try{if(t=Pe.getStr(t),t=Pe.calculateAt(e,t),i<=0)return-28;var n=c.readlink(t),s=Math.min(i,Mt(n)),r=Re[o+s];return Et(n,o,i+1),Re[o+s]=r,s}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function qr(e){try{return e=Pe.getStr(e),c.rmdir(e),0}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return-t.errno}}function vr(e,t){try{return e=Pe.getStr(e),Pe.writeStat(t,c.stat(e))}catch(o){if(typeof c>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}function Sr(e,t,o){try{if(t=Pe.getStr(t),t=Pe.calculateAt(e,t),!o)c.unlink(t);else if(o===512)c.rmdir(t);else return-28;return 0}catch(i){if(typeof c>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}var gn=e=>Fe[e>>2]+Ne[e+4>>2]*4294967296;function Tr(e,t,o,i){try{t=Pe.getStr(t),t=Pe.calculateAt(e,t,!0);var n=Date.now(),s,r;if(!o)s=n,r=n;else{var u=gn(o),P=Ne[o+8>>2];P==1073741823?s=n:P==1073741822?s=null:s=u*1e3+P/(1e3*1e3),o+=16,u=gn(o),P=Ne[o+8>>2],P==1073741823?r=n:P==1073741822?r=null:r=u*1e3+P/(1e3*1e3)}return(r??s)!==null&&c.utime(t,s,r),0}catch(I){if(typeof c>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}var wr=e=>e%4===0&&(e%100!==0||e%400===0),Ar=[0,31,60,91,121,152,182,213,244,274,305,335],Ir=[0,31,59,90,120,151,181,212,243,273,304,334],kr=e=>(wr(e.getFullYear())?Ar:Ir)[e.getMonth()]+e.getDate()-1;function Or(e,t){e=Pt(e);var o=new Date(e*1e3);Ne[t>>2]=o.getSeconds(),Ne[t+4>>2]=o.getMinutes(),Ne[t+8>>2]=o.getHours(),Ne[t+12>>2]=o.getDate(),Ne[t+16>>2]=o.getMonth(),Ne[t+20>>2]=o.getFullYear()-1900,Ne[t+24>>2]=o.getDay();var i=kr(o)|0;Ne[t+28>>2]=i,Ne[t+36>>2]=-(o.getTimezoneOffset()*60);var n=new Date(o.getFullYear(),0,1),s=new Date(o.getFullYear(),6,1).getTimezoneOffset(),r=n.getTimezoneOffset(),u=(s!=r&&o.getTimezoneOffset()==Math.min(r,s))|0;Ne[t+32>>2]=u}function Nr(e,t,o,i,n,s,r){n=Pt(n);try{var u=Pe.getStreamFromFD(i),P=c.mmap(u,e,n,t,o),I=P.ptr;return Ne[s>>2]=P.allocated,Fe[r>>2]=I,0}catch(Z){if(typeof c>"u"||Z.name!=="ErrnoError")throw Z;return-Z.errno}}function xr(e,t,o,i,n,s){s=Pt(s);try{var r=Pe.getStreamFromFD(n);o&2&&Pe.doMsync(e,r,t,i,s)}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}var Pr=(e,t,o,i)=>{var n=new Date().getFullYear(),s=new Date(n,0,1),r=new Date(n,6,1),u=s.getTimezoneOffset(),P=r.getTimezoneOffset(),I=Math.max(u,P);Fe[e>>2]=I*60,Ne[t>>2]=+(u!=P);var Z=p=>{var B=p>=0?"-":"+",F=Math.abs(p);return`UTC${B}${String(Math.floor(F/60)).padStart(2,"0")}${String(F%60).padStart(2,"0")}`},R=Z(u),X=Z(P);P<u?(Et(R,o,17),Et(X,i,17)):(Et(R,i,17),Et(X,o,17))},bn=()=>performance.now(),yn=()=>Date.now(),Lr=e=>e>=0&&e<=3;function Rr(e,t,o){if(!Lr(e))return 28;var i;e===0?i=yn():i=bn();var n=Math.round(i*1e3*1e3);return nt[o>>3]=BigInt(n),0}var En=()=>2147483648,Fr=()=>En(),Cr=e=>{var t=(e-pt.buffer.byteLength+65535)/65536|0;try{return pt.grow(t),sn(),1}catch{}},Mr=e=>{var t=xe.length;e>>>=0;var o=En();if(e>o)return!1;for(var i=1;i<=4;i*=2){var n=t*(1+.2/i);if(n=Math.min(n,e+100663296),Cr(Math.min(o,dn(Math.max(e,n),65536))))return!0}return!1},Kt={},Dr=()=>ye||"./this.program",Lt=()=>{if(!Lt.strings){var e=(globalThis.navigator?.language??"C").replace("-","_")+".UTF-8",t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:Dr()};for(var o in Kt)Kt[o]===void 0?delete t[o]:t[o]=Kt[o];var i=[];for(var o in t)i.push(`${o}=${t[o]}`);Lt.strings=i}return Lt.strings},jr=(e,t)=>{var o=0,i=0;for(var n of Lt()){var s=t+o;Fe[e+i>>2]=s,o+=Et(n,s,1/0)+1,i+=4}return 0},Ur=(e,t)=>{var o=Lt();Fe[e>>2]=o.length;var i=0;for(var n of o)i+=Mt(n)+1;return Fe[t>>2]=i,0};function Br(e){try{var t=Pe.getStreamFromFD(e);return c.close(t),0}catch(o){if(typeof c>"u"||o.name!=="ErrnoError")throw o;return o.errno}}function zr(e,t){try{var o=0,i=0,n=0,s=Pe.getStreamFromFD(e),r=s.tty?2:c.isDir(s.mode)?3:c.isLink(s.mode)?7:4;return Re[t]=r,$e[t+2>>1]=n,nt[t+8>>3]=BigInt(o),nt[t+16>>3]=BigInt(i),0}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return u.errno}}var Wr=(e,t,o,i)=>{for(var n=0,s=0;s<o;s++){var r=Fe[t>>2],u=Fe[t+4>>2];t+=8;var P=c.read(e,Re,r,u,i);if(P<0)return-1;if(n+=P,P<u)break}return n};function Qr(e,t,o,i){try{var n=Wr(Pe.getStreamFromFD(e),t,o);return Fe[i>>2]=n,0}catch(s){if(typeof c>"u"||s.name!=="ErrnoError")throw s;return s.errno}}function Vr(e,t,o,i){t=Pt(t);try{if(isNaN(t))return 61;var n=Pe.getStreamFromFD(e);return c.llseek(n,t,o),nt[i>>3]=BigInt(n.position),n.getdents&&t===0&&o===0&&(n.getdents=null),0}catch(s){if(typeof c>"u"||s.name!=="ErrnoError")throw s;return s.errno}}function Hr(e){try{var t=Pe.getStreamFromFD(e);return t.stream_ops?.fsync?.(t)}catch(o){if(typeof c>"u"||o.name!=="ErrnoError")throw o;return o.errno}}var Gr=(e,t,o,i)=>{for(var n=0,s=0;s<o;s++){var r=Fe[t>>2],u=Fe[t+4>>2];t+=8;var P=c.write(e,Re,r,u,i);if(P<0)return-1;if(n+=P,P<u)break}return n};function $r(e,t,o,i){try{var n=Gr(Pe.getStreamFromFD(e),t,o);return Fe[i>>2]=n,0}catch(s){if(typeof c>"u"||s.name!=="ErrnoError")throw s;return s.errno}}if(c.createPreloadedFile=rr,c.preloadFile=mn,c.staticInit(),Fn(),l.noExitRuntime&&l.noExitRuntime,l.preloadPlugins&&(hn=l.preloadPlugins),l.print&&(z=l.print),l.printErr&&(ue=l.printErr),l.wasmBinary&&(ce=l.wasmBinary),l.arguments&&l.arguments,l.thisProgram&&(ye=l.thisProgram),l.preInit)for(typeof l.preInit=="function"&&(l.preInit=[l.preInit]);l.preInit.length>0;)l.preInit.shift()();l.wasmMemory=pt;var qn;function Xr(e){l._sqlite3_status64=e.sqlite3_status64,l._sqlite3_status=e.sqlite3_status,l._sqlite3_db_status64=e.sqlite3_db_status64,l._sqlite3_msize=e.sqlite3_msize,l._sqlite3_db_status=e.sqlite3_db_status,l._sqlite3_vfs_find=e.sqlite3_vfs_find,l._sqlite3_initialize=e.sqlite3_initialize,l._sqlite3_malloc=e.sqlite3_malloc,l._sqlite3_free=e.sqlite3_free,l._sqlite3_vfs_register=e.sqlite3_vfs_register,l._sqlite3_vfs_unregister=e.sqlite3_vfs_unregister,l._sqlite3_malloc64=e.sqlite3_malloc64,l._sqlite3_realloc=e.sqlite3_realloc,l._sqlite3_realloc64=e.sqlite3_realloc64,l._sqlite3_value_text=e.sqlite3_value_text,l._sqlite3_randomness=e.sqlite3_randomness,l._sqlite3_stricmp=e.sqlite3_stricmp,l._sqlite3_strnicmp=e.sqlite3_strnicmp,l._sqlite3_uri_parameter=e.sqlite3_uri_parameter,l._sqlite3_uri_boolean=e.sqlite3_uri_boolean,l._sqlite3_serialize=e.sqlite3_serialize,l._sqlite3_prepare_v2=e.sqlite3_prepare_v2,l._sqlite3_step=e.sqlite3_step,l._sqlite3_column_int64=e.sqlite3_column_int64,l._sqlite3_reset=e.sqlite3_reset,l._sqlite3_exec=e.sqlite3_exec,l._sqlite3_column_int=e.sqlite3_column_int,l._sqlite3_finalize=e.sqlite3_finalize,l._sqlite3_file_control=e.sqlite3_file_control,l._sqlite3_column_name=e.sqlite3_column_name,l._sqlite3_column_text=e.sqlite3_column_text,l._sqlite3_column_type=e.sqlite3_column_type,l._sqlite3_errmsg=e.sqlite3_errmsg,l._sqlite3_deserialize=e.sqlite3_deserialize,l._sqlite3_clear_bindings=e.sqlite3_clear_bindings,l._sqlite3_value_blob=e.sqlite3_value_blob,l._sqlite3_value_bytes=e.sqlite3_value_bytes,l._sqlite3_value_double=e.sqlite3_value_double,l._sqlite3_value_int=e.sqlite3_value_int,l._sqlite3_value_int64=e.sqlite3_value_int64,l._sqlite3_value_subtype=e.sqlite3_value_subtype,l._sqlite3_value_pointer=e.sqlite3_value_pointer,l._sqlite3_value_type=e.sqlite3_value_type,l._sqlite3_value_nochange=e.sqlite3_value_nochange,l._sqlite3_value_frombind=e.sqlite3_value_frombind,l._sqlite3_value_dup=e.sqlite3_value_dup,l._sqlite3_value_free=e.sqlite3_value_free,l._sqlite3_result_blob=e.sqlite3_result_blob,l._sqlite3_result_error_toobig=e.sqlite3_result_error_toobig,l._sqlite3_result_error_nomem=e.sqlite3_result_error_nomem,l._sqlite3_result_double=e.sqlite3_result_double,l._sqlite3_result_error=e.sqlite3_result_error,l._sqlite3_result_int=e.sqlite3_result_int,l._sqlite3_result_int64=e.sqlite3_result_int64,l._sqlite3_result_null=e.sqlite3_result_null,l._sqlite3_result_pointer=e.sqlite3_result_pointer,l._sqlite3_result_subtype=e.sqlite3_result_subtype,l._sqlite3_result_text=e.sqlite3_result_text,l._sqlite3_result_zeroblob=e.sqlite3_result_zeroblob,l._sqlite3_result_zeroblob64=e.sqlite3_result_zeroblob64,l._sqlite3_result_error_code=e.sqlite3_result_error_code,l._sqlite3_user_data=e.sqlite3_user_data,l._sqlite3_context_db_handle=e.sqlite3_context_db_handle,l._sqlite3_vtab_nochange=e.sqlite3_vtab_nochange,l._sqlite3_vtab_in_first=e.sqlite3_vtab_in_first,l._sqlite3_vtab_in_next=e.sqlite3_vtab_in_next,l._sqlite3_aggregate_context=e.sqlite3_aggregate_context,l._sqlite3_get_auxdata=e.sqlite3_get_auxdata,l._sqlite3_set_auxdata=e.sqlite3_set_auxdata,l._sqlite3_column_count=e.sqlite3_column_count,l._sqlite3_data_count=e.sqlite3_data_count,l._sqlite3_column_blob=e.sqlite3_column_blob,l._sqlite3_column_bytes=e.sqlite3_column_bytes,l._sqlite3_column_double=e.sqlite3_column_double,l._sqlite3_column_value=e.sqlite3_column_value,l._sqlite3_column_decltype=e.sqlite3_column_decltype,l._sqlite3_column_database_name=e.sqlite3_column_database_name,l._sqlite3_column_table_name=e.sqlite3_column_table_name,l._sqlite3_column_origin_name=e.sqlite3_column_origin_name,l._sqlite3_bind_blob=e.sqlite3_bind_blob,l._sqlite3_bind_double=e.sqlite3_bind_double,l._sqlite3_bind_int=e.sqlite3_bind_int,l._sqlite3_bind_int64=e.sqlite3_bind_int64,l._sqlite3_bind_null=e.sqlite3_bind_null,l._sqlite3_bind_pointer=e.sqlite3_bind_pointer,l._sqlite3_bind_text=e.sqlite3_bind_text,l._sqlite3_bind_parameter_count=e.sqlite3_bind_parameter_count,l._sqlite3_bind_parameter_name=e.sqlite3_bind_parameter_name,l._sqlite3_bind_parameter_index=e.sqlite3_bind_parameter_index,l._sqlite3_db_handle=e.sqlite3_db_handle,l._sqlite3_stmt_readonly=e.sqlite3_stmt_readonly,l._sqlite3_stmt_isexplain=e.sqlite3_stmt_isexplain,l._sqlite3_stmt_explain=e.sqlite3_stmt_explain,l._sqlite3_stmt_busy=e.sqlite3_stmt_busy,l._sqlite3_next_stmt=e.sqlite3_next_stmt,l._sqlite3_stmt_status=e.sqlite3_stmt_status,l._sqlite3_sql=e.sqlite3_sql,l._sqlite3_expanded_sql=e.sqlite3_expanded_sql,l._sqlite3_preupdate_old=e.sqlite3_preupdate_old,l._sqlite3_preupdate_count=e.sqlite3_preupdate_count,l._sqlite3_preupdate_depth=e.sqlite3_preupdate_depth,l._sqlite3_preupdate_blobwrite=e.sqlite3_preupdate_blobwrite,l._sqlite3_preupdate_new=e.sqlite3_preupdate_new,l._sqlite3_value_numeric_type=e.sqlite3_value_numeric_type,l._sqlite3_set_authorizer=e.sqlite3_set_authorizer,l._sqlite3_strglob=e.sqlite3_strglob,l._sqlite3_strlike=e.sqlite3_strlike,l._sqlite3_auto_extension=e.sqlite3_auto_extension,l._sqlite3_cancel_auto_extension=e.sqlite3_cancel_auto_extension,l._sqlite3_reset_auto_extension=e.sqlite3_reset_auto_extension,l._sqlite3_prepare_v3=e.sqlite3_prepare_v3,l._sqlite3_create_module=e.sqlite3_create_module,l._sqlite3_create_module_v2=e.sqlite3_create_module_v2,l._sqlite3_drop_modules=e.sqlite3_drop_modules,l._sqlite3_declare_vtab=e.sqlite3_declare_vtab,l._sqlite3_vtab_on_conflict=e.sqlite3_vtab_on_conflict,l._sqlite3_vtab_collation=e.sqlite3_vtab_collation,l._sqlite3_vtab_in=e.sqlite3_vtab_in,l._sqlite3_vtab_rhs_value=e.sqlite3_vtab_rhs_value,l._sqlite3_vtab_distinct=e.sqlite3_vtab_distinct,l._sqlite3_keyword_name=e.sqlite3_keyword_name,l._sqlite3_keyword_count=e.sqlite3_keyword_count,l._sqlite3_keyword_check=e.sqlite3_keyword_check,l._sqlite3_complete=e.sqlite3_complete,l._sqlite3_libversion=e.sqlite3_libversion,l._sqlite3_libversion_number=e.sqlite3_libversion_number,l._sqlite3_shutdown=e.sqlite3_shutdown,l._sqlite3_last_insert_rowid=e.sqlite3_last_insert_rowid,l._sqlite3_set_last_insert_rowid=e.sqlite3_set_last_insert_rowid,l._sqlite3_changes64=e.sqlite3_changes64,l._sqlite3_changes=e.sqlite3_changes,l._sqlite3_total_changes64=e.sqlite3_total_changes64,l._sqlite3_total_changes=e.sqlite3_total_changes,l._sqlite3_txn_state=e.sqlite3_txn_state,l._sqlite3_close_v2=e.sqlite3_close_v2,l._sqlite3_busy_handler=e.sqlite3_busy_handler,l._sqlite3_progress_handler=e.sqlite3_progress_handler,l._sqlite3_busy_timeout=e.sqlite3_busy_timeout,l._sqlite3_interrupt=e.sqlite3_interrupt,l._sqlite3_is_interrupted=e.sqlite3_is_interrupted,l._sqlite3_create_function=e.sqlite3_create_function,l._sqlite3_create_function_v2=e.sqlite3_create_function_v2,l._sqlite3_create_window_function=e.sqlite3_create_window_function,l._sqlite3_overload_function=e.sqlite3_overload_function,l._sqlite3_trace_v2=e.sqlite3_trace_v2,l._sqlite3_commit_hook=e.sqlite3_commit_hook,l._sqlite3_update_hook=e.sqlite3_update_hook,l._sqlite3_rollback_hook=e.sqlite3_rollback_hook,l._sqlite3_preupdate_hook=e.sqlite3_preupdate_hook,l._sqlite3_set_errmsg=e.sqlite3_set_errmsg,l._sqlite3_error_offset=e.sqlite3_error_offset,l._sqlite3_errcode=e.sqlite3_errcode,l._sqlite3_extended_errcode=e.sqlite3_extended_errcode,l._sqlite3_errstr=e.sqlite3_errstr,l._sqlite3_limit=e.sqlite3_limit,l._sqlite3_open=e.sqlite3_open,l._sqlite3_open_v2=e.sqlite3_open_v2,l._sqlite3_create_collation=e.sqlite3_create_collation,l._sqlite3_create_collation_v2=e.sqlite3_create_collation_v2,l._sqlite3_collation_needed=e.sqlite3_collation_needed,l._sqlite3_get_autocommit=e.sqlite3_get_autocommit,l._sqlite3_table_column_metadata=e.sqlite3_table_column_metadata,l._sqlite3_extended_result_codes=e.sqlite3_extended_result_codes,l._sqlite3_uri_key=e.sqlite3_uri_key,l._sqlite3_uri_int64=e.sqlite3_uri_int64,l._sqlite3_db_name=e.sqlite3_db_name,l._sqlite3_db_filename=e.sqlite3_db_filename,l._sqlite3_db_readonly=e.sqlite3_db_readonly,l._sqlite3_compileoption_used=e.sqlite3_compileoption_used,l._sqlite3_compileoption_get=e.sqlite3_compileoption_get,l._sqlite3session_diff=e.sqlite3session_diff,l._sqlite3session_attach=e.sqlite3session_attach,l._sqlite3session_create=e.sqlite3session_create,l._sqlite3session_delete=e.sqlite3session_delete,l._sqlite3session_table_filter=e.sqlite3session_table_filter,l._sqlite3session_changeset=e.sqlite3session_changeset,l._sqlite3session_changeset_strm=e.sqlite3session_changeset_strm,l._sqlite3session_patchset_strm=e.sqlite3session_patchset_strm,l._sqlite3session_patchset=e.sqlite3session_patchset,l._sqlite3session_enable=e.sqlite3session_enable,l._sqlite3session_indirect=e.sqlite3session_indirect,l._sqlite3session_isempty=e.sqlite3session_isempty,l._sqlite3session_memory_used=e.sqlite3session_memory_used,l._sqlite3session_object_config=e.sqlite3session_object_config,l._sqlite3session_changeset_size=e.sqlite3session_changeset_size,l._sqlite3changeset_start=e.sqlite3changeset_start,l._sqlite3changeset_start_v2=e.sqlite3changeset_start_v2,l._sqlite3changeset_start_strm=e.sqlite3changeset_start_strm,l._sqlite3changeset_start_v2_strm=e.sqlite3changeset_start_v2_strm,l._sqlite3changeset_next=e.sqlite3changeset_next,l._sqlite3changeset_op=e.sqlite3changeset_op,l._sqlite3changeset_pk=e.sqlite3changeset_pk,l._sqlite3changeset_old=e.sqlite3changeset_old,l._sqlite3changeset_new=e.sqlite3changeset_new,l._sqlite3changeset_conflict=e.sqlite3changeset_conflict,l._sqlite3changeset_fk_conflicts=e.sqlite3changeset_fk_conflicts,l._sqlite3changeset_finalize=e.sqlite3changeset_finalize,l._sqlite3changeset_invert=e.sqlite3changeset_invert,l._sqlite3changeset_invert_strm=e.sqlite3changeset_invert_strm,l._sqlite3changeset_apply_v2=e.sqlite3changeset_apply_v2,l._sqlite3changeset_apply_v3=e.sqlite3changeset_apply_v3,l._sqlite3changeset_apply=e.sqlite3changeset_apply,l._sqlite3changeset_apply_v3_strm=e.sqlite3changeset_apply_v3_strm,l._sqlite3changeset_apply_v2_strm=e.sqlite3changeset_apply_v2_strm,l._sqlite3changeset_apply_strm=e.sqlite3changeset_apply_strm,l._sqlite3changegroup_new=e.sqlite3changegroup_new,l._sqlite3changegroup_add=e.sqlite3changegroup_add,l._sqlite3changegroup_output=e.sqlite3changegroup_output,l._sqlite3changegroup_add_strm=e.sqlite3changegroup_add_strm,l._sqlite3changegroup_output_strm=e.sqlite3changegroup_output_strm,l._sqlite3changegroup_delete=e.sqlite3changegroup_delete,l._sqlite3changeset_concat=e.sqlite3changeset_concat,l._sqlite3changeset_concat_strm=e.sqlite3changeset_concat_strm,l._sqlite3session_config=e.sqlite3session_config,l._sqlite3_sourceid=e.sqlite3_sourceid,l._sqlite3__wasm_pstack_ptr=e.sqlite3__wasm_pstack_ptr,l._sqlite3__wasm_pstack_restore=e.sqlite3__wasm_pstack_restore,l._sqlite3__wasm_pstack_alloc=e.sqlite3__wasm_pstack_alloc,l._sqlite3__wasm_pstack_remaining=e.sqlite3__wasm_pstack_remaining,l._sqlite3__wasm_pstack_quota=e.sqlite3__wasm_pstack_quota,l._sqlite3__wasm_test_struct=e.sqlite3__wasm_test_struct,l._sqlite3__wasm_enum_json=e.sqlite3__wasm_enum_json,l._sqlite3__wasm_vfs_unlink=e.sqlite3__wasm_vfs_unlink,l._sqlite3__wasm_db_vfs=e.sqlite3__wasm_db_vfs,l._sqlite3__wasm_db_reset=e.sqlite3__wasm_db_reset,l._sqlite3__wasm_db_export_chunked=e.sqlite3__wasm_db_export_chunked,l._sqlite3__wasm_db_serialize=e.sqlite3__wasm_db_serialize,l._sqlite3__wasm_vfs_create_file=e.sqlite3__wasm_vfs_create_file,l._sqlite3__wasm_posix_create_file=e.sqlite3__wasm_posix_create_file,l._sqlite3__wasm_kvvfsMakeKey=e.sqlite3__wasm_kvvfsMakeKey,l._sqlite3__wasm_kvvfs_methods=e.sqlite3__wasm_kvvfs_methods,l._sqlite3__wasm_vtab_config=e.sqlite3__wasm_vtab_config,l._sqlite3__wasm_db_config_ip=e.sqlite3__wasm_db_config_ip,l._sqlite3__wasm_db_config_pii=e.sqlite3__wasm_db_config_pii,l._sqlite3__wasm_db_config_s=e.sqlite3__wasm_db_config_s,l._sqlite3__wasm_config_i=e.sqlite3__wasm_config_i,l._sqlite3__wasm_config_ii=e.sqlite3__wasm_config_ii,l._sqlite3__wasm_config_j=e.sqlite3__wasm_config_j,l._sqlite3__wasm_qfmt_token=e.sqlite3__wasm_qfmt_token,l._sqlite3__wasm_kvvfs_decode=e.sqlite3__wasm_kvvfs_decode,l._sqlite3__wasm_kvvfs_encode=e.sqlite3__wasm_kvvfs_encode,l._sqlite3__wasm_init_wasmfs=e.sqlite3__wasm_init_wasmfs,l._sqlite3__wasm_test_intptr=e.sqlite3__wasm_test_intptr,l._sqlite3__wasm_test_voidptr=e.sqlite3__wasm_test_voidptr,l._sqlite3__wasm_test_int64_max=e.sqlite3__wasm_test_int64_max,l._sqlite3__wasm_test_int64_min=e.sqlite3__wasm_test_int64_min,l._sqlite3__wasm_test_int64_times2=e.sqlite3__wasm_test_int64_times2,l._sqlite3__wasm_test_int64_minmax=e.sqlite3__wasm_test_int64_minmax,l._sqlite3__wasm_test_int64ptr=e.sqlite3__wasm_test_int64ptr,l._sqlite3__wasm_test_stack_overflow=e.sqlite3__wasm_test_stack_overflow,l._sqlite3__wasm_test_str_hello=e.sqlite3__wasm_test_str_hello,l._sqlite3__wasm_SQLTester_strglob=e.sqlite3__wasm_SQLTester_strglob,l._malloc=e.malloc,l._free=e.free,l._realloc=e.realloc,qn=e.emscripten_builtin_memalign,e._emscripten_stack_restore,e._emscripten_stack_alloc,e.emscripten_stack_get_current,e.__indirect_function_table}var vn={__syscall_chmod:ir,__syscall_faccessat:or,__syscall_fchmod:ar,__syscall_fchown32:lr,__syscall_fcntl64:cr,__syscall_fstat64:ur,__syscall_ftruncate64:dr,__syscall_getcwd:pr,__syscall_ioctl:hr,__syscall_lstat64:mr,__syscall_mkdirat:gr,__syscall_newfstatat:br,__syscall_openat:yr,__syscall_readlinkat:Er,__syscall_rmdir:qr,__syscall_stat64:vr,__syscall_unlinkat:Sr,__syscall_utimensat:Tr,_localtime_js:Or,_mmap_js:Nr,_munmap_js:xr,_tzset_js:Pr,clock_time_get:Rr,emscripten_date_now:yn,emscripten_get_heap_max:Fr,emscripten_get_now:bn,emscripten_resize_heap:Mr,environ_get:jr,environ_sizes_get:Ur,fd_close:Br,fd_fdstat_get:zr,fd_read:Qr,fd_seek:Vr,fd_sync:Hr,fd_write:$r,memory:pt};function Jt(){if(yt>0){xt=Jt;return}if(Cn(),yt>0){xt=Jt;return}function e(){l.calledRun=!0,!Te&&(Mn(),Ge?.(l),l.onRuntimeInitialized?.(),Dn())}l.setStatus?(l.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>l.setStatus(""),1),e()},1)):e()}var wt=await Vn();return Jt(),l.runSQLite3PostLoadInit=async function(e,t,o){delete t.runSQLite3PostLoadInit,globalThis.sqlite3ApiBootstrap=async function i(n=globalThis.sqlite3ApiConfig||i.defaultConfig){if(i.sqlite3)return(i.sqlite3.config||console).warn("sqlite3ApiBootstrap() called multiple times.","Config and external initializers are ignored on calls after the first."),i.sqlite3;const s=Object.assign(Object.create(null),{exports:void 0,memory:void 0,bigIntEnabled:!!globalThis.BigInt64Array,debug:console.debug.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),log:console.log.bind(console),wasmfsOpfsDir:"/opfs",useStdAlloc:!1},n||{});Object.assign(s,{allocExportName:s.useStdAlloc?"malloc":"sqlite3_malloc",deallocExportName:s.useStdAlloc?"free":"sqlite3_free",reallocExportName:s.useStdAlloc?"realloc":"sqlite3_realloc"}),["exports","memory","functionTable","wasmfsOpfsDir"].forEach(f=>{typeof s[f]=="function"&&(s[f]=s[f]())});const r=Object.create(null),u=Object.create(null),P=f=>r.sqlite3_js_rc_str&&r.sqlite3_js_rc_str(f)||"Unknown result code #"+f,I=f=>typeof f=="number"&&f===(f|0)&&f<=2147483647&&f>=-2147483648;class Z extends Error{constructor(...m){let E;if(m.length)if(I(m[0]))if(E=m[0],m.length===1)super(P(m[0]));else{const j=P(E);typeof m[1]=="object"?super(j,m[1]):(m[0]=j+":",super(m.join(" ")))}else m.length===2&&typeof m[1]=="object"?super(...m):super(m.join(" "));this.resultCode=E||r.SQLITE_ERROR,this.name="SQLite3Error"}}Z.toss=(...f)=>{throw new Z(...f)};const R=Z.toss;s.wasmfsOpfsDir&&!/^\/[^/]+$/.test(s.wasmfsOpfsDir)&&R("config.wasmfsOpfsDir must be falsy or in the form '/dir-name'.");const X=function f(m){return f._max||(f._max=BigInt("0x7fffffffffffffff"),f._min=~f._max),m>=f._min&&m<=f._max},p=f=>f>=-2147483647n-1n&&f<=2147483647n,B=function f(m){return f._min||(f._min=Number.MIN_SAFE_INTEGER,f._max=Number.MAX_SAFE_INTEGER),m>=f._min&&m<=f._max},F=f=>f&&f.constructor&&I(f.constructor.BYTES_PER_ELEMENT)?f:!1,ie=f=>f&&(f instanceof Uint8Array||f instanceof Int8Array||f instanceof ArrayBuffer),y=f=>f&&(f instanceof Uint8Array||f instanceof Int8Array||f instanceof ArrayBuffer),b=f=>ie(f)||R("Value is not of a supported TypedArray type."),C=function(f){return y(f)?u.typedArrayToString(f instanceof ArrayBuffer?new Uint8Array(f):f,0,f.length):Array.isArray(f)?f.join(""):(u.isPtr(f)&&(f=u.cstrToJs(f)),f)};class Q extends Error{constructor(...m){m.length===2&&typeof m[1]=="object"?super(...m):m.length?super(m.join(" ")):super("Allocation failed."),this.resultCode=r.SQLITE_NOMEM,this.name="WasmAllocError"}}Q.toss=(...f)=>{throw new Q(...f)},Object.assign(r,{sqlite3_bind_blob:void 0,sqlite3_bind_text:void 0,sqlite3_create_function_v2:(f,m,E,j,te,_e,Se,Ie,ge)=>{},sqlite3_create_function:(f,m,E,j,te,_e,Se,Ie)=>{},sqlite3_create_window_function:(f,m,E,j,te,_e,Se,Ie,ge,G)=>{},sqlite3_prepare_v3:(f,m,E,j,te,_e)=>{},sqlite3_prepare_v2:(f,m,E,j,te)=>{},sqlite3_exec:(f,m,E,j,te)=>{},sqlite3_randomness:(f,m)=>{}});const T={affirmBindableTypedArray:b,flexibleString:C,bigIntFits32:p,bigIntFits64:X,bigIntFitsDouble:B,isBindableTypedArray:ie,isInt32:I,isSQLableTypedArray:y,isTypedArray:F,isUIThread:()=>globalThis.window===globalThis&&!!globalThis.document,toss:function(...f){throw new Error(f.join(" "))},toss3:R,typedArrayPart:u.typedArrayPart,assert:function(f,m){f||T.toss("Assertion failed:",m)},affirmDbHeader:function(f){f instanceof ArrayBuffer&&(f=new Uint8Array(f));const m="SQLite format 3";15>f.byteLength&&R("Input does not contain an SQLite3 database header.");for(let E=0;E<15;++E)m.charCodeAt(E)!==f[E]&&R("Input does not contain an SQLite3 database header.")},affirmIsDb:function(f){f instanceof ArrayBuffer&&(f=new Uint8Array(f));const m=f.byteLength;(m<512||m%512!==0)&&R("Byte array size",m,"is invalid for an SQLite3 db."),T.affirmDbHeader(f)}};Object.assign(u,{exports:s.exports||R("Missing API config.exports (WASM module exports)."),memory:s.memory||s.exports.memory||R("API config object requires a WebAssembly.Memory object","in either config.exports.memory (exported)","or config.memory (imported)."),pointerSize:typeof s.exports.sqlite3_libversion()=="number"?4:8,bigIntEnabled:!!s.bigIntEnabled,functionTable:s.functionTable,alloc:void 0,realloc:void 0,dealloc:void 0}),u.allocFromTypedArray=function(f){f instanceof ArrayBuffer&&(f=new Uint8Array(f)),b(f);const m=u.alloc(f.byteLength||1);return u.heapForSize(f.constructor).set(f.byteLength?f:[0],Number(m)),m};{const f=s.allocExportName,m=s.deallocExportName,E=s.reallocExportName;for(const j of[f,m,E])u.exports[j]instanceof Function||R("Missing required exports[",j,"] function.");u.alloc=function j(te){return j.impl(te)||Q.toss("Failed to allocate",te," bytes.")},u.alloc.impl=u.exports[f],u.realloc=function j(te,_e){const Se=j.impl(u.ptr.coerce(te),_e);return _e?Se||Q.toss("Failed to reallocate",_e," bytes."):u.ptr.null},u.realloc.impl=u.exports[E],u.dealloc=function j(te){j.impl(u.ptr.coerce(te))},u.dealloc.impl=u.exports[m]}u.compileOptionUsed=function f(m){if(arguments.length){if(Array.isArray(m)){const E=Object.create(null);return m.forEach(j=>{E[j]=r.sqlite3_compileoption_used(j)}),E}else if(typeof m=="object")return Object.keys(m).forEach(E=>{m[E]=r.sqlite3_compileoption_used(E)}),m}else{if(f._result)return f._result;f._opt||(f._rx=/^([^=]+)=(.+)/,f._rxInt=/^-?\d+$/,f._opt=function(Se,Ie){const ge=f._rx.exec(Se);Ie[0]=ge?ge[1]:Se,Ie[1]=ge?f._rxInt.test(ge[2])?+ge[2]:ge[2]:!0});const E=Object.create(null),j=[0,0];let te=0,_e;for(;_e=r.sqlite3_compileoption_get(te++);)f._opt(_e,j),E[j[0]]=j[1];return f._result=E}return typeof m=="string"?!!r.sqlite3_compileoption_used(m):!1},u.pstack=Object.assign(Object.create(null),{restore:u.exports.sqlite3__wasm_pstack_restore,alloc:function(f){return typeof f=="string"&&!(f=u.sizeofIR(f))&&Q.toss("Invalid value for pstack.alloc(",arguments[0],")"),u.exports.sqlite3__wasm_pstack_alloc(f)||Q.toss("Could not allocate",f,"bytes from the pstack.")},allocChunks:function(f,m){typeof m=="string"&&!(m=u.sizeofIR(m))&&Q.toss("Invalid size value for allocChunks(",arguments[1],")");const E=u.pstack.alloc(f*m),j=[E];let te=1,_e=m;for(;te<f;++te,_e+=m)j.push(u.ptr.add(E,_e));return j},allocPtr:(f=1,m=!0)=>f===1?u.pstack.alloc(m?8:u.ptr.size):u.pstack.allocChunks(f,m?8:u.ptr.size),call:function(f){const m=u.pstack.pointer;try{return f(O)}finally{u.pstack.restore(m)}}}),Object.defineProperties(u.pstack,{pointer:{configurable:!1,iterable:!0,writeable:!1,get:u.exports.sqlite3__wasm_pstack_ptr},quota:{configurable:!1,iterable:!0,writeable:!1,get:u.exports.sqlite3__wasm_pstack_quota},remaining:{configurable:!1,iterable:!0,writeable:!1,get:u.exports.sqlite3__wasm_pstack_remaining}}),r.sqlite3_randomness=(...f)=>{if(f.length===1&&T.isTypedArray(f[0])&&f[0].BYTES_PER_ELEMENT===1){const m=f[0];if(m.byteLength===0)return u.exports.sqlite3_randomness(0,u.ptr.null),m;const E=u.pstack.pointer;try{let j=m.byteLength,te=0;const _e=u.exports.sqlite3_randomness,Se=u.heap8u(),Ie=j<512?j:512,ge=u.pstack.alloc(Ie);do{const G=j>Ie?Ie:j;_e(G,ge),m.set(u.typedArrayPart(Se,ge,u.ptr.add(ge,G)),te),j-=G,te+=G}while(j>0)}catch(j){s.error("Highly unexpected (and ignored!) exception in sqlite3_randomness():",j)}finally{u.pstack.restore(E)}return m}u.exports.sqlite3_randomness(...f)},r.sqlite3_wasmfs_opfs_dir=(function(){if(this.dir!==void 0)return this.dir;const f=s.wasmfsOpfsDir;if(!f||!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!u.exports.sqlite3__wasm_init_wasmfs)return this.dir="";try{return f&&u.xCallWrapped("sqlite3__wasm_init_wasmfs","i32",["string"],f)===0?this.dir=f:this.dir=""}catch{return this.dir=""}}).bind(Object.create(null)),r.sqlite3_wasmfs_filename_is_persistent=function(f){const m=r.sqlite3_wasmfs_opfs_dir();return m&&f?f.startsWith(m+"/"):!1},r.sqlite3_js_db_uses_vfs=function(f,m,E=0){try{const j=r.sqlite3_vfs_find(m);return j?f?j===r.sqlite3_js_db_vfs(f,E)?j:!1:j===r.sqlite3_vfs_find(0)?j:!1:!1}catch{return!1}},r.sqlite3_js_vfs_list=function(){const f=[];let m=r.sqlite3_vfs_find(u.ptr.null);for(;m;){const E=new r.sqlite3_vfs(m);f.push(u.cstrToJs(E.$zName)),m=E.$pNext,E.dispose()}return f},r.sqlite3_js_db_export=function(f,m=0){f=u.xWrap.testConvertArg("sqlite3*",f),f||R("Invalid sqlite3* argument."),u.bigIntEnabled||R("BigInt support is not enabled.");const E=u.scopedAllocPush();let j;try{const te=u.scopedAlloc(8+u.ptr.size),_e=u.ptr.add(te,8),Se=m?u.isPtr(m)?m:u.scopedAllocCString(""+m):u.ptr.null;let Ie=u.exports.sqlite3__wasm_db_serialize(f,Se,_e,te,0);Ie&&R("Database serialization failed with code",O.capi.sqlite3_js_rc_str(Ie)),j=u.peekPtr(_e);const ge=u.peek(te,"i64");return Ie=ge?u.heap8u().slice(Number(j),Number(j)+Number(ge)):new Uint8Array,Ie}finally{j&&u.exports.sqlite3_free(j),u.scopedAllocPop(E)}},r.sqlite3_js_db_vfs=(f,m=u.ptr.null)=>T.sqlite3__wasm_db_vfs(f,m),r.sqlite3_js_aggregate_context=(f,m)=>r.sqlite3_aggregate_context(f,m)||(m?Q.toss("Cannot allocate",m,"bytes for sqlite3_aggregate_context()"):0),r.sqlite3_js_posix_create_file=function(f,m,E){let j;m&&u.isPtr(m)?j=m:m instanceof ArrayBuffer||m instanceof Uint8Array?(j=u.allocFromTypedArray(m),(arguments.length<3||!T.isInt32(E)||E<0)&&(E=m.byteLength)):Z.toss("Invalid 2nd argument for sqlite3_js_posix_create_file().");try{(!T.isInt32(E)||E<0)&&Z.toss("Invalid 3rd argument for sqlite3_js_posix_create_file().");const te=T.sqlite3__wasm_posix_create_file(f,j,E);te&&Z.toss("Creation of file failed with sqlite3 result code",r.sqlite3_js_rc_str(te))}finally{j&&j!==m&&u.dealloc(j)}},r.sqlite3_js_vfs_create_file=function(f,m,E,j){s.warn("sqlite3_js_vfs_create_file() is deprecated and","should be avoided because it can lead to C-level crashes.","See its documentation for alternatives.");let te;E?u.isPtr(E)?te=E:(E instanceof ArrayBuffer&&(E=new Uint8Array(E)),E instanceof Uint8Array?(te=u.allocFromTypedArray(E),(arguments.length<4||!T.isInt32(j)||j<0)&&(j=E.byteLength)):Z.toss("Invalid 3rd argument type for sqlite3_js_vfs_create_file().")):te=0,(!T.isInt32(j)||j<0)&&(te&&te!==E&&u.dealloc(te),Z.toss("Invalid 4th argument for sqlite3_js_vfs_create_file()."));try{const _e=T.sqlite3__wasm_vfs_create_file(f,m,te,j);_e&&Z.toss("Creation of file failed with sqlite3 result code",r.sqlite3_js_rc_str(_e))}finally{te&&te!==E&&u.dealloc(te)}},r.sqlite3_js_sql_to_string=f=>{if(typeof f=="string")return f;const m=C(v);return m===v?void 0:m},r.sqlite3_db_config=(function(f,m,...E){switch(m){case r.SQLITE_DBCONFIG_ENABLE_FKEY:case r.SQLITE_DBCONFIG_ENABLE_TRIGGER:case r.SQLITE_DBCONFIG_ENABLE_FTS3_TOKENIZER:case r.SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION:case r.SQLITE_DBCONFIG_NO_CKPT_ON_CLOSE:case r.SQLITE_DBCONFIG_ENABLE_QPSG:case r.SQLITE_DBCONFIG_TRIGGER_EQP:case r.SQLITE_DBCONFIG_RESET_DATABASE:case r.SQLITE_DBCONFIG_DEFENSIVE:case r.SQLITE_DBCONFIG_WRITABLE_SCHEMA:case r.SQLITE_DBCONFIG_LEGACY_ALTER_TABLE:case r.SQLITE_DBCONFIG_DQS_DML:case r.SQLITE_DBCONFIG_DQS_DDL:case r.SQLITE_DBCONFIG_ENABLE_VIEW:case r.SQLITE_DBCONFIG_LEGACY_FILE_FORMAT:case r.SQLITE_DBCONFIG_TRUSTED_SCHEMA:case r.SQLITE_DBCONFIG_STMT_SCANSTATUS:case r.SQLITE_DBCONFIG_REVERSE_SCANORDER:case r.SQLITE_DBCONFIG_ENABLE_ATTACH_CREATE:case r.SQLITE_DBCONFIG_ENABLE_ATTACH_WRITE:case r.SQLITE_DBCONFIG_ENABLE_COMMENTS:return this.ip||(this.ip=u.xWrap("sqlite3__wasm_db_config_ip","int",["sqlite3*","int","int","*"])),this.ip(f,m,E[0],E[1]||0);case r.SQLITE_DBCONFIG_LOOKASIDE:return this.pii||(this.pii=u.xWrap("sqlite3__wasm_db_config_pii","int",["sqlite3*","int","*","int","int"])),this.pii(f,m,E[0],E[1],E[2]);case r.SQLITE_DBCONFIG_MAINDBNAME:return this.s||(this.s=u.xWrap("sqlite3__wasm_db_config_s","int",["sqlite3*","int","string:static"])),this.s(f,m,E[0]);default:return r.SQLITE_MISUSE}}).bind(Object.create(null)),r.sqlite3_value_to_js=function(f,m=!0){let E;const j=r.sqlite3_value_type(f);switch(j){case r.SQLITE_INTEGER:u.bigIntEnabled?(E=r.sqlite3_value_int64(f),T.bigIntFitsDouble(E)&&(E=Number(E))):E=r.sqlite3_value_double(f);break;case r.SQLITE_FLOAT:E=r.sqlite3_value_double(f);break;case r.SQLITE_TEXT:E=r.sqlite3_value_text(f);break;case r.SQLITE_BLOB:{const te=r.sqlite3_value_bytes(f),_e=r.sqlite3_value_blob(f);te&&!_e&&O.WasmAllocError.toss("Cannot allocate memory for blob argument of",te,"byte(s)"),E=te?u.heap8u().slice(Number(_e),Number(_e)+Number(te)):null;break}case r.SQLITE_NULL:E=null;break;default:m&&R(r.SQLITE_MISMATCH,"Unhandled sqlite3_value_type():",j),E=void 0}return E},r.sqlite3_values_to_js=function(f,m,E=!0){let j;const te=[];for(j=0;j<f;++j)te.push(r.sqlite3_value_to_js(u.peekPtr(u.ptr.add(m,u.ptr.size*j)),E));return te},r.sqlite3_result_error_js=function(f,m){m instanceof Q?r.sqlite3_result_error_nomem(f):r.sqlite3_result_error(f,""+m,-1)},r.sqlite3_result_js=function(f,m){if(m instanceof Error){r.sqlite3_result_error_js(f,m);return}try{switch(typeof m){case"undefined":break;case"boolean":r.sqlite3_result_int(f,m?1:0);break;case"bigint":T.bigIntFits32(m)?r.sqlite3_result_int(f,Number(m)):T.bigIntFitsDouble(m)?r.sqlite3_result_double(f,Number(m)):u.bigIntEnabled?T.bigIntFits64(m)?r.sqlite3_result_int64(f,m):R("BigInt value",m.toString(),"is too BigInt for int64."):R("BigInt value",m.toString(),"is too BigInt.");break;case"number":{let E;T.isInt32(m)?E=r.sqlite3_result_int:u.bigIntEnabled&&Number.isInteger(m)&&T.bigIntFits64(BigInt(m))?E=r.sqlite3_result_int64:E=r.sqlite3_result_double,E(f,m);break}case"string":{const[E,j]=u.allocCString(m,!0);r.sqlite3_result_text(f,E,j,r.SQLITE_WASM_DEALLOC);break}case"object":if(m===null){r.sqlite3_result_null(f);break}else if(T.isBindableTypedArray(m)){const E=u.allocFromTypedArray(m);r.sqlite3_result_blob(f,E,m.byteLength,r.SQLITE_WASM_DEALLOC);break}default:R("Don't not how to handle this UDF result value:",typeof m,m)}}catch(E){r.sqlite3_result_error_js(f,E)}},r.sqlite3_column_js=function(f,m,E=!0){const j=r.sqlite3_column_value(f,m);return j===0?void 0:r.sqlite3_value_to_js(j,E)};{const f=(function(m,E,j){j=r[j],this.ptr?u.pokePtr(this.ptr,0):this.ptr=u.allocPtr();const te=j(m,E,this.ptr);if(te)return Z.toss(te,arguments[2]+"() failed with code "+te);const _e=u.peekPtr(this.ptr);return _e?r.sqlite3_value_to_js(_e,!0):void 0}).bind(Object.create(null));r.sqlite3_preupdate_new_js=(m,E)=>f(m,E,"sqlite3_preupdate_new"),r.sqlite3_preupdate_old_js=(m,E)=>f(m,E,"sqlite3_preupdate_old"),r.sqlite3changeset_new_js=(m,E)=>f(m,E,"sqlite3changeset_new"),r.sqlite3changeset_old_js=(m,E)=>f(m,E,"sqlite3changeset_old")}const O={WasmAllocError:Q,SQLite3Error:Z,capi:r,util:T,wasm:u,config:s,version:Object.create(null),client:void 0,asyncPostInit:(async function f(){if(f.isReady instanceof Promise)return f.isReady;let m=this.initializersAsync;delete this.initializersAsync;const E=async()=>(O.__isUnderTest||(delete O.util,delete O.StructBinder),O),j=_e=>{throw s.error("an async sqlite3 initializer failed:",_e),_e};if(!m||!m.length)return f.isReady=E().catch(j);m=m.map(_e=>_e instanceof Function?async Se=>_e(O):_e),m.push(E);let te=Promise.resolve(O);for(;m.length;)te=te.then(m.shift());return f.isReady=te.catch(j)}).bind(i),scriptInfo:void 0};typeof o<"u"&&(O.__isUnderTest=!!o);try{i.initializers.forEach(f=>{f(O)})}catch(f){throw console.error("sqlite3 bootstrap initializer threw:",f),f}if(delete i.initializers,i.sqlite3=O,typeof e<"u"&&(e.debugModule("sqlite3ApiBootstrap() complete",O),O.scriptInfo=e),O.__isUnderTest){typeof t<"u"&&(O.config.emscripten=t);const f=O.scriptInfo?.instantiateWasm;f&&(O.wasm.module=f.module,O.wasm.instance=f.instance,O.wasm.imports=f.imports)}return delete globalThis.sqlite3ApiConfig,delete globalThis.sqlite3ApiBootstrap,delete i.defaultConfig,O.asyncPostInit().then(f=>(typeof e<"u"&&e.debugModule("sqlite3.asyncPostInit() complete",f),delete f.asyncPostInit,delete f.scriptInfo,delete f.emscripten,f))},globalThis.sqlite3ApiBootstrap.initializers=[],globalThis.sqlite3ApiBootstrap.initializersAsync=[],globalThis.sqlite3ApiBootstrap.defaultConfig=Object.create(null),globalThis.sqlite3ApiBootstrap.sqlite3=void 0,globalThis.sqlite3ApiBootstrap.initializers.push(function(i){i.version={libVersion:"3.52.0",libVersionNumber:3052e3,sourceId:"2026-01-30 06:37:34 407724c4e80efdf93d885e95b5209a100a3f470fe0298138be57201f65f9817e",downloadVersion:352e4,scm:{"sha3-256":"407724c4e80efdf93d885e95b5209a100a3f470fe0298138be57201f65f9817e",branch:"trunk",tags:"",datetime:"2026-01-30T06:37:34.096Z"}}}),globalThis.WhWasmUtilInstaller=function(n){n.bigIntEnabled===void 0&&(n.bigIntEnabled=!!globalThis.BigInt64Array);const s=(...a)=>{throw new Error(a.join(" "))};if(!n.pointerSize&&!n.pointerIR&&n.alloc&&n.dealloc){const a=n.alloc(1);n.pointerSize=typeof a=="bigint"?8:4,n.dealloc(a)}n.pointerSize&&!n.pointerIR&&(n.pointerIR=n.pointerSize===4?"i32":"i64");const r=n.pointerIR??="i32",u=n.pointerSize??=r==="i32"?4:r==="i64"?8:0;delete n.pointerSize,delete n.pointerIR,r!=="i32"&&r!=="i64"?s("Invalid pointerIR:",r):u!==8&&u!==4&&s("Invalid pointerSize:",u);const P=n.bigIntEnabled?a=>BigInt(a||0):a=>s("BigInt support is disabled in this build."),Z=u===4?a=>Number(a||0):P,R=Z(0),X=function(...a){let _=Z(0);for(const d of a)_+=Z(d);return _};{const a=Object.create(null);Object.defineProperty(n,"ptr",{enumerable:!0,get:()=>a,set:()=>s("The ptr property is read-only.")}),(function _(d,q){return Object.defineProperty(a,d,{enumerable:!0,get:()=>q,set:()=>s("ptr["+d+"] is read-only.")}),_})("null",R)("size",u)("ir",r)("coerce",Z)("add",X)("addn",r===4?X:(..._)=>Number(X(..._)))}n.exports||Object.defineProperty(n,"exports",{enumerable:!0,configurable:!0,get:()=>n.instance?.exports});const p=Object.create(null);p.heapSize=0,p.memory=null,p.freeFuncIndexes=[],p.scopedAlloc=[],p.scopedAlloc.pushPtr=a=>(p.scopedAlloc[p.scopedAlloc.length-1].push(a),a),p.utf8Decoder=new TextDecoder,p.utf8Encoder=new TextEncoder("utf-8"),n.sizeofIR=a=>{switch(a){case"i8":return 1;case"i16":return 2;case"i32":case"f32":case"float":return 4;case"i64":case"f64":case"double":return 8;case"*":return u;default:return(""+a).endsWith("*")?u:void 0}};const B=function(){if(!p.memory)p.memory=n.memory instanceof WebAssembly.Memory?n.memory:n.exports.memory;else if(p.heapSize===p.memory.buffer.byteLength)return p;const a=p.memory.buffer;return p.HEAP8=new Int8Array(a),p.HEAP8U=new Uint8Array(a),p.HEAP16=new Int16Array(a),p.HEAP16U=new Uint16Array(a),p.HEAP32=new Int32Array(a),p.HEAP32U=new Uint32Array(a),p.HEAP32F=new Float32Array(a),p.HEAP64F=new Float64Array(a),n.bigIntEnabled&&(typeof BigInt64Array<"u"?(p.HEAP64=new BigInt64Array(a),p.HEAP64U=new BigUint64Array(a)):s("BigInt support is enabled, but the BigInt64Array type is missing.")),p.heapSize=a.byteLength,p};n.heap8=()=>B().HEAP8,n.heap8u=()=>B().HEAP8U,n.heap16=()=>B().HEAP16,n.heap16u=()=>B().HEAP16U,n.heap32=()=>B().HEAP32,n.heap32u=()=>B().HEAP32U,n.heapForSize=function(a,_=!0){const d=p.memory&&p.heapSize===p.memory.buffer.byteLength?p:B();switch(a){case Int8Array:return d.HEAP8;case Uint8Array:return d.HEAP8U;case Int16Array:return d.HEAP16;case Uint16Array:return d.HEAP16U;case Int32Array:return d.HEAP32;case Uint32Array:return d.HEAP32U;case 8:return _?d.HEAP8U:d.HEAP8;case 16:return _?d.HEAP16U:d.HEAP16;case 32:return _?d.HEAP32U:d.HEAP32;case 64:if(d.HEAP64)return _?d.HEAP64U:d.HEAP64;break;default:if(n.bigIntEnabled){if(a===globalThis.BigUint64Array)return d.HEAP64U;if(a===globalThis.BigInt64Array)return d.HEAP64;break}}s("Invalid heapForSize() size: expecting 8, 16, 32,","or (if BigInt is enabled) 64.")};const F=n.functionTable;delete n.functionTable,n.functionTable=F?()=>F:()=>n.exports.__indirect_function_table,n.functionEntry=function(a){const _=n.functionTable();return a<_.length?_.get(Z(a)):void 0},n.jsFuncToWasm=function a(_,d){if(a._||(a._={sigTypes:Object.assign(Object.create(null),{i:"i32",p:r,P:r,s:r,j:"i64",f:"f32",d:"f64"}),typeCodes:Object.assign(Object.create(null),{f64:124,f32:125,i64:126,i32:127}),uleb128Encode:(M,h,N)=>{N<128?M[h](N):M[h](N%128|128,N>>7)},rxJSig:/^(\w)\((\w*)\)$/,sigParams:M=>{const h=a._.rxJSig.exec(M);return h?h[2]:M.substr(1)},letterType:M=>a._.sigTypes[M]||s("Invalid signature letter:",M),pushSigType:(M,h)=>M.push(a._.typeCodes[a._.letterType(h)])}),typeof _=="string"){const M=d;d=_,_=M}const q=a._,V=q.sigParams(d),Y=[1,96];q.uleb128Encode(Y,"push",V.length);for(const M of V)q.pushSigType(Y,M);return d[0]==="v"?Y.push(0):(Y.push(1),q.pushSigType(Y,d[0])),q.uleb128Encode(Y,"unshift",Y.length),Y.unshift(0,97,115,109,1,0,0,0,1),Y.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array(Y)),{e:{f:_}}).exports.f};const ie=function(_,d,q){if(q&&!p.scopedAlloc.length&&s("No scopedAllocPush() scope is active."),typeof _=="string"){const h=d;d=_,_=h}(typeof d!="string"||!(_ instanceof Function))&&s("Invalid arguments: expecting (function,signature) or (signature,function).");const V=n.functionTable(),Y=Z(V.length);let M;for(;(M=p.freeFuncIndexes.pop())&&V.get(M);){M=null;continue}M||(M=Z(Y),V.grow(Z(1)));try{return V.set(M,_),q&&p.scopedAlloc.pushPtr(M),M}catch(h){if(!(h instanceof TypeError))throw M===Y&&p.freeFuncIndexes.push(Y),h}try{const h=n.jsFuncToWasm(_,d);V.set(M,h),q&&p.scopedAlloc.pushPtr(M)}catch(h){throw M===Y&&p.freeFuncIndexes.push(Y),h}return M};n.installFunction=(a,_)=>ie(a,_,!1),n.scopedInstallFunction=(a,_)=>ie(a,_,!0),n.uninstallFunction=function(a){if(!a&&R!==a)return;const _=n.functionTable();p.freeFuncIndexes.push(a);const d=_.get(a);return _.set(a,null),d},n.peek=function(_,d="i8"){d.endsWith("*")&&(d=r);const q=p.memory&&p.heapSize===p.memory.buffer.byteLength?p:B(),V=Array.isArray(_)?[]:void 0;let Y;do{switch(V&&(_=arguments[0].shift()),d){case"i1":case"i8":Y=q.HEAP8[Number(_)>>0];break;case"i16":Y=q.HEAP16[Number(_)>>1];break;case"i32":Y=q.HEAP32[Number(_)>>2];break;case"float":case"f32":Y=q.HEAP32F[Number(_)>>2];break;case"double":case"f64":Y=Number(q.HEAP64F[Number(_)>>3]);break;case"i64":if(q.HEAP64){Y=P(q.HEAP64[Number(_)>>3]);break}default:s("Invalid type for peek():",d)}V&&V.push(Y)}while(V&&arguments[0].length);return V||Y},n.poke=function(a,_,d="i8"){d.endsWith("*")&&(d=r);const q=p.memory&&p.heapSize===p.memory.buffer.byteLength?p:B();for(const V of Array.isArray(a)?a:[a])switch(d){case"i1":case"i8":q.HEAP8[Number(V)>>0]=_;continue;case"i16":q.HEAP16[Number(V)>>1]=_;continue;case"i32":q.HEAP32[Number(V)>>2]=_;continue;case"float":case"f32":q.HEAP32F[Number(V)>>2]=_;continue;case"double":case"f64":q.HEAP64F[Number(V)>>3]=_;continue;case"i64":if(q.HEAP64){q.HEAP64[Number(V)>>3]=P(_);continue}default:s("Invalid type for poke(): "+d)}return this},n.peekPtr=(...a)=>n.peek(a.length===1?a[0]:a,r),n.pokePtr=(a,_=0)=>n.poke(a,_,r),n.peek8=(...a)=>n.peek(a.length===1?a[0]:a,"i8"),n.poke8=(a,_)=>n.poke(a,_,"i8"),n.peek16=(...a)=>n.peek(a.length===1?a[0]:a,"i16"),n.poke16=(a,_)=>n.poke(a,_,"i16"),n.peek32=(...a)=>n.peek(a.length===1?a[0]:a,"i32"),n.poke32=(a,_)=>n.poke(a,_,"i32"),n.peek64=(...a)=>n.peek(a.length===1?a[0]:a,"i64"),n.poke64=(a,_)=>n.poke(a,_,"i64"),n.peek32f=(...a)=>n.peek(a.length===1?a[0]:a,"f32"),n.poke32f=(a,_)=>n.poke(a,_,"f32"),n.peek64f=(...a)=>n.peek(a.length===1?a[0]:a,"f64"),n.poke64f=(a,_)=>n.poke(a,_,"f64"),n.getMemValue=n.peek,n.getPtrValue=n.peekPtr,n.setMemValue=n.poke,n.setPtrValue=n.pokePtr,n.isPtr32=a=>typeof a=="number"&&a>=0&&a===(a|0),n.isPtr64=a=>typeof a=="bigint"?a>=0:n.isPtr32(a),n.isPtr=u===4?n.isPtr32:n.isPtr64,n.cstrlen=function(a){if(!a||!n.isPtr(a))return null;a=Number(a);const _=B().HEAP8U;let d=a;for(;_[d]!==0;++d);return d-a};const y=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,b=a=>a.buffer instanceof y;n.isSharedTypedArray=b;const C=(a,_,d)=>(u===8&&(typeof _=="bigint"&&(_=Number(_)),typeof d=="bigint"&&(d=Number(d))),b(a)?a.slice(_,d):a.subarray(_,d));n.typedArrayPart=C;const Q=(a,_,d)=>p.utf8Decoder.decode(C(a,_,d));n.typedArrayToString=Q,n.cstrToJs=function(a){const _=n.cstrlen(a);return _?Q(B().HEAP8U,Number(a),Number(a)+_):_===null?_:""},n.jstrlen=function(a){if(typeof a!="string")return null;const _=a.length;let d=0;for(let q=0;q<_;++q){let V=a.charCodeAt(q);V>=55296&&V<=57343&&(V=65536+((V&1023)<<10)|a.charCodeAt(++q)&1023),V<=127?++d:V<=2047?d+=2:V<=65535?d+=3:d+=4}return d},n.jstrcpy=function(a,_,d=0,q=-1,V=!0){if((!_||!(_ instanceof Int8Array)&&!(_ instanceof Uint8Array))&&s("jstrcpy() target must be an Int8Array or Uint8Array."),q=Number(q),d=Number(d),q<0&&(q=_.length-d),!(q>0)||!(d>=0))return 0;let Y=0,M=a.length;const h=d,N=d+q-(V?1:0);for(;Y<M&&d<N;++Y){let H=a.charCodeAt(Y);if(H>=55296&&H<=57343&&(H=65536+((H&1023)<<10)|a.charCodeAt(++Y)&1023),H<=127){if(d>=N)break;_[d++]=H}else if(H<=2047){if(d+1>=N)break;_[d++]=192|H>>6,_[d++]=128|H&63}else if(H<=65535){if(d+2>=N)break;_[d++]=224|H>>12,_[d++]=128|H>>6&63,_[d++]=128|H&63}else{if(d+3>=N)break;_[d++]=240|H>>18,_[d++]=128|H>>12&63,_[d++]=128|H>>6&63,_[d++]=128|H&63}}return V&&(_[d++]=0),d-h},n.cstrncpy=function(a,_,d){if((!a||!_)&&s("cstrncpy() does not accept NULL strings."),d<0)d=n.cstrlen(strPtr)+1;else if(!(d>0))return 0;const q=n.heap8u();let V=0,Y;const M=Number(a),h=Number(_);for(;V<d&&(Y=q[h+V]);++V)q[M+V]=Y;return V<d&&(q[M+V++]=0),V},n.jstrToUintArray=(a,_=!1)=>p.utf8Encoder.encode(_?a+"\0":a);const T=(a,_)=>{(!(a.alloc instanceof Function)||!(a.dealloc instanceof Function))&&s("Object is missing alloc() and/or dealloc() function(s)","required by",_+"().")},O=function(a,_,d,q){if(T(n,q),typeof a!="string")return null;const V=p.utf8Encoder.encode(a),Y=d(V.length+1);let M=Y;try{const h=B().HEAP8U;return h.set(V,Number(Y)),h[X(Y,V.length)]=0,M=R,_?[Y,V.length]:Y}finally{M&&n.dealloc(M)}};n.allocCString=(a,_=!1)=>O(a,_,n.alloc,"allocCString()"),n.scopedAllocPush=function(){T(n,"scopedAllocPush");const a=[];return p.scopedAlloc.push(a),a},n.scopedAllocPop=function(a){T(n,"scopedAllocPop");const _=arguments.length?p.scopedAlloc.indexOf(a):p.scopedAlloc.length-1;_<0&&s("Invalid state object for scopedAllocPop()."),arguments.length===0&&(a=p.scopedAlloc[_]),p.scopedAlloc.splice(_,1);for(let d;d=a.pop();)n.functionEntry(d)?n.uninstallFunction(d):n.dealloc(d)},n.scopedAlloc=function(a){p.scopedAlloc.length||s("No scopedAllocPush() scope is active.");const _=Z(n.alloc(a));return p.scopedAlloc.pushPtr(_)},Object.defineProperty(n.scopedAlloc,"level",{configurable:!1,enumerable:!1,get:()=>p.scopedAlloc.length,set:()=>s("The 'active' property is read-only.")}),n.scopedAllocCString=(a,_=!1)=>O(a,_,n.scopedAlloc,"scopedAllocCString()");const f=function(a,_){const d=n[a?"scopedAlloc":"alloc"]((_.length+1)*n.ptr.size);let q=0;return _.forEach(V=>{n.pokePtr(X(d,n.ptr.size*q++),n[a?"scopedAllocCString":"allocCString"](""+V))}),n.pokePtr(X(d,n.ptr.size*q),0),d};n.scopedAllocMainArgv=a=>f(!0,a),n.allocMainArgv=a=>f(!1,a),n.cArgvToJs=(a,_)=>{const d=[];for(let q=0;q<a;++q){const V=n.peekPtr(X(_,n.ptr.size*q));d.push(V?n.cstrToJs(V):null)}return d},n.scopedAllocCall=function(a){n.scopedAllocPush();try{return a()}finally{n.scopedAllocPop()}};const m=function(a,_,d){T(n,d);const q=_?"i64":r;let V=n[d](a*(_?8:u));if(n.poke(V,0,q),a===1)return V;const Y=[V];for(let M=1;M<a;++M)V=X(V,_?8:u),Y[M]=V,n.poke(V,0,q);return Y};n.allocPtr=(a=1,_=!0)=>m(a,_,"alloc"),n.scopedAllocPtr=(a=1,_=!0)=>m(a,_,"scopedAlloc"),n.xGet=function(a){return n.exports[a]||s("Cannot find exported symbol:",a)};const E=(a,_)=>s(a+"() requires",_,"argument(s).");n.xCall=function(a,..._){const d=a instanceof Function?a:n.xGet(a);return d instanceof Function||s("Exported symbol",a,"is not a function."),d.length!==_.length&&E(d===a?d.name:a,d.length),arguments.length===2&&Array.isArray(arguments[1])?d.apply(null,arguments[1]):d.apply(null,_)},p.xWrap=Object.create(null),p.xWrap.convert=Object.create(null),p.xWrap.convert.arg=new Map,p.xWrap.convert.result=new Map;const j=p.xWrap.convert.arg,te=p.xWrap.convert.result,_e=Z;j.set("i64",P).set("i32",a=>a|0).set("i16",a=>(a|0)&65535).set("i8",a=>(a|0)&255).set("f32",a=>Number(a).valueOf()).set("float",j.get("f32")).set("f64",j.get("f32")).set("double",j.get("f64")).set("int",j.get("i32")).set("null",a=>a).set(null,j.get("null")).set("**",_e).set("*",_e),te.set("*",_e).set("pointer",_e).set("number",a=>Number(a)).set("void",a=>{}).set(void 0,te.get("void")).set("null",a=>a).set(null,te.get("null"));for(const a of["i8","i16","i32","i64","int","f32","float","f64","double"])j.set(a+"*",_e),te.set(a+"*",_e),te.set(a,j.get(a)||s("Maintenance required: missing arg converter for",a));const Se=a=>typeof a=="string"?n.scopedAllocCString(a):Z(a);j.set("string",Se).set("utf8",Se),te.set("string",a=>n.cstrToJs(a)).set("utf8",te.get("string")).set("string:dealloc",a=>{try{return a?n.cstrToJs(a):null}finally{n.dealloc(a)}}).set("utf8:dealloc",te.get("string:dealloc")).set("json",a=>JSON.parse(n.cstrToJs(a))).set("json:dealloc",a=>{try{return a?JSON.parse(n.cstrToJs(a)):null}finally{n.dealloc(a)}});const Ie=class{constructor(a){this.name=a.name||"unnamed adapter"}convertArg(a,_,d){s("AbstractArgAdapter must be subclassed.")}};j.FuncPtrAdapter=class ht extends Ie{constructor(_){super(_),j.FuncPtrAdapter.warnOnUse&&console.warn("xArg.FuncPtrAdapter is an internal-only API","and is not intended to be invoked from","client-level code. Invoked with:",_),this.name=_.name||"unnamed",this.signature=_.signature,_.contextKey instanceof Function&&(this.contextKey=_.contextKey,_.bindScope||(_.bindScope="context")),this.bindScope=_.bindScope||s("FuncPtrAdapter options requires a bindScope (explicit or implied)."),ht.bindScopes.indexOf(_.bindScope)<0&&s("Invalid options.bindScope ("+_.bindMod+") for FuncPtrAdapter. Expecting one of: ("+ht.bindScopes.join(", ")+")"),this.isTransient=this.bindScope==="transient",this.isContext=this.bindScope==="context",this.isPermanent=this.bindScope==="permanent",this.singleton=this.bindScope==="singleton"?[]:void 0,this.callProxy=_.callProxy instanceof Function?_.callProxy:void 0}contextKey(_,d){return this}contextMap(_){const d=this.__cmap||(this.__cmap=new Map);let q=d.get(_);return q===void 0&&d.set(_,q=[]),q}convertArg(_,d,q){let V=this.singleton;if(!V&&this.isContext&&(V=this.contextMap(this.contextKey(d,q))),V&&V.length===2&&V[0]===_)return V[1];if(_ instanceof Function){this.callProxy&&(_=this.callProxy(_));const Y=ie(_,this.signature,this.isTransient);if(ht.debugFuncInstall&&ht.debugOut("FuncPtrAdapter installed",this,this.contextKey(d,q),"@"+Y,_),V){if(V[1]){ht.debugFuncInstall&&ht.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(d,q),"@"+V[1],_);try{p.scopedAlloc.pushPtr(V[1])}catch{}}V[0]=arguments[0]||R,V[1]=Y}return Y}else if(n.isPtr(_)||_===null||_===void 0){if(V&&V[1]&&V[1]!==_){ht.debugFuncInstall&&ht.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(d,q),"@"+V[1],_);try{p.scopedAlloc.pushPtr(V[1])}catch{}V[0]=V[1]=_||R}return _||R}else throw new TypeError("Invalid FuncPtrAdapter argument type. Expecting a function pointer or a "+(this.name?this.name+" ":"")+"function matching signature "+this.signature+".")}},j.FuncPtrAdapter.warnOnUse=!1,j.FuncPtrAdapter.debugFuncInstall=!1,j.FuncPtrAdapter.debugOut=console.debug.bind(console),j.FuncPtrAdapter.bindScopes=["transient","context","singleton","permanent"];const ge=a=>j.get(a)||s("Argument adapter not found:",a),G=a=>te.get(a)||s("Result adapter not found:",a);p.xWrap.convertArg=(a,..._)=>ge(a)(..._),p.xWrap.convertArgNoCheck=(a,..._)=>j.get(a)(..._),p.xWrap.convertResult=(a,_)=>a===null?_:a?G(a)(_):void 0,p.xWrap.convertResultNoCheck=(a,_)=>a===null?_:a?te.get(a)(_):void 0,n.xWrap=function a(_,d,...q){arguments.length===3&&Array.isArray(arguments[2])&&(q=arguments[2]),n.isPtr(_)&&(_=n.functionEntry(_)||s("Function pointer not found in WASM function table."));const V=_ instanceof Function,Y=V?_:n.xGet(_);if(V&&(_=Y.name||"unnamed function"),q.length!==Y.length&&E(_,Y.length),Y.length===0&&(d===null||d==="null"))return Y;G(d);for(const h of q)h instanceof Ie?j.set(h,(...N)=>h.convertArg(...N)):ge(h);const M=p.xWrap;return Y.length===0?(...h)=>h.length?E(_,Y.length):M.convertResult(d,Y.call(null)):function(...h){h.length!==Y.length&&E(_,Y.length);const N=n.scopedAllocPush();try{let H=0;for(a.debug&&console.debug("xWrap() preparing: resultType ",d,"xf",Y,"argTypes",q,"args",h);H<h.length;++H)h[H]=M.convertArgNoCheck(q[H],h[H],h,H);return a.debug&&console.debug("xWrap() calling: resultType ",d,"xf",Y,"argTypes",q,"args",h),M.convertResultNoCheck(d,Y.apply(null,h))}finally{n.scopedAllocPop(N)}}};const w=function(a,_,d,q,V,Y){if(typeof d=="string"){if(_===1)return Y.get(d);if(_===2){if(q)q instanceof Function||s(V,"requires a function argument.");else return Y.delete(d),a;return Y.set(d,q),a}}s("Invalid arguments to",V)};return n.xWrap.resultAdapter=function a(_,d){return w(a,arguments.length,_,d,"resultAdapter()",te)},n.xWrap.argAdapter=function a(_,d){return w(a,arguments.length,_,d,"argAdapter()",j)},n.xWrap.FuncPtrAdapter=j.FuncPtrAdapter,n.xCallWrapped=function(a,_,d,...q){return Array.isArray(arguments[3])&&(q=arguments[3]),n.xWrap(a,_,d||[]).apply(null,q||[])},n.xWrap.testConvertArg=p.xWrap.convertArg,n.xWrap.testConvertResult=p.xWrap.convertResult,n},globalThis.WhWasmUtilInstaller.yawl=(function(n){const s=()=>fetch(n.uri,{credentials:"same-origin"}),r=this,u=function(P){if(n.wasmUtilTarget){const I=(...R)=>{throw new Error(R.join(" "))},Z=n.wasmUtilTarget;if(Z.module=P.module,Z.instance=P.instance,Z.instance.exports.memory||(Z.memory=n?.imports?.env?.memory||I("Missing 'memory' object!")),!Z.alloc&&P.instance.exports.malloc){const R=P.instance.exports;Z.alloc=function(X){return R.malloc(X)||I("Allocation of",X,"bytes failed.")},Z.dealloc=function(X){X&&R.free(X)}}r(Z)}return P.config=n,n.onload&&n.onload(P),P};return WebAssembly.instantiateStreaming?()=>WebAssembly.instantiateStreaming(s(),n.imports||{}).then(u):()=>s().then(P=>P.arrayBuffer()).then(P=>WebAssembly.instantiate(P,n.imports||{})).then(u)}).bind(globalThis.WhWasmUtilInstaller),globalThis.Jaccwabyt=function i(n){const s=(...A)=>{throw new Error(A.join(" "))};{let A=n.heap;A instanceof WebAssembly.Memory?A=(function(){return new Uint8Array(this.buffer)}).bind(A):A instanceof Function||s("config.heap must be WebAssembly.Memory instance or","a function which returns one."),n.heap=A}["alloc","dealloc"].forEach(function(A){n[A]instanceof Function||s("Config option '"+A+"' must be a function.")});const r=i,u=n.heap,P=n.alloc,I=n.dealloc;n.realloc;const Z=n.log||console.debug.bind(console),R=n.memberPrefix||"",X=n.memberSuffix||"",p=globalThis.BigInt,B=globalThis.BigInt64Array,F=n.bigIntEnabled??!!B;let ie;const y=n.pointerSize||n.ptrSize||(typeof(ie=P(1))=="bigint"?8:4),b=n.pointerIR||n.ptrIR||(y===4?"i32":"i64");ie&&(I(ie),ie=void 0),y!==4&&y!==8&&s("Invalid pointer size:",y),b!=="i32"&&b!=="i64"&&s("Invalid pointer representation:",b);const C=F&&p?A=>p(A||0):A=>s("BigInt support is disabled in this build."),Q=b=="i32"?Number:C,T=Q(0),O=function(...A){let K=T;for(let ee=0;ee<A.length;++ee)K+=Q(A[ee]);return K},f=function(...A){return O(this.pointer,...A)};r.debugFlags||(r.__makeDebugFlags=function(A=null){A&&A.__flags&&(A=A.__flags);const K=function ee(le){return arguments.length===0?ee.__flags:(le<0?(delete ee.__flags.getter,delete ee.__flags.setter,delete ee.__flags.alloc,delete ee.__flags.dealloc):(ee.__flags.getter=(1&le)!==0,ee.__flags.setter=(2&le)!==0,ee.__flags.alloc=(4&le)!==0,ee.__flags.dealloc=(8&le)!==0),ee._flags)};return Object.defineProperty(K,"__flags",{iterable:!1,writable:!1,value:Object.create(A)}),A||K(0),K},r.debugFlags=r.__makeDebugFlags());const m=!0,E=A=>A[1]==="(",j=A=>A==="p"||A==="P"||A==="s",te=A=>A==="P",_e=A=>A?E(A)?"p":A[0]:void 0,Se=function(A){switch(_e(A)){case"c":case"C":return"i8";case"i":return"i32";case"p":case"P":case"s":return b;case"j":return"i64";case"f":return"float";case"d":return"double"}s("Unhandled signature IR:",A)},Ie=function(A){switch(_e(A)){case"c":case"C":return 1;case"i":return 4;case"p":case"P":case"s":return y;case"j":return 8;case"f":return 4;case"d":return 8}s("Unhandled signature sizeof:",A)},ge=B?()=>!0:()=>s("BigInt64Array is not available."),G=function(A){switch(_e(A)){case"p":case"P":case"s":switch(y){case 4:return"getInt32";case 8:return ge()&&"getBigInt64"}break;case"i":return"getInt32";case"c":return"getInt8";case"C":return"getUint8";case"j":return ge()&&"getBigInt64";case"f":return"getFloat32";case"d":return"getFloat64"}s("Unhandled DataView getter for signature:",A)},w=function(A){switch(_e(A)){case"p":case"P":case"s":switch(y){case 4:return"setInt32";case 8:return ge()&&"setBigInt64"}break;case"i":return"setInt32";case"c":return"setInt8";case"C":return"setUint8";case"j":return ge()&&"setBigInt64";case"f":return"setFloat32";case"d":return"setFloat64"}s("Unhandled DataView setter for signature:",A)},a=function(A){switch(_e(A)){case"i":case"f":case"c":case"C":case"d":return Number;case"j":return C;case"p":case"P":case"s":switch(y){case 4:return Number;case 8:return C}break}s("Unhandled DataView set wrapper for signature:",A)},_=(A,K)=>A+"::"+K,d=function(A,K){return()=>s(_(A,K),"is read-only.")},q=function A(K,ee=!0){let le=A.map.get(K);return!le&&ee&&A.map.set(K,le=A.create(K)),le};q.map=new WeakMap,q.create=A=>Object.assign(Object.create(null),{o:A,p:void 0,ownsPointer:!1,zod:!1,xb:0});const V=A=>q.map.delete(A),Y=A=>typeof A=="number"&&A===(A|0)&&A>=0,h=y===4?Y:A=>typeof A=="bigint"&&A>=0||Y(A),N=A=>h(A)&&A>0,H=function(A,K,ee){const le=q(K,!1);if(le){if(V(K),!ee&&!(ee=le.p)){console.warn("Cannot(?) happen: __freeStruct() found no instanceInfo");return}if(Array.isArray(K.ondispose)){let be;for(;be=K.ondispose.pop();)try{be instanceof Function?be.call(K):be instanceof ct?be.dispose():h(be)&&I(be)}catch(je){console.warn("ondispose() for",A.structName,"@",ee,"threw. NOT propagating it.",je)}}else if(K.ondispose instanceof Function)try{K.ondispose()}catch(be){console.warn("ondispose() for",A.structName,"@",ee,"threw. NOT propagating it.",be)}delete K.ondispose,A.debugFlags.__flags.dealloc&&Z("debug.dealloc:",le.ownsPointer?"":"EXTERNAL",A.structName,"instance:",A.structInfo.sizeof,"bytes @"+ee),le.ownsPointer&&((le.zod||A.structInfo.zeroOnDispose)&&u().fill(0,Number(ee),Number(ee)+A.structInfo.sizeof+le.xb),I(ee))}},oe=()=>({configurable:!1,writable:!1,iterable:!1}),g=A=>({...oe(),value:A}),L=function(K,ee,le){let be;const je=De=>{N(De)||s("Invalid pointer value",arguments[0],"for",K.structName,"constructor.")};arguments.length>=3?le&&typeof le=="object"?(be=le,le=be?.wrap):(je(le),be={wrap:le}):be={};const Je=!le;let rt=0,st=!1;if(le)je(le),st=!!be?.takeOwnership;else{const De=be?.extraBytes??0;(De<0||De!==(De|0))&&s("Invalid extraBytes value:",be?.extraBytes),rt=K.structInfo.sizeof+De,le=P(rt)||s("Allocation of",K.structName,"structure failed."),st=!0}try{be?.debugFlags&&ee.debugFlags(be.debugFlags),K.debugFlags.__flags.alloc&&Z("debug.alloc:",Je?"":"EXTERNAL",K.structName,"instance:",K.structInfo.sizeof,"bytes @"+le),Je&&u().fill(0,Number(le),Number(le)+rt);const De=q(ee);De.p=le,De.ownsPointer=st,De.xb=rt?rt-K.structInfo.sizeof:0,De.zod=!!be?.zeroOnDispose,be?.ondispose&&be.ondispose!==le&&ee.addOnDispose(be.ondispose)}catch(De){throw H(K,ee,le),De}},$=function A(K){return A.rxSig1??=/^[ipPsjfdcC]$/,A.rxSig2??=/^[vipPsjfdcC]\([ipPsjfdcC]*\)$/,A.rxSig1.test(K)||A.rxSig2.test(K)},ae=(function(A){let K=this.get(A);return K||(K=[Object.create(null),Object.create(null),Object.create(null)],this.set(A,K)),K}).bind(new WeakMap),re=function(A,K,ee,le){const be=ae(A)[K];return arguments.length===3?be[ee]:le?be[ee]=le:delete be[ee]},pe=function(A,...K){return re(this,0,A,...K)},ke=function(A,K){$(K)&&s(A,"(",K,") collides with a data type signature.")},he=function(A,...K){return ke("Setter adaptor",A),re(this,1,A,...K)},S=function(A,...K){return ke("Struct adaptor",A),re(this,2,A,...K)},x=function(A,K){const ee=typeof K=="string"?re(A,2,K):K;return typeof ee!="object"&&s("Invalid struct mapping object. Arg =",K,JSON.stringify(ee)),ee},W=g(A=>R+A+X),se=function(A,K,ee=!0){let le=A.members[K];if(!le&&(R||X)){for(const be of Object.values(A.members))if(be.key===K){le=be;break}!le&&ee&&s(_(A.name||A.structName,K),"is not a mapped struct member.")}return le},fe=function A(K,ee,le=!1){A._||(A._=je=>je.replace(/[^vipPsjrdcC]/g,"").replace(/[pPscC]/g,"i"));const be=se(K.structInfo,ee,!0);return le?A._(be.signature):be.signature},me=g(function(){const A=[];for(const K of Object.keys(this.structInfo.members))A.push(this.memberKey(K));return A}),de=new TextDecoder("utf-8"),ve=new TextEncoder,Ce=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,ze=function(A,K,ee){return y===8&&(K=Number(K),ee=Number(ee)),de.decode(A.buffer instanceof Ce?A.slice(K,ee):A.subarray(K,ee))},Oe=function(A,K,ee=!1){const le=se(A.structInfo,K,ee);return le&&le.signature.length===1&&le.signature[0]==="s"?le:!1},et=function(A){A.signature!=="s"&&s("Invalid member type signature for C-string value:",JSON.stringify(A))},ut=function(K,ee){const le=se(K.structInfo,ee,!0);et(le);const be=K[le.key];if(!be)return null;let je=be;const Je=u();for(;Je[je]!==0;++je);return be===je?"":ze(Je,be,je)},qt=function(A,...K){A.ondispose?Array.isArray(A.ondispose)||(A.ondispose=[A.ondispose]):A.ondispose=[],A.ondispose.push(...K)},lt=function(A){const K=ve.encode(A),ee=P(K.length+1);ee||s("Allocation error while duplicating string:",A);const le=u();return le.set(K,Number(ee)),le[O(ee,K.length)]=0,ee},Rt=function(A,K,ee){const le=se(A.structInfo,K,!0);et(le);const be=lt(ee);return A[le.key]=be,qt(A,be),A},ct=function(K,ee){arguments[2]!==g&&s("Do not call the StructType constructor","from client-level code."),Object.defineProperties(this,{structName:g(K),structInfo:g(ee)})};ct.prototype=Object.create(null,{dispose:g(function(){H(this.constructor,this)}),lookupMember:g(function(A,K=!0){return se(this.structInfo,A,K)}),memberToJsString:g(function(A){return ut(this,A)}),memberIsString:g(function(A,K=!0){return Oe(this,A,K)}),memberKey:W,memberKeys:me,memberSignature:g(function(A,K=!1){return fe(this,A,K)}),memoryDump:g(function(){const A=this.pointer;return A?new Uint8Array(u().slice(Number(A),Number(A)+this.structInfo.sizeof)):null}),extraBytes:{configurable:!1,enumerable:!1,get:function(){return q(this,!1)?.xb??0}},zeroOnDispose:{configurable:!1,enumerable:!1,get:function(){return q(this,!1)?.zod??!!this.structInfo.zeroOnDispose}},pointer:{configurable:!1,enumerable:!1,get:function(){return q(this,!1)?.p},set:()=>s("Cannot assign the 'pointer' property of a struct.")},setMemberCString:g(function(A,K){return Rt(this,A,K)})}),Object.assign(ct.prototype,{addOnDispose:function(...A){return qt(this,...A),this}}),Object.defineProperties(ct,{allocCString:g(lt),isA:g(A=>A instanceof ct),hasExternalPointer:g(A=>{const K=q(A,!1);return!!(K?.p&&!K?.ownsPointer)}),memberKey:W});const gt=function(A){return A.get||(A.adaptGet?ot.adaptGet(A.adaptGet):void 0)},jt=function(A){return A.set||(A.adaptSet?ot.adaptSet(A.adaptSet):void 0)},Kr=function A(K,ee,le){const be=A.innerStructs??=new Map,je=K.memberKey(ee);le.signature!==void 0&&s("'signature' cannot be used on an embedded struct (",K.structName,".",je,")."),jt(le)&&s("'set' and 'adaptSet' are not permitted for nested struct members."),le.structName??=K.structName+"::"+ee,le.key=je,le.name=ee,le.constructor=this.call(this,le.structName,le);const Je=gt(le),rt=Object.assign(Object.create(null),{configurable:!1,enumerable:!1,set:d(K.structName,je),get:function(){const st=this.debugFlags.__flags,De=this.pointer,Ye=De+"."+je;let Ee=be.get(Ye);return st.getter&&Z("debug.getter: k =",Ye),Ee||(Ee=new le.constructor(O(De,le.offset)),be.set(Ye,Ee),this.addOnDispose(()=>Ee.dispose()),Ee.addOnDispose(()=>be.delete(Ye))),Je&&(Ee=Je.apply(this,[Ee,je])),st.getter&&Z("debug.getter: result =",Ee),Ee}});Object.defineProperty(K.prototype,je,rt)},Jr=function A(K,ee,le){if(le=x(this,le),le.members)return Kr.call(this,K,ee,le);if(!A.cache){A.cache={getters:{},setters:{},sw:{}};const Ye=["i","c","C","p","P","s","f","d","v()"];F&&Ye.push("j"),Ye.forEach(function(Ee){A.cache.getters[Ee]=G(Ee),A.cache.setters[Ee]=w(Ee),A.cache.sw[Ee]=a(Ee)}),A.sigCheck=function(Ee,Ke,Ut,Tn){Object.prototype.hasOwnProperty.call(Ee,Ut)&&s(Ee.structName,"already has a property named",Ut+"."),$(Tn)||s("Malformed signature for",_(Ee.structName,Ke)+":",Tn)}}const be=K.memberKey(ee);A.sigCheck(K.prototype,ee,be,le.signature),le.key=be,le.name=ee;const je=_e(le.signature),Je=_(K.structName,be),rt=K.debugFlags.__flags,st=gt(le),De=Object.create(null);if(De.configurable=!1,De.enumerable=!1,De.get=function(){rt.getter&&Z("debug.getter:",A.cache.getters[je],"for",Se(je),Je,"@",this.pointer,"+",le.offset,"sz",le.sizeof);let Ye=new DataView(u().buffer,Number(this.pointer)+le.offset,le.sizeof)[A.cache.getters[je]](0,m);return st&&(Ye=st.apply(this,[be,Ye])),rt.getter&&Z("debug.getter:",Je,"result =",Ye),Ye},le.readOnly)De.set=d(K.prototype.structName,be);else{const Ye=jt(le);De.set=function(Ee){rt.setter&&Z("debug.setter:",A.cache.setters[je],"for",Se(je),Je,"@",this.pointer,"+",le.offset,"sz",le.sizeof,Ee),this.pointer||s("Cannot set native property on a disposed",this.structName,"instance."),Ye&&(Ee=Ye.apply(this,[be,Ee])),Ee==null?Ee=T:j(le.signature)&&!h(Ee)&&(te(le.signature)&&Ee instanceof ct?(Ee=Ee.pointer||T,rt.setter&&Z("debug.setter:",Je,"resolved to",Ee)):s("Invalid value for pointer-type",Je+".")),new DataView(u().buffer,Number(this.pointer)+le.offset,le.sizeof)[A.cache.setters[je]](0,A.cache.sw[je](Ee),m)}}Object.defineProperty(K.prototype,be,De)},Sn=function A(K,ee,le=Object.create(null)){const be=function Ee(Ke){this instanceof Ee||s("The",K,"constructor may only be called via 'new'."),L(Ee,this,...arguments)},je=this,Je=Ee=>typeof Ee=="string"&&$(Ee)?{signature:Ee}:x(je,Ee);arguments.length===1?(ee=Je(K),K=ee.structName||ee.name):arguments.length===2?(ee=Je(ee),ee.name??=K):ee=Je(ee),K??=ee.structName,K??=le.structName,K||s("One of 'name' or 'structName' are required."),ee.adapt&&(Object.keys(ee.adapt.struct||{}).forEach(Ee=>{S.call(A,Ee,ee.adapt.struct[Ee])}),Object.keys(ee.adapt.set||{}).forEach(Ee=>{he.call(A,Ee,ee.adapt.set[Ee])}),Object.keys(ee.adapt.get||{}).forEach(Ee=>{pe.call(A,Ee,ee.adapt.get[Ee])})),!ee.members&&!ee.sizeof&&(ee.sizeof=Ie(ee.signature));const rt=g(r.__makeDebugFlags(ot.debugFlags));Object.defineProperties(be,{debugFlags:rt,isA:g(Ee=>Ee instanceof be),memberKey:W,memberKeys:me,structInfo:g(ee),structName:g(K),ptrAdd:g(O)}),be.prototype=new ct(K,ee,g),Object.defineProperties(be.prototype,{debugFlags:rt,constructor:g(be),ptrAdd:g(f)});let st=!1,De=0;const Ye=!!ee.autoCalcSizeOffset;return Ye||ee.sizeof||s(K,"description is missing its sizeof property."),ee.offset??=0,Object.keys(ee.members||{}).forEach(Ee=>{let Ke=Je(ee.members[Ee]);!Ke.members&&!Ke.sizeof&&(Ke.sizeof=Ie(Ke.signature),Ke.sizeof||s(_(K,Ee),"is missing a sizeof property.",Ke)),Ke.offset===void 0&&(Ye?Ke.offset=De:s(_(K,Ee),"is missing its offset.",JSON.stringify(Ke))),ee.members[Ee]=Ke,(!st||st.offset<Ke.offset)&&(st=Ke);const Ut=!!Ke.autoCalc;Ye&&(Ke.autoCalcSizeOffset=!0),Jr.call(je,be,Ee,Ke),Ut?Ke.autoCalcSizeOffset=!0:delete Ke.autoCalcSizeOffset,De+=Ke.sizeof}),st||s("No member property descriptions found."),ee.sizeof||(ee.sizeof=De),ee.sizeof===1?ee.signature==="c"||ee.signature==="C"||s("Unexpected sizeof==1 member",_(K,k),"with signature",ee.signature):(ee.sizeof%4!==0&&(console.warn("Invalid struct member description",ee),s(K,"sizeof is not aligned. sizeof="+ee.sizeof)),ee.offset%4!==0&&(console.warn("Invalid struct member description",ee),s(K,"offset is not aligned. offset="+ee.offset))),ee.sizeof<De&&(console.warn("Suspect struct description:",ee,"offset =",De),s("Mismatch in the calculated vs. the provided sizeof/offset info.","Expected sizeof",De,"but got",ee.sizeof,"for",ee)),delete ee.autoCalcSizeOffset,be},ot=function A(K,ee){return arguments.length==1?Sn.call(A,K):Sn.call(A,K,ee)};return ot.StructType=ct,ot.config=n,ot.allocCString=lt,ot.adaptGet=pe,ot.adaptSet=he,ot.adaptStruct=S,ot.ptrAdd=O,ot.debugFlags||(ot.debugFlags=r.__makeDebugFlags(r.debugFlags)),ot},globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const n=(...y)=>{throw new Error(y.join(" "))},s=i.capi,r=i.wasm,u=i.util;globalThis.WhWasmUtilInstaller(r),delete globalThis.WhWasmUtilInstaller;const P={core:[["sqlite3_aggregate_context","void*","sqlite3_context*","int"],["sqlite3_bind_double","int","sqlite3_stmt*","int","f64"],["sqlite3_bind_int","int","sqlite3_stmt*","int","int"],["sqlite3_bind_null",void 0,"sqlite3_stmt*","int"],["sqlite3_bind_parameter_count","int","sqlite3_stmt*"],["sqlite3_bind_parameter_index","int","sqlite3_stmt*","string"],["sqlite3_bind_parameter_name","string","sqlite3_stmt*","int"],["sqlite3_bind_pointer","int","sqlite3_stmt*","int","*","string:static","*"],["sqlite3_busy_handler","int",["sqlite3*",new r.xWrap.FuncPtrAdapter({signature:"i(pi)",contextKey:(y,b)=>y[0]}),"*"]],["sqlite3_busy_timeout","int","sqlite3*","int"],["sqlite3_changes","int","sqlite3*"],["sqlite3_clear_bindings","int","sqlite3_stmt*"],["sqlite3_collation_needed","int","sqlite3*","*","*"],["sqlite3_column_blob","*","sqlite3_stmt*","int"],["sqlite3_column_bytes","int","sqlite3_stmt*","int"],["sqlite3_column_count","int","sqlite3_stmt*"],["sqlite3_column_decltype","string","sqlite3_stmt*","int"],["sqlite3_column_double","f64","sqlite3_stmt*","int"],["sqlite3_column_int","int","sqlite3_stmt*","int"],["sqlite3_column_name","string","sqlite3_stmt*","int"],["sqlite3_column_type","int","sqlite3_stmt*","int"],["sqlite3_column_value","sqlite3_value*","sqlite3_stmt*","int"],["sqlite3_commit_hook","void*",["sqlite3*",new r.xWrap.FuncPtrAdapter({name:"sqlite3_commit_hook",signature:"i(p)",contextKey:y=>y[0]}),"*"]],["sqlite3_compileoption_get","string","int"],["sqlite3_compileoption_used","int","string"],["sqlite3_complete","int","string:flexible"],["sqlite3_context_db_handle","sqlite3*","sqlite3_context*"],["sqlite3_data_count","int","sqlite3_stmt*"],["sqlite3_db_filename","string","sqlite3*","string"],["sqlite3_db_handle","sqlite3*","sqlite3_stmt*"],["sqlite3_db_name","string","sqlite3*","int"],["sqlite3_db_readonly","int","sqlite3*","string"],["sqlite3_db_status","int","sqlite3*","int","*","*","int"],["sqlite3_errcode","int","sqlite3*"],["sqlite3_errmsg","string","sqlite3*"],["sqlite3_error_offset","int","sqlite3*"],["sqlite3_errstr","string","int"],["sqlite3_exec","int",["sqlite3*","string:flexible",new r.xWrap.FuncPtrAdapter({signature:"i(pipp)",bindScope:"transient",callProxy:y=>{let b;return(C,Q,T,O)=>{try{const f=r.cArgvToJs(Q,T);return b||(b=r.cArgvToJs(Q,O)),y(f,b)|0}catch(f){return f.resultCode||s.SQLITE_ERROR}}}}),"*","**"]],["sqlite3_expanded_sql","string","sqlite3_stmt*"],["sqlite3_extended_errcode","int","sqlite3*"],["sqlite3_extended_result_codes","int","sqlite3*","int"],["sqlite3_file_control","int","sqlite3*","string","int","*"],["sqlite3_finalize","int","sqlite3_stmt*"],["sqlite3_free",void 0,"*"],["sqlite3_get_autocommit","int","sqlite3*"],["sqlite3_get_auxdata","*","sqlite3_context*","int"],["sqlite3_initialize",void 0],["sqlite3_interrupt",void 0,"sqlite3*"],["sqlite3_is_interrupted","int","sqlite3*"],["sqlite3_keyword_count","int"],["sqlite3_keyword_name","int",["int","**","*"]],["sqlite3_keyword_check","int",["string","int"]],["sqlite3_libversion","string"],["sqlite3_libversion_number","int"],["sqlite3_limit","int",["sqlite3*","int","int"]],["sqlite3_malloc","*","int"],["sqlite3_next_stmt","sqlite3_stmt*",["sqlite3*","sqlite3_stmt*"]],["sqlite3_open","int","string","*"],["sqlite3_open_v2","int","string","*","int","string"],["sqlite3_realloc","*","*","int"],["sqlite3_reset","int","sqlite3_stmt*"],["sqlite3_result_blob",void 0,"sqlite3_context*","*","int","*"],["sqlite3_result_double",void 0,"sqlite3_context*","f64"],["sqlite3_result_error",void 0,"sqlite3_context*","string","int"],["sqlite3_result_error_code",void 0,"sqlite3_context*","int"],["sqlite3_result_error_nomem",void 0,"sqlite3_context*"],["sqlite3_result_error_toobig",void 0,"sqlite3_context*"],["sqlite3_result_int",void 0,"sqlite3_context*","int"],["sqlite3_result_null",void 0,"sqlite3_context*"],["sqlite3_result_pointer",void 0,"sqlite3_context*","*","string:static","*"],["sqlite3_result_subtype",void 0,"sqlite3_value*","int"],["sqlite3_result_text",void 0,"sqlite3_context*","string","int","*"],["sqlite3_result_zeroblob",void 0,"sqlite3_context*","int"],["sqlite3_rollback_hook","void*",["sqlite3*",new r.xWrap.FuncPtrAdapter({name:"sqlite3_rollback_hook",signature:"v(p)",contextKey:y=>y[0]}),"*"]],["sqlite3_set_auxdata",void 0,["sqlite3_context*","int","*","*"]],["sqlite3_set_errmsg","int","sqlite3*","int","string"],["sqlite3_shutdown",void 0],["sqlite3_sourceid","string"],["sqlite3_sql","string","sqlite3_stmt*"],["sqlite3_status","int","int","*","*","int"],["sqlite3_step","int","sqlite3_stmt*"],["sqlite3_stmt_busy","int","sqlite3_stmt*"],["sqlite3_stmt_readonly","int","sqlite3_stmt*"],["sqlite3_stmt_status","int","sqlite3_stmt*","int","int"],["sqlite3_strglob","int","string","string"],["sqlite3_stricmp","int","string","string"],["sqlite3_strlike","int","string","string","int"],["sqlite3_strnicmp","int","string","string","int"],["sqlite3_table_column_metadata","int","sqlite3*","string","string","string","**","**","*","*","*"],["sqlite3_total_changes","int","sqlite3*"],["sqlite3_trace_v2","int",["sqlite3*","int",new r.xWrap.FuncPtrAdapter({name:"sqlite3_trace_v2::callback",signature:"i(ippp)",contextKey:(y,b)=>y[0]}),"*"]],["sqlite3_txn_state","int",["sqlite3*","string"]],["sqlite3_uri_boolean","int","sqlite3_filename","string","int"],["sqlite3_uri_key","string","sqlite3_filename","int"],["sqlite3_uri_parameter","string","sqlite3_filename","string"],["sqlite3_user_data","void*","sqlite3_context*"],["sqlite3_value_blob","*","sqlite3_value*"],["sqlite3_value_bytes","int","sqlite3_value*"],["sqlite3_value_double","f64","sqlite3_value*"],["sqlite3_value_dup","sqlite3_value*","sqlite3_value*"],["sqlite3_value_free",void 0,"sqlite3_value*"],["sqlite3_value_frombind","int","sqlite3_value*"],["sqlite3_value_int","int","sqlite3_value*"],["sqlite3_value_nochange","int","sqlite3_value*"],["sqlite3_value_numeric_type","int","sqlite3_value*"],["sqlite3_value_pointer","*","sqlite3_value*","string:static"],["sqlite3_value_subtype","int","sqlite3_value*"],["sqlite3_value_type","int","sqlite3_value*"],["sqlite3_vfs_find","*","string"],["sqlite3_vfs_register","int","sqlite3_vfs*","int"],["sqlite3_vfs_unregister","int","sqlite3_vfs*"]],int64:[["sqlite3_bind_int64","int",["sqlite3_stmt*","int","i64"]],["sqlite3_changes64","i64",["sqlite3*"]],["sqlite3_column_int64","i64",["sqlite3_stmt*","int"]],["sqlite3_deserialize","int","sqlite3*","string","*","i64","i64","int"],["sqlite3_last_insert_rowid","i64",["sqlite3*"]],["sqlite3_malloc64","*","i64"],["sqlite3_msize","i64","*"],["sqlite3_overload_function","int",["sqlite3*","string","int"]],["sqlite3_realloc64","*","*","i64"],["sqlite3_result_int64",void 0,"*","i64"],["sqlite3_result_zeroblob64","int","*","i64"],["sqlite3_serialize","*","sqlite3*","string","*","int"],["sqlite3_set_last_insert_rowid",void 0,["sqlite3*","i64"]],["sqlite3_status64","int","int","*","*","int"],["sqlite3_db_status64","int","sqlite3*","int","*","*","int"],["sqlite3_total_changes64","i64",["sqlite3*"]],["sqlite3_update_hook","*",["sqlite3*",new r.xWrap.FuncPtrAdapter({name:"sqlite3_update_hook::callback",signature:"v(pippj)",contextKey:y=>y[0],callProxy:y=>(b,C,Q,T,O)=>{y(b,C,r.cstrToJs(Q),r.cstrToJs(T),O)}}),"*"]],["sqlite3_uri_int64","i64",["sqlite3_filename","string","i64"]],["sqlite3_value_int64","i64","sqlite3_value*"]],wasmInternal:[["sqlite3__wasm_db_reset","int","sqlite3*"],["sqlite3__wasm_db_vfs","sqlite3_vfs*","sqlite3*","string"],["sqlite3__wasm_vfs_create_file","int","sqlite3_vfs*","string","*","int"],["sqlite3__wasm_posix_create_file","int","string","*","int"],["sqlite3__wasm_vfs_unlink","int","sqlite3_vfs*","string"],["sqlite3__wasm_qfmt_token","string:dealloc","string","int"]]};if(r.exports.sqlite3_progress_handler&&P.core.push(["sqlite3_progress_handler",void 0,["sqlite3*","int",new r.xWrap.FuncPtrAdapter({name:"xProgressHandler",signature:"i(p)",bindScope:"context",contextKey:(y,b)=>y[0]}),"*"]]),r.exports.sqlite3_stmt_explain&&P.core.push(["sqlite3_stmt_explain","int","sqlite3_stmt*","int"],["sqlite3_stmt_isexplain","int","sqlite3_stmt*"]),r.exports.sqlite3_set_authorizer&&P.core.push(["sqlite3_set_authorizer","int",["sqlite3*",new r.xWrap.FuncPtrAdapter({name:"sqlite3_set_authorizer::xAuth",signature:"i(pissss)",contextKey:(y,b)=>y[0],callProxy:y=>(b,C,Q,T,O,f)=>{try{return Q=Q&&r.cstrToJs(Q),T=T&&r.cstrToJs(T),O=O&&r.cstrToJs(O),f=f&&r.cstrToJs(f),y(b,C,Q,T,O,f)|0}catch(m){return m.resultCode||s.SQLITE_ERROR}}}),"*"]]),r.exports.sqlite3_column_origin_name&&P.core.push(["sqlite3_column_database_name","string","sqlite3_stmt*","int"],["sqlite3_column_origin_name","string","sqlite3_stmt*","int"],["sqlite3_column_table_name","string","sqlite3_stmt*","int"]),r.bigIntEnabled&&r.exports.sqlite3_declare_vtab&&P.int64.push(["sqlite3_create_module","int",["sqlite3*","string","sqlite3_module*","*"]],["sqlite3_create_module_v2","int",["sqlite3*","string","sqlite3_module*","*","*"]],["sqlite3_declare_vtab","int",["sqlite3*","string:flexible"]],["sqlite3_drop_modules","int",["sqlite3*","**"]],["sqlite3_vtab_collation","string","sqlite3_index_info*","int"],["sqlite3_vtab_distinct","int","sqlite3_index_info*"],["sqlite3_vtab_in","int","sqlite3_index_info*","int","int"],["sqlite3_vtab_in_first","int","sqlite3_value*","**"],["sqlite3_vtab_in_next","int","sqlite3_value*","**"],["sqlite3_vtab_nochange","int","sqlite3_context*"],["sqlite3_vtab_on_conflict","int","sqlite3*"],["sqlite3_vtab_rhs_value","int","sqlite3_index_info*","int","**"]),r.bigIntEnabled&&r.exports.sqlite3_preupdate_hook&&P.int64.push(["sqlite3_preupdate_blobwrite","int","sqlite3*"],["sqlite3_preupdate_count","int","sqlite3*"],["sqlite3_preupdate_depth","int","sqlite3*"],["sqlite3_preupdate_hook","*",["sqlite3*",new r.xWrap.FuncPtrAdapter({name:"sqlite3_preupdate_hook",signature:"v(ppippjj)",contextKey:y=>y[0],callProxy:y=>(b,C,Q,T,O,f,m)=>{y(b,C,Q,r.cstrToJs(T),r.cstrToJs(O),f,m)}}),"*"]],["sqlite3_preupdate_new","int",["sqlite3*","int","**"]],["sqlite3_preupdate_old","int",["sqlite3*","int","**"]]),r.bigIntEnabled&&r.exports.sqlite3changegroup_add&&r.exports.sqlite3session_create&&r.exports.sqlite3_preupdate_hook){const y={signature:"i(ps)",callProxy:b=>(C,Q)=>{try{return b(C,r.cstrToJs(Q))|0}catch(T){return T.resultCode||s.SQLITE_ERROR}}};P.int64.push(["sqlite3changegroup_add","int",["sqlite3_changegroup*","int","void*"]],["sqlite3changegroup_add_strm","int",["sqlite3_changegroup*",new r.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changegroup_delete",void 0,["sqlite3_changegroup*"]],["sqlite3changegroup_new","int",["**"]],["sqlite3changegroup_output","int",["sqlite3_changegroup*","int*","**"]],["sqlite3changegroup_output_strm","int",["sqlite3_changegroup*",new r.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply","int",["sqlite3*","int","void*",new r.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...y}),new r.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_strm","int",["sqlite3*",new r.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new r.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...y}),new r.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_v2","int",["sqlite3*","int","void*",new r.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...y}),new r.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v2_strm","int",["sqlite3*",new r.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new r.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...y}),new r.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v3","int",["sqlite3*","int","void*",new r.xWrap.FuncPtrAdapter({name:"xFilter",signature:"i(pp)",bindScope:"transient"}),new r.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v3_strm","int",["sqlite3*",new r.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new r.xWrap.FuncPtrAdapter({name:"xFilter",signature:"i(pp)",bindScope:"transient"}),new r.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_concat","int",["int","void*","int","void*","int*","**"]],["sqlite3changeset_concat_strm","int",[new r.xWrap.FuncPtrAdapter({name:"xInputA",signature:"i(ppp)",bindScope:"transient"}),"void*",new r.xWrap.FuncPtrAdapter({name:"xInputB",signature:"i(ppp)",bindScope:"transient"}),"void*",new r.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_conflict","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_finalize","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_fk_conflicts","int",["sqlite3_changeset_iter*","int*"]],["sqlite3changeset_invert","int",["int","void*","int*","**"]],["sqlite3changeset_invert_strm","int",[new r.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new r.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_new","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_next","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_old","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_op","int",["sqlite3_changeset_iter*","**","int*","int*","int*"]],["sqlite3changeset_pk","int",["sqlite3_changeset_iter*","**","int*"]],["sqlite3changeset_start","int",["**","int","*"]],["sqlite3changeset_start_strm","int",["**",new r.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changeset_start_v2","int",["**","int","*","int"]],["sqlite3changeset_start_v2_strm","int",["**",new r.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*","int"]],["sqlite3session_attach","int",["sqlite3_session*","string"]],["sqlite3session_changeset","int",["sqlite3_session*","int*","**"]],["sqlite3session_changeset_size","i64",["sqlite3_session*"]],["sqlite3session_changeset_strm","int",["sqlite3_session*",new r.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_config","int",["int","void*"]],["sqlite3session_create","int",["sqlite3*","string","**"]],["sqlite3session_diff","int",["sqlite3_session*","string","string","**"]],["sqlite3session_enable","int",["sqlite3_session*","int"]],["sqlite3session_indirect","int",["sqlite3_session*","int"]],["sqlite3session_isempty","int",["sqlite3_session*"]],["sqlite3session_memory_used","i64",["sqlite3_session*"]],["sqlite3session_object_config","int",["sqlite3_session*","int","void*"]],["sqlite3session_patchset","int",["sqlite3_session*","*","**"]],["sqlite3session_patchset_strm","int",["sqlite3_session*",new r.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_table_filter",void 0,["sqlite3_session*",new r.xWrap.FuncPtrAdapter({name:"xFilter",...y,contextKey:(b,C)=>b[0]}),"*"]])}i.StructBinder=globalThis.Jaccwabyt({heap:r.heap8u,alloc:r.alloc,dealloc:r.dealloc,bigIntEnabled:r.bigIntEnabled,pointerIR:r.ptr.ir,memberPrefix:"$"}),delete globalThis.Jaccwabyt;{const y=r.xWrap.argAdapter("string");r.xWrap.argAdapter("string:flexible",T=>y(u.flexibleString(T))),r.xWrap.argAdapter("string:static",(function(T){return r.isPtr(T)?T:(T=""+T,this[T]||(this[T]=r.allocCString(T)))}).bind(Object.create(null)));const b=r.xWrap.argAdapter("*"),C=function(){};r.xWrap.argAdapter("sqlite3_filename",b)("sqlite3_context*",b)("sqlite3_value*",b)("void*",b)("sqlite3_changegroup*",b)("sqlite3_changeset_iter*",b)("sqlite3_session*",b)("sqlite3_stmt*",T=>b(T instanceof(i?.oo1?.Stmt||C)?T.pointer:T))("sqlite3*",T=>b(T instanceof(i?.oo1?.DB||C)?T.pointer:T))("sqlite3_vfs*",T=>typeof T=="string"?s.sqlite3_vfs_find(T)||i.SQLite3Error.toss(s.SQLITE_NOTFOUND,"Unknown sqlite3_vfs name:",T):b(T instanceof(s.sqlite3_vfs||C)?T.pointer:T)),r.exports.sqlite3_declare_vtab&&r.xWrap.argAdapter("sqlite3_index_info*",T=>b(T instanceof(s.sqlite3_index_info||C)?T.pointer:T))("sqlite3_module*",T=>b(T instanceof(s.sqlite3_module||C)?T.pointer:T));const Q=r.xWrap.resultAdapter("*");r.xWrap.resultAdapter("sqlite3*",Q)("sqlite3_context*",Q)("sqlite3_stmt*",Q)("sqlite3_value*",Q)("sqlite3_vfs*",Q)("void*",Q);for(const T of P.core)s[T[0]]=r.xWrap.apply(null,T);for(const T of P.wasmInternal)u[T[0]]=r.xWrap.apply(null,T);for(const T of P.int64)s[T[0]]=r.bigIntEnabled?r.xWrap.apply(null,T):()=>n(T[0]+"() is unavailable due to lack","of BigInt support in this build.");delete P.core,delete P.int64,delete P.wasmInternal,u.sqlite3__wasm_db_error=function(T,O,f){return T?(O instanceof i.WasmAllocError?(O=s.SQLITE_NOMEM,f=0):O instanceof Error&&(f=f||""+O,O=O.resultCode||s.SQLITE_ERROR),s.sqlite3_set_errmsg(T,O,f)||O):s.SQLITE_MISUSE}}{const y=r.xCall("sqlite3__wasm_enum_json");y||n("Maintenance required: increase sqlite3__wasm_enum_json()'s","static buffer size!"),r.ctype=JSON.parse(r.cstrToJs(y));const b=["access","authorizer","blobFinalizers","changeset","config","dataTypes","dbConfig","dbStatus","encodings","fcntl","flock","ioCap","limits","openFlags","prepareFlags","resultCodes","sqlite3Status","stmtStatus","syncFlags","trace","txnState","udfFlags","version"];r.bigIntEnabled&&b.push("serialize","session","vtab");for(const T of b)for(const O of Object.entries(r.ctype[T]))s[O[0]]=O[1];r.functionEntry(s.SQLITE_WASM_DEALLOC)||n("Internal error: cannot resolve exported function","entry SQLITE_WASM_DEALLOC (=="+s.SQLITE_WASM_DEALLOC+").");const C=Object.create(null);for(const T of Object.entries(r.ctype.resultCodes))C[T[1]]=T[0];s.sqlite3_js_rc_str=T=>C[T];const Q=Object.assign(Object.create(null),{WasmTestStruct:!0,sqlite3_index_info:!r.bigIntEnabled,sqlite3_index_constraint:!r.bigIntEnabled,sqlite3_index_orderby:!r.bigIntEnabled,sqlite3_index_constraint_usage:!r.bigIntEnabled});for(const T of r.ctype.structs)Q[T.name]||(s[T.name]=i.StructBinder(T));if(s.sqlite3_index_info){for(const T of["sqlite3_index_constraint","sqlite3_index_orderby","sqlite3_index_constraint_usage"])s.sqlite3_index_info[T]=s[T],delete s[T];s.sqlite3_vtab_config=r.xWrap("sqlite3__wasm_vtab_config","int",["sqlite3*","int","int"])}}const I=(y,b,C)=>u.sqlite3__wasm_db_error(y,s.SQLITE_MISUSE,b+"() requires "+C+" argument"+(C===1?"":"s")+"."),Z=y=>u.sqlite3__wasm_db_error(y,s.SQLITE_FORMAT,"SQLITE_UTF8 is the only supported encoding."),R=y=>r.xWrap.argAdapter("sqlite3*")(y),X=y=>r.isPtr(y)?r.cstrToJs(y):y,p=(function(y,b){y=R(y);let C=this.dbMap.get(y);if(b)!C&&b>0&&this.dbMap.set(y,C=Object.create(null));else return this.dbMap.delete(y),C;return C}).bind(Object.assign(Object.create(null),{dbMap:new Map}));p.addCollation=function(y,b){const C=p(y,1);C.collation||(C.collation=new Set),C.collation.add(X(b).toLowerCase())},p._addUDF=function(y,b,C,Q){b=X(b).toLowerCase();let T=Q.get(b);T||Q.set(b,T=new Set),T.add(C<0?-1:C)},p.addFunction=function(y,b,C){const Q=p(y,1);Q.udf||(Q.udf=new Map),this._addUDF(y,b,C,Q.udf)},r.exports.sqlite3_create_window_function&&(p.addWindowFunc=function(y,b,C){const Q=p(y,1);Q.wudf||(Q.wudf=new Map),this._addUDF(y,b,C,Q.wudf)}),p.cleanup=function(y){y=R(y);for(const Q of[["sqlite3_busy_handler",3],["sqlite3_commit_hook",3],["sqlite3_preupdate_hook",3],["sqlite3_progress_handler",4],["sqlite3_rollback_hook",3],["sqlite3_set_authorizer",3],["sqlite3_trace_v2",4],["sqlite3_update_hook",3]]){const[T,O]=Q;if(!r.exports[T])continue;const f=[y];f.length=O;try{s[T](...f)}catch(m){i.config.warn("close-time call of",T+"(",f,") threw:",m)}}const b=p(y,0);if(!b)return;if(b.collation){for(const Q of b.collation)try{s.sqlite3_create_collation_v2(y,Q,s.SQLITE_UTF8,0,0,0)}catch{}delete b.collation}let C;for(C=0;C<2;++C){const Q=C?b.wudf:b.udf;if(!Q)continue;const T=C?s.sqlite3_create_window_function:s.sqlite3_create_function_v2;for(const O of Q){const f=O[0],m=O[1],E=[y,f,0,s.SQLITE_UTF8,0,0,0,0,0];C&&E.push(0);for(const j of m)try{E[2]=j,T.apply(null,E)}catch{}m.clear()}Q.clear()}delete b.udf,delete b.wudf};{const y=r.xWrap("sqlite3_close_v2","int","sqlite3*");s.sqlite3_close_v2=function(b){if(arguments.length!==1)return I(b,"sqlite3_close_v2",1);if(b)try{p.cleanup(b)}catch{}return y(b)}}if(s.sqlite3session_create){const y=r.xWrap("sqlite3session_delete",void 0,["sqlite3_session*"]);s.sqlite3session_delete=function(b){if(arguments.length!==1)return I(pDb,"sqlite3session_delete",1);b&&s.sqlite3session_table_filter(b,0,0),y(b)}}{const y=(C,Q)=>"argv["+Q+"]:"+C[0]+":"+r.cstrToJs(C[1]).toLowerCase(),b=r.xWrap("sqlite3_create_collation_v2","int",["sqlite3*","string","int","*",new r.xWrap.FuncPtrAdapter({name:"xCompare",signature:"i(pipip)",contextKey:y}),new r.xWrap.FuncPtrAdapter({name:"xDestroy",signature:"v(p)",contextKey:y})]);s.sqlite3_create_collation_v2=function(C,Q,T,O,f,m){if(arguments.length!==6)return I(C,"sqlite3_create_collation_v2",6);if((T&15)===0)T|=s.SQLITE_UTF8;else if(s.SQLITE_UTF8!==(T&15))return Z(C);try{const E=b(C,Q,T,O,f,m);return E===0&&f instanceof Function&&p.addCollation(C,Q),E}catch(E){return u.sqlite3__wasm_db_error(C,E)}},s.sqlite3_create_collation=(C,Q,T,O,f)=>arguments.length===5?s.sqlite3_create_collation_v2(C,Q,T,O,f,0):I(C,"sqlite3_create_collation",5)}{const y=function(T,O){return T[0]+":"+(T[2]<0?-1:T[2])+":"+O+":"+r.cstrToJs(T[1]).toLowerCase()},b=Object.assign(Object.create(null),{xInverseAndStep:{signature:"v(pip)",contextKey:y,callProxy:T=>(O,f,m)=>{try{T(O,...s.sqlite3_values_to_js(f,m))}catch(E){s.sqlite3_result_error_js(O,E)}}},xFinalAndValue:{signature:"v(p)",contextKey:y,callProxy:T=>O=>{try{s.sqlite3_result_js(O,T(O))}catch(f){s.sqlite3_result_error_js(O,f)}}},xFunc:{signature:"v(pip)",contextKey:y,callProxy:T=>(O,f,m)=>{try{s.sqlite3_result_js(O,T(O,...s.sqlite3_values_to_js(f,m)))}catch(E){s.sqlite3_result_error_js(O,E)}}},xDestroy:{signature:"v(p)",contextKey:y,callProxy:T=>O=>{try{T(O)}catch(f){console.error("UDF xDestroy method threw:",f)}}}}),C=r.xWrap("sqlite3_create_function_v2","int",["sqlite3*","string","int","int","*",new r.xWrap.FuncPtrAdapter({name:"xFunc",...b.xFunc}),new r.xWrap.FuncPtrAdapter({name:"xStep",...b.xInverseAndStep}),new r.xWrap.FuncPtrAdapter({name:"xFinal",...b.xFinalAndValue}),new r.xWrap.FuncPtrAdapter({name:"xDestroy",...b.xDestroy})]),Q=r.exports.sqlite3_create_window_function?r.xWrap("sqlite3_create_window_function","int",["sqlite3*","string","int","int","*",new r.xWrap.FuncPtrAdapter({name:"xStep",...b.xInverseAndStep}),new r.xWrap.FuncPtrAdapter({name:"xFinal",...b.xFinalAndValue}),new r.xWrap.FuncPtrAdapter({name:"xValue",...b.xFinalAndValue}),new r.xWrap.FuncPtrAdapter({name:"xInverse",...b.xInverseAndStep}),new r.xWrap.FuncPtrAdapter({name:"xDestroy",...b.xDestroy})]):void 0;s.sqlite3_create_function_v2=function T(O,f,m,E,j,te,_e,Se,Ie){if(T.length!==arguments.length)return I(O,"sqlite3_create_function_v2",T.length);if((E&15)===0)E|=s.SQLITE_UTF8;else if(s.SQLITE_UTF8!==(E&15))return Z(O);try{const ge=C(O,f,m,E,j,te,_e,Se,Ie);return ge===0&&(te instanceof Function||_e instanceof Function||Se instanceof Function||Ie instanceof Function)&&p.addFunction(O,f,m),ge}catch(ge){return console.error("sqlite3_create_function_v2() setup threw:",ge),u.sqlite3__wasm_db_error(O,ge,"Creation of UDF threw: "+ge)}},s.sqlite3_create_function=function T(O,f,m,E,j,te,_e,Se){return T.length===arguments.length?s.sqlite3_create_function_v2(O,f,m,E,j,te,_e,Se,0):I(O,"sqlite3_create_function",T.length)},Q?s.sqlite3_create_window_function=function T(O,f,m,E,j,te,_e,Se,Ie,ge){if(T.length!==arguments.length)return I(O,"sqlite3_create_window_function",T.length);if((E&15)===0)E|=s.SQLITE_UTF8;else if(s.SQLITE_UTF8!==(E&15))return Z(O);try{const G=Q(O,f,m,E,j,te,_e,Se,Ie,ge);return G===0&&(te instanceof Function||_e instanceof Function||Se instanceof Function||Ie instanceof Function||ge instanceof Function)&&p.addWindowFunc(O,f,m),G}catch(G){return console.error("sqlite3_create_window_function() setup threw:",G),u.sqlite3__wasm_db_error(O,G,"Creation of UDF threw: "+G)}}:delete s.sqlite3_create_window_function,s.sqlite3_create_function_v2.udfSetResult=s.sqlite3_create_function.udfSetResult=s.sqlite3_result_js,s.sqlite3_create_window_function&&(s.sqlite3_create_window_function.udfSetResult=s.sqlite3_result_js),s.sqlite3_create_function_v2.udfConvertArgs=s.sqlite3_create_function.udfConvertArgs=s.sqlite3_values_to_js,s.sqlite3_create_window_function&&(s.sqlite3_create_window_function.udfConvertArgs=s.sqlite3_values_to_js),s.sqlite3_create_function_v2.udfSetError=s.sqlite3_create_function.udfSetError=s.sqlite3_result_error_js,s.sqlite3_create_window_function&&(s.sqlite3_create_window_function.udfSetError=s.sqlite3_result_error_js)}{const y=(C,Q)=>(typeof C=="string"?Q=-1:u.isSQLableTypedArray(C)?(Q=C.byteLength,C=r.typedArrayToString(C instanceof ArrayBuffer?new Uint8Array(C):C)):Array.isArray(C)&&(C=C.join(""),Q=-1),[C,Q]),b={basic:r.xWrap("sqlite3_prepare_v3","int",["sqlite3*","string","int","int","**","**"]),full:r.xWrap("sqlite3_prepare_v3","int",["sqlite3*","*","int","int","**","**"])};s.sqlite3_prepare_v3=function C(Q,T,O,f,m,E){if(C.length!==arguments.length)return I(Q,"sqlite3_prepare_v3",C.length);const[j,te]=y(T,Number(O));switch(typeof j){case"string":return b.basic(Q,j,te,f,m,null);case typeof r.ptr.null:return b.full(Q,r.ptr.coerce(j),te,f,m,E);default:return u.sqlite3__wasm_db_error(Q,s.SQLITE_MISUSE,"Invalid SQL argument type for sqlite3_prepare_v2/v3(). typeof="+typeof j)}},s.sqlite3_prepare_v2=function C(Q,T,O,f,m){return C.length===arguments.length?s.sqlite3_prepare_v3(Q,T,O,0,f,m):I(Q,"sqlite3_prepare_v2",C.length)}}{const y=r.xWrap("sqlite3_bind_text","int",["sqlite3_stmt*","int","string","int","*"]),b=r.xWrap("sqlite3_bind_blob","int",["sqlite3_stmt*","int","*","int","*"]);s.sqlite3_bind_text=function C(Q,T,O,f,m){if(C.length!==arguments.length)return I(s.sqlite3_db_handle(Q),"sqlite3_bind_text",C.length);if(r.isPtr(O)||O===null)return y(Q,T,O,f,m);O instanceof ArrayBuffer?O=new Uint8Array(O):Array.isArray(pMem)&&(O=pMem.join(""));let E,j;try{if(u.isSQLableTypedArray(O))E=r.allocFromTypedArray(O),j=O.byteLength;else if(typeof O=="string")[E,j]=r.allocCString(O);else return u.sqlite3__wasm_db_error(s.sqlite3_db_handle(Q),s.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_text().");return y(Q,T,E,j,s.SQLITE_WASM_DEALLOC)}catch(te){return r.dealloc(E),u.sqlite3__wasm_db_error(s.sqlite3_db_handle(Q),te)}},s.sqlite3_bind_blob=function C(Q,T,O,f,m){if(C.length!==arguments.length)return I(s.sqlite3_db_handle(Q),"sqlite3_bind_blob",C.length);if(r.isPtr(O)||O===null)return b(Q,T,O,f,m);O instanceof ArrayBuffer?O=new Uint8Array(O):Array.isArray(O)&&(O=O.join(""));let E,j;try{if(u.isBindableTypedArray(O))E=r.allocFromTypedArray(O),j=f>=0?f:O.byteLength;else if(typeof O=="string")[E,j]=r.allocCString(O);else return u.sqlite3__wasm_db_error(s.sqlite3_db_handle(Q),s.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_blob().");return b(Q,T,E,j,s.SQLITE_WASM_DEALLOC)}catch(te){return r.dealloc(E),u.sqlite3__wasm_db_error(s.sqlite3_db_handle(Q),te)}}}if(!s.sqlite3_column_text){const y=r.xWrap.argAdapter("sqlite3_stmt*"),b=r.xWrap.argAdapter("int"),C=r.xWrap.argAdapter("sqlite3_value*"),Q=(T,O)=>r.typedArrayToString(r.heap8u(),Number(T),Number(T)+O);s.sqlite3_column_text=function(T,O){const f=y(T),m=b(O),E=r.exports.sqlite3_column_text(f,m);return E?Q(E,r.exports.sqlite3_column_bytes(f,m)):null},s.sqlite3_value_text=function(T){const O=C(T),f=r.exports.sqlite3_value_text(O);return f?Q(f,r.exports.sqlite3_value_bytes(O)):null}}s.sqlite3_config=function(y,...b){if(arguments.length<2)return s.SQLITE_MISUSE;switch(y){case s.SQLITE_CONFIG_COVERING_INDEX_SCAN:case s.SQLITE_CONFIG_MEMSTATUS:case s.SQLITE_CONFIG_SMALL_MALLOC:case s.SQLITE_CONFIG_SORTERREF_SIZE:case s.SQLITE_CONFIG_STMTJRNL_SPILL:case s.SQLITE_CONFIG_URI:return r.exports.sqlite3__wasm_config_i(y,b[0]);case s.SQLITE_CONFIG_LOOKASIDE:return r.exports.sqlite3__wasm_config_ii(y,b[0],b[1]);case s.SQLITE_CONFIG_MEMDB_MAXSIZE:return r.exports.sqlite3__wasm_config_j(y,b[0]);case s.SQLITE_CONFIG_GETMALLOC:case s.SQLITE_CONFIG_GETMUTEX:case s.SQLITE_CONFIG_GETPCACHE2:case s.SQLITE_CONFIG_GETPCACHE:case s.SQLITE_CONFIG_HEAP:case s.SQLITE_CONFIG_LOG:case s.SQLITE_CONFIG_MALLOC:case s.SQLITE_CONFIG_MMAP_SIZE:case s.SQLITE_CONFIG_MULTITHREAD:case s.SQLITE_CONFIG_MUTEX:case s.SQLITE_CONFIG_PAGECACHE:case s.SQLITE_CONFIG_PCACHE2:case s.SQLITE_CONFIG_PCACHE:case s.SQLITE_CONFIG_PCACHE_HDRSZ:case s.SQLITE_CONFIG_PMASZ:case s.SQLITE_CONFIG_SERIALIZED:case s.SQLITE_CONFIG_SINGLETHREAD:case s.SQLITE_CONFIG_SQLLOG:case s.SQLITE_CONFIG_WIN32_HEAPSIZE:default:return s.SQLITE_NOTFOUND}};{const y=new Set;s.sqlite3_auto_extension=function(b){if(b instanceof Function)b=r.installFunction("i(ppp)",b);else if(arguments.length!==1||!r.isPtr(b))return s.SQLITE_MISUSE;const C=r.exports.sqlite3_auto_extension(b);return b!==arguments[0]&&(C===0?y.add(b):r.uninstallFunction(b)),C},s.sqlite3_cancel_auto_extension=function(b){return!b||arguments.length!==1||!r.isPtr(b)?0:r.exports.sqlite3_cancel_auto_extension(b)},s.sqlite3_reset_auto_extension=function(){r.exports.sqlite3_reset_auto_extension();for(const b of y)r.uninstallFunction(b);y.clear()}}r.xWrap.FuncPtrAdapter.warnOnUse=!0;const B=i.StructBinder,F=function y(b,C,Q,T=y.installMethodArgcCheck){if(b instanceof B.StructType?!(Q instanceof Function)&&!r.isPtr(Q)&&n("Usage error: expecting a Function or WASM pointer to one."):n("Usage error: target object is-not-a StructType."),arguments.length===1)return(E,j)=>y(b,E,j,T);y.argcProxy||(y.argcProxy=function(E,j,te,_e){return function(...Se){return te.length!==arguments.length&&n("Argument mismatch for",E.structInfo.name+"::"+j+": Native signature is:",_e),te.apply(this,Se)}},y.removeFuncList=function(){this.ondispose.__removeFuncList&&(this.ondispose.__removeFuncList.forEach((E,j)=>{if(r.isPtr(E))try{r.uninstallFunction(E)}catch{}}),delete this.ondispose.__removeFuncList)});const O=b.memberSignature(C);O.length<2&&n("Member",C,"does not have a function pointer signature:",O);const f=b.memberKey(C),m=T&&!r.isPtr(Q)?y.argcProxy(b,f,Q,O):Q;if(r.isPtr(m))m&&!r.functionEntry(m)&&n("Pointer",m,"is not a WASM function table entry."),b[f]=m;else{const E=r.installFunction(m,O);b[f]=E,(!b.ondispose||!b.ondispose.__removeFuncList)&&(b.addOnDispose("ondispose.__removeFuncList handler",y.removeFuncList),b.ondispose.__removeFuncList=[]),b.ondispose.__removeFuncList.push(f,E)}return(E,j)=>y(b,E,j,T)};F.installMethodArgcCheck=!1;const ie=function(y,b,C=F.installMethodArgcCheck){const Q=new Map;for(const T of Object.keys(b)){const O=b[T],f=Q.get(O);if(f){const m=y.memberKey(T);y[m]=y[y.memberKey(f)]}else F(y,T,O,C),Q.set(O,T)}return y};B.StructType.prototype.installMethod=function(b,C,Q=F.installMethodArgcCheck){return arguments.length<3&&b&&typeof b=="object"?ie(this,...arguments):F(this,...arguments)},B.StructType.prototype.installMethods=function(y,b=F.installMethodArgcCheck){return ie(this,y,b)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const n=(...w)=>{throw new i.SQLite3Error(...w)},s=i.capi,r=i.wasm,u=i.util,P=function(w){return(...a)=>w("sqlite3.oo1:",...a)};i.__isUnderTest?P(console.debug.bind(console)):P(i.config.debug),i.__isUnderTest?P(console.warn.bind(console)):P(i.config.warn),i.__isUnderTest?P(console.error.bind(console)):P(i.config.error);const I=new WeakMap,Z=new Set,R=new WeakMap,X=(w,a,_)=>{const d=Object.getOwnPropertyDescriptor(w,a);return d?d.value:_},p=function(w,a){return a&&(w instanceof y&&(w=w.pointer),n(a,"sqlite3 result code",a+":",w?s.sqlite3_errmsg(w):s.sqlite3_errstr(a))),arguments[0]},B=r.installFunction("i(ippp)",(function(w,a,_,d){s.SQLITE_TRACE_STMT===w&&console.log("SQL TRACE #"+ ++this.counter,"via sqlite3@"+a+"["+s.sqlite3_db_filename(a,null)+"]",r.cstrToJs(d))}).bind({counter:0})),F=Object.create(null),ie=function w(...a){const _=w.normalizeArgs(...a);let d;if(d=_["sqlite3*"])_["sqlite3*:takeOwnership"]||Z.add(this),this.filename=s.sqlite3_db_filename(d,"main");else{let q=_.filename,V=_.vfs,Y=_.flags;(typeof q!="string"&&!r.isPtr(q)||typeof Y!="string"||V&&typeof V!="string"&&!r.isPtr(V))&&(i.config.error("Invalid DB ctor args",_,arguments),n("Invalid arguments for DB constructor:",arguments,"opts:",_));let M=0;Y.indexOf("c")>=0&&(M|=s.SQLITE_OPEN_CREATE|s.SQLITE_OPEN_READWRITE),Y.indexOf("w")>=0&&(M|=s.SQLITE_OPEN_READWRITE),M===0&&(M|=s.SQLITE_OPEN_READONLY),M|=s.SQLITE_OPEN_EXRESCODE;const h=r.pstack.pointer;try{const N=r.pstack.allocPtr();let H=s.sqlite3_open_v2(q,N,M,V||r.ptr.null);d=r.peekPtr(N),p(d,H),s.sqlite3_extended_result_codes(d,1),Y.indexOf("t")>=0&&s.sqlite3_trace_v2(d,s.SQLITE_TRACE_STMT,B,d)}catch(N){throw d&&s.sqlite3_close_v2(d),N}finally{r.pstack.restore(h)}this.filename=r.isPtr(q)?r.cstrToJs(q):q}if(I.set(this,d),R.set(this,Object.create(null)),!_["sqlite3*"])try{const q=F[s.sqlite3_js_db_vfs(d)||n("Internal error: cannot get VFS for new db handle.")];q&&(q instanceof Function?q(this,i):p(d,s.sqlite3_exec(d,q,0,0,0)))}catch(q){throw this.close(),q}};ie.setVfsPostOpenCallback=function(w,a){a instanceof Function||n("dbCtorHelper.setVfsPostOpenCallback() should not be used with a non-function argument.",arguments),F[w]=a},ie.normalizeArgs=function(w=":memory:",a="c",_=null){const d={};return arguments.length===1&&arguments[0]&&typeof arguments[0]=="object"?(Object.assign(d,arguments[0]),d.flags===void 0&&(d.flags="c"),d.vfs===void 0&&(d.vfs=null),d.filename===void 0&&(d.filename=":memory:")):(d.filename=w,d.flags=a,d.vfs=_),d};const y=function(...w){ie.apply(this,w)};y.dbCtorHelper=ie;const b={null:1,number:2,string:3,boolean:4,blob:5};r.bigIntEnabled&&(b.bigint=b.number);const C=function(){b!==arguments[2]&&n(s.SQLITE_MISUSE,"Do not call the Stmt constructor directly. Use DB.prepare()."),this.db=arguments[0],I.set(this,arguments[1]),arguments.length>3&&!arguments[3]&&Z.add(this)},Q=function(w){return w.pointer||n("DB has been closed."),w},T=function(w,a){return(a!==(a|0)||a<0||a>=w.columnCount)&&n("Column index",a,"is out of range."),w},O=function(w,a){const _=Object.create(null);switch(_.opt=Object.create(null),a.length){case 1:typeof a[0]=="string"||u.isSQLableTypedArray(a[0])||Array.isArray(a[0])?_.sql=a[0]:a[0]&&typeof a[0]=="object"&&(_.opt=a[0],_.sql=_.opt.sql);break;case 2:_.sql=a[0],_.opt=a[1];break;default:n("Invalid argument count for exec().")}_.sql=u.flexibleString(_.sql),typeof _.sql!="string"&&n("Missing SQL argument or unsupported SQL value type.");const d=_.opt;switch(d.returnValue){case"resultRows":d.resultRows||(d.resultRows=[]),_.returnVal=()=>d.resultRows;break;case"saveSql":d.saveSql||(d.saveSql=[]),_.returnVal=()=>d.saveSql;break;case void 0:case"this":_.returnVal=()=>w;break;default:n("Invalid returnValue value:",d.returnValue)}if(!d.callback&&!d.returnValue&&d.rowMode!==void 0&&(d.resultRows||(d.resultRows=[]),_.returnVal=()=>d.resultRows),d.callback||d.resultRows)switch(d.rowMode===void 0?"array":d.rowMode){case"object":_.cbArg=(q,V)=>{V.columnNames||(V.columnNames=q.getColumnNames([]));const Y=q.get([]),M=Object.create(null);for(const h in V.columnNames)M[V.columnNames[h]]=Y[h];return M};break;case"array":_.cbArg=q=>q.get([]);break;case"stmt":Array.isArray(d.resultRows)&&n("exec(): invalid rowMode for a resultRows array: must","be one of 'array', 'object',","a result column number, or column name reference."),_.cbArg=q=>q;break;default:if(u.isInt32(d.rowMode)){_.cbArg=q=>q.get(d.rowMode);break}else if(typeof d.rowMode=="string"&&d.rowMode.length>1&&d.rowMode[0]==="$"){const q=d.rowMode.substr(1);_.cbArg=V=>{const Y=V.get(Object.create(null))[q];return Y===void 0?n(s.SQLITE_NOTFOUND,"exec(): unknown result column:",q):Y};break}n("Invalid rowMode:",d.rowMode)}return _},f=(w,a,_,...d)=>{const q=w.prepare(a);try{const V=q.bind(_).step()?q.get(...d):void 0;return q.reset(),V}finally{q.finalize()}},m=(w,a,_,d)=>w.exec({sql:a,bind:_,rowMode:d,returnValue:"resultRows"});y.checkRc=(w,a)=>p(w,a),y.prototype={isOpen:function(){return!!this.pointer},affirmOpen:function(){return Q(this)},close:function(){const w=this.pointer;if(w){if(this.onclose&&this.onclose.before instanceof Function)try{this.onclose.before(this)}catch{}if(Object.keys(R.get(this)).forEach((a,_)=>{if(_&&_.pointer)try{_.finalize()}catch{}}),I.delete(this),R.delete(this),Z.delete(this)||s.sqlite3_close_v2(w),this.onclose&&this.onclose.after instanceof Function)try{this.onclose.after(this)}catch{}delete this.filename}},changes:function(w=!1,a=!1){const _=Q(this).pointer;return w?a?s.sqlite3_total_changes64(_):s.sqlite3_total_changes(_):a?s.sqlite3_changes64(_):s.sqlite3_changes(_)},dbFilename:function(w="main"){return s.sqlite3_db_filename(Q(this).pointer,w)},dbName:function(w=0){return s.sqlite3_db_name(Q(this).pointer,w)},dbVfsName:function(w=0){let a;const _=s.sqlite3_js_db_vfs(Q(this).pointer,w);if(_){const d=new s.sqlite3_vfs(_);try{a=r.cstrToJs(d.$zName)}finally{d.dispose()}}return a},prepare:function(w){Q(this);const a=r.pstack.pointer;let _,d;try{_=r.pstack.alloc(8),y.checkRc(this,s.sqlite3_prepare_v2(this.pointer,w,-1,_,null)),d=r.peekPtr(_)}finally{r.pstack.restore(a)}d||n("Cannot prepare empty SQL.");const q=new C(this,d,b);return R.get(this)[d]=q,q},exec:function(){Q(this);const w=O(this,arguments);if(!w.sql)return n("exec() requires an SQL string.");const a=w.opt,_=a.callback,d=Array.isArray(a.resultRows)?a.resultRows:void 0;let q,V=a.bind,Y=!!(w.cbArg||a.columnNames||d);const M=r.scopedAllocPush(),h=Array.isArray(a.saveSql)?a.saveSql:void 0;try{const N=u.isSQLableTypedArray(w.sql);let H=N?w.sql.byteLength:r.jstrlen(w.sql);const oe=r.scopedAlloc(2*r.ptr.size+(H+1)),g=r.ptr.add(oe,r.ptr.size);let L=r.ptr.add(g,r.ptr.size);const $=r.ptr.add(L,H);for(N?r.heap8().set(w.sql,L):r.jstrcpy(w.sql,r.heap8(),L,H,!1),r.poke8(r.ptr.add(L,H),0);L&&r.peek8(L);){r.pokePtr([oe,g],0),y.checkRc(this,s.sqlite3_prepare_v3(this.pointer,L,H,0,oe,g));const ae=r.peekPtr(oe);if(L=r.peekPtr(g),H=Number(r.ptr.add($,-L)),!!ae){if(h&&h.push(s.sqlite3_sql(ae).trim()),q=new C(this,ae,b),V&&q.parameterCount&&(q.bind(V),V=null),Y&&q.columnCount){let re=Array.isArray(a.columnNames)?0:1;if(Y=!1,w.cbArg||d){const pe=Object.create(null);for(;q.step();Se.delete(q)){re++===0&&q.getColumnNames(pe.columnNames=a.columnNames||[]),Se.add(q);const ke=w.cbArg(q,pe);if(d&&d.push(ke),_&&_.call(a,ke,q)===!1)break}Se.delete(q)}re===0&&q.getColumnNames(a.columnNames)}else q.step();q.reset().finalize(),q=null}}}finally{q&&(Se.delete(q),q.finalize()),r.scopedAllocPop(M)}return w.returnVal()},createFunction:function(a,_,d){const q=pe=>pe instanceof Function;switch(arguments.length){case 1:d=a,a=d.name,_=d.xFunc||0;break;case 2:q(_)||(d=_,_=d.xFunc||0);break}d||(d={}),typeof a!="string"&&n("Invalid arguments: missing function name.");let V=d.xStep||0,Y=d.xFinal||0;const M=d.xValue||0,h=d.xInverse||0;let N;q(_)?(N=!1,(q(V)||q(Y))&&n("Ambiguous arguments: scalar or aggregate?"),V=Y=null):q(V)?(q(Y)||n("Missing xFinal() callback for aggregate or window UDF."),_=null):q(Y)?n("Missing xStep() callback for aggregate or window UDF."):n("Missing function-type properties."),N===!1?(q(M)||q(h))&&n("xValue and xInverse are not permitted for non-window UDFs."):q(M)?(q(h)||n("xInverse must be provided if xValue is."),N=!0):q(h)&&n("xValue must be provided if xInverse is.");const H=d.pApp;H!=null&&!r.isPtr(H)&&n("Invalid value for pApp property. Must be a legal WASM pointer value.");const oe=d.xDestroy||0;oe&&!q(oe)&&n("xDestroy property must be a function.");let g=0;X(d,"deterministic")&&(g|=s.SQLITE_DETERMINISTIC),X(d,"directOnly")&&(g|=s.SQLITE_DIRECTONLY),X(d,"innocuous")&&(g|=s.SQLITE_INNOCUOUS),a=a.toLowerCase();const L=_||V,$=X(d,"arity"),ae=typeof $=="number"?$:L.length?L.length-1:0;let re;return N?re=s.sqlite3_create_window_function(this.pointer,a,ae,s.SQLITE_UTF8|g,H||0,V,Y,M,h,oe):re=s.sqlite3_create_function_v2(this.pointer,a,ae,s.SQLITE_UTF8|g,H||0,_,V,Y,oe),y.checkRc(this,re),this},selectValue:function(w,a,_){return f(this,w,a,0,_)},selectValues:function(w,a,_){const d=this.prepare(w),q=[];try{for(d.bind(a);d.step();)q.push(d.get(0,_));d.reset()}finally{d.finalize()}return q},selectArray:function(w,a){return f(this,w,a,[])},selectObject:function(w,a){return f(this,w,a,{})},selectArrays:function(w,a){return m(this,w,a,"array")},selectObjects:function(w,a){return m(this,w,a,"object")},openStatementCount:function(){return this.pointer?Object.keys(R.get(this)).length:0},transaction:function(w){let a="BEGIN";arguments.length>1&&(/[^a-zA-Z]/.test(arguments[0])&&n(s.SQLITE_MISUSE,"Invalid argument for BEGIN qualifier."),a+=" "+arguments[0],w=arguments[1]),Q(this).exec(a);try{const _=w(this);return this.exec("COMMIT"),_}catch(_){throw this.exec("ROLLBACK"),_}},savepoint:function(w){Q(this).exec("SAVEPOINT oo1");try{const a=w(this);return this.exec("RELEASE oo1"),a}catch(a){throw this.exec("ROLLBACK to SAVEPOINT oo1; RELEASE SAVEPOINT oo1"),a}},checkRc:function(w){return p(this,w)}},y.wrapHandle=function(w,a=!1){if(!w||!r.isPtr(w))throw new i.SQLite3Error(s.SQLITE_MISUSE,"Argument must be a WASM sqlite3 pointer");return new y({"sqlite3*":w,"sqlite3*:takeOwnership":!!a})};const E=function(w){return w.pointer||n("Stmt has been closed."),w},j=function(w){let a=b[w==null?"null":typeof w];switch(a){case b.boolean:case b.null:case b.number:case b.string:return a;case b.bigint:return r.bigIntEnabled?a:void 0;default:return u.isBindableTypedArray(w)?b.blob:void 0}},te=function(w){return j(w)||n("Unsupported bind() argument type:",typeof w)},_e=function(w,a){const _=typeof a=="number"?a:s.sqlite3_bind_parameter_index(w.pointer,a);return _===0||!u.isInt32(_)?n("Invalid bind() parameter name: "+a):(_<1||_>w.parameterCount)&&n("Bind index",a,"is out of range."),_},Se=new Set,Ie=new Set,ge=function(w,a){return Se.has(w)&&n("Operation is illegal when statement is locked:",a),w},G=function w(a,_,d,q){ge(E(a),"bind()"),w._||(w._tooBigInt=Y=>n("BigInt value is too big to store without precision loss:",Y),w._={string:function(Y,M,h,N){const[H,oe]=r.allocCString(h,!0);return(N?s.sqlite3_bind_blob:s.sqlite3_bind_text)(Y.pointer,M,H,oe,s.SQLITE_WASM_DEALLOC)}}),te(q),_=_e(a,_);let V=0;switch(q==null?b.null:d){case b.null:V=s.sqlite3_bind_null(a.pointer,_);break;case b.string:V=w._.string(a,_,q,!1);break;case b.number:{let Y;u.isInt32(q)?Y=s.sqlite3_bind_int:typeof q=="bigint"?u.bigIntFits64(q)?r.bigIntEnabled?Y=s.sqlite3_bind_int64:u.bigIntFitsDouble(q)?(q=Number(q),Y=s.sqlite3_bind_double):w._tooBigInt(q):w._tooBigInt(q):(q=Number(q),r.bigIntEnabled&&Number.isInteger(q)?Y=s.sqlite3_bind_int64:Y=s.sqlite3_bind_double),V=Y(a.pointer,_,q);break}case b.boolean:V=s.sqlite3_bind_int(a.pointer,_,q?1:0);break;case b.blob:{if(typeof q=="string"){V=w._.string(a,_,q,!0);break}else q instanceof ArrayBuffer?q=new Uint8Array(q):u.isBindableTypedArray(q)||n("Binding a value as a blob requires","that it be a string, Uint8Array, Int8Array, or ArrayBuffer.");const Y=r.alloc(q.byteLength||1);r.heap8().set(q.byteLength?q:[0],Number(Y)),V=s.sqlite3_bind_blob(a.pointer,_,Y,q.byteLength,s.SQLITE_WASM_DEALLOC);break}default:i.config.warn("Unsupported bind() argument type:",q),n("Unsupported bind() argument type: "+typeof q)}return V&&y.checkRc(a.db.pointer,V),a};C.prototype={finalize:function(){const w=this.pointer;if(w){ge(this,"finalize()");const a=Z.delete(this)?0:s.sqlite3_finalize(w);return delete R.get(this.db)[w],I.delete(this),Se.delete(this),Ie.delete(this),delete this.parameterCount,delete this.db,a}},clearBindings:function(){return ge(E(this),"clearBindings()"),s.sqlite3_clear_bindings(this.pointer),Ie.delete(this),this},reset:function(w){ge(this,"reset()"),w&&this.clearBindings();const a=s.sqlite3_reset(E(this).pointer);return Ie.delete(this),p(this.db,a),this},bind:function(){E(this);let w,a;switch(arguments.length){case 1:w=1,a=arguments[0];break;case 2:w=arguments[0],a=arguments[1];break;default:n("Invalid bind() arguments.")}return a===void 0?this:(this.parameterCount||n("This statement has no bindable parameters."),Ie.delete(this),a===null?G(this,w,b.null,a):Array.isArray(a)?(arguments.length!==1&&n("When binding an array, an index argument is not permitted."),a.forEach((_,d)=>G(this,d+1,te(_),_)),this):(a instanceof ArrayBuffer&&(a=new Uint8Array(a)),typeof a=="object"&&!u.isBindableTypedArray(a)?(arguments.length!==1&&n("When binding an object, an index argument is not permitted."),Object.keys(a).forEach(_=>G(this,_,te(a[_]),a[_])),this):G(this,w,te(a),a)))},bindAsBlob:function(w,a){E(this),arguments.length===1&&(a=w,w=1);const _=te(a);return b.string!==_&&b.blob!==_&&b.null!==_&&n("Invalid value type for bindAsBlob()"),G(this,w,b.blob,a)},step:function(){ge(this,"step()");const w=s.sqlite3_step(E(this).pointer);switch(w){case s.SQLITE_DONE:return Ie.delete(this),!1;case s.SQLITE_ROW:return Ie.add(this),!0;default:Ie.delete(this),i.config.warn("sqlite3_step() rc=",w,s.sqlite3_js_rc_str(w),"SQL =",s.sqlite3_sql(this.pointer)),y.checkRc(this.db.pointer,w)}},stepReset:function(){return this.step(),this.reset()},stepFinalize:function(){try{const w=this.step();return this.reset(),w}finally{try{this.finalize()}catch{}}},get:function(w,a){if(Ie.has(E(this))||n("Stmt.step() has not (recently) returned true."),Array.isArray(w)){let _=0;const d=this.columnCount;for(;_<d;)w[_]=this.get(_++);return w}else if(w&&typeof w=="object"){let _=0;const d=this.columnCount;for(;_<d;)w[s.sqlite3_column_name(this.pointer,_)]=this.get(_++);return w}switch(T(this,w),a===void 0?s.sqlite3_column_type(this.pointer,w):a){case s.SQLITE_NULL:return null;case s.SQLITE_INTEGER:if(r.bigIntEnabled){const _=s.sqlite3_column_int64(this.pointer,w);return _>=Number.MIN_SAFE_INTEGER&&_<=Number.MAX_SAFE_INTEGER?Number(_).valueOf():_}else{const _=s.sqlite3_column_double(this.pointer,w);return(_>Number.MAX_SAFE_INTEGER||_<Number.MIN_SAFE_INTEGER)&&n("Integer is out of range for JS integer range: "+_),u.isInt32(_)?_|0:_}case s.SQLITE_FLOAT:return s.sqlite3_column_double(this.pointer,w);case s.SQLITE_TEXT:return s.sqlite3_column_text(this.pointer,w);case s.SQLITE_BLOB:{const _=s.sqlite3_column_bytes(this.pointer,w),d=s.sqlite3_column_blob(this.pointer,w),q=new Uint8Array(_);return _&&(q.set(r.heap8u().slice(Number(d),Number(d)+_),0),this.db._blobXfer instanceof Array&&this.db._blobXfer.push(q.buffer)),q}default:n("Don't know how to translate","type of result column #"+w+".")}n("Not reached.")},getInt:function(w){return this.get(w,s.SQLITE_INTEGER)},getFloat:function(w){return this.get(w,s.SQLITE_FLOAT)},getString:function(w){return this.get(w,s.SQLITE_TEXT)},getBlob:function(w){return this.get(w,s.SQLITE_BLOB)},getJSON:function(w){const a=this.get(w,s.SQLITE_STRING);return a===null?a:JSON.parse(a)},getColumnName:function(w){return s.sqlite3_column_name(T(E(this),w).pointer,w)},getColumnNames:function(w=[]){T(E(this),0);const a=this.columnCount;for(let _=0;_<a;++_)w.push(s.sqlite3_column_name(this.pointer,_));return w},getParamIndex:function(w){return E(this).parameterCount?s.sqlite3_bind_parameter_index(this.pointer,w):void 0},getParamName:function(w){return E(this).parameterCount?s.sqlite3_bind_parameter_name(this.pointer,w):void 0},isBusy:function(){return s.sqlite3_stmt_busy(E(this))!==0},isReadOnly:function(){return s.sqlite3_stmt_readonly(E(this))!==0}};{const w={enumerable:!0,get:function(){return I.get(this)},set:()=>n("The pointer property is read-only.")};Object.defineProperty(C.prototype,"pointer",w),Object.defineProperty(y.prototype,"pointer",w)}Object.defineProperty(C.prototype,"columnCount",{enumerable:!1,get:function(){return s.sqlite3_column_count(this.pointer)},set:()=>n("The columnCount property is read-only.")}),Object.defineProperty(C.prototype,"parameterCount",{enumerable:!1,get:function(){return s.sqlite3_bind_parameter_count(this.pointer)},set:()=>n("The parameterCount property is read-only.")}),C.wrapHandle=function(w,a,_=!1){if(!(w instanceof y)||!w.pointer)throw new i.SQLite3Error(i.SQLITE_MISUSE,"First argument must be an opened sqlite3.oo1.DB instance");if(!a||!r.isPtr(a))throw new i.SQLite3Error(i.SQLITE_MISUSE,"Second argument must be a WASM sqlite3_stmt pointer");return new C(w,a,b,!!_)},i.oo1={DB:y,Stmt:C}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const n=i.util;i.initWorker1API=(function(){const s=(...B)=>{throw new Error(B.join(" "))};globalThis.WorkerGlobalScope instanceof Function||s("initWorker1API() must be run from a Worker thread.");const r=this.sqlite3||s("Missing this.sqlite3 object."),u=r.oo1.DB,P=function(B){let F=I.idMap.get(B);return F||(F="db#"+ ++I.idSeq+":"+Math.floor(Math.random()*1e8)+":"+Math.floor(Math.random()*1e8),I.idMap.set(B,F),F)},I={dbList:[],idSeq:0,idMap:new WeakMap,xfer:[],open:function(B){const F=new u(B);return this.dbs[P(F)]=F,this.dbList.indexOf(F)<0&&this.dbList.push(F),F},close:function(B,F){if(B){delete this.dbs[P(B)];const ie=B.filename,y=n.sqlite3__wasm_db_vfs(B.pointer,0);B.close();const b=this.dbList.indexOf(B);b>=0&&this.dbList.splice(b,1),F&&ie&&y&&n.sqlite3__wasm_vfs_unlink(y,ie)}},post:function(B,F){F&&F.length?(globalThis.postMessage(B,Array.from(F)),F.length=0):globalThis.postMessage(B)},dbs:Object.create(null),getDb:function(B,F=!0){return this.dbs[B]||(F?s("Unknown (or closed) DB ID:",B):void 0)}},Z=function(B=I.dbList[0]){return B&&B.pointer?B:s("DB is not opened.")},R=function(B,F=!0){const ie=I.getDb(B.dbId,!1)||I.dbList[0];return F?Z(ie):ie},X=function(){return I.dbList[0]&&P(I.dbList[0])},p={open:function(B){const F=Object.create(null),ie=B.args||Object.create(null);ie.simulateError&&s("Throwing because of simulateError flag.");const y=Object.create(null);F.vfs=ie.vfs,F.filename=ie.filename||"";const b=I.open(F);return y.filename=b.filename,y.persistent=!!r.capi.sqlite3_js_db_uses_vfs(b.pointer,"opfs"),y.dbId=P(b),y.vfs=b.dbVfsName(),y},close:function(B){const F=R(B,!1),ie={filename:F&&F.filename};if(F){const y=B.args&&typeof B.args=="object"?!!B.args.unlink:!1;I.close(F,y)}return ie},exec:function(B){const F=typeof B.args=="string"?{sql:B.args}:B.args||Object.create(null);F.rowMode==="stmt"?s("Invalid rowMode for 'exec': stmt mode","does not work in the Worker API."):F.sql||s("'exec' requires input SQL.");const ie=R(B);(F.callback||Array.isArray(F.resultRows))&&(ie._blobXfer=I.xfer);const y=F.callback;let b=0;const C=!!F.columnNames;typeof y=="string"&&(C||(F.columnNames=[]),F.callback=function(Q,T){I.post({type:y,columnNames:F.columnNames,rowNumber:++b,row:Q},I.xfer)});try{const Q=F.countChanges?ie.changes(!0,F.countChanges===64):void 0;ie.exec(F),Q!==void 0&&(F.changeCount=ie.changes(!0,F.countChanges===64)-Q);const T=F.lastInsertRowId?r.capi.sqlite3_last_insert_rowid(ie):void 0;T!==void 0&&(F.lastInsertRowId=T),F.callback instanceof Function&&(F.callback=y,I.post({type:y,columnNames:F.columnNames,rowNumber:null,row:void 0}))}finally{delete ie._blobXfer,F.callback&&(F.callback=y)}return F},"config-get":function(){const B=Object.create(null),F=r.config;return["bigIntEnabled"].forEach(function(ie){Object.getOwnPropertyDescriptor(F,ie)&&(B[ie]=F[ie])}),B.version=r.version,B.vfsList=r.capi.sqlite3_js_vfs_list(),B},export:function(B){const F=R(B),ie={byteArray:r.capi.sqlite3_js_db_export(F.pointer),filename:F.filename,mimetype:"application/x-sqlite3"};return I.xfer.push(ie.byteArray.buffer),ie},toss:function(B){s("Testing worker exception")}};globalThis.onmessage=async function(B){B=B.data;let F,ie=B.dbId,y=B.type;const b=performance.now();try{p.hasOwnProperty(y)&&p[y]instanceof Function?F=await p[y](B):s("Unknown db worker message type:",B.type)}catch(C){y="error",F={operation:B.type,message:C.message,errorClass:C.name,input:B},C.stack&&(F.stack=typeof C.stack=="string"?C.stack.split(/\n\s*/):C.stack)}ie||(ie=F.dbId||X()),I.post({type:y,dbId:ie,messageId:B.messageId,workerReceivedTime:b,workerRespondTime:performance.now(),departureTime:B.departureTime,result:F},I.xfer)},globalThis.postMessage({type:"sqlite3-api",result:"worker1-ready"})}).bind({sqlite3:i})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const n=i.wasm,s=i.capi,r=i.util.toss3,u=Object.create(null);i.vfs=u,s.sqlite3_vfs.prototype.registerVfs=function(P=!1){this instanceof i.capi.sqlite3_vfs||r("Expecting a sqlite3_vfs-type argument.");const I=s.sqlite3_vfs_register(this,P?1:0);return I&&r("sqlite3_vfs_register(",this,") failed with rc",I),this.pointer!==s.sqlite3_vfs_find(this.$zName)&&r("BUG: sqlite3_vfs_find(vfs.$zName) failed for just-installed VFS",this),this},u.installVfs=function(P){let I=0;const Z=["io","vfs"];for(const R of Z){const X=P[R];X&&(++I,X.struct.installMethods(X.methods,!!X.applyArgcCheck),R==="vfs"&&(!X.struct.$zName&&typeof X.name=="string"&&X.struct.addOnDispose(X.struct.$zName=n.allocCString(X.name)),X.struct.registerVfs(!!X.asDefault)))}return I||r("Misuse: installVfs() options object requires at least","one of:",Z),this}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){if(!i.wasm.exports.sqlite3_declare_vtab)return;const n=i.wasm,s=i.capi,r=i.util.toss3,u=Object.create(null);i.vtab=u;const P=s.sqlite3_index_info;P.prototype.nthConstraint=function(R,X=!1){if(R<0||R>=this.$nConstraint)return!1;const p=n.ptr.add(this.$aConstraint,P.sqlite3_index_constraint.structInfo.sizeof*R);return X?p:new P.sqlite3_index_constraint(p)},P.prototype.nthConstraintUsage=function(R,X=!1){if(R<0||R>=this.$nConstraint)return!1;const p=n.ptr.add(this.$aConstraintUsage,P.sqlite3_index_constraint_usage.structInfo.sizeof*R);return X?p:new P.sqlite3_index_constraint_usage(p)},P.prototype.nthOrderBy=function(R,X=!1){if(R<0||R>=this.$nOrderBy)return!1;const p=n.ptr.add(this.$aOrderBy,P.sqlite3_index_orderby.structInfo.sizeof*R);return X?p:new P.sqlite3_index_orderby(p)};const I=function(R,X){return(function(p,B=!1){if(arguments.length===0&&(p=new X),p instanceof X)return this.set(p.pointer,p),p;n.isPtr(p)||i.SQLite3Error.toss("Invalid argument to",R+"()");let F=this.get(p);return B&&this.delete(p),F}).bind(new Map)},Z=function(R,X){const p=I(R,X);return Object.assign(Object.create(null),{StructType:X,create:B=>{const F=p();return n.pokePtr(B,F.pointer),F},get:B=>p(B),unget:B=>p(B,!0),dispose:B=>p(B,!0)?.dispose?.()})};u.xVtab=Z("xVtab",s.sqlite3_vtab),u.xCursor=Z("xCursor",s.sqlite3_vtab_cursor),u.xIndexInfo=R=>new s.sqlite3_index_info(R),u.xError=function R(X,p,B){if(R.errorReporter instanceof Function)try{R.errorReporter("sqlite3_module::"+X+"(): "+p.message)}catch{}let F;return p instanceof i.WasmAllocError?F=s.SQLITE_NOMEM:arguments.length>2?F=B:p instanceof i.SQLite3Error&&(F=p.resultCode),F||s.SQLITE_ERROR},u.xError.errorReporter=i.config.error.bind(i.config),u.xRowid=(R,X)=>n.poke(R,X,"i64"),u.setupModule=function(R){let X=!1;const p=this instanceof s.sqlite3_module?this:R.struct||(X=new s.sqlite3_module);try{const B=R.methods||r("Missing 'methods' object.");for(const F of Object.entries({xConnect:"xCreate",xDisconnect:"xDestroy"})){const ie=F[0],y=F[1];B[ie]===!0?B[ie]=B[y]:B[y]===!0&&(B[y]=B[ie])}if(R.catchExceptions){const F=function(b,C){return["xConnect","xCreate"].indexOf(b)>=0?function(Q,T,O,f,m,E){try{return C(...arguments)||0}catch(j){return j instanceof i.WasmAllocError||(n.dealloc(n.peekPtr(E)),n.pokePtr(E,n.allocCString(j.message))),u.xError(b,j)}}:function(...Q){try{return C(...Q)||0}catch(T){return u.xError(b,T)}}},ie=["xCreate","xConnect","xBestIndex","xDisconnect","xDestroy","xOpen","xClose","xFilter","xNext","xEof","xColumn","xRowid","xUpdate","xBegin","xSync","xCommit","xRollback","xFindFunction","xRename","xSavepoint","xRelease","xRollbackTo","xShadowName"],y=Object.create(null);for(const b of ie){const C=B[b];if(C instanceof Function)b==="xConnect"&&B.xCreate===C?y[b]=B.xCreate:b==="xCreate"&&B.xConnect===C?y[b]=B.xConnect:y[b]=F(b,C);else continue}p.installMethods(y,!1)}else p.installMethods(B,!!R.applyArgcCheck);if(p.$iVersion===0){let F;typeof R.iVersion=="number"?F=R.iVersion:p.$xIntegrity?F=4:p.$xShadowName?F=3:p.$xSavePoint||p.$xRelease||p.$xRollbackTo?F=2:F=1,p.$iVersion=F}}catch(B){throw X&&X.dispose(),B}return p},s.sqlite3_module.prototype.setupModule=function(R){return u.setupModule.call(this,R)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const n=i.capi,s=n.sqlite3_kvvfs_methods,r=n.KVVfsFile,u=i.capi.sqlite3_vfs_find("kvvfs");if(delete n.sqlite3_kvvfs_methods,delete n.KVVfsFile,!u)return;const P=i.util,I=i.wasm,Z=P.toss3,R=(S,x)=>Object.prototype.hasOwnProperty.call(S,x),X=new s(I.exports.sqlite3__wasm_kvvfs_methods());P.assert(32<=X.$nKeySize,"unexpected kvvfsMethods.$nKeySize: "+X.$nKeySize);const p=Object.assign(Object.create(null),{rxJournalSuffix:/-journal$/,zKeyJrnl:I.allocCString("jrnl"),zKeySz:I.allocCString("sz"),keySize:X.$nKeySize,buffer:Object.assign(Object.create(null),{n:X.$nBufferSize,pool:Object.create(null)})});p.memBuffer=(S=0)=>p.buffer.pool[S]??=I.alloc(p.buffer.n),p.memBufferFree=S=>{const x=p.buffer.pool[S];x&&(I.dealloc(x),delete p.buffer.pool[S])};const B=()=>{},F=i.__isUnderTest?(...S)=>i.config.debug("kvvfs:",...S):B,ie=(...S)=>i.config.warn("kvvfs:",...S),y=(...S)=>i.config.error("kvvfs:",...S);class b{#e;#r;#a(){return this.#r??=Object.keys(this.#e)}constructor(){this.clear()}key(x){const U=this.#a();return x<U.length?U[x]:null}getItem(x){return this.#e[x]??null}setItem(x,U){R(this.#e,x)||(this.#r=null),this.#e[x]=""+U}removeItem(x){delete this.#e[x]&&(this.#r=null)}clear(){this.#e=Object.create(null),this.#r=null}get length(){return this.#a().length}}const C=S=>S==="local"||S==="session",Q=S=>C(S)?"kvvfs-"+S+"-":"",T=function(S,x=!1){if(C(S))return;const U=new Blob([S]).size;U||Z(n.SQLITE_MISUSE,"Empty name is not permitted.");let W=p.keySize-1;p.rxJournalSuffix.test(S)?x||Z(n.SQLITE_MISUSE,"Storage names may not have a '-journal' suffix."):["-wal","-shm"].filter(fe=>S.endsWith(fe)).length?Z(n.SQLITE_MISUSE,"Storage names may not have a -wal or -shm suffix."):W-=8,U>W&&Z(n.SQLITE_RANGE,"Storage name is too long. Limit =",W);let se;for(se=0;se<U;++se){const fe=S.codePointAt(se);fe<32&&Z(n.SQLITE_RANGE,"Illegal character ("+fe+"d) in storage name:",S)}},O=(S,x=void 0)=>Object.assign(Object.create(null),{jzClass:S,refc:1,deleteAtRefc0:!1,storage:x||new b,keyPrefix:Q(S),files:[],listeners:void 0}),f=i.kvvfs=Object.create(null);i.__isUnderTest&&(f.log=Object.assign(Object.create(null),{xOpen:!1,xClose:!1,xWrite:!1,xRead:!1,xSync:!1,xAccess:!1,xFileControl:!1,xRcrdRead:!1,xRcrdWrite:!1,xRcrdDelete:!1}));const m=function(S){const x=p.rxJournalSuffix.test(S.jzClass)?S.jzClass.replace(p.rxJournalSuffix,""):S.jzClass+"-journal";f?.log?.xClose&&F("cleaning up storage handles [",S.jzClass,x,"]",S),delete p.storagePool[S.jzClass],delete p.storagePool[x],i.__isUnderTest||(delete S.storage,delete S.refc)},E=S=>p.storagePool[S.jzClass]=p.storagePool[S.jzClass+"-journal"]=S,j=".";p.storagePool=Object.assign(Object.create(null),{[j]:O(j)}),globalThis.Storage&&(globalThis.localStorage instanceof globalThis.Storage&&(p.storagePool.local=O("local",globalThis.localStorage)),globalThis.sessionStorage instanceof globalThis.Storage&&(p.storagePool.session=O("session",globalThis.sessionStorage))),p.builtinStorageNames=Object.keys(p.storagePool);const te=S=>p.builtinStorageNames.indexOf(S)>-1;for(const S of Object.keys(p.storagePool)){const x=p.storagePool[S];p.storagePool[S+"-journal"]=x}p.setError=(S=void 0,x=n.SQLITE_ERROR)=>S?(p.lastError=S,S.resultCode|0||x):(delete p.lastError,0),p.popError=()=>{const S=p.lastError;return delete p.lastError,S};const _e=S=>{ie("kvvfs.listener handler threw:",S)},Se=I.exports.sqlite3__wasm_kvvfs_decode,Ie=I.exports.sqlite3__wasm_kvvfs_encode,ge=async function(S,x,...U){try{x.keyPrefix&&U[0]&&(U[0]=U[0].replace(x.keyPrefix,""));let W,se,fe,me;for(const de of x.listeners){const ve=Object.create(null);ve.storageName=x.jzClass,ve.type=S,de.decodePages;const Ce=de.events[S];if(Ce){if(!de.includeJournal&&U[0]==="jrnl")continue;if(S==="write"&&de.decodePages&&+U[0]>0){if(ve.data=[U[0]],me?.[U[0]]){ve.data[1]=me[U[0]];continue}W??=new TextEncoder("utf-8"),se??=p.memBuffer(10),fe??=p.memBuffer(11);const ze=W.encode(U[1]),Oe=I.heap8u();Oe.set(ze,Number(se)),Oe[I.ptr.addn(se,ze.length)]=0;const et=Se(se,fe,p.buffer.n);if(et>0)me??=Object.create(null),me[U[0]]=ve.data[1]=Oe.slice(Number(fe),I.ptr.addn(fe,et));else continue}else ve.data=U.length?U.length===1?U[0]:U:void 0;try{Ce(ve)?.catch?.(_e)}catch(ze){ie("notifyListeners [",x.jzClass,"]",S,ze)}}}}catch(W){_e(W)}},G=S=>typeof S=="string"?p.storagePool[S]:p.storagePool[I.cstrToJs(S)],w=I.exports.sqlite3__wasm_kvvfsMakeKey,a=(S,x,U)=>x&&S.keyPrefix?w(x,U):U,_=(S,x,U)=>I.cstrToJs(a(S,x,U)),d=S=>+S.storage.getItem(S.keyPrefix+"sz"),q=new Map,V={vfs:Object.create(null),ioDb:Object.create(null),ioJrnl:Object.create(null)},Y=new n.sqlite3_vfs(X.$pVfs),M=new n.sqlite3_io_methods(X.$pIoDb),h=new n.sqlite3_io_methods(X.$pIoJrnl),N=Object.create(null),H=Object.assign(Object.create(null),{pFileHandles:q,cache:p,storageForZClass:G,KVVfsStorage:b,disablePageSizeChange:!0});f.log&&(f.internal=H);const oe={recordHandler:{xRcrdRead:(S,x,U,W)=>{try{const se=I.cstrToJs(S),fe=G(se);if(!fe)return-1;const me=_(fe,S,x);f?.log?.xRcrdRead&&ie("xRcrdRead",se,me,W,fe);const de=fe.storage.getItem(me);if(de===null)return-1;const ve=de.length;if(W<=0)return ve;if(W===1)return I.poke(U,0),ve;W+1<ve&&Z(n.SQLITE_RANGE,"xRcrdRead()",se,me,"input buffer is too small: need",ve,"but have",W);const Ce=p.memBuffer(0),ze=I.heap8();let Oe;for(Oe=0;Oe<ve;++Oe)ze[I.ptr.add(Ce,Oe)]=de.codePointAt(Oe)&255;return ze.copyWithin(Number(U),Number(Ce),I.ptr.addn(Ce,Oe)),ze[I.ptr.add(U,ve)]=0,W}catch(se){return y("kvrecordRead()",se),p.setError(se),-2}},xRcrdWrite:(S,x,U)=>{try{const W=G(S),se=_(W,S,x),fe=I.cstrToJs(U);return f?.log?.xRcrdWrite&&ie("xRcrdWrite",se,W),W.storage.setItem(se,fe),W.listeners&&ge("write",W,se,fe),0}catch(W){return y("kvrecordWrite()",W),p.setError(W,n.SQLITE_IOERR)}},xRcrdDelete:(S,x)=>{try{const U=G(S),W=_(U,S,x);return f?.log?.xRcrdDelete&&ie("xRcrdDelete",W,U),U.storage.removeItem(W),U.listeners&&ge("delete",U,W),0}catch(U){return y("kvrecordDelete()",U),p.setError(U,n.SQLITE_IOERR)}}},vfs:{xOpen:function(S,x,U,W,se){p.popError();let fe;try{x||(fe=I.allocCString(""+U+"."+(Math.random()*1e5|0)),x=fe);const me=I.cstrToJs(x);f?.log?.xOpen&&F("xOpen",me,"flags =",W),T(me,!0),W&(n.SQLITE_OPEN_MAIN_DB|n.SQLITE_OPEN_TEMP_DB|n.SQLITE_OPEN_TRANSIENT_DB)&&p.rxJournalSuffix.test(me)&&Z(n.SQLITE_ERROR,"DB files may not have a '-journal' suffix.");let de=G(me);!de&&!(W&n.SQLITE_OPEN_CREATE)&&Z(n.SQLITE_ERROR,"Storage not found:",me);const ve=V.vfs.xOpen(S,x,U,W,se);if(ve)return ve;let Ce=!!(n.SQLITE_OPEN_DELETEONCLOSE&W);I.isPtr(arguments[1])&&n.sqlite3_uri_boolean(x,"delete-on-close",0)&&(Ce=!0);const ze=new r(U);if(P.assert(ze.$zClass,"Missing f.$zClass"),ze.addOnDispose(fe),fe=void 0,de)++de.refc,de.files.push(ze),I.poke32(se,W);else{I.poke32(se,W|n.SQLITE_OPEN_CREATE),P.assert(!ze.$isJournal,"Opening a journal before its db? "+me);const Oe=me.replace(p.rxJournalSuffix,"");de=O(Oe),E(de),de.files.push(ze),de.deleteAtRefc0=Ce,f?.log?.xOpen&&F("xOpen installed storage handle [",Oe,Oe+"-journal","]",de)}return q.set(U,{store:de,file:ze,jzClass:me}),de.listeners&&ge("open",de,de.files.length),0}catch(me){return ie("xOpen:",me),p.setError(me)}finally{fe&&I.dealloc(fe)}},xDelete:function(S,x,U){p.popError();try{const W=I.cstrToJs(x);return p.rxJournalSuffix.test(W)&&N.xRcrdDelete(x,p.zKeyJrnl),0}catch(W){return ie("xDelete",W),p.setError(W)}},xAccess:function(S,x,U,W){p.popError();try{const se=G(x),fe=se?.jzClass||I.cstrToJs(x);if(f?.log?.xAccess&&F("xAccess",fe,"flags =",U,"*pResOut =",I.peek32(W),"store =",se),!se)try{T(fe)}catch{return I.poke32(W,0),0}if(se){const me=se.keyPrefix+(p.rxJournalSuffix.test(fe)?"jrnl":"1"),de=se.storage.getItem(me)?0:1;I.poke32(W,de)}else I.poke32(W,0);return 0}catch(se){return y("xAccess",se),p.setError(se)}},xRandomness:function(S,x,U){const W=I.heap8u();let se=0;const fe=Number(U);for(;se<x;++se)W[fe+se]=Math.random()*255e3&255;return x},xGetLastError:function(S,x,U){const W=p.popError();if(F("xGetLastError",W),W){const se=I.scopedAllocPush();try{const[fe,me]=I.scopedAllocCString(W.message,!0);return I.cstrncpy(U,fe,x),me>x&&I.poke8(I.ptr.add(U,x,-1),0),F("set xGetLastError",W.message),W.resultCode|0||n.SQLITE_IOERR}catch{return n.SQLITE_NOMEM}finally{I.scopedAllocPop(se)}}return 0}},ioDb:{xClose:function(S){p.popError();try{const x=q.get(S);if(f?.log?.xClose&&F("xClose",S,x),x){q.delete(S);const U=x.store;U.files=U.files.filter(W=>W!==x.file),--U.refc<=0&&U.deleteAtRefc0&&m(U),V.ioDb.xClose(S),x.file.dispose(),U.listeners&&ge("close",U,U.files.length)}return 0}catch(x){return y("xClose",x),p.setError(x)}},xFileControl:function(S,x,U){p.popError();try{const W=q.get(S);if(P.assert(W,"Missing KVVfsFile handle"),f?.log?.xFileControl&&F("xFileControl",W,"op =",x),x===n.SQLITE_FCNTL_PRAGMA&&H.disablePageSizeChange){const fe=I.peekPtr(I.ptr.add(U,I.ptr.size));if(I.cstrToJs(fe)==="page_size"){f?.log?.xFileControl&&F("xFileControl pragma",I.cstrToJs(fe));const me=I.peekPtr(I.ptr.add(U,2*I.ptr.size));if(me)return f?.log?.xFileControl&&ie("xFileControl pragma",W,"NOT setting page size to",I.cstrToJs(me)),W.file.$szPage=-1,0;if(W.file.$szPage>0)return f?.log?.xFileControl&&ie("xFileControl",W,"getting page size",W.file.$szPage),I.pokePtr(U,I.allocCString(""+W.file.$szPage)),0}}const se=V.ioDb.xFileControl(S,x,U);return se==0&&n.SQLITE_FCNTL_SYNC===x&&W.store.listeners&&ge("sync",W.store,!1),se}catch(W){return y("xFileControl",W),p.setError(W)}},xSync:function(S,x){p.popError();try{const U=q.get(S);f?.log?.xSync&&F("xSync",U),P.assert(U,"Missing KVVfsFile handle");const W=V.ioDb.xSync(S,x);return W==0&&U.store.listeners&&ge("sync",U.store,!0),W}catch(U){return y("xSync",U),p.setError(U)}},xRead:function(S,x,U,W){p.popError();try{if(f?.log?.xRead){const se=q.get(S);P.assert(se,"Missing KVVfsFile handle"),F("xRead",U,W,se)}return V.ioDb.xRead(S,x,U,W)}catch(se){return y("xRead",se),p.setError(se)}},xWrite:function(S,x,U,W){p.popError();try{if(f?.log?.xWrite){const se=q.get(S);P.assert(se,"Missing KVVfsFile handle"),F("xWrite",U,W,se)}return V.ioDb.xWrite(S,x,U,W)}catch(se){return y("xWrite",se),p.setError(se)}}},ioJrnl:{xClose:!0}};F("pVfs and friends",Y,M,h,X,n.sqlite3_file.structInfo,r.structInfo);try{P.assert(p.buffer.n>1024*129,"Heap buffer is not large enough");for(const S of Object.entries(oe.recordHandler)){const x=S[0],U=S[1];N[x]=U,X[X.memberKey(x)]=I.installFunction(X.memberSignature(x),U)}for(const S of Object.entries(oe.vfs)){const x=S[0],U=S[1],W=Y.memberKey(x),se=Y.structInfo.members[x]||P.toss("Missing pVfs.structInfo[",x,"]");V.vfs[x]=I.functionEntry(Y[W]),Y[W]=I.installFunction(se.signature,U)}for(const S of Object.entries(oe.ioDb)){const x=S[0],U=S[1],W=M.memberKey(x);V.ioDb[x]=I.functionEntry(M[W])||P.toss("Missing native pIoDb[",W,"]"),M[W]=I.installFunction(M.memberSignature(x),U)}for(const S of Object.entries(oe.ioJrnl)){const x=S[0],U=S[1],W=h.memberKey(x);V.ioJrnl[x]=I.functionEntry(h[W])||P.toss("Missing native pIoJrnl[",W,"]"),U===!0?h[W]=M[W]||P.toss("Missing copied pIoDb[",W,"]"):h[W]=I.installFunction(h.memberSignature(x),U)}}finally{X.dispose(),Y.dispose(),M.dispose(),h.dispose()}const g=function S(x){if(x==="")return S("local")+S("session");const U=G(x);if(!U)return 0;U.files.length&&(globalThis.localStorage===U.storage||globalThis.sessionStorage===U.storage||Z(n.SQLITE_ACCESS,"Cannot clear in-use database storage."));const W=U.storage,se=[];let fe,me=W.length;for(fe=0;fe<me;++fe){const de=W.key(fe);(!U.keyPrefix||de.startsWith(U.keyPrefix))&&se.push(de)}return se.forEach(de=>W.removeItem(de)),se.length},L=function S(x){if(x==="")return S("local")+S("session");const U=G(x);if(!U)return 0;const W=U.storage;let se,fe=0;for(se=0;se<W.length;++se){const me=W.key(se);(!U.keyPrefix||me.startsWith(U.keyPrefix))&&(fe+=me.length,fe+=W.getItem(me).length)}return fe*2},$=function(...x){let U;x.length===1&&typeof x[0]=="object"?U=x[0]:x.length&&(U=Object.assign(Object.create(null),{name:x[0]}));const W=U?G(U.name):null;W||Z(n.SQLITE_NOTFOUND,"There is no kvvfs storage named",U?.name);const se=W.storage,fe=Object.assign(Object.create(null),{name:W.jzClass,timestamp:Date.now(),pages:[]}),me=Object.create(null),de=W.keyPrefix,ve=de?/^kvvfs-[^-]+-(\w+)/:void 0;let Ce=0,ze=se.length;for(;Ce<ze;++Ce){const Oe=se.key(Ce);if(!de||Oe.startsWith(de)){let et=(de?ve.exec(Oe):void 0)?.[1]??Oe;switch(et){case"jrnl":U.includeJournal&&(fe.journal=se.getItem(Oe));break;case"sz":fe.size=+se.getItem(Oe);break;default:if(et=+et,(!P.isInt32(et)||et<=0)&&Z(n.SQLITE_RANGE,"Malformed kvvfs key: "+Oe),U.decodePages){const ut=se.getItem(Oe),qt=ut.length,lt=p.memBuffer(0),Rt=p.memBuffer(1),ct=I.heap8u();let gt=0;for(;gt<qt;++gt)ct[I.ptr.add(lt,gt)]=ut.codePointAt(gt)&255;ct[I.ptr.add(lt,gt)]=0;const jt=Se(lt,Rt,p.buffer.n);me[et]=ct.slice(Number(Rt),I.ptr.addn(Rt,jt))}else me[et]=se.getItem(Oe);break}}}return U.decodePages&&p.memBufferFree(1),Object.keys(me).map(Oe=>+Oe).sort().forEach(Oe=>fe.pages.push(me[Oe])),fe},ae=function(S,x=!1){!S?.timestamp||!S.name||S.size===void 0||!Array.isArray(S.pages)?Z(n.SQLITE_MISUSE,"Malformed export object."):(!S.size||S.size!==(S.size|0)||S.size>=2147483647)&&Z(n.SQLITE_RANGE,"Invalid db size: "+S.size),T(S.name);let U=G(S.name);const W=!U;U?(x?!U.files||!U.jzClass?Z(n.SQLITE_ERROR,"Internal storage object",S.name,"seems to be malformed."):U.files.length&&Z(n.SQLITE_IOERR_ACCESS,"Cannot import db storage while it is in use."):Z(n.SQLITE_ACCESS,"Storage '"+S.name+"' already exists and","overwrite was not specified."),g(S.name)):U=O(S.name);const se=Q(S.name);let fe;try{const me=U.storage;me.setItem(se+"sz",S.size),S.journal&&me.setItem(se+"jrnl",S.journal),S.pages[0]instanceof Uint8Array?S.pages.forEach((de,ve)=>{const Ce=de.length;fe??=p.memBuffer(1);const ze=p.memBuffer(0),Oe=I.heap8u();Oe.set(de,Number(ze)),Oe[I.ptr.addn(ze,Ce)]=0;const et=Ie(ze,Ce,fe);P.assert(et<p.buffer.n,"Impossibly long output - possibly smashed the heap"),P.assert(I.peek8(I.ptr.add(fe,et))===0,"Expecting NUL-terminated encoded output");const ut=I.cstrToJs(fe);me.setItem(se+(ve+1),ut)}):S.pages[0]&&S.pages.forEach((de,ve)=>me.setItem(se+(ve+1),de)),W&&E(U)}catch{if(!W)try{g(S.name)}catch{}}finally{fe&&p.memBufferFree(1)}return this},re=function(S){let x=G(S);if(x){++x.refc;return}T(S),E(O(S))},pe=function(S){const x=G(S);return!x||C(x.jzClass)||te(x.jzClass)||p.rxJournalSuffix.test(S)?!1:x.refc>x.files.length||x.files.length===0?(--x.refc<=0&&m(x),!0):!1},ke=function(S){(!S||typeof S!="object")&&Z(n.SQLITE_MISUSE,"Expecting a listener object.");let x=G(S.storage);x||(S.storage&&S.reserve?(re(S.storage),x=G(S.storage),P.assert(x,"Unexpectedly cannot fetch reserved storage "+S.storage)):Z(n.SQLITE_NOTFOUND,"No such storage:",S.storage)),S.events&&(x.listeners??=[]).push(S)},he=function(S){const x=G(S?.storage);if(x?.listeners&&S.events){const U=x.listeners.length;x.listeners=x.listeners.filter(se=>se!==S);const W=U>x.listeners.length;return x.listeners.length||(x.listeners=void 0),W}return!1};if(i.kvvfs.reserve=re,i.kvvfs.import=ae,i.kvvfs.export=$,i.kvvfs.unlink=pe,i.kvvfs.listen=ke,i.kvvfs.unlisten=he,i.kvvfs.exists=S=>!!G(S),i.kvvfs.estimateSize=L,i.kvvfs.clear=g,globalThis.Storage&&(n.sqlite3_js_kvvfs_size=(S="")=>L(S),n.sqlite3_js_kvvfs_clear=(S="")=>g(S)),i.oo1?.DB){const S=i.oo1.DB;i.oo1.JsStorageDb=function(U=i.oo1.JsStorageDb.defaultStorageName){const W=S.dbCtorHelper.normalizeArgs(...arguments);switch(W.vfs="kvvfs",W.filename){case":sessionStorage:":W.filename="session";break;case":localStorage:":W.filename="local";break}const se=/(file:(\/\/)?)([^?]+)/.exec(W.filename);T(se?se[3]:W.filename),S.dbCtorHelper.call(this,W)},i.oo1.JsStorageDb.defaultStorageName=p.storagePool.session?"session":j;const x=i.oo1.JsStorageDb;x.prototype=Object.create(S.prototype),x.clearStorage=g,x.prototype.clearStorage=function(){return x.clearStorage(this.affirmOpen().dbFilename(),!0)},x.storageSize=L,x.prototype.storageSize=function(){return x.storageSize(this.affirmOpen().dbFilename(),!0)}}if(i.__isUnderTest&&i.vtab){const S=Object.assign(Object.create(null),{rowid:{type:"INTEGER"},name:{type:"TEXT"},nRef:{type:"INTEGER"},nOpen:{type:"INTEGER"},isTransient:{type:"INTEGER"},dbSize:{type:"INTEGER"}});Object.keys(S).forEach((me,de)=>S[me].colId=de);const x=i.vtab,U=Object.assign(Object.create(null),{row:function(){return p.storagePool[this.names[this.rowid]]}});Object.assign(Object.create(U),{rowid:0,names:Object.keys(p.storagePool).filter(me=>!p.rxJournalSuffix.test(me))});const W=function(me,de){const ve=me instanceof n.sqlite3_vtab_cursor?me:x.xCursor.get(me);return(de||!ve.vTabState)&&(ve.vTabState=Object.assign(Object.create(U),{rowid:0,names:Object.keys(p.storagePool).filter(Ce=>!p.rxJournalSuffix.test(Ce))})),ve.vTabState},se=()=>{},fe=function me(){return me.mod??=new i.capi.sqlite3_module().setupModule({catchExceptions:!0,methods:{xConnect:function(de,ve,Ce,ze,Oe,et){try{const ut=[];Object.keys(S).forEach(lt=>{ut.push(lt+" "+S[lt].type)});const qt=n.sqlite3_declare_vtab(de,"CREATE TABLE ignored("+ut.join(",")+")");if(qt===0){const lt=x.xVtab.create(Oe);P.assert(lt===x.xVtab.get(I.peekPtr(Oe)),"output pointer check failed")}return qt}catch(ut){return x.xErrror("xConnect",ut,n.SQLITE_ERROR)}},xCreate:I.ptr.null,xDisconnect:function(de){return x.xVtab.dispose(de),0},xOpen:function(de,ve){return x.xCursor.create(ve),0},xClose:function(de){const ve=x.xCursor.unget(de);return delete ve.vTabState,ve.dispose(),0},xNext:function(de){const ve=x.xCursor.get(de);return++W(ve).rowid,0},xColumn:function(de,ve,Ce){const ze=W(de),Oe=ze.row();switch(P.assert(Oe,"Unexpected xColumn call"),Ce){case S.rowid.colId:n.sqlite3_result_int(ve,ze.rowid);break;case S.name.colId:n.sqlite3_result_text(ve,Oe.jzClass,-1,n.SQLITE_TRANSIENT);break;case S.nRef.colId:n.sqlite3_result_int(ve,Oe.refc);break;case S.nOpen.colId:n.sqlite3_result_int(ve,Oe.files.length);break;case S.isTransient.colId:n.sqlite3_result_int(ve,!!Oe.deleteAtRefc0);break;case S.dbSize.colId:n.sqlite3_result_int(ve,d(Oe));break;default:return n.sqlite3_result_error(ve,"Invalid column id: "+Ce),n.SQLITE_RANGE}return 0},xRowid:function(de,ve){const Ce=W(de);return x.xRowid(ve,Ce.rowid),0},xEof:function(de){const ve=W(de);return se("xEof?="+!ve.row(),...arguments),!ve.row()},xFilter:function(de,ve,Ce,ze,Oe){return W(de,!0),0},xBestIndex:function(de,ve){const Ce=new n.sqlite3_index_info(ve);return Ce.$estimatedRows=p.storagePool.size,Ce.$estimatedCost=1,Ce.dispose(),0}}})};i.kvvfs.create_module=function(me,de="sqlite_kvvfs"){return n.sqlite3_create_module(me,de,fe(),I.ptr.null)}}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const n=function s(r){if(!globalThis.SharedArrayBuffer||!globalThis.Atomics)return Promise.reject(new Error("Cannot install OPFS: Missing SharedArrayBuffer and/or Atomics. The server must emit the COOP/COEP response headers to enable those. See https://sqlite.org/wasm/doc/trunk/persistence.md#coop-coep"));if(typeof WorkerGlobalScope>"u")return Promise.reject(new Error("The OPFS sqlite3_vfs cannot run in the main thread because it requires Atomics.wait()."));if(!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!navigator?.storage?.getDirectory)return Promise.reject(new Error("Missing required OPFS APIs."));(!r||typeof r!="object")&&(r=Object.create(null));const u=new URL(globalThis.location.href).searchParams;return u.has("opfs-disable")?Promise.resolve(i):(r.verbose===void 0&&(r.verbose=u.has("opfs-verbose")?+u.get("opfs-verbose")||2:1),r.sanityChecks===void 0&&(r.sanityChecks=u.has("opfs-sanity-check")),r.proxyUri===void 0&&(r.proxyUri=s.defaultProxyUri),typeof r.proxyUri=="function"&&(r.proxyUri=r.proxyUri()),new Promise(function(P,I){const Z=[i.config.error,i.config.warn,i.config.log],R=(g,...L)=>{r.verbose>g&&Z[g]("OPFS syncer:",...L)},X=(...g)=>R(2,...g),p=(...g)=>R(1,...g),B=(...g)=>R(0,...g),F=i.util.toss,ie=i.capi,y=i.util,b=i.wasm,C=ie.sqlite3_vfs,Q=ie.sqlite3_file,T=ie.sqlite3_io_methods,O=Object.create(null),f=()=>globalThis.FileSystemHandle&&globalThis.FileSystemDirectoryHandle&&globalThis.FileSystemFileHandle&&globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle&&navigator?.storage?.getDirectory;O.metrics={dump:function(){let g,L=0,$=0,ae=0;for(g in G.opIds){const re=w[g];L+=re.count,$+=re.time,ae+=re.wait,re.avgTime=re.count&&re.time?re.time/re.count:0,re.avgWait=re.count&&re.wait?re.wait/re.count:0}i.config.log(globalThis.location.href,"metrics for",globalThis.location.href,":",w,`
Total of`,L,"op(s) for",$,"ms (incl. "+ae+" ms of waiting on the async side)"),i.config.log("Serialization metrics:",w.s11n),Se.postMessage({type:"opfs-async-metrics"})},reset:function(){let g;const L=ae=>ae.count=ae.time=ae.wait=0;for(g in G.opIds)L(w[g]=Object.create(null));let $=w.s11n=Object.create(null);$=$.serialize=Object.create(null),$.count=$.time=0,$=w.s11n.deserialize=Object.create(null),$.count=$.time=0}};const m=new T,E=new C().addOnDispose(()=>m.dispose());let j;const te=g=>(j=!0,E.dispose(),I(g)),_e=()=>(j=!1,P(i)),Se=new Worker(new URL("/litebistudio/assets/sqlite3-opfs-async-proxy-BWKAW6aw.js",self.location.href));setTimeout(()=>{j===void 0&&te(new Error("Timeout while waiting for OPFS async proxy worker."))},4e3),Se._originalOnError=Se.onerror,Se.onerror=function(g){B("Error initializing OPFS asyncer:",g),te(new Error("Loading OPFS async Worker failed for unknown reasons."))};const Ie=ie.sqlite3_vfs_find(null),ge=Ie?new C(Ie):null;m.$iVersion=1,E.$iVersion=2,E.$szOsFile=ie.sqlite3_file.structInfo.sizeof,E.$mxPathname=1024,E.$zName=b.allocCString("opfs"),E.$xDlOpen=E.$xDlError=E.$xDlSym=E.$xDlClose=null,E.addOnDispose("$zName",E.$zName,"cleanup default VFS wrapper",()=>ge?ge.dispose():null);const G=Object.create(null);G.verbose=r.verbose,G.littleEndian=(()=>{const g=new ArrayBuffer(2);return new DataView(g).setInt16(0,256,!0),new Int16Array(g)[0]===256})(),G.asyncIdleWaitTime=150,G.asyncS11nExceptions=1,G.fileBufferSize=65536,G.sabS11nOffset=G.fileBufferSize,G.sabS11nSize=E.$mxPathname*2,G.sabIO=new SharedArrayBuffer(G.fileBufferSize+G.sabS11nSize),G.opIds=Object.create(null);const w=Object.create(null);{let g=0;G.opIds.whichOp=g++,G.opIds.rc=g++,G.opIds.xAccess=g++,G.opIds.xClose=g++,G.opIds.xDelete=g++,G.opIds.xDeleteNoWait=g++,G.opIds.xFileSize=g++,G.opIds.xLock=g++,G.opIds.xOpen=g++,G.opIds.xRead=g++,G.opIds.xSleep=g++,G.opIds.xSync=g++,G.opIds.xTruncate=g++,G.opIds.xUnlock=g++,G.opIds.xWrite=g++,G.opIds.mkdir=g++,G.opIds["opfs-async-metrics"]=g++,G.opIds["opfs-async-shutdown"]=g++,G.opIds.retry=g++,G.sabOP=new SharedArrayBuffer(g*4),O.metrics.reset()}G.sq3Codes=Object.create(null),["SQLITE_ACCESS_EXISTS","SQLITE_ACCESS_READWRITE","SQLITE_BUSY","SQLITE_CANTOPEN","SQLITE_ERROR","SQLITE_IOERR","SQLITE_IOERR_ACCESS","SQLITE_IOERR_CLOSE","SQLITE_IOERR_DELETE","SQLITE_IOERR_FSYNC","SQLITE_IOERR_LOCK","SQLITE_IOERR_READ","SQLITE_IOERR_SHORT_READ","SQLITE_IOERR_TRUNCATE","SQLITE_IOERR_UNLOCK","SQLITE_IOERR_WRITE","SQLITE_LOCK_EXCLUSIVE","SQLITE_LOCK_NONE","SQLITE_LOCK_PENDING","SQLITE_LOCK_RESERVED","SQLITE_LOCK_SHARED","SQLITE_LOCKED","SQLITE_MISUSE","SQLITE_NOTFOUND","SQLITE_OPEN_CREATE","SQLITE_OPEN_DELETEONCLOSE","SQLITE_OPEN_MAIN_DB","SQLITE_OPEN_READONLY"].forEach(g=>{(G.sq3Codes[g]=ie[g])===void 0&&F("Maintenance required: not found:",g)}),G.opfsFlags=Object.assign(Object.create(null),{OPFS_UNLOCK_ASAP:1,OPFS_UNLINK_BEFORE_OPEN:2,defaultUnlockAsap:!1});const a=(g,...L)=>{const $=G.opIds[g]||F("Invalid op ID:",g);G.s11n.serialize(...L),Atomics.store(G.sabOPView,G.opIds.rc,-1),Atomics.store(G.sabOPView,G.opIds.whichOp,$),Atomics.notify(G.sabOPView,G.opIds.whichOp);const ae=performance.now();for(;Atomics.wait(G.sabOPView,G.opIds.rc,-1)!=="not-equal";);const re=Atomics.load(G.sabOPView,G.opIds.rc);if(w[g].wait+=performance.now()-ae,re&&G.asyncS11nExceptions){const pe=G.s11n.deserialize();pe&&B(g+"() async error:",...pe)}return re};O.debug={asyncShutdown:()=>{p("Shutting down OPFS async listener. The OPFS VFS will no longer work."),a("opfs-async-shutdown")},asyncRestart:()=>{p("Attempting to restart OPFS VFS async listener. Might work, might not."),Se.postMessage({type:"opfs-async-restart"})}};const _=()=>{if(G.s11n)return G.s11n;const g=new TextDecoder,L=new TextEncoder("utf-8"),$=new Uint8Array(G.sabIO,G.sabS11nOffset,G.sabS11nSize),ae=new DataView(G.sabIO,G.sabS11nOffset,G.sabS11nSize);G.s11n=Object.create(null);const re=Object.create(null);re.number={id:1,size:8,getter:"getFloat64",setter:"setFloat64"},re.bigint={id:2,size:8,getter:"getBigInt64",setter:"setBigInt64"},re.boolean={id:3,size:4,getter:"getInt32",setter:"setInt32"},re.string={id:4};const pe=he=>re[typeof he]||F("Maintenance required: this value type cannot be serialized.",he),ke=he=>{switch(he){case re.number.id:return re.number;case re.bigint.id:return re.bigint;case re.boolean.id:return re.boolean;case re.string.id:return re.string;default:F("Invalid type ID:",he)}};return G.s11n.deserialize=function(he=!1){++w.s11n.deserialize.count;const S=performance.now(),x=$[0],U=x?[]:null;if(x){const W=[];let se=1,fe,me,de;for(fe=0;fe<x;++fe,++se)W.push(ke($[se]));for(fe=0;fe<x;++fe){const ve=W[fe];ve.getter?(de=ae[ve.getter](se,G.littleEndian),se+=ve.size):(me=ae.getInt32(se,G.littleEndian),se+=4,de=g.decode($.slice(se,se+me)),se+=me),U.push(de)}}return he&&($[0]=0),w.s11n.deserialize.time+=performance.now()-S,U},G.s11n.serialize=function(...he){const S=performance.now();if(++w.s11n.serialize.count,he.length){const x=[];let U=0,W=1;for($[0]=he.length&255;U<he.length;++U,++W)x.push(pe(he[U])),$[W]=x[U].id;for(U=0;U<he.length;++U){const se=x[U];if(se.setter)ae[se.setter](W,he[U],G.littleEndian),W+=se.size;else{const fe=L.encode(he[U]);ae.setInt32(W,fe.byteLength,G.littleEndian),W+=4,$.set(fe,W),W+=fe.byteLength}}}else $[0]=0;w.s11n.serialize.time+=performance.now()-S},G.s11n},d=function g(L=16){g._chars||(g._chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012346789",g._n=g._chars.length);const $=[];let ae=0;for(;ae<L;++ae){const re=Math.random()*(g._n*64)%g._n|0;$[ae]=g._chars[re]}return $.join("")},q=Object.create(null),V=Object.create(null);V.op=void 0,V.start=void 0;const Y=g=>{V.start=performance.now(),V.op=g,++w[g].count},M=()=>w[V.op].time+=performance.now()-V.start,h={xCheckReservedLock:function(g,L){return b.poke(L,0,"i32"),0},xClose:function(g){Y("xClose");let L=0;const $=q[g];return $&&(delete q[g],L=a("xClose",g),$.sq3File&&$.sq3File.dispose()),M(),L},xDeviceCharacteristics:function(g){return ie.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(g,L,$){return ie.SQLITE_NOTFOUND},xFileSize:function(g,L){Y("xFileSize");let $=a("xFileSize",g);if($==0)try{const ae=G.s11n.deserialize()[0];b.poke(L,ae,"i64")}catch(ae){B("Unexpected error reading xFileSize() result:",ae),$=G.sq3Codes.SQLITE_IOERR}return M(),$},xLock:function(g,L){Y("xLock");const $=q[g];let ae=0;return $.lockType?$.lockType=L:(ae=a("xLock",g,L),ae===0&&($.lockType=L)),M(),ae},xRead:function(g,L,$,ae){Y("xRead");const re=q[g];let pe;try{pe=a("xRead",g,$,Number(ae)),(pe===0||ie.SQLITE_IOERR_SHORT_READ===pe)&&b.heap8u().set(re.sabView.subarray(0,$),Number(L))}catch(ke){B("xRead(",arguments,") failed:",ke,re),pe=ie.SQLITE_IOERR_READ}return M(),pe},xSync:function(g,L){Y("xSync"),++w.xSync.count;const $=a("xSync",g,L);return M(),$},xTruncate:function(g,L){Y("xTruncate");const $=a("xTruncate",g,Number(L));return M(),$},xUnlock:function(g,L){Y("xUnlock");const $=q[g];let ae=0;return ie.SQLITE_LOCK_NONE===L&&$.lockType&&(ae=a("xUnlock",g,L)),ae===0&&($.lockType=L),M(),ae},xWrite:function(g,L,$,ae){Y("xWrite");const re=q[g];let pe;try{re.sabView.set(b.heap8u().subarray(Number(L),Number(L)+$)),pe=a("xWrite",g,$,Number(ae))}catch(ke){B("xWrite(",arguments,") failed:",ke,re),pe=ie.SQLITE_IOERR_WRITE}return M(),pe}},N={xAccess:function(g,L,$,ae){Y("xAccess");const re=a("xAccess",b.cstrToJs(L));return b.poke(ae,re?0:1,"i32"),M(),0},xCurrentTime:function(g,L){return b.poke(L,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(g,L){return b.poke(L,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(g,L,$){Y("xDelete");const ae=a("xDelete",b.cstrToJs(L),$,!1);return M(),ae},xFullPathname:function(g,L,$,ae){return b.cstrncpy(ae,L,$)<$?0:ie.SQLITE_CANTOPEN},xGetLastError:function(g,L,$){return p("OPFS xGetLastError() has nothing sensible to return."),0},xOpen:function(L,$,ae,re,pe){Y("xOpen");let ke=0;$===0?$=d():b.isPtr($)&&(ie.sqlite3_uri_boolean($,"opfs-unlock-asap",0)&&(ke|=G.opfsFlags.OPFS_UNLOCK_ASAP),ie.sqlite3_uri_boolean($,"delete-before-open",0)&&(ke|=G.opfsFlags.OPFS_UNLINK_BEFORE_OPEN),$=b.cstrToJs($));const he=Object.create(null);he.fid=ae,he.filename=$,he.sab=new SharedArrayBuffer(G.fileBufferSize),he.flags=re,he.readOnly=!(ie.SQLITE_OPEN_CREATE&re)&&!!(re&ie.SQLITE_OPEN_READONLY);const S=a("xOpen",ae,$,re,ke);return S||(he.readOnly&&b.poke(pe,ie.SQLITE_OPEN_READONLY,"i32"),q[ae]=he,he.sabView=G.sabFileBufView,he.sq3File=new Q(ae),he.sq3File.$pMethods=m.pointer,he.lockType=ie.SQLITE_LOCK_NONE),M(),S}};ge&&(E.$xRandomness=ge.$xRandomness,E.$xSleep=ge.$xSleep),E.$xRandomness||(N.xRandomness=function(g,L,$){const ae=b.heap8u();let re=0;const pe=Number($);for(;re<L;++re)ae[pe+re]=Math.random()*255e3&255;return re}),E.$xSleep||(N.xSleep=function(g,L){return Atomics.wait(G.sabOPView,G.opIds.xSleep,0,L),0}),O.getResolvedPath=function(g,L){const $=new URL(g,"file://irrelevant").pathname;return L?$.split("/").filter(ae=>!!ae):$},O.getDirForFilename=async function(L,$=!1){const ae=O.getResolvedPath(L,!0),re=ae.pop();let pe=O.rootDirectory;for(const ke of ae)ke&&(pe=await pe.getDirectoryHandle(ke,{create:!!$}));return[pe,re]},O.mkdir=async function(g){try{return await O.getDirForFilename(g+"/filepart",!0),!0}catch{return!1}},O.entryExists=async function(g){try{const[L,$]=await O.getDirForFilename(g);return await L.getFileHandle($),!0}catch{return!1}},O.randomFilename=d,O.treeList=async function(){const g=async function $(ae,re){re.name=ae.name,re.dirs=[],re.files=[];for await(const pe of ae.values())if(pe.kind==="directory"){const ke=Object.create(null);re.dirs.push(ke),await $(pe,ke)}else re.files.push(pe.name)},L=Object.create(null);return await g(O.rootDirectory,L),L},O.rmfr=async function(){const g=O.rootDirectory,L={recurse:!0};for await(const $ of g.values())g.removeEntry($.name,L)},O.unlink=async function(g,L=!1,$=!1){try{const[ae,re]=await O.getDirForFilename(g,!1);return await ae.removeEntry(re,{recursive:L}),!0}catch(ae){if($)throw new Error("unlink(",arguments[0],") failed: "+ae.message,{cause:ae});return!1}},O.traverse=async function(g){const L={recursive:!0,directory:O.rootDirectory};typeof g=="function"&&(g={callback:g}),g=Object.assign(L,g||{}),(async function $(ae,re){for await(const pe of ae.values()){if(g.callback(pe,ae,re)===!1)return!1;if(g.recursive&&pe.kind==="directory"&&await $(pe,re+1)===!1)break}})(g.directory,0)};const H=async function(g,L){const[$,ae]=await O.getDirForFilename(g,!0);let re=await(await $.getFileHandle(ae,{create:!0})).createSyncAccessHandle(),pe=0,ke,he=!1;try{for(re.truncate(0);(ke=await L())!==void 0;)ke instanceof ArrayBuffer&&(ke=new Uint8Array(ke)),!he&&pe===0&&ke.byteLength>=15&&(y.affirmDbHeader(ke),he=!0),re.write(ke,{at:pe}),pe+=ke.byteLength;if((pe<512||pe%512!==0)&&F("Input size",pe,"is not correct for an SQLite database."),!he){const S=new Uint8Array(20);re.read(S,{at:0}),y.affirmDbHeader(S)}return re.write(new Uint8Array([1,1]),{at:18}),pe}catch(S){throw await re.close(),re=void 0,await $.removeEntry(ae).catch(()=>{}),S}finally{re&&await re.close()}};if(O.importDb=async function(g,L){if(L instanceof Function)return H(g,L);L instanceof ArrayBuffer&&(L=new Uint8Array(L)),y.affirmIsDb(L);const $=L.byteLength,[ae,re]=await O.getDirForFilename(g,!0);let pe,ke=0;try{return pe=await(await ae.getFileHandle(re,{create:!0})).createSyncAccessHandle(),pe.truncate(0),ke=pe.write(L,{at:0}),ke!=$&&F("Expected to write "+$+" bytes but wrote "+ke+"."),pe.write(new Uint8Array([1,1]),{at:18}),ke}catch(he){throw pe&&(await pe.close(),pe=void 0),await ae.removeEntry(re).catch(()=>{}),he}finally{pe&&await pe.close()}},i.oo1){const g=function(...L){const $=i.oo1.DB.dbCtorHelper.normalizeArgs(...L);$.vfs=E.$zName,i.oo1.DB.dbCtorHelper.call(this,$)};g.prototype=Object.create(i.oo1.DB.prototype),i.oo1.OpfsDb=g,g.importDb=O.importDb,i.oo1.DB.dbCtorHelper.setVfsPostOpenCallback(E.pointer,function(L,$){$.capi.sqlite3_busy_timeout(L,1e4)})}const oe=function(){const g=b.scopedAllocPush(),L=new Q;try{const $=L.pointer,ae=ie.SQLITE_OPEN_CREATE|ie.SQLITE_OPEN_READWRITE|ie.SQLITE_OPEN_MAIN_DB,re=b.scopedAlloc(8),pe="/sanity/check/file"+d(8),ke=b.scopedAllocCString(pe);let he;if(G.s11n.serialize("This is  string."),he=G.s11n.deserialize(),X("deserialize() says:",he),he[0]!=="This is  string."&&F("String d13n error."),N.xAccess(E.pointer,ke,0,re),he=b.peek(re,"i32"),X("xAccess(",pe,") exists ?=",he),he=N.xOpen(E.pointer,ke,$,ae,re),X("open rc =",he,"state.sabOPView[xOpen] =",G.sabOPView[G.opIds.xOpen]),he!==0){B("open failed with code",he);return}N.xAccess(E.pointer,ke,0,re),he=b.peek(re,"i32"),he||F("xAccess() failed to detect file."),he=h.xSync(L.pointer,0),he&&F("sync failed w/ rc",he),he=h.xTruncate(L.pointer,1024),he&&F("truncate failed w/ rc",he),b.poke(re,0,"i64"),he=h.xFileSize(L.pointer,re),he&&F("xFileSize failed w/ rc",he),X("xFileSize says:",b.peek(re,"i64")),he=h.xWrite(L.pointer,ke,10,1),he&&F("xWrite() failed!");const S=b.scopedAlloc(16);he=h.xRead(L.pointer,S,6,2),b.poke(S+6,0);let x=b.cstrToJs(S);X("xRead() got:",x),x!=="sanity"&&F("Unexpected xRead() value."),N.xSleep&&(X("xSleep()ing before close()ing..."),N.xSleep(E.pointer,2e3),X("waking up from xSleep()")),he=h.xClose($),X("xClose rc =",he,"sabOPView =",G.sabOPView),X("Deleting file:",pe),N.xDelete(E.pointer,ke,4660),N.xAccess(E.pointer,ke,0,re),he=b.peek(re,"i32"),he&&F("Expecting 0 from xAccess(",pe,") after xDelete()."),p("End of OPFS sanity checks.")}finally{L.dispose(),b.scopedAllocPop(g)}};Se.onmessage=function({data:g}){switch(g.type){case"opfs-unavailable":te(new Error(g.payload.join(" ")));break;case"opfs-async-loaded":Se.postMessage({type:"opfs-async-init",args:G});break;case"opfs-async-inited":if(j===!0)break;try{i.vfs.installVfs({io:{struct:m,methods:h},vfs:{struct:E,methods:N}}),G.sabOPView=new Int32Array(G.sabOP),G.sabFileBufView=new Uint8Array(G.sabIO,0,G.fileBufferSize),G.sabS11nView=new Uint8Array(G.sabIO,G.sabS11nOffset,G.sabS11nSize),_(),r.sanityChecks&&(p("Running sanity checks because of opfs-sanity-check URL arg..."),oe()),f()?navigator.storage.getDirectory().then(L=>{Se.onerror=Se._originalOnError,delete Se._originalOnError,i.opfs=O,O.rootDirectory=L,X("End of OPFS sqlite3_vfs setup.",E),_e()}).catch(te):_e()}catch(L){B(L),te(L)}break;default:{const L="Unexpected message from the OPFS async worker: "+JSON.stringify(g);B(L),te(new Error(L));break}}}}))};n.defaultProxyUri="sqlite3-opfs-async-proxy.js",globalThis.sqlite3ApiBootstrap.initializersAsync.push(async s=>{try{let r=n.defaultProxyUri;return s?.scriptInfo?.sqlite3Dir&&(n.defaultProxyUri=s.scriptInfo.sqlite3Dir+r),n().catch(u=>{s.config.warn("Ignoring inability to install OPFS sqlite3_vfs:",u.message)})}catch(r){return s.config.error("installOpfsVfs() exception:",r),Promise.reject(r)}})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const n=i.util.toss,s=i.util.toss3,r=Object.create(null),u=i.capi,P=i.util,I=i.wasm,Z=4096,R=512,X=4,p=8,B=R+X,F=R,ie=B,y=Z,b=u.SQLITE_OPEN_MAIN_DB|u.SQLITE_OPEN_MAIN_JOURNAL|u.SQLITE_OPEN_SUPER_JOURNAL|u.SQLITE_OPEN_WAL,C=u.SQLITE_OPEN_MEMORY,Q=".opaque",T=()=>Math.random().toString(36).slice(2),O=new TextDecoder,f=new TextEncoder,m=Object.assign(Object.create(null),{name:"opfs-sahpool",directory:void 0,initialCapacity:6,clearOnInit:!1,verbosity:2,forceReinitIfPreviouslyFailed:!1}),E=[i.config.error,i.config.warn,i.config.log];i.config.log;const j=i.config.warn;i.config.error;const te=new Map,_e=M=>te.get(M),Se=(M,h)=>{h?te.set(M,h):te.delete(M)},Ie=new Map,ge=M=>Ie.get(M),G=(M,h)=>{h?Ie.set(M,h):Ie.delete(M)},w={xCheckReservedLock:function(M,h){const N=ge(M);return N.log("xCheckReservedLock"),N.storeErr(),I.poke32(h,1),0},xClose:function(M){const h=ge(M);h.storeErr();const N=h.getOFileForS3File(M);if(N)try{h.log(`xClose ${N.path}`),h.mapS3FileToOFile(M,!1),N.sah.flush(),N.flags&u.SQLITE_OPEN_DELETEONCLOSE&&h.deletePath(N.path)}catch(H){return h.storeErr(H,u.SQLITE_IOERR)}return 0},xDeviceCharacteristics:function(M){return u.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(M,h,N){return u.SQLITE_NOTFOUND},xFileSize:function(M,h){const N=ge(M);N.log("xFileSize");const H=N.getOFileForS3File(M).sah.getSize()-y;return I.poke64(h,BigInt(H)),0},xLock:function(M,h){const N=ge(M);N.log(`xLock ${h}`),N.storeErr();const H=N.getOFileForS3File(M);return H.lockType=h,0},xRead:function(M,h,N,H){const oe=ge(M);oe.storeErr();const g=oe.getOFileForS3File(M);oe.log(`xRead ${g.path} ${N} @ ${H}`);try{const L=g.sah.read(I.heap8u().subarray(Number(h),Number(h)+N),{at:y+Number(H)});return L<N?(I.heap8u().fill(0,Number(h)+L,Number(h)+N),u.SQLITE_IOERR_SHORT_READ):0}catch(L){return oe.storeErr(L,u.SQLITE_IOERR)}},xSectorSize:function(M){return Z},xSync:function(M,h){const N=ge(M);N.log(`xSync ${h}`),N.storeErr();const H=N.getOFileForS3File(M);try{return H.sah.flush(),0}catch(oe){return N.storeErr(oe,u.SQLITE_IOERR)}},xTruncate:function(M,h){const N=ge(M);N.log(`xTruncate ${h}`),N.storeErr();const H=N.getOFileForS3File(M);try{return H.sah.truncate(y+Number(h)),0}catch(oe){return N.storeErr(oe,u.SQLITE_IOERR)}},xUnlock:function(M,h){const N=ge(M);N.log("xUnlock");const H=N.getOFileForS3File(M);return H.lockType=h,0},xWrite:function(M,h,N,H){const oe=ge(M);oe.storeErr();const g=oe.getOFileForS3File(M);oe.log(`xWrite ${g.path} ${N} ${H}`);try{return N===g.sah.write(I.heap8u().subarray(Number(h),Number(h)+N),{at:y+Number(H)})?0:n("Unknown write() failure.")}catch(L){return oe.storeErr(L,u.SQLITE_IOERR)}}},a=new u.sqlite3_io_methods;a.$iVersion=1,i.vfs.installVfs({io:{struct:a,methods:w}});const _={xAccess:function(M,h,N,H){const oe=_e(M);oe.storeErr();try{const g=oe.getPath(h);I.poke32(H,oe.hasFilename(g)?1:0)}catch{I.poke32(H,0)}return 0},xCurrentTime:function(M,h){return I.poke(h,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(M,h){return I.poke(h,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(M,h,N){const H=_e(M);H.log(`xDelete ${I.cstrToJs(h)}`),H.storeErr();try{return H.deletePath(H.getPath(h)),0}catch(oe){return H.storeErr(oe),u.SQLITE_IOERR_DELETE}},xFullPathname:function(M,h,N,H){return I.cstrncpy(H,h,N)<N?0:u.SQLITE_CANTOPEN},xGetLastError:function(M,h,N){const H=_e(M),oe=H.popErr();if(H.log(`xGetLastError ${h} e =`,oe),oe){const g=I.scopedAllocPush();try{const[L,$]=I.scopedAllocCString(oe.message,!0);I.cstrncpy(N,L,h),$>h&&I.poke8(I.ptr.add(N,h,-1),0)}catch{return u.SQLITE_NOMEM}finally{I.scopedAllocPop(g)}}return oe?oe.sqlite3Rc||u.SQLITE_IOERR:0},xOpen:function(h,N,H,oe,g){const L=_e(h);try{oe&=~C,L.log(`xOpen ${I.cstrToJs(N)} ${oe}`);const $=N&&I.peek8(N)?L.getPath(N):T();let ae=L.getSAHForPath($);!ae&&oe&u.SQLITE_OPEN_CREATE&&(L.getFileCount()<L.getCapacity()?(ae=L.nextAvailableSAH(),L.setAssociatedPath(ae,$,oe)):n("SAH pool is full. Cannot create file",$)),ae||n("file not found:",$);const re={path:$,flags:oe,sah:ae};L.mapS3FileToOFile(H,re),re.lockType=u.SQLITE_LOCK_NONE;const pe=new u.sqlite3_file(H);return pe.$pMethods=a.pointer,pe.dispose(),I.poke32(g,oe),0}catch($){return L.storeErr($),u.SQLITE_CANTOPEN}}},d=function(M){i.capi.sqlite3_vfs_find(M)&&s("VFS name is already registered:",M);const h=new u.sqlite3_vfs,N=u.sqlite3_vfs_find(null),H=N?new u.sqlite3_vfs(N):null;return h.$iVersion=2,h.$szOsFile=u.sqlite3_file.structInfo.sizeof,h.$mxPathname=R,h.addOnDispose(h.$zName=I.allocCString(M),()=>Se(h.pointer,0)),H&&(h.$xRandomness=H.$xRandomness,h.$xSleep=H.$xSleep,H.dispose()),!h.$xRandomness&&!_.xRandomness&&(_.xRandomness=function(oe,g,L){const $=I.heap8u();let ae=0;const re=Number(L);for(;ae<g;++ae)$[re+ae]=Math.random()*255e3&255;return ae}),!h.$xSleep&&!_.xSleep&&(_.xSleep=(oe,g)=>0),i.vfs.installVfs({vfs:{struct:h,methods:_}}),h};class q{vfsDir;#e;#r;#a;#s=new Map;#t=new Map;#i=new Set;#l=new Map;#n=new Uint8Array(B);#c;#o;#_;constructor(h=Object.create(null)){this.#_=h.verbosity??m.verbosity,this.vfsName=h.name||m.name,this.#o=d(this.vfsName),Se(this.#o.pointer,this),this.vfsDir=h.directory||"."+this.vfsName,this.#c=new DataView(this.#n.buffer,this.#n.byteOffset),this.isReady=this.reset(!!(h.clearOnInit??m.clearOnInit)).then(()=>{if(this.$error)throw this.$error;return this.getCapacity()?Promise.resolve(void 0):this.addCapacity(h.initialCapacity||m.initialCapacity)})}#u(h,...N){this.#_>h&&E[h](this.vfsName+":",...N)}log(...h){this.#u(2,...h)}warn(...h){this.#u(1,...h)}error(...h){this.#u(0,...h)}getVfs(){return this.#o}getCapacity(){return this.#s.size}getFileCount(){return this.#t.size}getFileNames(){const h=[];for(const N of this.#t.keys())h.push(N);return h}async addCapacity(h){for(let N=0;N<h;++N){const H=T(),oe=await(await this.#r.getFileHandle(H,{create:!0})).createSyncAccessHandle();this.#s.set(oe,H),this.setAssociatedPath(oe,"",0)}return this.getCapacity()}async reduceCapacity(h){let N=0;for(const H of Array.from(this.#i)){if(N===h||this.getFileCount()===this.getCapacity())break;const oe=this.#s.get(H);H.close(),await this.#r.removeEntry(oe),this.#s.delete(H),this.#i.delete(H),++N}return N}releaseAccessHandles(){for(const h of this.#s.keys())h.close();this.#s.clear(),this.#t.clear(),this.#i.clear()}async acquireAccessHandles(h=!1){const N=[];for await(const[H,oe]of this.#r)oe.kind==="file"&&N.push([H,oe]);return Promise.all(N.map(async([H,oe])=>{try{const g=await oe.createSyncAccessHandle();if(this.#s.set(g,H),h)g.truncate(y),this.setAssociatedPath(g,"",0);else{const L=this.getAssociatedPath(g);L?this.#t.set(L,g):this.#i.add(g)}}catch(g){throw this.storeErr(g),this.releaseAccessHandles(),g}}))}getAssociatedPath(h){h.read(this.#n,{at:0});const N=this.#c.getUint32(F);if(this.#n[0]&&(N&u.SQLITE_OPEN_DELETEONCLOSE||(N&b)===0))return j(`Removing file with unexpected flags ${N.toString(16)}`,this.#n),this.setAssociatedPath(h,"",0),"";const H=new Uint32Array(p/4);h.read(H,{at:ie});const oe=this.computeDigest(this.#n,N);if(H.every((g,L)=>g===oe[L])){const g=this.#n.findIndex(L=>L===0);return g===0&&h.truncate(y),g?O.decode(this.#n.subarray(0,g)):""}else return j("Disassociating file with bad digest."),this.setAssociatedPath(h,"",0),""}setAssociatedPath(h,N,H){const oe=f.encodeInto(N,this.#n);R<=oe.written+1&&n("Path too long:",N),N&&H&&(H|=C),this.#n.fill(0,oe.written,R),this.#c.setUint32(F,H);const g=this.computeDigest(this.#n,H);h.write(this.#n,{at:0}),h.write(g,{at:ie}),h.flush(),N?(this.#t.set(N,h),this.#i.delete(h)):(h.truncate(y),this.#i.add(h))}computeDigest(h,N){if(N&C){let H=3735928559,oe=1103547991;for(const g of h)H=Math.imul(H^g,2654435761),oe=Math.imul(oe^g,104729);return new Uint32Array([H>>>0,oe>>>0])}else return new Uint32Array([0,0])}async reset(h){await this.isReady;let N=await navigator.storage.getDirectory(),H;for(const oe of this.vfsDir.split("/"))oe&&(H=N,N=await N.getDirectoryHandle(oe,{create:!0}));return this.#e=N,this.#a=H,this.#r=await this.#e.getDirectoryHandle(Q,{create:!0}),this.releaseAccessHandles(),this.acquireAccessHandles(h)}getPath(h){return I.isPtr(h)&&(h=I.cstrToJs(h)),(h instanceof URL?h:new URL(h,"file://localhost/")).pathname}deletePath(h){const N=this.#t.get(h);return N&&(this.#t.delete(h),this.setAssociatedPath(N,"",0)),!!N}storeErr(h,N){return h&&(h.sqlite3Rc=N||u.SQLITE_IOERR,this.error(h)),this.$error=h,N}popErr(){const h=this.$error;return this.$error=void 0,h}nextAvailableSAH(){const[h]=this.#i.keys();return h}getOFileForS3File(h){return this.#l.get(h)}mapS3FileToOFile(h,N){N?(this.#l.set(h,N),G(h,this)):(this.#l.delete(h),G(h,!1))}hasFilename(h){return this.#t.has(h)}getSAHForPath(h){return this.#t.get(h)}async removeVfs(){if(!this.#o.pointer||!this.#r)return!1;u.sqlite3_vfs_unregister(this.#o.pointer),this.#o.dispose(),delete r[this.vfsName];try{this.releaseAccessHandles(),await this.#e.removeEntry(Q,{recursive:!0}),this.#r=void 0,await this.#a.removeEntry(this.#e.name,{recursive:!0}),this.#e=this.#a=void 0}catch(h){i.config.error(this.vfsName,"removeVfs() failed with no recovery strategy:",h)}return!0}pauseVfs(){return this.#l.size>0&&i.SQLite3Error.toss(u.SQLITE_MISUSE,"Cannot pause VFS",this.vfsName,"because it has opened files."),this.#s.size>0&&(u.sqlite3_vfs_unregister(this.vfsName),this.releaseAccessHandles()),this}isPaused(){return this.#s.size===0}async unpauseVfs(){return this.#s.size===0?this.acquireAccessHandles(!1).then(()=>u.sqlite3_vfs_register(this.#o,0),this):this}exportFile(h){const N=this.#t.get(h)||n("File not found:",h),H=N.getSize()-y,oe=new Uint8Array(H>0?H:0);if(H>0){const g=N.read(oe,{at:y});g!=H&&n("Expected to read "+H+" bytes but read "+g+".")}return oe}async importDbChunked(h,N){const H=this.#t.get(h)||this.nextAvailableSAH()||n("No available handles to import to.");H.truncate(0);let oe=0,g,L=!1;try{for(;(g=await N())!==void 0;)g instanceof ArrayBuffer&&(g=new Uint8Array(g)),!L&&oe===0&&g.byteLength>=15&&(P.affirmDbHeader(g),L=!0),H.write(g,{at:y+oe}),oe+=g.byteLength;if((oe<512||oe%512!==0)&&n("Input size",oe,"is not correct for an SQLite database."),!L){const $=new Uint8Array(20);H.read($,{at:0}),P.affirmDbHeader($)}H.write(new Uint8Array([1,1]),{at:y+18})}catch($){throw this.setAssociatedPath(H,"",0),$}return this.setAssociatedPath(H,h,u.SQLITE_OPEN_MAIN_DB),oe}importDb(h,N){if(N instanceof ArrayBuffer)N=new Uint8Array(N);else if(N instanceof Function)return this.importDbChunked(h,N);const H=this.#t.get(h)||this.nextAvailableSAH()||n("No available handles to import to."),oe=N.byteLength;(oe<512||oe%512!=0)&&n("Byte array size is invalid for an SQLite db.");const g="SQLite format 3";for(let $=0;$<15;++$)g.charCodeAt($)!==N[$]&&n("Input does not contain an SQLite database header.");const L=H.write(N,{at:y});return L!=oe?(this.setAssociatedPath(H,"",0),n("Expected to write "+oe+" bytes but wrote "+L+".")):(H.write(new Uint8Array([1,1]),{at:y+18}),this.setAssociatedPath(H,h,u.SQLITE_OPEN_MAIN_DB)),L}}class V{#e;constructor(h){this.#e=h,this.vfsName=h.vfsName}async addCapacity(h){return this.#e.addCapacity(h)}async reduceCapacity(h){return this.#e.reduceCapacity(h)}getCapacity(){return this.#e.getCapacity(this.#e)}getFileCount(){return this.#e.getFileCount()}getFileNames(){return this.#e.getFileNames()}async reserveMinimumCapacity(h){const N=this.#e.getCapacity();return N<h?this.#e.addCapacity(h-N):N}exportFile(h){return this.#e.exportFile(h)}importDb(h,N){return this.#e.importDb(h,N)}async wipeFiles(){return this.#e.reset(!0)}unlink(h){return this.#e.deletePath(h)}async removeVfs(){return this.#e.removeVfs()}pauseVfs(){return this.#e.pauseVfs(),this}async unpauseVfs(){return this.#e.unpauseVfs().then(()=>this)}isPaused(){return this.#e.isPaused()}}const Y=async()=>{const M=await navigator.storage.getDirectory(),h=".opfs-sahpool-sync-check-"+T(),N=(await(await M.getFileHandle(h,{create:!0})).createSyncAccessHandle()).close();return await N,await M.removeEntry(h),N?.then&&n("The local OPFS API is too old for opfs-sahpool:","it has an async FileSystemSyncAccessHandle.close() method."),!0};i.installOpfsSAHPoolVfs=async function(M=Object.create(null)){M=Object.assign(Object.create(null),m,M||{});const h=M.name;if(M.$testThrowPhase1)throw M.$testThrowPhase1;if(r[h])try{return await r[h]}catch(N){if(M.forceReinitIfPreviouslyFailed)delete r[h];else throw N}return!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!navigator?.storage?.getDirectory?r[h]=Promise.reject(new Error("Missing required OPFS APIs.")):r[h]=Y().then(async function(){if(M.$testThrowPhase2)throw M.$testThrowPhase2;const N=new q(M);return N.isReady.then(async()=>{const H=new V(N);if(i.oo1){const oe=i.oo1,g=N.getVfs(),L=function(...$){const ae=oe.DB.dbCtorHelper.normalizeArgs(...$);ae.vfs=g.$zName,oe.DB.dbCtorHelper.call(this,ae)};L.prototype=Object.create(oe.DB.prototype),H.OpfsSAHPoolDb=L}return N.log("VFS initialized."),H}).catch(async H=>{throw await N.removeVfs().catch(()=>{}),H})}).catch(N=>r[h]=Promise.reject(N))}});try{const i=Object.assign(Object.create(null),{memory:typeof pt<"u"?pt:t.wasmMemory,exports:typeof wt<"u"?wt:Object.prototype.hasOwnProperty.call(t,"wasmExports")?t.wasmExports:t.asm},globalThis.sqlite3ApiBootstrap.defaultConfig,globalThis.sqlite3ApiConfig||{});e.debugModule("Bootstrapping lib config",i);const n=globalThis.sqlite3ApiBootstrap(i);return delete globalThis.sqlite3ApiBootstrap,n}catch(i){throw console.error("sqlite3ApiBootstrap() error:",i),i}},rn?J=l:J=new Promise((e,t)=>{Ge=e,Xe=t}),J}Bt=(function(){const D=Bt;if(!D)throw new Error("Expecting sqlite3InitModule to be defined by the Emscripten build.");const J=globalThis.sqlite3InitModuleState=Object.assign(Object.create(null),{moduleScript:globalThis?.document?.currentScript,isWorker:typeof WorkerGlobalScope<"u",location:globalThis.location,urlParams:globalThis?.location?.href?new URL(globalThis.location.href).searchParams:new URLSearchParams,wasmFilename:"sqlite3.wasm"});if(J.debugModule=J.urlParams.has("sqlite3.debugModule")?(...ne)=>console.warn("sqlite3.debugModule:",...ne):()=>{},J.urlParams.has("sqlite3.dir"))J.sqlite3Dir=J.urlParams.get("sqlite3.dir")+"/";else if(J.moduleScript){const ne=J.moduleScript.src.split("/");ne.pop(),J.sqlite3Dir=ne.join("/")+"/"}const l=globalThis.sqlite3InitModule=function ne(...qe){return J.emscriptenLocateFile=qe[0]?.locateFile,J.emscriptenInstantiateWasm=qe[0]?.instantiateWasm,D(...qe).then(ye=>{J.debugModule("sqlite3InitModule() sIMS =",J),J.debugModule("sqlite3InitModule() EmscriptenModule =",ye);const we=ye.runSQLite3PostLoadInit(J,ye,!!ne.__isUnderTest);return J.debugModule("sqlite3InitModule() sqlite3 =",we),we}).catch(ye=>{throw console.error("Exception loading sqlite3 module:",ye),ye})};if(l.ready=D.ready,J.moduleScript){let ne=J.moduleScript.src.split("/");ne.pop(),J.scriptDir=ne.join("/")+"/"}return J.debugModule("extern-post-js.c-pp.js sqlite3InitModuleState =",J),l})();var wn=Bt;globalThis.sqlite3Worker1Promiser=function D(J=D.defaultConfig){if(arguments.length===1&&typeof arguments[0]=="function"){const z=J;J=Object.assign(Object.create(null),D.defaultConfig),J.onready=z}else J=Object.assign(Object.create(null),D.defaultConfig,J);const l=Object.create(null),ne=function(){},qe=J.onerror||ne,ye=J.debug||ne,we=J.generateMessageId?void 0:Object.create(null),Ue=J.generateMessageId||function(z){return z.type+"#"+(we[z.type]=(we[z.type]||0)+1)},Me=(...z)=>{throw new Error(z.join(" "))};J.worker||(J.worker=D.defaultConfig.worker),typeof J.worker=="function"&&(J.worker=J.worker());let Le,He;return J.worker.onmessage=function(z){z=z.data,ye("worker1.onmessage",z);let ue=l[z.messageId];if(!ue){if(z&&z.type==="sqlite3-api"&&z.result==="worker1-ready"){J.onready&&J.onready(He);return}if(ue=l[z.type],ue&&ue.onrow){ue.onrow(z);return}J.onunhandled?J.onunhandled(arguments[0]):qe("sqlite3Worker1Promiser() unhandled worker message:",z);return}switch(delete l[z.messageId],z.type){case"error":ue.reject(z);return;case"open":Le||(Le=z.dbId);break;case"close":z.dbId===Le&&(Le=void 0);break}try{ue.resolve(z)}catch(ce){ue.reject(ce)}},He=function(){let z;arguments.length===1?z=arguments[0]:arguments.length===2?(z=Object.create(null),z.type=arguments[0],z.args=arguments[1],z.dbId=z.args.dbId):Me("Invalid arguments for sqlite3Worker1Promiser()-created factory."),!z.dbId&&z.type!=="open"&&(z.dbId=Le),z.messageId=Ue(z),z.departureTime=performance.now();const ue=Object.create(null);ue.message=z;let ce;z.type==="exec"&&z.args&&(typeof z.args.callback=="function"?(ce=z.messageId+":row",ue.onrow=z.args.callback,z.args.callback=ce,l[ce]=ue):typeof z.args.callback=="string"&&Me("exec callback may not be a string when using the Promise interface."));let Te=new Promise(function(Ge,Xe){ue.resolve=Ge,ue.reject=Xe,l[z.messageId]=ue,ye("Posting",z.type,"message to Worker dbId="+(Le||"default")+":",z),J.worker.postMessage(z)});return ce&&(Te=Te.finally(()=>delete l[ce])),Te}},globalThis.sqlite3Worker1Promiser.defaultConfig={worker:function(){return new Worker(new URL("/litebistudio/assets/sqlite3-worker1-DXWo2tlp.js",self.location.href),{type:"module"})},onerror:(...D)=>console.error("sqlite3Worker1Promiser():",...D)},globalThis.sqlite3Worker1Promiser.v2=(function D(J=D.defaultConfig){let l;typeof J=="function"?(l=J,J={}):typeof J?.onready=="function"&&(l=J.onready,delete J.onready);const ne=Object.create(null);J=Object.assign(J||Object.create(null),{onready:async function(ye){try{l&&await l(ye),ne.resolve(ye)}catch(we){ne.reject(we)}}});const qe=new Promise(function(ye,we){ne.resolve=ye,ne.reject=we});try{this.original(J)}catch(ye){ne.reject(ye)}return qe}).bind({original:sqlite3Worker1Promiser}),globalThis.sqlite3Worker1Promiser.v2.defaultConfig=globalThis.sqlite3Worker1Promiser.defaultConfig,sqlite3Worker1Promiser.v2,delete globalThis.sqlite3Worker1Promiser;var An=wn,Ft=`-- Core Infrastructure Tables
CREATE TABLE IF NOT EXISTS sys_settings (
    key TEXT PRIMARY KEY,
    value TEXT
);

CREATE TABLE IF NOT EXISTS sys_user_widgets (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    sql_statement_id TEXT,
    sql_query TEXT NOT NULL,
    visualization_config TEXT, -- JSON
    visual_builder_config TEXT, -- JSON string of QueryConfig (for reload)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE INDEX IF NOT EXISTS idx_sys_user_widgets_sql_statement ON sys_user_widgets(sql_statement_id);

CREATE TABLE IF NOT EXISTS sys_worklist (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    source_table TEXT NOT NULL,
    source_id TEXT NOT NULL,
    display_label TEXT,
    display_context TEXT,
    status TEXT DEFAULT 'open',
    priority TEXT DEFAULT 'normal',
    due_at TIMESTAMP,
    comment TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS sys_migrations (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT UNIQUE,
    applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS sys_dashboards (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    layout TEXT, -- JSON string of SavedWidget[]
    is_default INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS sys_report_packs (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    config TEXT, -- JSON string of ReportPackConfig
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS sys_sql_statement (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    sql_text TEXT NOT NULL,
    description TEXT DEFAULT '',
    scope TEXT NOT NULL DEFAULT 'global',
    tags TEXT DEFAULT '',
    is_favorite INTEGER NOT NULL DEFAULT 0,
    use_count INTEGER NOT NULL DEFAULT 0,
    last_used_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(name, scope)
);

CREATE INDEX IF NOT EXISTS idx_sys_sql_scope_name ON sys_sql_statement(scope, name);
CREATE INDEX IF NOT EXISTS idx_sys_sql_last_used ON sys_sql_statement(last_used_at DESC);

CREATE TABLE IF NOT EXISTS sys_health_snapshot (
    id TEXT PRIMARY KEY,
    scope TEXT NOT NULL DEFAULT 'database',
    status TEXT NOT NULL,
    score INTEGER NOT NULL,
    checks_run INTEGER NOT NULL DEFAULT 0,
    findings_json TEXT NOT NULL, -- JSON array of findings
    metadata_json TEXT, -- Optional JSON metadata
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX IF NOT EXISTS idx_sys_health_snapshot_created_at ON sys_health_snapshot(created_at DESC);
`,Yt=`DROP VIEW IF EXISTS kpi_history;
CREATE VIEW kpi_history AS
SELECT 
    'Volume' as metric, 
    SUM(Amount) as value, 
    'EUR' as unit, 
    'Actuals' as category, 
    CASE 
        WHEN Period LIKE '%-13' THEN date(MAX(PostingDate), '+1 day') 
        ELSE MAX(PostingDate) 
    END as date,
    Period as period
FROM records
GROUP BY Period;

DROP VIEW IF EXISTS latest_kpis;
CREATE VIEW latest_kpis AS
SELECT * FROM kpi_history
GROUP BY metric
ORDER BY date DESC;

-- Detailed summary view
DROP VIEW IF EXISTS data_summary_view;
CREATE VIEW data_summary_view AS
SELECT 
    SUM(Amount) as total_amount,
    COUNT(DISTINCT VendorName) as active_entities,
    MAX(PostingDate) as latest_date,
    MAX(FiscalYear) as latest_year,
    'EUR' as unit
FROM records;

-- Anomaly Radar View
DROP VIEW IF EXISTS view_anomalies;
CREATE VIEW view_anomalies AS
WITH ItemHistory AS (
    SELECT 
        *,
        LAG(Amount) OVER (
            PARTITION BY Category, SubCategory
            ORDER BY Period
        ) as PrevAmount,
        LAG(Period) OVER (
            PARTITION BY Category, SubCategory
            ORDER BY Period
        ) as PrevPeriod
    FROM records
),
ScoredItems AS (
    SELECT 
        *,
        -- 1. Drift Score: High deviation from previous amount
        CASE 
            WHEN PrevAmount IS NOT NULL AND Amount > PrevAmount * 1.2 AND (Amount - PrevAmount) > 500 THEN 50
            WHEN PrevAmount IS NOT NULL AND Amount < PrevAmount * 0.8 AND (PrevAmount - Amount) > 500 THEN 20
            ELSE 0 
        END as ScoreDrift,
        
        -- 2. New Item Score: First time appearance
        CASE 
            WHEN PrevAmount IS NULL THEN 30 
            ELSE 0 
        END as ScoreNew,

        -- 3. Quality Score: Synthetic IDs
        CASE 
            WHEN id < 0 THEN 25 
            ELSE 0 
        END as ScoreQuality,

        -- 4. Value Score: Logarithmic scale of amount (cap at 50)
        MIN(50, CAST((LOG10(MAX(ABS(Amount), 1)) * 10) AS INTEGER)) as ScoreValue
    FROM ItemHistory
)
SELECT 
    *,
    (ScoreDrift + ScoreNew + ScoreQuality + ScoreValue) as RiskScore,
    CASE
        WHEN ScoreDrift > 0 THEN 'Cost Drift'
        WHEN ScoreNew > 0 THEN 'New Item'
        WHEN ScoreQuality > 0 THEN 'Data Quality'
        ELSE 'Review'
    END as AnomalyType
FROM ScoredItems
WHERE RiskScore > 40;
`;const zt="error",Zt={off:0,error:1,warn:2,info:3,debug:4};function In(D){return D&&(D==="off"||D==="error"||D==="warn"||D==="info"||D==="debug")?D:zt}function Ct(D,J){return Zt[D]>=Zt[J]}function Wt(D,J){const l=D[J];return typeof l=="string"?l:""}function Qt(D){return D.replace(/"/g,'""')}function kn(D){D.exec("PRAGMA foreign_keys = OFF");try{D.exec("BEGIN TRANSACTION");const J=[];D.exec({sql:"SELECT name FROM sqlite_master WHERE type='view' AND name NOT LIKE 'sqlite_%'",rowMode:"object",callback:qe=>J.push(Wt(qe,"name"))});for(const qe of J)D.exec(`DROP VIEW IF EXISTS "${Qt(qe)}"`);const l=[];D.exec({sql:"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'",rowMode:"object",callback:qe=>l.push(Wt(qe,"name"))});for(const qe of l)D.exec(`DROP TABLE IF EXISTS "${Qt(qe)}"`);const ne=[];D.exec({sql:"SELECT name FROM sqlite_master WHERE type='trigger' AND name NOT LIKE 'sqlite_%'",rowMode:"object",callback:qe=>ne.push(Wt(qe,"name"))});for(const qe of ne)D.exec(`DROP TRIGGER IF EXISTS "${Qt(qe)}"`);D.exec("COMMIT")}catch(J){try{D.exec("ROLLBACK")}catch{}throw J}finally{D.exec("PRAGMA foreign_keys = ON")}}let We=null,mt=null,At=null,It="memory",kt=null,vt=zt;const Qe=(...D)=>{Ct(vt,"info")&&console.info("[DB Worker]",...D)},On=(...D)=>{Ct(vt,"debug")&&console.debug("[DB Worker]",...D)},en=(...D)=>{Ct(vt,"warn")&&console.warn("[DB Worker]",...D)},tt=(...D)=>{Ct(vt,"error")&&console.error("[DB Worker]",...D)},ft=11;function Ze(D){return D instanceof Error?D.message:String(D)}function Ot(D){return typeof D=="object"&&D!==null}function Ve(D,J){const l=D[J];return typeof l=="string"?l:""}function dt(D){return D.replace(/"/g,'""')}function at(){if(!We)throw new Error("Database not initialized");return We}function tn(){if(!mt)throw new Error("SQLite API not initialized");return mt}function Vt(D){if(!D)return;let J=D.selectValue("PRAGMA user_version");if(Qe(`Current database schema version: ${J} (Target: ${ft})`),J>=ft){Qe("Database is up to date.");return}if(J<1&&(Qe("Migration V1: Initializing infrastructure schema..."),D.exec(Ft),D.exec("PRAGMA user_version = 1"),J=1),J<2){Qe("Migration V2: Adding visual_builder_config to sys_user_widgets...");try{const l=[];D.exec({sql:"PRAGMA table_info(sys_user_widgets)",rowMode:"object",callback:ne=>l.push(Ve(ne,"name"))}),l.length>0&&!l.includes("visual_builder_config")&&D.exec("ALTER TABLE sys_user_widgets ADD COLUMN visual_builder_config TEXT")}catch(l){tt("Migration failed for V2",l)}D.exec("PRAGMA user_version = 2"),J=2}if(J<3){Qe("Migration V3: Enhancing sys_worklist...");try{const l=[];D.exec({sql:"PRAGMA table_info(sys_worklist)",rowMode:"object",callback:ne=>l.push(Ve(ne,"name"))}),l.length>0&&(l.includes("comment")||D.exec("ALTER TABLE sys_worklist ADD COLUMN comment TEXT"),l.includes("updated_at")||(D.exec("ALTER TABLE sys_worklist ADD COLUMN updated_at TIMESTAMP"),D.exec("UPDATE sys_worklist SET updated_at = CURRENT_TIMESTAMP WHERE updated_at IS NULL")))}catch(l){tt("Migration failed for V3",l)}D.exec("PRAGMA user_version = 3"),J=3}if(J<4){Qe("Migration V4: Adding sys_report_packs and sys_dashboards...");try{D.exec(`
                CREATE TABLE IF NOT EXISTS sys_report_packs (
                    id TEXT PRIMARY KEY,
                    name TEXT NOT NULL,
                    description TEXT,
                    config TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                
                CREATE TABLE IF NOT EXISTS sys_dashboards (
                    id TEXT PRIMARY KEY,
                    name TEXT NOT NULL,
                    layout TEXT,
                    is_default INTEGER DEFAULT 0,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            `)}catch(l){tt("Migration failed for V4",l)}D.exec("PRAGMA user_version = 4"),J=4}if(J<5){Qe("Migration V5: Finalizing versioning system...");try{D.exec(Yt)}catch{Qe("Warning: views.sql execution partially or fully failed")}D.exec("PRAGMA user_version = 5"),J=5}if(J<6){Qe("Migration V6: Unifying sys_worklist statuses...");try{D.exec("UPDATE sys_worklist SET status = 'open' WHERE status = 'pending'"),D.exec("UPDATE sys_worklist SET status = 'closed' WHERE status IN ('error', 'obsolete', 'clarification')"),D.exec("UPDATE sys_worklist SET status = 'done' WHERE status = 'ok'")}catch(l){tt("Migration failed for V6",l)}D.exec("PRAGMA user_version = 6"),J=6}if(J<7){Qe("Migration V7: Adding category to sys_report_packs...");try{const l=[];D.exec({sql:"PRAGMA table_info(sys_report_packs)",rowMode:"object",callback:ne=>l.push(Ve(ne,"name"))}),l.length>0&&!l.includes("category")&&D.exec("ALTER TABLE sys_report_packs ADD COLUMN category TEXT"),D.exec("UPDATE sys_report_packs SET category = 'General' WHERE category IS NULL OR TRIM(category) = ''")}catch(l){tt("Migration failed for V7",l)}D.exec("PRAGMA user_version = 7"),J=7}if(J<8){Qe("Migration V8: Adding sys_sql_statement...");try{D.exec(`
                CREATE TABLE IF NOT EXISTS sys_sql_statement (
                    id TEXT PRIMARY KEY,
                    name TEXT NOT NULL,
                    sql_text TEXT NOT NULL,
                    description TEXT DEFAULT '',
                    scope TEXT NOT NULL DEFAULT 'global',
                    tags TEXT DEFAULT '',
                    is_favorite INTEGER NOT NULL DEFAULT 0,
                    use_count INTEGER NOT NULL DEFAULT 0,
                    last_used_at TIMESTAMP,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    UNIQUE(name, scope)
                );
                CREATE INDEX IF NOT EXISTS idx_sys_sql_scope_name ON sys_sql_statement(scope, name);
                CREATE INDEX IF NOT EXISTS idx_sys_sql_last_used ON sys_sql_statement(last_used_at DESC);
            `)}catch(l){tt("Migration failed for V8",l)}D.exec("PRAGMA user_version = 8"),J=8}if(J<9){Qe("Migration V9: Adding sql_statement_id to sys_user_widgets...");try{const l=[];D.exec({sql:"PRAGMA table_info(sys_user_widgets)",rowMode:"object",callback:ne=>l.push(Ve(ne,"name"))}),l.length>0&&!l.includes("sql_statement_id")&&D.exec("ALTER TABLE sys_user_widgets ADD COLUMN sql_statement_id TEXT"),D.exec("CREATE INDEX IF NOT EXISTS idx_sys_user_widgets_sql_statement ON sys_user_widgets(sql_statement_id)"),D.exec(`
                UPDATE sys_user_widgets
                SET sql_statement_id = (
                    SELECT s.id
                    FROM sys_sql_statement s
                    WHERE TRIM(s.sql_text) = TRIM(sys_user_widgets.sql_query)
                    LIMIT 1
                )
                WHERE (sql_statement_id IS NULL OR TRIM(sql_statement_id) = '')
            `)}catch(l){tt("Migration failed for V9",l)}D.exec("PRAGMA user_version = 9"),J=9}if(J<10){Qe("Migration V10: Adding priority and due_at to sys_worklist...");try{const l=[];D.exec({sql:"PRAGMA table_info(sys_worklist)",rowMode:"object",callback:ne=>l.push(Ve(ne,"name"))}),l.length>0&&(l.includes("priority")||D.exec("ALTER TABLE sys_worklist ADD COLUMN priority TEXT DEFAULT 'normal'"),l.includes("due_at")||D.exec("ALTER TABLE sys_worklist ADD COLUMN due_at TIMESTAMP"),D.exec("UPDATE sys_worklist SET priority = 'normal' WHERE priority IS NULL OR TRIM(priority) = ''"))}catch(l){tt("Migration failed for V10",l)}D.exec("PRAGMA user_version = 10"),J=10}if(J<11){Qe("Migration V11: Adding sys_health_snapshot...");try{D.exec(`
                CREATE TABLE IF NOT EXISTS sys_health_snapshot (
                    id TEXT PRIMARY KEY,
                    scope TEXT NOT NULL DEFAULT 'database',
                    status TEXT NOT NULL,
                    score INTEGER NOT NULL,
                    checks_run INTEGER NOT NULL DEFAULT 0,
                    findings_json TEXT NOT NULL,
                    metadata_json TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX IF NOT EXISTS idx_sys_health_snapshot_created_at ON sys_health_snapshot(created_at DESC);
            `)}catch(l){tt("Migration failed for V11",l)}D.exec("PRAGMA user_version = 11"),J=11}Qe(`Database migrated to version ${J}`)}async function it(){if(!We)return At||(At=(async()=>{try{Qe("Initializing SQLite...");const D=!1;if(mt=await An({print:Qe,printErr:(...l)=>{const ne=l.join(" ");D&&(ne.includes("OPFS asyncer")||ne.includes("GetSyncHandleError")),tt(...l)}}),mt.oo1.OpfsDb)try{We=new mt.oo1.OpfsDb("/litebistudio.sqlite3"),It="opfs",kt=null,Qe("Opened OPFS database")}catch(l){tt("OPFS unavailable OR corrupted, falling back to memory",l),Ze(l).includes("is not a database")&&Qe("Database file corrupted on disk. User should restore backup."),We=new mt.oo1.DB(":memory:"),It="memory",kt=Ze(l)}else Qe("OPFS not supported, using memory"),We=new mt.oo1.DB(":memory:"),It="memory",kt="OPFS not supported in this environment.";return Vt(We),!0}catch(D){throw tt("Initialization failed",D),At=null,D}})(),At)}async function Nn(D){if(!D)return Qe("No demo data provided for generic loader."),0;try{const J=at();J.exec("BEGIN TRANSACTION");let l=0;for(const[ne,qe]of Object.entries(D))Array.isArray(qe)&&qe.length>0&&J.selectValue("SELECT count(*) FROM sqlite_master WHERE type='table' AND name=?",[ne])&&(nn(ne,qe,!1),l+=qe.length);return J.exec("COMMIT"),Qe(`Demo data loaded successfully: ${l} records across multiple tables.`),l}catch(J){throw at().exec("ROLLBACK"),tt("Failed to load demo data",J),J}}function nn(D,J,l=!0){if(J.length===0)return;if(!/^[a-z0-9_]+$/i.test(D))throw new Error(`Invalid table name: ${D}`);const ne=at(),qe=[];ne.exec({sql:`PRAGMA table_info("${D}")`,rowMode:"object",callback:Le=>{const He=Le.name;typeof He=="string"&&He.length>0&&qe.push(He)}});const ye=Object.keys(J[0]).filter(Le=>qe.includes(Le));if(ye.length===0)throw new Error(`No matching columns found for table "${D}" in import payload.`);const we=ye.map(()=>"?").join(", "),Ue=ye.map(Le=>`"${Le}"`).join(", "),Me=`INSERT INTO ${D} (${Ue}) VALUES (${we})`;l&&ne.exec("BEGIN TRANSACTION");try{const Le=ne.prepare(Me);try{for(const He of J){const z=ye.map(ue=>{const ce=He[ue];return ce===void 0?null:ce});Le.bind(z),Le.step(),Le.reset()}}finally{Le.finalize()}l&&ne.exec("COMMIT")}catch(Le){throw l&&ne.exec("ROLLBACK"),Le}}async function xn(D){const{id:J,type:l,payload:ne}=D.data;try{let qe;switch(l){case"INIT":await it(),qe=!0;break;case"EXEC":{We||await it();const ye=at(),we=Ot(ne)?ne:{},Ue=typeof we.sql=="string"?we.sql:"",Me=Array.isArray(we.bind)?we.bind:void 0,Le=[];ye.exec({sql:Ue,bind:Me,rowMode:"object",callback:He=>Le.push(He)}),qe=Le;break}case"SET_LOG_LEVEL":{const ye=Ot(ne)?ne:{},we=typeof ye.level=="string"?ye.level:null;vt=In(we),On("Log level updated:",vt),qe=!0;break}case"GET_DIAGNOSTICS":We||await it(),qe=Pn();break;case"GET_DATABASE_HEALTH":We||await it(),qe=Ln();break;case"GET_STORAGE_STATUS":We||await it(),qe={mode:It,reason:kt};break;case"EXPORT":We||await it(),qe=tn().capi.sqlite3_js_db_export(at().pointer);break;case"IMPORT":{if(!(ne instanceof ArrayBuffer))throw new Error("IMPORT payload must be ArrayBuffer");qe=await Rn(ne);break}case"CLEAR":{We||await it();const ye=at();try{ye.exec("BEGIN TRANSACTION");const we=[];ye.exec({sql:"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' AND name NOT LIKE 'sys_%'",rowMode:"object",callback:Ue=>we.push(Ve(Ue,"name"))});for(const Ue of we)ye.exec(`DELETE FROM ${Ue};`);ye.exec("COMMIT"),Qe("Database cleared (all user tables)")}catch(we){throw ye.exec("ROLLBACK"),we}qe=!0;break}case"FACTORY_RESET":We||await it();{const ye=at();Qe("Running in-place factory reset (drop views/tables/triggers + reinitialize schema)..."),kn(ye),ye.exec(Ft);try{ye.exec(Yt)}catch(we){en("views.sql execution partially failed during factory reset rebuild:",we)}Vt(ye)}qe=!0;break;case"CLEAR_TABLE":{We||await it();const ye=at(),we=Ot(ne)?ne:{},Ue=typeof we.tableName=="string"?we.tableName:"";if(!/^[a-z0-9_]+$/i.test(Ue))throw new Error(`Invalid table name: ${Ue}`);ye.exec(`DELETE FROM ${Ue};`),qe=!0;break}case"GENERIC_BULK_INSERT":{We||await it();const ye=Ot(ne)?ne:{},we=typeof ye.tableName=="string"?ye.tableName:"",Ue=Array.isArray(ye.records)?ye.records:[];nn(we,Ue),qe=Ue.length;break}case"EXPORT_DEMO_DATA":{We||await it();const ye=at(),we={},Ue=[];ye.exec({sql:"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'",rowMode:"object",callback:Me=>Ue.push(Ve(Me,"name"))});for(const Me of Ue){const Le=[];ye.exec({sql:`SELECT * FROM ${Me}`,rowMode:"object",callback:He=>Le.push(He)}),we[Me]=Le}qe=we;break}case"LOAD_DEMO":{We||await it(),qe=await Nn(Ot(ne)?ne:void 0);break}case"CLOSE":We&&(Qe("Closing database..."),We.close(),We=null),qe=!0,self.close();break}self.postMessage({id:J,result:qe})}catch(qe){self.postMessage({id:J,error:Ze(qe)})}}function Pn(){const D=at(),J=D.selectValue("PRAGMA page_count"),l=D.selectValue("PRAGMA page_size"),ne=J*l,qe={},ye=[];D.exec({sql:"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'",rowMode:"object",callback:we=>ye.push(Ve(we,"name"))});for(const we of ye)qe[we]=Number(D.selectValue(`SELECT count(*) FROM "${we}"`)||0);return{dbSize:ne,pageCount:J,pageSize:l,tableStats:qe,schemaVersion:D.selectValue("PRAGMA user_version"),storageMode:It,storageReason:kt}}function Ln(){const D=at(),J=[];let l=0;const ne=(z,ue,ce,Te,Ge)=>{J.push({severity:z,code:ue,title:ce,details:Te,recommendation:Ge})},qe=z=>{const ue=[];return D.exec({sql:`PRAGMA table_info("${dt(z)}")`,rowMode:"object",callback:ce=>{const Te=Ve(ce,"name");Te&&ue.push(Te)}}),ue},ye=z=>Number(D.selectValue("SELECT COUNT(*) FROM sqlite_master WHERE type='index' AND name = ?",[z])||0)>0,we=(z,ue,ce)=>{const Te=[];D.exec({sql:`PRAGMA index_list("${dt(z)}")`,rowMode:"object",callback:Ge=>{const Xe=Ve(Ge,"name");!Xe||Xe.startsWith("sqlite_")||Te.push({name:Xe,unique:Number(Ge.unique||0)===1})}});for(const Ge of Te){if(!Ge.unique)continue;const Xe=[];D.exec({sql:`PRAGMA index_info("${dt(Ge.name)}")`,rowMode:"object",callback:xe=>{const $e=Ve(xe,"name");$e&&Xe.push({seqno:Number(xe.seqno||0),name:$e})}});const Re=Xe.sort((xe,$e)=>xe.seqno-$e.seqno).map(xe=>xe.name);if(Re.length===ue.length&&Re.every((xe,$e)=>xe===ue[$e]))return!0}return!1};l+=1;try{const z=Number(D.selectValue("PRAGMA user_version")||0);z<ft?ne("error","schema_version_outdated","Database schema version is outdated",`Current: ${z}, expected: ${ft}.`,"Run migrations by reopening the app or executing maintenance routines to upgrade the schema."):z>ft?ne("warning","schema_version_ahead","Database schema version is newer than expected",`Current: ${z}, expected: ${ft}.`,"Verify application and database compatibility before continuing."):ne("info","schema_version_ok","Database schema version matches expected target",`Schema version ${z} is up to date.`)}catch(z){ne("warning","schema_version_check_error","Database schema version could not be checked",Ze(z))}l+=1;try{const z=String(D.selectValue("PRAGMA integrity_check")??"");z.toLowerCase()!=="ok"?ne("error","integrity_check_failed","SQLite integrity check failed",z||"Unknown integrity check result.","Run backup/export, restore into a fresh database, and investigate file-system issues."):ne("info","integrity_check_ok","SQLite integrity check passed","PRAGMA integrity_check returned OK.")}catch(z){ne("error","integrity_check_error","SQLite integrity check could not be executed",Ze(z),"Retry diagnostics and verify SQLite worker availability.")}l+=1;try{let z=0;D.exec({sql:"PRAGMA foreign_key_check",rowMode:"object",callback:()=>{z+=1}}),z>0?ne("warning","foreign_key_violations","Foreign key inconsistencies detected",`${z} violation(s) reported by PRAGMA foreign_key_check.`,"Review orphaned child rows and repair or remove inconsistent records."):ne("info","foreign_key_ok","No foreign key inconsistencies found","PRAGMA foreign_key_check returned no rows.")}catch(z){ne("warning","foreign_key_check_error","Foreign key check could not be executed",Ze(z),"Ensure schema and pragma execution are available in the current SQLite mode.")}l+=1;try{const z=Ft.split(";").map(ce=>{const Te=ce.match(/CREATE TABLE (?:IF NOT EXISTS )?([a-z0-9_]+)/i);return Te?Te[1]:null}).filter(ce=>!!ce&&ce.startsWith("sys_")),ue=z.filter(ce=>Number(D.selectValue("SELECT COUNT(*) FROM sqlite_master WHERE type='table' AND name = ?",[ce])||0)===0);ue.length>0?ne("error","missing_system_tables","Required system tables are missing",ue.join(", "),"Run migration/bootstrap and restore missing infrastructure tables."):ne("info","system_tables_ok","All required system tables are present",`Checked ${z.length} table definitions.`)}catch(z){ne("warning","system_table_check_error","System table consistency could not be fully checked",Ze(z))}l+=1;try{const z={sys_worklist:["priority","due_at"],sys_user_widgets:["sql_statement_id"],sys_report_packs:["category"],sys_sql_statement:["description","scope","tags","is_favorite","use_count","last_used_at"]},ue=[];for(const[Te,Ge]of Object.entries(z)){const Xe=new Set(qe(Te));for(const Re of Ge)Xe.has(Re)||ue.push(`${Te}.${Re}`)}const ce=[];if(ye("idx_sys_user_widgets_sql_statement")||ce.push("idx_sys_user_widgets_sql_statement"),ye("idx_sys_sql_scope_name")||ce.push("idx_sys_sql_scope_name"),ye("idx_sys_sql_last_used")||ce.push("idx_sys_sql_last_used"),we("sys_sql_statement",["name","scope"],!0)||ce.push("UNIQUE sys_sql_statement(name, scope)"),ue.length>0||ce.length>0){const Te=[];ue.length>0&&Te.push(`Missing columns: ${ue.join(", ")}`),ce.length>0&&Te.push(`Missing indexes/constraints: ${ce.join(", ")}`),ne("error","system_schema_incomplete","System schema is incomplete for current feature set",Te.join(" | "),"Run migrations/repair routines to restore required system columns and indexes.")}else ne("info","system_schema_complete","System schema includes required columns and indexes","Verified key columns and index/constraint coverage for system tables.")}catch(z){ne("warning","system_schema_check_error","System schema details could not be fully validated",Ze(z))}l+=1;try{const z=Number(D.selectValue(`
                SELECT COUNT(*)
                FROM sys_user_widgets w
                LEFT JOIN sys_sql_statement s ON s.id = w.sql_statement_id
                WHERE COALESCE(TRIM(w.sql_statement_id), '') <> ''
                  AND s.id IS NULL
            `)||0);if(z>0){const ue=[];D.exec({sql:`
                    SELECT w.id AS widget_id, w.name AS widget_name, w.sql_statement_id AS statement_id
                    FROM sys_user_widgets w
                    LEFT JOIN sys_sql_statement s ON s.id = w.sql_statement_id
                    WHERE COALESCE(TRIM(w.sql_statement_id), '') <> ''
                      AND s.id IS NULL
                    LIMIT 10
                `,rowMode:"object",callback:ce=>{const Te=Ve(ce,"widget_name")||Ve(ce,"widget_id"),Ge=Ve(ce,"statement_id");ue.push(`${Te} -> ${Ge}`)}}),ne("warning","orphan_widget_sql_references","Widgets with orphan SQL statement references detected",`${z} orphan reference(s). ${ue.join(", ")}${z>ue.length?" ...":""}`,"Reassign affected widgets to existing SQL statements or clear invalid sql_statement_id values.")}else ne("info","widget_sql_references_ok","No orphan SQL statement references in widgets","All non-empty sys_user_widgets.sql_statement_id values resolve to sys_sql_statement.")}catch(z){ne("warning","widget_sql_reference_check_error","Widget-to-SQL reference check could not be completed",Ze(z))}l+=1;try{const z=[];D.exec({sql:`
                SELECT status, COUNT(*) AS cnt
                FROM sys_worklist
                WHERE COALESCE(TRIM(status), '') NOT IN ('open', 'in_progress', 'done', 'closed')
                GROUP BY status
            `,rowMode:"object",callback:ce=>{z.push(`${String(ce.status??"(null)")}: ${Number(ce.cnt||0)}`)}});const ue=[];if(D.exec({sql:`
                SELECT priority, COUNT(*) AS cnt
                FROM sys_worklist
                WHERE COALESCE(TRIM(priority), '') NOT IN ('low', 'normal', 'high', 'critical')
                GROUP BY priority
            `,rowMode:"object",callback:ce=>{ue.push(`${String(ce.priority??"(null)")}: ${Number(ce.cnt||0)}`)}}),z.length>0||ue.length>0){const ce=[];z.length>0&&ce.push(`Invalid status values: ${z.join(", ")}`),ue.length>0&&ce.push(`Invalid priority values: ${ue.join(", ")}`),ne("warning","worklist_enum_inconsistencies","Worklist contains values outside expected status/priority sets",ce.join(" | "),"Normalize sys_worklist values to known enums used by the UI.")}else ne("info","worklist_enum_ok","Worklist status and priority values are consistent","All records match expected enum values.")}catch(z){ne("warning","worklist_enum_check_error","Worklist status/priority validation could not be completed",Ze(z))}l+=1;try{const z=[];D.exec({sql:"SELECT name FROM sqlite_master WHERE type='view' AND name NOT LIKE 'sqlite_%'",rowMode:"object",callback:ce=>z.push(Ve(ce,"name"))});const ue=[];for(const ce of z)try{D.exec(`SELECT * FROM "${ce}" LIMIT 1`)}catch{ue.push(ce)}ue.length>0?ne("warning","invalid_views","One or more views are invalid",ue.join(", "),"Recreate or drop broken views and ensure referenced tables/columns exist."):ne("info","views_ok","All views are valid",`Checked ${z.length} view definition(s).`)}catch(z){ne("warning","view_check_error","View validation could not be completed",Ze(z))}l+=1;try{const z=[];D.exec({sql:"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' AND name NOT LIKE 'sys_%'",rowMode:"object",callback:ce=>z.push(Ve(ce,"name"))});const ue=[];for(const ce of z){const Te=Number(D.selectValue(`SELECT COUNT(*) FROM "${ce}"`)||0);if(Te<5e4)continue;Number(D.selectValue("SELECT COUNT(*) FROM sqlite_master WHERE type='index' AND LOWER(tbl_name) = LOWER(?) AND name NOT LIKE 'sqlite_%'",[ce])||0)===0&&ue.push(`${ce} (${Te} rows)`)}ue.length>0?ne("warning","large_unindexed_tables","Large tables without custom indexes detected",ue.join(", "),"Create indexes for frequently filtered/joined columns in these tables."):ne("info","index_coverage_ok","No large unindexed user tables detected","Threshold: 50,000 rows.")}catch(z){ne("warning","index_coverage_check_error","Index coverage check could not be completed",Ze(z))}l+=1;try{const z=[];D.exec({sql:"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' AND name NOT LIKE 'sys_%'",rowMode:"object",callback:Te=>z.push(Ve(Te,"name"))});const ue=[],ce=[];for(const Te of z){const Ge=dt(Te),Xe=Number(D.selectValue(`SELECT COUNT(*) FROM "${Ge}"`)||0);if(Xe===0)continue;const Re=[];D.exec({sql:`PRAGMA table_info("${Ge}")`,rowMode:"object",callback:xe=>{const $e=Ve(xe,"name");$e&&Re.push({name:$e,notnull:Number(xe.notnull||0),pk:Number(xe.pk||0)})}});for(const xe of Re){const $e=dt(xe.name),Ne=Number(D.selectValue(`SELECT COUNT(*) FROM "${Ge}" WHERE "${$e}" IS NULL`)||0);if(xe.notnull===1&&Ne>0&&ue.push(`${Te}.${xe.name}: ${Ne}`),xe.pk===0){const Fe=Ne/Xe;Fe>=.7&&Ne>=100&&ce.push(`${Te}.${xe.name}: ${(Fe*100).toFixed(1)}%`)}}}ue.length>0?ne("error","not_null_violations","NOT NULL violations detected",ue.slice(0,10).join(", ")+(ue.length>10?" ...":""),"Repair imported rows or adjust mappings to ensure mandatory fields are always populated."):ne("info","not_null_ok","No NOT NULL violations detected","All checked user tables satisfy mandatory field constraints."),ce.length>0&&ne("warning","high_null_ratio_columns","Columns with high NULL ratio detected",ce.slice(0,10).join(", ")+(ce.length>10?" ...":""),"Review data quality and import mappings for these columns.")}catch(z){ne("warning","null_quality_check_error","NULL quality checks could not be completed",Ze(z))}l+=1;try{const z=[];D.exec({sql:"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' AND name NOT LIKE 'sys_%'",rowMode:"object",callback:ce=>z.push(Ve(ce,"name"))});const ue=[];for(const ce of z){const Te=dt(ce),Ge=[];D.exec({sql:`PRAGMA table_info("${Te}")`,rowMode:"object",callback:Re=>{const xe=Ve(Re,"name");xe&&Ge.push({name:xe,pk:Number(Re.pk||0)})}});const Xe=Ge.filter(Re=>{const xe=Re.name.toLowerCase();return Re.pk>0||xe==="id"||xe.endsWith("_id")||xe.endsWith("_key")}).slice(0,3);for(const Re of Xe){const xe=dt(Re.name),$e=Number(D.selectValue(`SELECT COUNT(*) FROM (
                            SELECT "${xe}" AS v
                            FROM "${Te}"
                            WHERE "${xe}" IS NOT NULL
                            GROUP BY "${xe}"
                            HAVING COUNT(*) > 1
                        )`)||0);$e>0&&ue.push(`${ce}.${Re.name}: ${$e}`)}}ue.length>0?ne("warning","duplicate_key_candidates","Possible duplicate keys detected",ue.slice(0,10).join(", ")+(ue.length>10?" ...":""),"Verify key semantics and add UNIQUE indexes where duplicates are not allowed."):ne("info","duplicate_candidates_ok","No duplicate key candidates found","Checked common key-like columns in user tables.")}catch(z){ne("warning","duplicate_check_error","Duplicate candidate checks could not be completed",Ze(z))}l+=1;try{const z=[];D.exec({sql:"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' AND name NOT LIKE 'sys_%'",rowMode:"object",callback:ce=>z.push(Ve(ce,"name"))});const ue=[];for(const ce of z){const Te=dt(ce);if(Number(D.selectValue(`SELECT COUNT(*) FROM "${Te}"`)||0)<5e4)continue;const Xe=[];D.exec({sql:`PRAGMA table_info("${Te}")`,rowMode:"object",callback:Ne=>{const Fe=Ve(Ne,"name");Fe&&Xe.push({name:Fe,pk:Number(Ne.pk||0)})}});const Re=Xe.find(Ne=>Ne.pk>0)||Xe[0];if(!Re)continue;const xe=dt(Re.name),$e=[];D.exec({sql:`EXPLAIN QUERY PLAN SELECT * FROM "${Te}" WHERE "${xe}" = ? LIMIT 1`,bind:[0],rowMode:"object",callback:Ne=>{$e.push(Ve(Ne,"detail").toUpperCase())}}),$e.some(Ne=>Ne.includes("SCAN"))&&ue.push(`${ce} (column: ${Re.name})`)}ue.length>0?ne("warning","query_plan_full_scan_risk","EXPLAIN detected full-scan risks on large tables",ue.join(", "),"Add indexes for frequently queried columns and validate plans in the inspector with EXPLAIN."):ne("info","query_plan_ok","No EXPLAIN full-scan risks detected for sampled key lookups","Checked large user tables with representative key filters.")}catch(z){ne("warning","query_plan_check_error","EXPLAIN-based performance checks could not be completed",Ze(z))}const Ue=J.filter(z=>z.severity==="error").length,Me=J.filter(z=>z.severity==="warning").length,Le=J.filter(z=>z.severity==="info").length,He=Math.max(0,100-Ue*25-Me*10-Le*1);return{status:Ue>0?"error":Me>0?"warning":"ok",score:He,checkedAt:new Date().toISOString(),checksRun:l,findings:J}}async function Rn(D){let J=null;const l={isValid:!1,headerMatch:!1,missingTables:[],missingColumns:{},versionInfo:{current:1,backup:0}};try{mt||await it();const ne=tn(),qe=new Uint8Array(D.slice(0,16));if(new TextDecoder().decode(qe).startsWith("SQLite format 3"))l.headerMatch=!0;else throw new Error("Invalid SQLite header");try{J=new ne.oo1.DB(D)}catch(Me){return tt("Temporary DB open failed",Me),l.error="Memory DB allocation failed or buffer malformed: "+Ze(Me),l}const we=J.selectValue("PRAGMA user_version")||0;l.versionInfo={current:ft,backup:we};const Ue=Ft.split(";").map(Me=>{const Le=Me.match(/CREATE TABLE (?:IF NOT EXISTS )?([a-z0_9_]+)/i);return Le?Le[1]:null}).filter(Boolean);for(const Me of Ue){if(!J.selectValue("SELECT count(*) FROM sqlite_master WHERE type='table' AND name=?",[Me])){l.missingTables.push(Me);continue}const He=[];if(J.exec({sql:`PRAGMA table_info("${Me}")`,rowMode:"object",callback:z=>He.push(Ve(z,"name"))}),We){const z=at(),ue=[];z.exec({sql:`PRAGMA table_info("${Me}")`,rowMode:"object",callback:Te=>ue.push(Ve(Te,"name"))});const ce=ue.filter(Te=>!He.includes(Te));ce.length>0&&(l.missingColumns[Me]=ce)}}if(we>ft?(l.isValid=!1,l.isDowngrade=!0,l.error=`The backup (V${we}) is newer than this application (V${ft}). Please update the application first.`):l.isValid=!0,ne.oo1.OpfsDb){We&&(We.close(),We=null);const Me=await navigator.storage.getDirectory();try{await Me.removeEntry("litebistudio.sqlite3")}catch{en("No OPFS file to delete or unable to remove existing file before import.")}const He=await(await Me.getFileHandle("litebistudio.sqlite3",{create:!0})).createWritable();await He.write(D),await He.close(),We=new ne.oo1.OpfsDb("/litebistudio.sqlite3"),Vt(We),Qe("Database imported and validated")}return l}catch(ne){return tt("Import failed",ne),l.error=Ze(ne),l}finally{J&&J.close()}}self.onmessage=xn})();
