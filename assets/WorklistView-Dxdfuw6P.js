import{u as se,d as ae,a as le,S as x,j as e,P as re,c as oe}from"./index-dhaNcLTM.js";import{u as de,r as d}from"./vendor-react-D64xOC9_.js";import{R as ie}from"./RecordDetailModal-CcwDbpMK.js";import{g as ne,h as ce,aq as F,ar as $,m as P,as as xe,l as be,u as ue,at as he,au as pe,am as ge,Z as ke}from"./vendor-icons-Du2dXQHa.js";import"./vendor-pdf-FXkUb51H.js";import"./vendor-ui-BNe0Xlio.js";import"./vendor-charts-BtQqxQq4.js";import"./SchemaDocumentation-D4hlYnEY.js";const me=oe("WorklistView"),we=()=>{if(typeof window>"u")return"all";const s=localStorage.getItem("worklist_default_view");return s==="open"||s==="overdue"||s==="today"||s==="high_priority"||s==="all"?s:"all"},De=()=>{const{t:s}=se(),H=de(),g=we(),[v,M]=d.useState([]),[B,D]=d.useState(!0),[j,k]=d.useState(g==="open"?"open":"all"),[m,w]=d.useState(g==="overdue"||g==="today"||g==="high_priority"?g:"none"),[y,A]=d.useState(""),[U,Y]=d.useState(!1),[h,N]=d.useState("focus"),[l,_]=d.useState([]),[V,G]=d.useState(null),{isReadOnly:r}=ae(),[K]=le("worklist_hide_completed",!1),[C,L]=d.useState(null),[Q,I]=d.useState([]),[T,S]=d.useState(!1),c=d.useCallback(async()=>{D(!0);const t=await x.getWorklist(),a=await Promise.all(t.map(async o=>{const n=await x.checkRecordExists(o.source_table,o.source_id);return{...o,_exists:n}}));M(a),D(!1)},[]);d.useEffect(()=>{const t=window.setTimeout(()=>{c()},0);return window.addEventListener("db-updated",c),window.addEventListener("db-changed",c),()=>{window.clearTimeout(t),window.removeEventListener("db-updated",c),window.removeEventListener("db-changed",c)}},[c]);const Z=async t=>{r||(await x.executeRaw("DELETE FROM sys_worklist WHERE id = ?",[t]),await c())},E=async t=>{let a=[];try{a=await x.executeRaw(`SELECT rowid as _rowid, * FROM "${t.source_table}" WHERE id = ?`,[t.source_id])}catch{try{const n=(await x.getTableSchema(t.source_table)).find(p=>p.pk===1||p.name.toLowerCase()==="id")?.name;n&&n.toLowerCase()!=="id"?a=await x.executeRaw(`SELECT rowid as _rowid, * FROM "${t.source_table}" WHERE "${n}" = ?`,[t.source_id]):a=await x.executeRaw(`SELECT rowid as _rowid, * FROM "${t.source_table}" WHERE rowid = ?`,[t.source_id])}catch(o){me.error("Failed to load details for",t,o)}}a.length>0?(I(a),L(t),S(!0)):(I([{...t,_deleted:!0}]),L(t),S(!0))},z=t=>{switch(t){case"done":return e.jsx(ke,{className:"w-4 h-4 text-emerald-500"});case"in_progress":return e.jsx(ge,{className:"w-4 h-4 text-blue-500"});case"closed":return e.jsx(pe,{className:"w-4 h-4 text-slate-400 opacity-50"});default:return e.jsx(P,{className:"w-4 h-4 text-amber-500"})}},f=t=>{if(!t)return!1;const a=new Date,o=new Date(a.getFullYear(),a.getMonth(),a.getDate()),n=new Date(t);return new Date(n.getFullYear(),n.getMonth(),n.getDate()).getTime()<o.getTime()},R=t=>{if(!t)return!1;const a=new Date,o=new Date(t);return o.getFullYear()===a.getFullYear()&&o.getMonth()===a.getMonth()&&o.getDate()===a.getDate()},W={critical:4,high:3,normal:2,low:1},i=v.filter(t=>j==="all"||t.status===j).filter(t=>!K||t.status!=="done"&&t.status!=="closed").filter(t=>m==="none"?!0:m==="overdue"?t.status!=="done"&&t.status!=="closed"&&f(t.due_at):m==="today"?R(t.due_at):m==="high_priority"?t.priority==="high"||t.priority==="critical":!0).filter(t=>t.display_label?.toLowerCase().includes(y.toLowerCase())||t.source_table?.toLowerCase().includes(y.toLowerCase())||t.comment?.toLowerCase().includes(y.toLowerCase())).sort((t,a)=>{const o=f(t.due_at)&&t.status!=="done"&&t.status!=="closed"?1:0,n=f(a.due_at)&&a.status!=="done"&&a.status!=="closed"?1:0;if(o!==n)return n-o;const p=W[t.priority||"normal"],q=W[a.priority||"normal"];if(p!==q)return q-p;const te=new Date(t.updated_at||t.created_at).getTime();return new Date(a.updated_at||a.created_at).getTime()-te}),J=i.filter(t=>l.includes(t.id)),b=i.find(t=>t.id===V)||J[0]||i[0]||null,X=t=>{_(a=>a.includes(t)?a.filter(o=>o!==t):[...a,t])},ee=t=>{_(t?i.map(a=>a.id):[])},u=async t=>{l.length===0||r||(await Promise.all(l.map(a=>x.updateWorklistItem(a,t))),await c())},O=t=>{const a=new Date;return a.setDate(a.getDate()+t),`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`};return e.jsxs(re,{header:{title:s("sidebar.worklist"),subtitle:s("worklist.subtitle"),onBack:()=>H(-1)},rightPanel:{title:s("worklist.tools_title","Worklist Tools"),enabled:!0,triggerTitle:s("worklist.tools_title","Worklist Tools"),width:"sm",isOpen:U,onOpenChange:Y,content:e.jsxs("div",{className:"h-full min-h-0 flex flex-col gap-4",children:[e.jsxs("div",{className:"inline-flex items-center rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-1 flex-shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>N("focus"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${h==="focus"?"bg-blue-600 text-white":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:s("worklist.tools_tab_focus","Fokus")}),e.jsx("button",{type:"button",onClick:()=>N("batch"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${h==="batch"?"bg-blue-600 text-white":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:s("worklist.tools_tab_batch","Batch")}),e.jsx("button",{type:"button",onClick:()=>N("preview"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${h==="preview"?"bg-blue-600 text-white":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:s("worklist.tools_tab_preview","Preview")})]}),h==="focus"&&e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col gap-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/40 p-2",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400",children:s("worklist.focus_open","Offen")}),e.jsx("div",{className:"text-lg font-black text-slate-800 dark:text-slate-100",children:v.filter(t=>t.status==="open"||t.status==="in_progress").length})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/40 p-2",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400",children:s("worklist.quick_overdue","Ueberfaellig")}),e.jsx("div",{className:"text-lg font-black text-rose-600 dark:text-rose-300",children:v.filter(t=>t.status!=="done"&&t.status!=="closed"&&f(t.due_at)).length})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/40 p-2",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400",children:s("worklist.quick_today","Heute")}),e.jsx("div",{className:"text-lg font-black text-blue-600 dark:text-blue-300",children:v.filter(t=>R(t.due_at)).length})]})]}),e.jsxs("div",{className:"flex-1 min-h-0 rounded-lg border border-slate-200 dark:border-slate-700 p-3 space-y-2",children:[e.jsx("div",{className:"text-xs font-bold text-slate-700 dark:text-slate-200",children:s("worklist.tools_quick_filters","Schnellfilter")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{w("none"),k("all")},className:"h-9 rounded-md border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-xs font-semibold text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700",children:s("worklist.quick_all","Alles")}),e.jsx("button",{type:"button",onClick:()=>{w("overdue"),k("all")},className:"h-9 rounded-md border border-rose-200 dark:border-rose-800 bg-rose-50 dark:bg-rose-900/20 text-xs font-semibold text-rose-700 dark:text-rose-300 hover:bg-rose-100 dark:hover:bg-rose-900/30",children:s("worklist.quick_overdue","Ueberfaellig")}),e.jsx("button",{type:"button",onClick:()=>{w("today"),k("all")},className:"h-9 rounded-md border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20 text-xs font-semibold text-blue-700 dark:text-blue-300 hover:bg-blue-100 dark:hover:bg-blue-900/30",children:s("worklist.quick_today","Heute")}),e.jsx("button",{type:"button",onClick:()=>{w("high_priority"),k("all")},className:"h-9 rounded-md border border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/20 text-xs font-semibold text-amber-700 dark:text-amber-300 hover:bg-amber-100 dark:hover:bg-amber-900/30",children:s("worklist.quick_high_priority","Hohe Prioritaet")})]})]})]}),h==="batch"&&e.jsxs("div",{className:"flex-1 min-h-0 rounded-lg border border-slate-200 dark:border-slate-700 p-3 space-y-3",children:[e.jsx("div",{className:"text-xs font-bold text-slate-700 dark:text-slate-200",children:s("worklist.tools_selected_count","{{count}} ausgewaehlt",{count:l.length})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",disabled:l.length===0||r,onClick:()=>{u({status:"open"})},className:"h-9 rounded-md border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-xs font-semibold text-slate-600 dark:text-slate-300 disabled:opacity-40",children:s("worklist.status_open","Neu / Offen")}),e.jsx("button",{type:"button",disabled:l.length===0||r,onClick:()=>{u({status:"in_progress"})},className:"h-9 rounded-md border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-xs font-semibold text-slate-600 dark:text-slate-300 disabled:opacity-40",children:s("worklist.status_in_progress","In Bearbeitung")}),e.jsx("button",{type:"button",disabled:l.length===0||r,onClick:()=>{u({status:"done"})},className:"h-9 rounded-md border border-emerald-200 dark:border-emerald-800 bg-emerald-50 dark:bg-emerald-900/20 text-xs font-semibold text-emerald-700 dark:text-emerald-300 disabled:opacity-40",children:s("worklist.status_done","Erledigt")}),e.jsx("button",{type:"button",disabled:l.length===0||r,onClick:()=>{u({status:"closed"})},className:"h-9 rounded-md border border-slate-300 dark:border-slate-700 bg-slate-100 dark:bg-slate-800 text-xs font-semibold text-slate-700 dark:text-slate-300 disabled:opacity-40",children:s("worklist.status_closed","Geschlossen")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",disabled:l.length===0||r,onClick:()=>{u({priority:"normal"})},className:"h-9 rounded-md border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-xs font-semibold text-slate-600 dark:text-slate-300 disabled:opacity-40",children:s("worklist.priority_normal","Normal")}),e.jsx("button",{type:"button",disabled:l.length===0||r,onClick:()=>{u({priority:"high"})},className:"h-9 rounded-md border border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/20 text-xs font-semibold text-amber-700 dark:text-amber-300 disabled:opacity-40",children:s("worklist.priority_high","Hoch")})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{type:"button",disabled:l.length===0||r,onClick:()=>{u({due_at:O(0)})},className:"h-9 rounded-md border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20 text-xs font-semibold text-blue-700 dark:text-blue-300 disabled:opacity-40",children:s("worklist.quick_today","Heute")}),e.jsx("button",{type:"button",disabled:l.length===0||r,onClick:()=>{u({due_at:O(7)})},className:"h-9 rounded-md border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20 text-xs font-semibold text-blue-700 dark:text-blue-300 disabled:opacity-40",children:"+7"}),e.jsx("button",{type:"button",disabled:l.length===0||r,onClick:()=>{u({due_at:null})},className:"h-9 rounded-md border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-xs font-semibold text-slate-600 dark:text-slate-300 disabled:opacity-40",children:s("common.clear","Leeren")})]})]}),h==="preview"&&e.jsx("div",{className:"flex-1 min-h-0 rounded-lg border border-slate-200 dark:border-slate-700 p-3",children:b?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-bold text-slate-800 dark:text-slate-100 truncate",children:b.display_label||s("worklist.entry_id",{id:b.source_id})}),e.jsx("div",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:b.source_table}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600 dark:text-slate-300",children:[e.jsx("span",{className:"px-2 py-0.5 rounded bg-slate-100 dark:bg-slate-800",children:b.status}),e.jsx("span",{className:"px-2 py-0.5 rounded bg-slate-100 dark:bg-slate-800",children:b.priority||"normal"})]}),e.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-300 flex items-center gap-1.5",children:[e.jsx(he,{className:"w-3.5 h-3.5 text-slate-400"}),b.due_at?String(b.due_at).slice(0,10):"-"]}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-300 min-h-[48px] rounded border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/40 p-2",children:b.comment||"-"}),e.jsx("button",{type:"button",onClick:()=>{E(b)},className:"h-9 w-full rounded-md border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20 text-xs font-semibold text-blue-700 dark:text-blue-300 hover:bg-blue-100 dark:hover:bg-blue-900/30",children:s("worklist.details_btn","Details oeffnen")})]}):e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-slate-500 dark:text-slate-400",children:s("common.no_data")})})]})},children:[e.jsxs("div",{className:"max-w-5xl space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:s("common.search"),value:y,onChange:t=>A(t.target.value),className:"h-10 pl-10 pr-4 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-blue-500/20 w-64 text-sm font-medium text-slate-700 dark:text-slate-200"})]}),e.jsx("div",{className:"h-10 flex items-center gap-1 p-1 bg-slate-50 dark:bg-slate-900/50 rounded-lg border border-slate-200 dark:border-slate-700",children:[{id:"all",label:s("worklist.filter_all")},{id:"open",label:s("worklist.filter_open")},{id:"in_progress",label:s("worklist.filter_in_progress")},{id:"done",label:s("worklist.filter_done")},{id:"closed",label:s("worklist.filter_closed")}].map(t=>e.jsx("button",{onClick:()=>k(t.id),className:`h-8 px-3 text-[10px] font-black rounded-md transition-all ${j===t.id?"bg-white dark:bg-slate-700 text-blue-600 dark:text-blue-400 shadow-sm":"text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300"}`,children:t.label.toUpperCase()},t.id))}),e.jsx("div",{className:"h-10 flex items-center gap-1 p-1 bg-slate-50 dark:bg-slate-900/50 rounded-lg border border-slate-200 dark:border-slate-700",children:[{id:"none",label:s("worklist.quick_all","Alles")},{id:"overdue",label:s("worklist.quick_overdue","Ueberfaellig")},{id:"today",label:s("worklist.quick_today","Heute")},{id:"high_priority",label:s("worklist.quick_high_priority","Hohe Prioritaet")}].map(t=>e.jsx("button",{onClick:()=>w(t.id),className:`h-8 px-3 text-[10px] font-black rounded-md transition-all ${m===t.id?"bg-white dark:bg-slate-700 text-blue-600 dark:text-blue-400 shadow-sm":"text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300"}`,children:t.label.toUpperCase()},t.id))})]}),e.jsxs("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:[s("worklist.found_count",{count:i.length})," Â· ",s("worklist.tools_selected_count","{{count}} ausgewaehlt",{count:l.length})]})]}),B?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 animate-pulse",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-200 dark:bg-slate-800 rounded-full mb-4"}),e.jsx("div",{className:"h-4 w-32 bg-slate-200 dark:bg-slate-800 rounded mb-2"}),e.jsx("div",{className:"h-3 w-48 bg-slate-200 dark:bg-slate-800 rounded opacity-50"})]}):i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 bg-white dark:bg-slate-800/50 rounded-2xl border-2 border-dashed border-slate-200 dark:border-slate-800",children:[e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-900 rounded-full mb-4",children:e.jsx(ce,{className:"w-8 h-8 text-slate-300"})}),e.jsx("h3",{className:"text-sm font-bold text-slate-900 dark:text-white mb-1",children:s("worklist.empty_msg")}),e.jsx("p",{className:"text-xs text-slate-500 max-w-xs text-center",children:s("worklist.empty_hint")})]}):e.jsx("div",{className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm whitespace-nowrap",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 border-b border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 uppercase text-[11px] font-black tracking-wider",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 w-12",children:e.jsx("button",{type:"button",onClick:()=>ee(l.length!==i.length||i.length===0),className:"inline-flex items-center justify-center text-slate-500 dark:text-slate-400 hover:text-blue-600 dark:hover:text-blue-400",title:l.length===i.length&&i.length>0?s("common.clear","Leeren"):s("common.select_all","Alle waehlen"),children:l.length===i.length&&i.length>0?e.jsx(F,{className:"w-4 h-4"}):e.jsx($,{className:"w-4 h-4"})})}),e.jsx("th",{className:"px-4 py-3 w-40",children:s("worklist.status_label","Status")}),e.jsx("th",{className:"px-4 py-3",children:s("worklist.element_label","Element")}),e.jsx("th",{className:"px-4 py-3",children:s("worklist.table_label","Tabelle")}),e.jsx("th",{className:"px-4 py-3 w-36",children:s("worklist.priority_label","Prioritaet")}),e.jsx("th",{className:"px-4 py-3 w-36",children:s("worklist.due_label","Faellig")}),e.jsx("th",{className:"px-4 py-3",children:s("worklist.context_label","Kontext")}),e.jsx("th",{className:"px-4 py-3 hidden md:table-cell",children:s("worklist.created_label","Erstellt am")}),e.jsx("th",{className:"px-4 py-3 text-right",children:s("common.actions","Aktionen")})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700/50",children:i.map(t=>e.jsxs("tr",{onClick:()=>G(t.id),className:`group hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors cursor-pointer ${l.includes(t.id)?"bg-blue-50/40 dark:bg-blue-900/10":""} ${t._exists?"":"bg-red-50/10"}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{type:"button",onClick:a=>{a.stopPropagation(),X(t.id)},className:"inline-flex items-center justify-center text-slate-500 dark:text-slate-400 hover:text-blue-600 dark:hover:text-blue-400",children:l.includes(t.id)?e.jsx(F,{className:"w-4 h-4"}):e.jsx($,{className:"w-4 h-4"})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("select",{value:t.status,disabled:r,onChange:async a=>{a.stopPropagation(),!r&&(await x.updateWorklistItem(t.id,{status:a.target.value}),await c())},className:"h-9 w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded px-2 text-[11px] font-bold outline-none cursor-pointer focus:ring-2 focus:ring-blue-500/20 text-slate-700 dark:text-slate-300",children:[e.jsx("option",{value:"open",children:s("worklist.status_open","Neu / Offen")}),e.jsx("option",{value:"in_progress",children:s("worklist.status_in_progress","In Bearbeitung")}),e.jsx("option",{value:"done",children:s("worklist.status_done","Erledigt")}),e.jsx("option",{value:"closed",children:s("worklist.status_closed","Geschlossen")})]})}),e.jsx("td",{className:"px-4 py-3",onClick:()=>E(t),children:e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer",children:[z(t.status),e.jsx("span",{className:"font-bold text-slate-900 dark:text-white group-hover:text-blue-600 transition-colors",children:t.display_label||s("worklist.entry_id",{id:t.source_id})}),!t._exists&&e.jsxs("span",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-red-100 dark:bg-red-900/30 text-[9px] font-black text-red-600 dark:text-red-400 rounded uppercase tracking-tighter shadow-sm",children:[e.jsx(P,{className:"w-2.5 h-2.5"})," ",s("common.deleted")]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-[10px] font-mono font-bold text-slate-500 dark:text-slate-400 rounded",children:t.source_table})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("select",{value:t.priority||"normal",disabled:r,onChange:async a=>{a.stopPropagation(),!r&&(await x.updateWorklistItem(t.id,{priority:a.target.value}),await c())},className:"h-9 w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded px-2 text-[11px] font-bold outline-none cursor-pointer focus:ring-2 focus:ring-blue-500/20 text-slate-700 dark:text-slate-300",children:[e.jsx("option",{value:"low",children:s("worklist.priority_low","Niedrig")}),e.jsx("option",{value:"normal",children:s("worklist.priority_normal","Normal")}),e.jsx("option",{value:"high",children:s("worklist.priority_high","Hoch")}),e.jsx("option",{value:"critical",children:s("worklist.priority_critical","Kritisch")})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"date",value:t.due_at?String(t.due_at).slice(0,10):"",disabled:r,onChange:async a=>{a.stopPropagation(),!r&&(await x.updateWorklistItem(t.id,{due_at:a.target.value||null}),await c())},className:`h-9 w-full bg-slate-50 dark:bg-slate-900 border rounded px-2 text-[11px] font-bold outline-none focus:ring-2 focus:ring-blue-500/20 ${f(t.due_at)&&t.status!=="done"&&t.status!=="closed"?"border-rose-300 dark:border-rose-700 text-rose-700 dark:text-rose-300":"border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300"}`})}),e.jsx("td",{className:"px-4 py-3 text-slate-500 dark:text-slate-400",children:e.jsx("div",{className:"flex items-center gap-3 text-[11px]",children:t.comment?e.jsxs("span",{className:"flex items-center gap-1.5 text-slate-700 dark:text-slate-300 w-full max-w-[200px] truncate",title:t.comment,children:[e.jsx(xe,{className:"w-3 h-3 opacity-60 shrink-0"}),e.jsx("span",{className:"truncate",children:t.comment})]}):e.jsx("span",{className:"text-slate-400 dark:text-slate-600 italic",children:"-"})})}),e.jsx("td",{className:"px-4 py-3 text-slate-500 hidden md:table-cell text-[11px]",children:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>E(t),className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-all",title:s("worklist.details_btn"),children:e.jsx(be,{className:"w-4 h-4"})}),!r&&e.jsx("button",{onClick:()=>Z(t.id),className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-all",title:s("worklist.remove_btn"),children:e.jsx(ue,{className:"w-4 h-4"})})]})})]},t.id))})]})})})]}),T&&C&&e.jsx(ie,{isOpen:T,onClose:()=>S(!1),items:Q,initialIndex:0,tableName:C.source_table,title:C.display_label??void 0})]})};export{De as WorklistView};
