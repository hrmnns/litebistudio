import{u as Re,j as n,o as Zt,e as xr,S as G,q as qr,c as pr,a as Et,d as Ur,P as Kr,C as Qt,M as Vr,b as Ee}from"./index-BwrLLMel.js";import{r as c,d as V,b as Ze,u as kt}from"./vendor-react-D64xOC9_.js";import{u as Xr}from"./MarkdownContent-CG2IGVkl.js";import{W as Yr}from"./WidgetRenderer-BPQ5Qx-0.js";import{d as Hr,X as Jr,am as Pt,an as Gr,g as ft,$ as Zr,D as Qe,A as gt,C as Qr,ao as en,O as tn,m as vr,S as wr,h as mt,Z as rn,z as nn,H as sn,K as bt,ad as an,u as Oe,a3 as on,ap as Rt,aq as ln,a9 as er,aa as tr,a2 as dn,al as cn,a0 as un,a4 as hn}from"./vendor-icons-DtiG8Nuk.js";import{u as bn}from"./useBackupStatus-Cgw2k5uG.js";import"./vendor-pdf-FXkUb51H.js";import"./vendor-ui-BNe0Xlio.js";import"./vendor-charts-BtQqxQq4.js";import"./vendor-canvas-DXEQVQnt.js";import"./DataTable-CN3uIG45.js";import"./RecordDetailModal-BuVEuf7b.js";import"./SchemaDocumentation-AXcMGSW8.js";import"./inspectorBridge-BnIEasIL.js";const Nt=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function ze(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function Kt(e){return"nodeType"in e}function Z(e){var t,r;return e?ze(e)?e:Kt(e)&&(t=(r=e.ownerDocument)==null?void 0:r.defaultView)!=null?t:window:window}function Vt(e){const{Document:t}=Z(e);return e instanceof t}function ot(e){return ze(e)?!1:e instanceof Z(e).HTMLElement}function yr(e){return e instanceof Z(e).SVGElement}function Pe(e){return e?ze(e)?e.document:Kt(e)?Vt(e)?e:ot(e)||yr(e)?e.ownerDocument:document:document:document}const De=Nt?c.useLayoutEffect:c.useEffect;function Xt(e){const t=c.useRef(e);return De(()=>{t.current=e}),c.useCallback(function(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return t.current==null?void 0:t.current(...s)},[])}function fn(){const e=c.useRef(null),t=c.useCallback((s,a)=>{e.current=setInterval(s,a)},[]),r=c.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,r]}function nt(e,t){t===void 0&&(t=[e]);const r=c.useRef(e);return De(()=>{r.current!==e&&(r.current=e)},t),r}function it(e,t){const r=c.useRef();return c.useMemo(()=>{const s=e(r.current);return r.current=s,s},[...t])}function pt(e){const t=Xt(e),r=c.useRef(null),s=c.useCallback(a=>{a!==r.current&&t?.(a,r.current),r.current=a},[]);return[r,s]}function $t(e){const t=c.useRef();return c.useEffect(()=>{t.current=e},[e]),t.current}let Mt={};function jt(e,t){return c.useMemo(()=>{if(t)return t;const r=Mt[e]==null?0:Mt[e]+1;return Mt[e]=r,e+"-"+r},[e,t])}function kr(e){return function(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return s.reduce((o,l)=>{const d=Object.entries(l);for(const[u,g]of d){const m=o[u];m!=null&&(o[u]=m+e*g)}return o},{...t})}}const Le=kr(1),st=kr(-1);function gn(e){return"clientX"in e&&"clientY"in e}function Nr(e){if(!e)return!1;const{KeyboardEvent:t}=Z(e.target);return t&&e instanceof t}function mn(e){if(!e)return!1;const{TouchEvent:t}=Z(e.target);return t&&e instanceof t}function Ft(e){if(mn(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:r}=e.touches[0];return{x:t,y:r}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:r}=e.changedTouches[0];return{x:t,y:r}}}return gn(e)?{x:e.clientX,y:e.clientY}:null}const Wt=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:r}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(r?Math.round(r):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:r}=e;return"scaleX("+t+") scaleY("+r+")"}},Transform:{toString(e){if(e)return[Wt.Translate.toString(e),Wt.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:r,easing:s}=e;return t+" "+r+"ms "+s}}}),rr="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function xn(e){return e.matches(rr)?e:e.querySelector(rr)}const pn={display:"none"};function vn(e){let{id:t,value:r}=e;return V.createElement("div",{id:t,style:pn},r)}function wn(e){let{id:t,announcement:r,ariaLiveType:s="assertive"}=e;const a={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return V.createElement("div",{id:t,style:a,role:"status","aria-live":s,"aria-atomic":!0},r)}function yn(){const[e,t]=c.useState("");return{announce:c.useCallback(s=>{s!=null&&t(s)},[]),announcement:e}}const jr=c.createContext(null);function kn(e){const t=c.useContext(jr);c.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function Nn(){const[e]=c.useState(()=>new Set),t=c.useCallback(s=>(e.add(s),()=>e.delete(s)),[e]);return[c.useCallback(s=>{let{type:a,event:o}=s;e.forEach(l=>{var d;return(d=l[a])==null?void 0:d.call(l,o)})},[e]),t]}const jn={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Cn={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:r}=e;return r?"Draggable item "+t.id+" was moved over droppable area "+r.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:r}=e;return r?"Draggable item "+t.id+" was dropped over droppable area "+r.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Sn(e){let{announcements:t=Cn,container:r,hiddenTextDescribedById:s,screenReaderInstructions:a=jn}=e;const{announce:o,announcement:l}=yn(),d=jt("DndLiveRegion"),[u,g]=c.useState(!1);if(c.useEffect(()=>{g(!0)},[]),kn(c.useMemo(()=>({onDragStart(h){let{active:w}=h;o(t.onDragStart({active:w}))},onDragMove(h){let{active:w,over:p}=h;t.onDragMove&&o(t.onDragMove({active:w,over:p}))},onDragOver(h){let{active:w,over:p}=h;o(t.onDragOver({active:w,over:p}))},onDragEnd(h){let{active:w,over:p}=h;o(t.onDragEnd({active:w,over:p}))},onDragCancel(h){let{active:w,over:p}=h;o(t.onDragCancel({active:w,over:p}))}}),[o,t])),!u)return null;const m=V.createElement(V.Fragment,null,V.createElement(vn,{id:s,value:a.draggable}),V.createElement(wn,{id:d,announcement:l}));return r?Ze.createPortal(m,r):m}var X;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(X||(X={}));function vt(){}function nr(e,t){return c.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function Dn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return c.useMemo(()=>[...t].filter(s=>s!=null),[...t])}const fe=Object.freeze({x:0,y:0});function Cr(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Sr(e,t){let{data:{value:r}}=e,{data:{value:s}}=t;return r-s}function _n(e,t){let{data:{value:r}}=e,{data:{value:s}}=t;return s-r}function sr(e){let{left:t,top:r,height:s,width:a}=e;return[{x:t,y:r},{x:t+a,y:r},{x:t,y:r+s},{x:t+a,y:r+s}]}function Dr(e,t){if(!e||e.length===0)return null;const[r]=e;return r[t]}function ar(e,t,r){return t===void 0&&(t=e.left),r===void 0&&(r=e.top),{x:t+e.width*.5,y:r+e.height*.5}}const En=e=>{let{collisionRect:t,droppableRects:r,droppableContainers:s}=e;const a=ar(t,t.left,t.top),o=[];for(const l of s){const{id:d}=l,u=r.get(d);if(u){const g=Cr(ar(u),a);o.push({id:d,data:{droppableContainer:l,value:g}})}}return o.sort(Sr)},Rn=e=>{let{collisionRect:t,droppableRects:r,droppableContainers:s}=e;const a=sr(t),o=[];for(const l of s){const{id:d}=l,u=r.get(d);if(u){const g=sr(u),m=a.reduce((w,p,S)=>w+Cr(g[S],p),0),h=Number((m/4).toFixed(4));o.push({id:d,data:{droppableContainer:l,value:h}})}}return o.sort(Sr)};function Mn(e,t){const r=Math.max(t.top,e.top),s=Math.max(t.left,e.left),a=Math.min(t.left+t.width,e.left+e.width),o=Math.min(t.top+t.height,e.top+e.height),l=a-s,d=o-r;if(s<a&&r<o){const u=t.width*t.height,g=e.width*e.height,m=l*d,h=m/(u+g-m);return Number(h.toFixed(4))}return 0}const An=e=>{let{collisionRect:t,droppableRects:r,droppableContainers:s}=e;const a=[];for(const o of s){const{id:l}=o,d=r.get(l);if(d){const u=Mn(d,t);u>0&&a.push({id:l,data:{droppableContainer:o,value:u}})}}return a.sort(_n)};function Tn(e,t,r){return{...e,scaleX:t&&r?t.width/r.width:1,scaleY:t&&r?t.height/r.height:1}}function _r(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:fe}function In(e){return function(r){for(var s=arguments.length,a=new Array(s>1?s-1:0),o=1;o<s;o++)a[o-1]=arguments[o];return a.reduce((l,d)=>({...l,top:l.top+e*d.y,bottom:l.bottom+e*d.y,left:l.left+e*d.x,right:l.right+e*d.x}),{...r})}}const On=In(1);function Ln(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function zn(e,t,r){const s=Ln(t);if(!s)return e;const{scaleX:a,scaleY:o,x:l,y:d}=s,u=e.left-l-(1-a)*parseFloat(r),g=e.top-d-(1-o)*parseFloat(r.slice(r.indexOf(" ")+1)),m=a?e.width/a:e.width,h=o?e.height/o:e.height;return{width:m,height:h,top:g,right:u+m,bottom:g+h,left:u}}const Pn={ignoreTransform:!1};function lt(e,t){t===void 0&&(t=Pn);let r=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:g,transformOrigin:m}=Z(e).getComputedStyle(e);g&&(r=zn(r,g,m))}const{top:s,left:a,width:o,height:l,bottom:d,right:u}=r;return{top:s,left:a,width:o,height:l,bottom:d,right:u}}function or(e){return lt(e,{ignoreTransform:!0})}function $n(e){const t=e.innerWidth,r=e.innerHeight;return{top:0,left:0,right:t,bottom:r,width:t,height:r}}function Fn(e,t){return t===void 0&&(t=Z(e).getComputedStyle(e)),t.position==="fixed"}function Wn(e,t){t===void 0&&(t=Z(e).getComputedStyle(e));const r=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(a=>{const o=t[a];return typeof o=="string"?r.test(o):!1})}function Ct(e,t){const r=[];function s(a){if(t!=null&&r.length>=t||!a)return r;if(Vt(a)&&a.scrollingElement!=null&&!r.includes(a.scrollingElement))return r.push(a.scrollingElement),r;if(!ot(a)||yr(a)||r.includes(a))return r;const o=Z(e).getComputedStyle(a);return a!==e&&Wn(a,o)&&r.push(a),Fn(a,o)?r:s(a.parentNode)}return e?s(e):r}function Er(e){const[t]=Ct(e,1);return t??null}function At(e){return!Nt||!e?null:ze(e)?e:Kt(e)?Vt(e)||e===Pe(e).scrollingElement?window:ot(e)?e:null:null}function Rr(e){return ze(e)?e.scrollX:e.scrollLeft}function Mr(e){return ze(e)?e.scrollY:e.scrollTop}function Bt(e){return{x:Rr(e),y:Mr(e)}}var Y;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(Y||(Y={}));function Ar(e){return!Nt||!e?!1:e===document.scrollingElement}function Tr(e){const t={x:0,y:0},r=Ar(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},s={x:e.scrollWidth-r.width,y:e.scrollHeight-r.height},a=e.scrollTop<=t.y,o=e.scrollLeft<=t.x,l=e.scrollTop>=s.y,d=e.scrollLeft>=s.x;return{isTop:a,isLeft:o,isBottom:l,isRight:d,maxScroll:s,minScroll:t}}const Bn={x:.2,y:.2};function qn(e,t,r,s,a){let{top:o,left:l,right:d,bottom:u}=r;s===void 0&&(s=10),a===void 0&&(a=Bn);const{isTop:g,isBottom:m,isLeft:h,isRight:w}=Tr(e),p={x:0,y:0},S={x:0,y:0},y={height:t.height*a.y,width:t.width*a.x};return!g&&o<=t.top+y.height?(p.y=Y.Backward,S.y=s*Math.abs((t.top+y.height-o)/y.height)):!m&&u>=t.bottom-y.height&&(p.y=Y.Forward,S.y=s*Math.abs((t.bottom-y.height-u)/y.height)),!w&&d>=t.right-y.width?(p.x=Y.Forward,S.x=s*Math.abs((t.right-y.width-d)/y.width)):!h&&l<=t.left+y.width&&(p.x=Y.Backward,S.x=s*Math.abs((t.left+y.width-l)/y.width)),{direction:p,speed:S}}function Un(e){if(e===document.scrollingElement){const{innerWidth:o,innerHeight:l}=window;return{top:0,left:0,right:o,bottom:l,width:o,height:l}}const{top:t,left:r,right:s,bottom:a}=e.getBoundingClientRect();return{top:t,left:r,right:s,bottom:a,width:e.clientWidth,height:e.clientHeight}}function Ir(e){return e.reduce((t,r)=>Le(t,Bt(r)),fe)}function Kn(e){return e.reduce((t,r)=>t+Rr(r),0)}function Vn(e){return e.reduce((t,r)=>t+Mr(r),0)}function Xn(e,t){if(t===void 0&&(t=lt),!e)return;const{top:r,left:s,bottom:a,right:o}=t(e);Er(e)&&(a<=0||o<=0||r>=window.innerHeight||s>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Yn=[["x",["left","right"],Kn],["y",["top","bottom"],Vn]];class Yt{constructor(t,r){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=Ct(r),a=Ir(s);this.rect={...t},this.width=t.width,this.height=t.height;for(const[o,l,d]of Yn)for(const u of l)Object.defineProperty(this,u,{get:()=>{const g=d(s),m=a[o]-g;return this.rect[u]+m},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class et{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(r=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...r)})},this.target=t}add(t,r,s){var a;(a=this.target)==null||a.addEventListener(t,r,s),this.listeners.push([t,r,s])}}function Hn(e){const{EventTarget:t}=Z(e);return e instanceof t?e:Pe(e)}function Tt(e,t){const r=Math.abs(e.x),s=Math.abs(e.y);return typeof t=="number"?Math.sqrt(r**2+s**2)>t:"x"in t&&"y"in t?r>t.x&&s>t.y:"x"in t?r>t.x:"y"in t?s>t.y:!1}var de;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(de||(de={}));function ir(e){e.preventDefault()}function Jn(e){e.stopPropagation()}var _;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(_||(_={}));const Or={start:[_.Space,_.Enter],cancel:[_.Esc],end:[_.Space,_.Enter,_.Tab]},Gn=(e,t)=>{let{currentCoordinates:r}=t;switch(e.code){case _.Right:return{...r,x:r.x+25};case _.Left:return{...r,x:r.x-25};case _.Down:return{...r,y:r.y+25};case _.Up:return{...r,y:r.y-25}}};class Ht{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:r}}=t;this.props=t,this.listeners=new et(Pe(r)),this.windowListeners=new et(Z(r)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(de.Resize,this.handleCancel),this.windowListeners.add(de.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(de.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:r}=this.props,s=t.node.current;s&&Xn(s),r(fe)}handleKeyDown(t){if(Nr(t)){const{active:r,context:s,options:a}=this.props,{keyboardCodes:o=Or,coordinateGetter:l=Gn,scrollBehavior:d="smooth"}=a,{code:u}=t;if(o.end.includes(u)){this.handleEnd(t);return}if(o.cancel.includes(u)){this.handleCancel(t);return}const{collisionRect:g}=s.current,m=g?{x:g.left,y:g.top}:fe;this.referenceCoordinates||(this.referenceCoordinates=m);const h=l(t,{active:r,context:s.current,currentCoordinates:m});if(h){const w=st(h,m),p={x:0,y:0},{scrollableAncestors:S}=s.current;for(const y of S){const k=t.code,{isTop:E,isRight:M,isLeft:N,isBottom:W,maxScroll:T,minScroll:P}=Tr(y),D=Un(y),R={x:Math.min(k===_.Right?D.right-D.width/2:D.right,Math.max(k===_.Right?D.left:D.left+D.width/2,h.x)),y:Math.min(k===_.Down?D.bottom-D.height/2:D.bottom,Math.max(k===_.Down?D.top:D.top+D.height/2,h.y))},K=k===_.Right&&!M||k===_.Left&&!N,A=k===_.Down&&!W||k===_.Up&&!E;if(K&&R.x!==h.x){const U=y.scrollLeft+w.x,ce=k===_.Right&&U<=T.x||k===_.Left&&U>=P.x;if(ce&&!w.y){y.scrollTo({left:U,behavior:d});return}ce?p.x=y.scrollLeft-U:p.x=k===_.Right?y.scrollLeft-T.x:y.scrollLeft-P.x,p.x&&y.scrollBy({left:-p.x,behavior:d});break}else if(A&&R.y!==h.y){const U=y.scrollTop+w.y,ce=k===_.Down&&U<=T.y||k===_.Up&&U>=P.y;if(ce&&!w.x){y.scrollTo({top:U,behavior:d});return}ce?p.y=y.scrollTop-U:p.y=k===_.Down?y.scrollTop-T.y:y.scrollTop-P.y,p.y&&y.scrollBy({top:-p.y,behavior:d});break}}this.handleMove(t,Le(st(h,this.referenceCoordinates),p))}}}handleMove(t,r){const{onMove:s}=this.props;t.preventDefault(),s(r)}handleEnd(t){const{onEnd:r}=this.props;t.preventDefault(),this.detach(),r()}handleCancel(t){const{onCancel:r}=this.props;t.preventDefault(),this.detach(),r()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Ht.activators=[{eventName:"onKeyDown",handler:(e,t,r)=>{let{keyboardCodes:s=Or,onActivation:a}=t,{active:o}=r;const{code:l}=e.nativeEvent;if(s.start.includes(l)){const d=o.activatorNode.current;return d&&e.target!==d?!1:(e.preventDefault(),a?.({event:e.nativeEvent}),!0)}return!1}}];function lr(e){return!!(e&&"distance"in e)}function dr(e){return!!(e&&"delay"in e)}class Jt{constructor(t,r,s){var a;s===void 0&&(s=Hn(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=r;const{event:o}=t,{target:l}=o;this.props=t,this.events=r,this.document=Pe(l),this.documentListeners=new et(this.document),this.listeners=new et(s),this.windowListeners=new et(Z(l)),this.initialCoordinates=(a=Ft(o))!=null?a:fe,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:r,bypassActivationConstraint:s}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(de.Resize,this.handleCancel),this.windowListeners.add(de.DragStart,ir),this.windowListeners.add(de.VisibilityChange,this.handleCancel),this.windowListeners.add(de.ContextMenu,ir),this.documentListeners.add(de.Keydown,this.handleKeydown),r){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(dr(r)){this.timeoutId=setTimeout(this.handleStart,r.delay),this.handlePending(r);return}if(lr(r)){this.handlePending(r);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,r){const{active:s,onPending:a}=this.props;a(s,t,this.initialCoordinates,r)}handleStart(){const{initialCoordinates:t}=this,{onStart:r}=this.props;t&&(this.activated=!0,this.documentListeners.add(de.Click,Jn,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(de.SelectionChange,this.removeTextSelection),r(t))}handleMove(t){var r;const{activated:s,initialCoordinates:a,props:o}=this,{onMove:l,options:{activationConstraint:d}}=o;if(!a)return;const u=(r=Ft(t))!=null?r:fe,g=st(a,u);if(!s&&d){if(lr(d)){if(d.tolerance!=null&&Tt(g,d.tolerance))return this.handleCancel();if(Tt(g,d.distance))return this.handleStart()}if(dr(d)&&Tt(g,d.tolerance))return this.handleCancel();this.handlePending(d,g);return}t.cancelable&&t.preventDefault(),l(u)}handleEnd(){const{onAbort:t,onEnd:r}=this.props;this.detach(),this.activated||t(this.props.active),r()}handleCancel(){const{onAbort:t,onCancel:r}=this.props;this.detach(),this.activated||t(this.props.active),r()}handleKeydown(t){t.code===_.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Zn={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Gt extends Jt{constructor(t){const{event:r}=t,s=Pe(r.target);super(t,Zn,s)}}Gt.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:r}=e,{onActivation:s}=t;return!r.isPrimary||r.button!==0?!1:(s?.({event:r}),!0)}}];const Qn={move:{name:"mousemove"},end:{name:"mouseup"}};var qt;(function(e){e[e.RightClick=2]="RightClick"})(qt||(qt={}));class es extends Jt{constructor(t){super(t,Qn,Pe(t.event.target))}}es.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:r}=e,{onActivation:s}=t;return r.button===qt.RightClick?!1:(s?.({event:r}),!0)}}];const It={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class ts extends Jt{constructor(t){super(t,It)}static setup(){return window.addEventListener(It.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(It.move.name,t)};function t(){}}}ts.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:r}=e,{onActivation:s}=t;const{touches:a}=r;return a.length>1?!1:(s?.({event:r}),!0)}}];var tt;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(tt||(tt={}));var wt;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(wt||(wt={}));function rs(e){let{acceleration:t,activator:r=tt.Pointer,canScroll:s,draggingRect:a,enabled:o,interval:l=5,order:d=wt.TreeOrder,pointerCoordinates:u,scrollableAncestors:g,scrollableAncestorRects:m,delta:h,threshold:w}=e;const p=ss({delta:h,disabled:!o}),[S,y]=fn(),k=c.useRef({x:0,y:0}),E=c.useRef({x:0,y:0}),M=c.useMemo(()=>{switch(r){case tt.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case tt.DraggableRect:return a}},[r,a,u]),N=c.useRef(null),W=c.useCallback(()=>{const P=N.current;if(!P)return;const D=k.current.x*E.current.x,R=k.current.y*E.current.y;P.scrollBy(D,R)},[]),T=c.useMemo(()=>d===wt.TreeOrder?[...g].reverse():g,[d,g]);c.useEffect(()=>{if(!o||!g.length||!M){y();return}for(const P of T){if(s?.(P)===!1)continue;const D=g.indexOf(P),R=m[D];if(!R)continue;const{direction:K,speed:A}=qn(P,R,M,t,w);for(const U of["x","y"])p[U][K[U]]||(A[U]=0,K[U]=0);if(A.x>0||A.y>0){y(),N.current=P,S(W,l),k.current=A,E.current=K;return}}k.current={x:0,y:0},E.current={x:0,y:0},y()},[t,W,s,y,o,l,JSON.stringify(M),JSON.stringify(p),S,g,T,m,JSON.stringify(w)])}const ns={x:{[Y.Backward]:!1,[Y.Forward]:!1},y:{[Y.Backward]:!1,[Y.Forward]:!1}};function ss(e){let{delta:t,disabled:r}=e;const s=$t(t);return it(a=>{if(r||!s||!a)return ns;const o={x:Math.sign(t.x-s.x),y:Math.sign(t.y-s.y)};return{x:{[Y.Backward]:a.x[Y.Backward]||o.x===-1,[Y.Forward]:a.x[Y.Forward]||o.x===1},y:{[Y.Backward]:a.y[Y.Backward]||o.y===-1,[Y.Forward]:a.y[Y.Forward]||o.y===1}}},[r,t,s])}function as(e,t){const r=t!=null?e.get(t):void 0,s=r?r.node.current:null;return it(a=>{var o;return t==null?null:(o=s??a)!=null?o:null},[s,t])}function os(e,t){return c.useMemo(()=>e.reduce((r,s)=>{const{sensor:a}=s,o=a.activators.map(l=>({eventName:l.eventName,handler:t(l.handler,s)}));return[...r,...o]},[]),[e,t])}var at;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(at||(at={}));var Ut;(function(e){e.Optimized="optimized"})(Ut||(Ut={}));const cr=new Map;function is(e,t){let{dragging:r,dependencies:s,config:a}=t;const[o,l]=c.useState(null),{frequency:d,measure:u,strategy:g}=a,m=c.useRef(e),h=k(),w=nt(h),p=c.useCallback(function(E){E===void 0&&(E=[]),!w.current&&l(M=>M===null?E:M.concat(E.filter(N=>!M.includes(N))))},[w]),S=c.useRef(null),y=it(E=>{if(h&&!r)return cr;if(!E||E===cr||m.current!==e||o!=null){const M=new Map;for(let N of e){if(!N)continue;if(o&&o.length>0&&!o.includes(N.id)&&N.rect.current){M.set(N.id,N.rect.current);continue}const W=N.node.current,T=W?new Yt(u(W),W):null;N.rect.current=T,T&&M.set(N.id,T)}return M}return E},[e,o,r,h,u]);return c.useEffect(()=>{m.current=e},[e]),c.useEffect(()=>{h||p()},[r,h]),c.useEffect(()=>{o&&o.length>0&&l(null)},[JSON.stringify(o)]),c.useEffect(()=>{h||typeof d!="number"||S.current!==null||(S.current=setTimeout(()=>{p(),S.current=null},d))},[d,h,p,...s]),{droppableRects:y,measureDroppableContainers:p,measuringScheduled:o!=null};function k(){switch(g){case at.Always:return!1;case at.BeforeDragging:return r;default:return!r}}}function Lr(e,t){return it(r=>e?r||(typeof t=="function"?t(e):e):null,[t,e])}function ls(e,t){return Lr(e,t)}function ds(e){let{callback:t,disabled:r}=e;const s=Xt(t),a=c.useMemo(()=>{if(r||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(s)},[s,r]);return c.useEffect(()=>()=>a?.disconnect(),[a]),a}function St(e){let{callback:t,disabled:r}=e;const s=Xt(t),a=c.useMemo(()=>{if(r||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(s)},[r]);return c.useEffect(()=>()=>a?.disconnect(),[a]),a}function cs(e){return new Yt(lt(e),e)}function ur(e,t,r){t===void 0&&(t=cs);const[s,a]=c.useState(null);function o(){a(u=>{if(!e)return null;if(e.isConnected===!1){var g;return(g=u??r)!=null?g:null}const m=t(e);return JSON.stringify(u)===JSON.stringify(m)?u:m})}const l=ds({callback(u){if(e)for(const g of u){const{type:m,target:h}=g;if(m==="childList"&&h instanceof HTMLElement&&h.contains(e)){o();break}}}}),d=St({callback:o});return De(()=>{o(),e?(d?.observe(e),l?.observe(document.body,{childList:!0,subtree:!0})):(d?.disconnect(),l?.disconnect())},[e]),s}function us(e){const t=Lr(e);return _r(e,t)}const hr=[];function hs(e){const t=c.useRef(e),r=it(s=>e?s&&s!==hr&&e&&t.current&&e.parentNode===t.current.parentNode?s:Ct(e):hr,[e]);return c.useEffect(()=>{t.current=e},[e]),r}function bs(e){const[t,r]=c.useState(null),s=c.useRef(e),a=c.useCallback(o=>{const l=At(o.target);l&&r(d=>d?(d.set(l,Bt(l)),new Map(d)):null)},[]);return c.useEffect(()=>{const o=s.current;if(e!==o){l(o);const d=e.map(u=>{const g=At(u);return g?(g.addEventListener("scroll",a,{passive:!0}),[g,Bt(g)]):null}).filter(u=>u!=null);r(d.length?new Map(d):null),s.current=e}return()=>{l(e),l(o)};function l(d){d.forEach(u=>{const g=At(u);g?.removeEventListener("scroll",a)})}},[a,e]),c.useMemo(()=>e.length?t?Array.from(t.values()).reduce((o,l)=>Le(o,l),fe):Ir(e):fe,[e,t])}function br(e,t){t===void 0&&(t=[]);const r=c.useRef(null);return c.useEffect(()=>{r.current=null},t),c.useEffect(()=>{const s=e!==fe;s&&!r.current&&(r.current=e),!s&&r.current&&(r.current=null)},[e]),r.current?st(e,r.current):fe}function fs(e){c.useEffect(()=>{if(!Nt)return;const t=e.map(r=>{let{sensor:s}=r;return s.setup==null?void 0:s.setup()});return()=>{for(const r of t)r?.()}},e.map(t=>{let{sensor:r}=t;return r}))}function gs(e,t){return c.useMemo(()=>e.reduce((r,s)=>{let{eventName:a,handler:o}=s;return r[a]=l=>{o(l,t)},r},{}),[e,t])}function zr(e){return c.useMemo(()=>e?$n(e):null,[e])}const fr=[];function ms(e,t){t===void 0&&(t=lt);const[r]=e,s=zr(r?Z(r):null),[a,o]=c.useState(fr);function l(){o(()=>e.length?e.map(u=>Ar(u)?s:new Yt(t(u),u)):fr)}const d=St({callback:l});return De(()=>{d?.disconnect(),l(),e.forEach(u=>d?.observe(u))},[e]),a}function xs(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return ot(t)?t:e}function ps(e){let{measure:t}=e;const[r,s]=c.useState(null),a=c.useCallback(g=>{for(const{target:m}of g)if(ot(m)){s(h=>{const w=t(m);return h?{...h,width:w.width,height:w.height}:w});break}},[t]),o=St({callback:a}),l=c.useCallback(g=>{const m=xs(g);o?.disconnect(),m&&o?.observe(m),s(m?t(m):null)},[t,o]),[d,u]=pt(l);return c.useMemo(()=>({nodeRef:d,rect:r,setRef:u}),[r,d,u])}const vs=[{sensor:Gt,options:{}},{sensor:Ht,options:{}}],ws={current:{}},xt={draggable:{measure:or},droppable:{measure:or,strategy:at.WhileDragging,frequency:Ut.Optimized},dragOverlay:{measure:lt}};class rt extends Map{get(t){var r;return t!=null&&(r=super.get(t))!=null?r:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:r}=t;return!r})}getNodeFor(t){var r,s;return(r=(s=this.get(t))==null?void 0:s.node.current)!=null?r:void 0}}const ys={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new rt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:vt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:xt,measureDroppableContainers:vt,windowRect:null,measuringScheduled:!1},ks={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:vt,draggableNodes:new Map,over:null,measureDroppableContainers:vt},Dt=c.createContext(ks),Ns=c.createContext(ys);function js(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new rt}}}function Cs(e,t){switch(t.type){case X.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case X.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case X.DragEnd:case X.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case X.RegisterDroppable:{const{element:r}=t,{id:s}=r,a=new rt(e.droppable.containers);return a.set(s,r),{...e,droppable:{...e.droppable,containers:a}}}case X.SetDroppableDisabled:{const{id:r,key:s,disabled:a}=t,o=e.droppable.containers.get(r);if(!o||s!==o.key)return e;const l=new rt(e.droppable.containers);return l.set(r,{...o,disabled:a}),{...e,droppable:{...e.droppable,containers:l}}}case X.UnregisterDroppable:{const{id:r,key:s}=t,a=e.droppable.containers.get(r);if(!a||s!==a.key)return e;const o=new rt(e.droppable.containers);return o.delete(r),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function Ss(e){let{disabled:t}=e;const{active:r,activatorEvent:s,draggableNodes:a}=c.useContext(Dt),o=$t(s),l=$t(r?.id);return c.useEffect(()=>{if(!t&&!s&&o&&l!=null){if(!Nr(o)||document.activeElement===o.target)return;const d=a.get(l);if(!d)return;const{activatorNode:u,node:g}=d;if(!u.current&&!g.current)return;requestAnimationFrame(()=>{for(const m of[u.current,g.current]){if(!m)continue;const h=xn(m);if(h){h.focus();break}}})}},[s,t,a,l,o]),null}function Ds(e,t){let{transform:r,...s}=t;return e!=null&&e.length?e.reduce((a,o)=>o({transform:a,...s}),r):r}function _s(e){return c.useMemo(()=>({draggable:{...xt.draggable,...e?.draggable},droppable:{...xt.droppable,...e?.droppable},dragOverlay:{...xt.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function Es(e){let{activeNode:t,measure:r,initialRect:s,config:a=!0}=e;const o=c.useRef(!1),{x:l,y:d}=typeof a=="boolean"?{x:a,y:a}:a;De(()=>{if(!l&&!d||!t){o.current=!1;return}if(o.current||!s)return;const g=t?.node.current;if(!g||g.isConnected===!1)return;const m=r(g),h=_r(m,s);if(l||(h.x=0),d||(h.y=0),o.current=!0,Math.abs(h.x)>0||Math.abs(h.y)>0){const w=Er(g);w&&w.scrollBy({top:h.y,left:h.x})}},[t,l,d,s,r])}const Pr=c.createContext({...fe,scaleX:1,scaleY:1});var Se;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Se||(Se={}));const Rs=c.memo(function(t){var r,s,a,o;let{id:l,accessibility:d,autoScroll:u=!0,children:g,sensors:m=vs,collisionDetection:h=An,measuring:w,modifiers:p,...S}=t;const y=c.useReducer(Cs,void 0,js),[k,E]=y,[M,N]=Nn(),[W,T]=c.useState(Se.Uninitialized),P=W===Se.Initialized,{draggable:{active:D,nodes:R,translate:K},droppable:{containers:A}}=k,U=D!=null?R.get(D):null,ce=c.useRef({initial:null,translated:null}),ue=c.useMemo(()=>{var J;return D!=null?{id:D,data:(J=U?.data)!=null?J:ws,rect:ce}:null},[D,U]),q=c.useRef(null),[$e,Fe]=c.useState(null),[$,v]=c.useState(null),he=nt(S,Object.values(S)),We=jt("DndDescribedBy",l),oe=c.useMemo(()=>A.getEnabled(),[A]),ge=_s(w),{droppableRects:be,measureDroppableContainers:Me,measuringScheduled:Be}=is(oe,{dragging:P,dependencies:[K.x,K.y],config:ge.droppable}),Q=as(R,D),ct=c.useMemo(()=>$?Ft($):null,[$]),Ae=Br(),ut=ls(Q,ge.draggable.measure);Es({activeNode:D!=null?R.get(D):null,config:Ae.layoutShiftCompensation,initialRect:ut,measure:ge.draggable.measure});const ee=ur(Q,ge.draggable.measure,ut),qe=ur(Q?Q.parentElement:null),ve=c.useRef({activatorEvent:null,active:null,activeNode:Q,collisionRect:null,collisions:null,droppableRects:be,draggableNodes:R,draggingNode:null,draggingNodeRect:null,droppableContainers:A,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Ue=A.getNodeFor((r=ve.current.over)==null?void 0:r.id),me=ps({measure:ge.dragOverlay.measure}),Te=(s=me.nodeRef.current)!=null?s:Q,ye=P?(a=me.rect)!=null?a:ee:null,Ke=!!(me.nodeRef.current&&me.rect),Ve=us(Ke?null:ee),_e=zr(Te?Z(Te):null),ie=hs(P?Ue??Q:null),i=ms(ie),f=Ds(p,{transform:{x:K.x-Ve.x,y:K.y-Ve.y,scaleX:1,scaleY:1},activatorEvent:$,active:ue,activeNodeRect:ee,containerNodeRect:qe,draggingNodeRect:ye,over:ve.current.over,overlayNodeRect:me.rect,scrollableAncestors:ie,scrollableAncestorRects:i,windowRect:_e}),b=ct?Le(ct,K):null,x=bs(ie),j=br(x),C=br(x,[ee]),L=Le(f,j),F=ye?On(ye,f):null,I=ue&&F?h({active:ue,collisionRect:F,droppableRects:be,droppableContainers:oe,pointerCoordinates:b}):null,z=Dr(I,"id"),[B,O]=c.useState(null),te=Ke?f:Le(f,C),re=Tn(te,(o=B?.rect)!=null?o:null,ee),ke=c.useRef(null),ht=c.useCallback((J,ne)=>{let{sensor:se,options:Ne}=ne;if(q.current==null)return;const le=R.get(q.current);if(!le)return;const ae=J.nativeEvent,xe=new se({active:q.current,activeNode:le,event:ae,options:Ne,context:ve,onAbort(H){if(!R.get(H))return;const{onDragAbort:pe}=he.current,we={id:H};pe?.(we),M({type:"onDragAbort",event:we})},onPending(H,je,pe,we){if(!R.get(H))return;const{onDragPending:Je}=he.current,Ce={id:H,constraint:je,initialCoordinates:pe,offset:we};Je?.(Ce),M({type:"onDragPending",event:Ce})},onStart(H){const je=q.current;if(je==null)return;const pe=R.get(je);if(!pe)return;const{onDragStart:we}=he.current,He={activatorEvent:ae,active:{id:je,data:pe.data,rect:ce}};Ze.unstable_batchedUpdates(()=>{we?.(He),T(Se.Initializing),E({type:X.DragStart,initialCoordinates:H,active:je}),M({type:"onDragStart",event:He}),Fe(ke.current),v(ae)})},onMove(H){E({type:X.DragMove,coordinates:H})},onEnd:Ie(X.DragEnd),onCancel:Ie(X.DragCancel)});ke.current=xe;function Ie(H){return async function(){const{active:pe,collisions:we,over:He,scrollAdjustedTranslate:Je}=ve.current;let Ce=null;if(pe&&Je){const{cancelDrop:Ge}=he.current;Ce={activatorEvent:ae,active:pe,collisions:we,delta:Je,over:He},H===X.DragEnd&&typeof Ge=="function"&&await Promise.resolve(Ge(Ce))&&(H=X.DragCancel)}q.current=null,Ze.unstable_batchedUpdates(()=>{E({type:H}),T(Se.Uninitialized),O(null),Fe(null),v(null),ke.current=null;const Ge=H===X.DragEnd?"onDragEnd":"onDragCancel";if(Ce){const _t=he.current[Ge];_t?.(Ce),M({type:Ge,event:Ce})}})}}},[R]),Xe=c.useCallback((J,ne)=>(se,Ne)=>{const le=se.nativeEvent,ae=R.get(Ne);if(q.current!==null||!ae||le.dndKit||le.defaultPrevented)return;const xe={active:ae};J(se,ne.options,xe)===!0&&(le.dndKit={capturedBy:ne.sensor},q.current=Ne,ht(se,ne))},[R,ht]),Ye=os(m,Xe);fs(m),De(()=>{ee&&W===Se.Initializing&&T(Se.Initialized)},[ee,W]),c.useEffect(()=>{const{onDragMove:J}=he.current,{active:ne,activatorEvent:se,collisions:Ne,over:le}=ve.current;if(!ne||!se)return;const ae={active:ne,activatorEvent:se,collisions:Ne,delta:{x:L.x,y:L.y},over:le};Ze.unstable_batchedUpdates(()=>{J?.(ae),M({type:"onDragMove",event:ae})})},[L.x,L.y]),c.useEffect(()=>{const{active:J,activatorEvent:ne,collisions:se,droppableContainers:Ne,scrollAdjustedTranslate:le}=ve.current;if(!J||q.current==null||!ne||!le)return;const{onDragOver:ae}=he.current,xe=Ne.get(z),Ie=xe&&xe.rect.current?{id:xe.id,rect:xe.rect.current,data:xe.data,disabled:xe.disabled}:null,H={active:J,activatorEvent:ne,collisions:se,delta:{x:le.x,y:le.y},over:Ie};Ze.unstable_batchedUpdates(()=>{O(Ie),ae?.(H),M({type:"onDragOver",event:H})})},[z]),De(()=>{ve.current={activatorEvent:$,active:ue,activeNode:Q,collisionRect:F,collisions:I,droppableRects:be,draggableNodes:R,draggingNode:Te,draggingNodeRect:ye,droppableContainers:A,over:B,scrollableAncestors:ie,scrollAdjustedTranslate:L},ce.current={initial:ye,translated:F}},[ue,Q,I,F,R,Te,ye,be,A,B,ie,L]),rs({...Ae,delta:K,draggingRect:F,pointerCoordinates:b,scrollableAncestors:ie,scrollableAncestorRects:i});const Fr=c.useMemo(()=>({active:ue,activeNode:Q,activeNodeRect:ee,activatorEvent:$,collisions:I,containerNodeRect:qe,dragOverlay:me,draggableNodes:R,droppableContainers:A,droppableRects:be,over:B,measureDroppableContainers:Me,scrollableAncestors:ie,scrollableAncestorRects:i,measuringConfiguration:ge,measuringScheduled:Be,windowRect:_e}),[ue,Q,ee,$,I,qe,me,R,A,be,B,Me,ie,i,ge,Be,_e]),Wr=c.useMemo(()=>({activatorEvent:$,activators:Ye,active:ue,activeNodeRect:ee,ariaDescribedById:{draggable:We},dispatch:E,draggableNodes:R,over:B,measureDroppableContainers:Me}),[$,Ye,ue,ee,E,We,R,B,Me]);return V.createElement(jr.Provider,{value:N},V.createElement(Dt.Provider,{value:Wr},V.createElement(Ns.Provider,{value:Fr},V.createElement(Pr.Provider,{value:re},g)),V.createElement(Ss,{disabled:d?.restoreFocus===!1})),V.createElement(Sn,{...d,hiddenTextDescribedById:We}));function Br(){const J=$e?.autoScrollEnabled===!1,ne=typeof u=="object"?u.enabled===!1:u===!1,se=P&&!J&&!ne;return typeof u=="object"?{...u,enabled:se}:{enabled:se}}}),Ms=c.createContext(null),gr="button",As="Draggable";function Ts(e){let{id:t,data:r,disabled:s=!1,attributes:a}=e;const o=jt(As),{activators:l,activatorEvent:d,active:u,activeNodeRect:g,ariaDescribedById:m,draggableNodes:h,over:w}=c.useContext(Dt),{role:p=gr,roleDescription:S="draggable",tabIndex:y=0}=a??{},k=u?.id===t,E=c.useContext(k?Pr:Ms),[M,N]=pt(),[W,T]=pt(),P=gs(l,t),D=nt(r);De(()=>(h.set(t,{id:t,key:o,node:M,activatorNode:W,data:D}),()=>{const K=h.get(t);K&&K.key===o&&h.delete(t)}),[h,t]);const R=c.useMemo(()=>({role:p,tabIndex:y,"aria-disabled":s,"aria-pressed":k&&p===gr?!0:void 0,"aria-roledescription":S,"aria-describedby":m.draggable}),[s,p,y,k,S,m.draggable]);return{active:u,activatorEvent:d,activeNodeRect:g,attributes:R,isDragging:k,listeners:s?void 0:P,node:M,over:w,setNodeRef:N,setActivatorNodeRef:T,transform:E}}const Is="Droppable",Os={timeout:25};function Ls(e){let{data:t,disabled:r=!1,id:s,resizeObserverConfig:a}=e;const o=jt(Is),{active:l,dispatch:d,over:u,measureDroppableContainers:g}=c.useContext(Dt),m=c.useRef({disabled:r}),h=c.useRef(!1),w=c.useRef(null),p=c.useRef(null),{disabled:S,updateMeasurementsFor:y,timeout:k}={...Os,...a},E=nt(y??s),M=c.useCallback(()=>{if(!h.current){h.current=!0;return}p.current!=null&&clearTimeout(p.current),p.current=setTimeout(()=>{g(Array.isArray(E.current)?E.current:[E.current]),p.current=null},k)},[k]),N=St({callback:M,disabled:S||!l}),W=c.useCallback((R,K)=>{N&&(K&&(N.unobserve(K),h.current=!1),R&&N.observe(R))},[N]),[T,P]=pt(W),D=nt(t);return c.useEffect(()=>{!N||!T.current||(N.disconnect(),h.current=!1,N.observe(T.current))},[T,N]),c.useEffect(()=>(d({type:X.RegisterDroppable,element:{id:s,key:o,disabled:r,node:T,rect:w,data:D}}),()=>d({type:X.UnregisterDroppable,key:o,id:s})),[s]),c.useEffect(()=>{r!==m.current.disabled&&(d({type:X.SetDroppableDisabled,id:s,key:o,disabled:r}),m.current.disabled=r)},[s,o,r,d]),{active:l,rect:w,isOver:u?.id===s,node:T,over:u,setNodeRef:P}}function Ot(e,t,r){const s=e.slice();return s.splice(r<0?s.length+r:r,0,s.splice(t,1)[0]),s}function yt(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const zs=[_.Down,_.Right,_.Up,_.Left],Ps=(e,t)=>{let{context:{active:r,collisionRect:s,droppableRects:a,droppableContainers:o,over:l,scrollableAncestors:d}}=t;if(zs.includes(e.code)){if(e.preventDefault(),!r||!s)return;const u=[];o.getEnabled().forEach(h=>{if(!h||h!=null&&h.disabled)return;const w=a.get(h.id);if(w)switch(e.code){case _.Down:s.top<w.top&&u.push(h);break;case _.Up:s.top>w.top&&u.push(h);break;case _.Left:s.left>w.left&&u.push(h);break;case _.Right:s.left<w.left&&u.push(h);break}});const g=Rn({collisionRect:s,droppableRects:a,droppableContainers:u});let m=Dr(g,"id");if(m===l?.id&&g.length>1&&(m=g[1].id),m!=null){const h=o.get(r.id),w=o.get(m),p=w?a.get(w.id):null,S=w?.node.current;if(S&&p&&h&&w){const k=Ct(S).some((P,D)=>d[D]!==P),E=$r(h,w),M=$s(h,w),N=k||!E?{x:0,y:0}:{x:M?s.width-p.width:0,y:M?s.height-p.height:0},W={x:p.left,y:p.top};return N.x&&N.y?W:st(W,N)}}}};function $r(e,t){return!yt(e)||!yt(t)?!1:e.data.current.sortable.containerId===t.data.current.sortable.containerId}function $s(e,t){return!yt(e)||!yt(t)||!$r(e,t)?!1:e.data.current.sortable.index<t.data.current.sortable.index}const Fs={blue:"text-blue-600 bg-blue-50 dark:bg-blue-900/20 dark:text-blue-400",emerald:"text-emerald-600 bg-emerald-50 dark:bg-emerald-900/20 dark:text-emerald-400",rose:"text-rose-600 bg-rose-50 dark:bg-rose-900/20 dark:text-rose-400",amber:"text-amber-600 bg-amber-50 dark:bg-amber-900/20 dark:text-amber-400",indigo:"text-indigo-600 bg-indigo-50 dark:bg-indigo-900/20 dark:text-indigo-400",slate:"text-slate-600 bg-slate-50 dark:bg-slate-900/20 dark:text-slate-400"},dt=({title:e,icon:t,iconColor:r="blue",children:s,onRemove:a,onClick:o,targetView:l,footerLeft:d,footerRight:u,className:g,backgroundIcon:m})=>{const{t:h}=Re(),w=kt(),p=d||u||l,S=d||(l&&!u?n.jsxs("button",{onClick:y=>{y.stopPropagation(),w(l)},className:"flex items-center gap-1.5 text-[10px] font-black text-slate-400 hover:text-blue-600 uppercase tracking-widest transition-colors group/footer",children:[h("common.open_details"),n.jsx(Hr,{className:"w-3 h-3 transition-transform group-hover/footer:translate-x-0.5"})]}):null);return n.jsxs("div",{className:Zt("group relative flex flex-col bg-white dark:bg-slate-800 rounded-xl border border-slate-300 dark:border-slate-700/50 shadow-sm hover:shadow-xl hover:shadow-slate-200/50 dark:hover:shadow-none transition-all duration-500 overflow-hidden h-full",o&&"cursor-pointer active:scale-[0.98]",g),children:[m&&n.jsx("div",{className:"absolute -right-8 -bottom-8 text-slate-50/50 dark:text-slate-900/20 group-hover:text-slate-100/50 dark:group-hover:text-slate-900/40 transition-colors duration-500",children:n.jsx(m,{size:160,strokeWidth:1})}),n.jsxs("div",{className:"relative flex items-center justify-between pt-2.5 pb-2.5 px-5 bg-slate-50/50 dark:bg-slate-900/20 border-b border-slate-200 dark:border-slate-800/50",children:[n.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[n.jsx("div",{className:Zt("p-1.5 rounded-xl shrink-0 shadow-sm",Fs[r]),children:n.jsx(t,{className:"w-4 h-4"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("h3",{className:"text-xs font-bold leading-snug text-slate-800 dark:text-white truncate tracking-tight",children:e}),n.jsx("div",{className:"h-0.5 w-4 bg-slate-200 dark:bg-slate-700 rounded-full mt-0.5 group-hover:w-8 transition-all duration-500"})]})]}),n.jsx("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-all duration-300 translate-x-2 group-hover:translate-x-0",children:a&&n.jsx("button",{onClick:y=>{y.stopPropagation(),a()},className:"p-1 text-slate-400 hover:text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg transition-colors",title:h("common.remove"),children:n.jsx(Jr,{className:"w-3.5 h-3.5"})})})]}),n.jsx("div",{className:"relative flex-1 p-4 px-5 pt-2 min-h-0",onClick:o,children:s}),p&&n.jsxs("div",{className:"relative p-3 px-5 border-t border-slate-200 dark:border-slate-800/50 bg-slate-50/50 dark:bg-slate-900/30 flex items-center justify-between min-h-[40px]",children:[n.jsx("div",{className:"flex-1 min-w-0",children:S}),n.jsx("div",{className:"shrink-0",children:u})]}),n.jsx("div",{className:"absolute inset-0 pointer-events-none border border-transparent group-hover:border-blue-500/10 dark:group-hover:border-blue-400/10 rounded-xl transition-colors"})]})},Ws=({onRemove:e,dragHandleProps:t,onClick:r,targetView:s})=>{const{t:a,i18n:o}=Re(),[l,d]=c.useState(new Date);c.useEffect(()=>{const h=setInterval(()=>d(new Date),1e3);return()=>clearInterval(h)},[]);const u=c.useMemo(()=>new Intl.DateTimeFormat(o.language==="de"?"de-DE":"en-US",{weekday:"long",day:"2-digit",month:"long"}).format(l),[l,o.language]),g=l.toLocaleTimeString(o.language==="de"?"de-DE":"en-US",{hour:"2-digit",minute:"2-digit"});return n.jsx(dt,{title:a("widgets.clock.title"),icon:Pt,iconColor:"indigo",onRemove:e,dragHandleProps:t,onClick:r,targetView:s,backgroundIcon:Pt,children:n.jsx("div",{className:"flex flex-col h-full items-center justify-center -mt-2",children:n.jsxs("div",{className:"text-center group-hover:scale-110 transition-transform duration-700",children:[n.jsxs("div",{className:"flex items-baseline justify-center gap-1.5",children:[n.jsx("span",{className:"text-6xl font-black text-slate-900 dark:text-white tracking-tighter tabular-nums leading-none",children:g}),n.jsx("span",{className:"text-xs font-black text-indigo-500/80 dark:text-indigo-400/80 uppercase tracking-widest tabular-nums",children:"CET"})]}),n.jsxs("div",{className:"mt-4 flex flex-col items-center",children:[n.jsx("div",{className:"h-px w-8 bg-slate-100 dark:bg-slate-800 mb-4"}),n.jsxs("div",{className:"flex items-center gap-2 px-4 py-1.5 bg-slate-50 dark:bg-slate-900/40 rounded-2xl border border-slate-100 dark:border-slate-800/50",children:[n.jsx(Gr,{className:"w-3.5 h-3.5 text-slate-400 flex-shrink-0"}),n.jsx("span",{className:"text-xs font-bold text-slate-600 dark:text-slate-300 tracking-tight whitespace-nowrap",children:u})]})]})]})})})},Bs=({className:e=""})=>n.jsx("div",{className:`animate-shimmer bg-slate-100 dark:bg-slate-800 rounded ${e}`}),qs=({onRemove:e,dragHandleProps:t,onClick:r,targetView:s})=>{const{t:a}=Re(),o=kt(),{data:l,loading:d,error:u}=xr(()=>G.getDatabaseStats(),[],{cacheKey:"db-stats-tile",ttl:600*1e3});if(u)return n.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-red-200 dark:border-red-900/50 p-4 h-full flex items-center justify-center text-center",children:n.jsx("p",{className:"text-red-500 font-bold text-[10px] uppercase",children:a("common.error")})});const g=()=>{r&&r(),o("/inspector")};return n.jsx(dt,{title:a("widgets.data_inspector.title"),icon:ft,iconColor:"indigo",onClick:r||g,onRemove:e,targetView:s,dragHandleProps:t,backgroundIcon:ft,className:"cursor-pointer",footerLeft:n.jsxs("button",{onClick:m=>{m.stopPropagation(),o("/inspector")},className:"flex items-center gap-1.5 text-[10px] font-black text-slate-400 hover:text-indigo-600 uppercase tracking-widest transition-colors group/footer",children:[a("widgets.data_inspector.details"),n.jsx(ft,{className:"w-3 h-3 transition-transform group-hover/footer:scale-110"})]}),children:n.jsxs("div",{className:"flex flex-col h-full items-center justify-around py-2",children:[n.jsxs("div",{className:"text-center group-hover:scale-105 transition-transform duration-500",children:[n.jsxs("div",{className:"flex items-center justify-center gap-1.5 text-[10px] font-black text-indigo-600 dark:text-indigo-400 uppercase tracking-widest mb-1",children:[n.jsx(Zr,{className:"w-3 h-3"}),n.jsx("span",{children:a("widgets.data_inspector.records_total")})]}),n.jsx("div",{className:"text-4xl font-black text-slate-900 dark:text-white tracking-tighter tabular-nums leading-none",children:d||!l?n.jsx(Bs,{className:"h-8 w-20 mx-auto"}):l.records.toLocaleString()})]}),n.jsxs("div",{className:"w-full pt-4 border-t border-slate-200 dark:border-slate-800/50 text-center",children:[n.jsxs("div",{className:"flex items-center justify-center gap-1.5 text-[10px] font-black text-indigo-500 dark:text-indigo-400 uppercase tracking-widest mb-1",children:[n.jsx(Qe,{className:"w-3 h-3"}),n.jsx("span",{children:a("widgets.data_inspector.tables")})]}),n.jsx("div",{className:"text-2xl font-black text-slate-700 dark:text-slate-300 tabular-nums leading-none",children:d||!l?"...":l.tables})]})]})})},Us=({onRemove:e,dragHandleProps:t,onClick:r,targetView:s})=>{const{t:a}=Re(),[o,l]=c.useState(!1),[d,u]=c.useState(null),[g,m]=c.useState(null);V.useEffect(()=>{const w=performance.getEntriesByType("navigation")[0];w&&m(Math.round(w.duration));const p=()=>{const y=performance;if(y.memory){const k=y.memory;u({used:Math.round(k.usedJSHeapSize/1024/1024),total:Math.round(k.jsHeapSizeLimit/1024/1024)})}};p();const S=setInterval(p,5e3);return()=>clearInterval(S)},[]);const h=()=>{l(!0),r&&r()};return n.jsxs(n.Fragment,{children:[n.jsx(dt,{title:a("widgets.system_status.title"),icon:gt,iconColor:"emerald",onRemove:e,dragHandleProps:t,onClick:h,targetView:s,backgroundIcon:gt,className:"cursor-pointer",footerLeft:n.jsxs("button",{onClick:w=>{w.stopPropagation(),l(!0)},className:"flex items-center gap-1.5 text-[10px] font-black text-slate-400 hover:text-blue-600 uppercase tracking-widest transition-colors group/footer",children:[a("widgets.system_status.details"),n.jsx(gt,{className:"w-3 h-3 transition-transform group-hover/footer:scale-110"})]}),children:n.jsxs("div",{className:"flex flex-col h-full items-center justify-around py-2",children:[n.jsxs("div",{className:"text-center group-hover:scale-105 transition-transform duration-500",children:[n.jsxs("div",{className:"flex items-center justify-center gap-1.5 text-[10px] font-black text-emerald-600 dark:text-emerald-400 uppercase tracking-widest mb-1",children:[n.jsx(Qr,{className:"w-3 h-3"}),n.jsx("span",{children:a("widgets.system_status.memory_usage")})]}),n.jsx("div",{className:"text-4xl font-black text-slate-900 dark:text-white tracking-tighter tabular-nums leading-none",children:d?`${d.used} MB`:"---"}),n.jsx("div",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-tighter mt-1",children:a("widgets.system_status.heap_from",{total:d?d.total:"---"})})]}),n.jsxs("div",{className:"w-full pt-4 border-t border-slate-200 dark:border-slate-800/50 text-center",children:[n.jsxs("div",{className:"flex items-center justify-center gap-1.5 text-[10px] font-black text-blue-500 dark:text-blue-400 uppercase tracking-widest mb-1",children:[n.jsx(en,{className:"w-3 h-3"}),n.jsx("span",{children:a("widgets.system_status.load_time")})]}),n.jsx("div",{className:"text-2xl font-black text-slate-700 dark:text-slate-300 tabular-nums leading-none",children:g?`${g} ms`:"---"})]})]})}),n.jsx(qr,{isOpen:o,onClose:()=>l(!1)})]})},Ks=({onRemove:e,dragHandleProps:t,onClick:r,targetView:s,isOverlay:a})=>{const{t:o,i18n:l}=Re(),d=kt(),{lastBackup:u,changeCount:g,isBackupRecommended:m}=bn(),h=p=>p?p.toLocaleString(l.language==="de"?"de-DE":"en-US",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):o("widgets.database_status.never"),w=p=>{p.stopPropagation(),d("/datasource")};return n.jsx(dt,{title:o("widgets.database_status.title"),icon:Qe,iconColor:m?"amber":"emerald",onRemove:e,dragHandleProps:t,onClick:r,targetView:s,backgroundIcon:Qe,className:a?"opacity-90":"",footerLeft:n.jsxs("button",{onClick:w,className:"flex items-center gap-1.5 text-[10px] font-black text-slate-400 hover:text-blue-600 uppercase tracking-widest transition-colors group/footer",children:[o("widgets.database_status.data_management"),n.jsx(wr,{className:"w-3 h-3 transition-transform group-hover/footer:rotate-90"})]}),children:n.jsxs("div",{className:"flex flex-col h-full items-center justify-around py-2",children:[n.jsxs("div",{className:"text-center",children:[n.jsxs("div",{className:"flex items-center justify-center gap-1.5 text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-1",children:[n.jsx(tn,{className:"w-3 h-3"}),n.jsx("span",{children:o("widgets.database_status.last_backup")})]}),n.jsx("div",{className:"text-xl font-black text-slate-900 dark:text-white tracking-tight tabular-nums leading-none",children:h(u)})]}),n.jsxs("div",{className:"w-full pt-4 border-t border-slate-100 dark:border-slate-800/50 text-center",children:[n.jsxs("div",{className:`flex items-center justify-center gap-1.5 text-[10px] font-black uppercase tracking-widest mb-1 ${m?"text-amber-600 dark:text-amber-400":"text-emerald-600 dark:text-emerald-400"}`,children:[m?n.jsx(vr,{className:"w-3 h-3"}):n.jsx(Qe,{className:"w-3 h-3"}),n.jsx("span",{children:o("widgets.database_status.modifications")})]}),n.jsx("div",{className:`text-4xl font-black tabular-nums leading-none tracking-tighter ${m?"text-amber-600 dark:text-amber-400":"text-slate-900 dark:text-white"}`,children:g}),n.jsx("div",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-tighter mt-1",children:o("widgets.database_status.records_since_backup")})]})]})})},Vs=pr("WorklistComponent"),Xs=({onRemove:e,dragHandleProps:t,onClick:r,targetView:s,isOverlay:a})=>{const{t:o}=Re(),l=kt(),[d,u]=c.useState({total:0,pending:0}),[g,m]=c.useState(!0),h=async()=>{try{const p=await G.getWorklist(),S=p.length,y=p.filter(k=>k.status==="pending"||!k.status).length;u({total:S,pending:y})}catch(p){Vs.error("Failed to load worklist stats",p)}finally{m(!1)}};c.useEffect(()=>(h(),window.addEventListener("db-updated",h),window.addEventListener("db-changed",h),()=>{window.removeEventListener("db-updated",h),window.removeEventListener("db-changed",h)}),[]);const w=p=>{p.stopPropagation(),l("/worklist")};return n.jsx(dt,{title:o("widgets.worklist.title"),icon:mt,iconColor:d.pending>0?"amber":"emerald",onRemove:e,dragHandleProps:t,onClick:r,targetView:s,backgroundIcon:mt,className:a?"opacity-90":"",footerLeft:n.jsxs("button",{onClick:w,className:"flex items-center gap-1.5 text-[10px] font-black text-slate-400 hover:text-blue-600 uppercase tracking-widest transition-colors group/footer",children:[o("widgets.worklist.open_list"),n.jsx(nn,{className:"w-3 h-3 transition-transform group-hover/footer:translate-x-1"})]}),children:n.jsxs("div",{className:"flex flex-col h-full items-center justify-around py-2",children:[n.jsxs("div",{className:"text-center",children:[n.jsxs("div",{className:`flex items-center justify-center gap-1.5 text-[10px] font-black uppercase tracking-widest mb-1 ${d.pending>0?"text-amber-600 dark:text-amber-400":"text-emerald-600 dark:text-emerald-400"}`,children:[d.pending>0?n.jsx(vr,{className:"w-3 h-3"}):n.jsx(rn,{className:"w-3 h-3"}),n.jsx("span",{children:d.pending>0?o("widgets.worklist.open_tasks"):o("widgets.worklist.all_done")})]}),n.jsx("div",{className:`text-4xl font-black tracking-tighter tabular-nums leading-none ${d.pending>0?"text-amber-600 dark:text-amber-400":"text-slate-900 dark:text-white"}`,children:g?"---":d.pending})]}),n.jsxs("div",{className:"w-full pt-4 border-t border-slate-100 dark:border-slate-800/50 text-center",children:[n.jsxs("div",{className:"flex items-center justify-center gap-1.5 text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-1",children:[n.jsx(mt,{className:"w-3 h-3"}),n.jsx("span",{children:o("widgets.worklist.total_entries")})]}),n.jsx("div",{className:"text-xl font-black text-slate-700 dark:text-slate-300 tabular-nums leading-none",children:g?"---":d.total})]})]})})},Ys={ClockComponent:Ws,DataInspectorComponent:qs,SystemStatusComponent:Us,DatabaseStatusComponent:Ks,WorklistComponent:Xs},Lt=[{id:"SystemStatusComponent",titleKey:"widgets.system_status.title",descriptionKey:"widgets.system_status.description",icon:gt,defaultColSpan:1},{id:"DataInspectorComponent",titleKey:"widgets.data_inspector.title",descriptionKey:"widgets.data_inspector.description",icon:ft,defaultColSpan:1},{id:"DatabaseStatusComponent",titleKey:"widgets.database_status.title",descriptionKey:"widgets.database_status.description",icon:sn,defaultColSpan:1},{id:"ClockComponent",titleKey:"widgets.clock.title",descriptionKey:"widgets.clock.description",icon:Pt,defaultColSpan:1},{id:"WorklistComponent",titleKey:"widgets.worklist.title",descriptionKey:"widgets.worklist.description",icon:mt,defaultColSpan:1}],Hs=e=>Ys[e]||null,zt=pr("CustomDashboardView"),Js="litebi:app-ready",mr=({id:e,className:t,children:r})=>{const{attributes:s,listeners:a,setNodeRef:o,transform:l,isDragging:d}=Ts({id:e}),{setNodeRef:u,isOver:g}=Ls({id:e}),m=h=>{o(h),u(h)};return n.jsx("div",{ref:m,style:{transform:Wt.Translate.toString(l)},className:`${t||""} ${d?"opacity-50 z-10":""} ${g&&!d?"ring-2 ring-blue-300 rounded-xl":""}`,...s,...a,children:r})},ua=()=>{const{t:e}=Re(),[t,r]=c.useState([]),[s,a]=Et("dashboard_order_v1",[]),[o,l]=c.useState(null),[d,u]=c.useState(!1),[g,m]=c.useState(!1),[h,w]=c.useState("system"),[p,S]=Et("dashboard_tools_open",!1),[y,k]=Et("dashboard_tools_tab_v1","layout"),[E,M]=c.useState(null),[N,W]=c.useState([]),[T,P]=c.useState({}),{visibleSidebarComponentIds:D,setVisibleSidebarComponentIds:R,togglePresentationMode:K,isReadOnly:A}=Ur(),{isExporting:U,exportToPdf:ce}=Xr(),ue=Dn(nr(Gt,{activationConstraint:{distance:8}}),nr(Ht,{coordinateGetter:Ps})),{data:q,refresh:$e}=xr(async()=>await G.executeRaw("SELECT * FROM sys_user_widgets ORDER BY created_at DESC"),[]),Fe=V.useRef(!1);c.useEffect(()=>{(async()=>{if(Fe.current)return;Fe.current=!0;let b=await G.getDashboards();const x=localStorage.getItem("custom_dashboard_layout");if(b.length===0){const I={id:crypto.randomUUID(),name:e("dashboard.default_name"),layout:x?JSON.parse(x):[],is_default:!0};await G.saveDashboard(I,!0),x&&localStorage.removeItem("custom_dashboard_layout"),b=[I]}else b.length>0&&(b=b.map(I=>({...I,layout:typeof I.layout=="string"?JSON.parse(I.layout):I.layout})));r(b);const j=window.location.hash||"#/",C=j.includes("?")?j.slice(j.indexOf("?")+1):"",L=C?new URLSearchParams(C).get("dashboard"):null,F=L&&b.some(I=>I.id===L)?L:b[0]?.id??null;l(F),u(!0),window.__LITEBI_READY__=!0,window.dispatchEvent(new Event(Js))})()},[e]);const $=V.useMemo(()=>{if(!t.length)return[];const i=new Map(t.map(x=>[x.id,x])),f=s.map(x=>i.get(x)).filter(x=>!!x),b=t.filter(x=>!s.includes(x.id));return[...f,...b]},[t,s]),v=$.find(i=>i.id===o),he=V.useMemo(()=>$.filter(i=>i.id!==o),[$,o]),We=V.useMemo(()=>!E||!v?null:v.layout.some(i=>i.id===E)?E:null,[v,E]);c.useEffect(()=>{if(!v||!q)return;(async()=>{const f=v.layout.map(F=>F.id),b=q.filter(F=>f.includes(F.id));if(b.length===0){W([]);return}const x=[];for(const F of b){const I=new Set,z=/\b(?:FROM|JOIN)\s+([a-zA-Z0-9_]+)/gi;let B=null;for(;(B=z.exec(F.sql_query))!==null;)B[1]&&I.add(B[1]);const O=new Set;for(const te of Array.from(I))try{const re=await G.getTableSchema(te);re&&Array.isArray(re)&&re.forEach(ke=>O.add(ke.name))}catch(re){zt.error("Error fetching schema for table",te,re)}O.size>0&&x.push(O)}if(x.length===0){W([]);return}const[j,...C]=x,L=new Set(Array.from(j).filter(F=>C.every(I=>I.has(F))));W(Array.from(L).sort())})()},[v,q]);const oe=async i=>{await G.saveDashboard(i),r(f=>f.map(b=>b.id===i.id?i:b))},ge=async(i,f)=>{if(!v||v.layout.find(x=>x.id===i))return;const b={...v,layout:[...v.layout,{id:i,type:f}]};await oe(b),m(!1)},be=async i=>{if(!v)return;const f={...v,layout:v.layout.filter(b=>b.id!==i)};await oe(f)},Me=async i=>{if(A||!v)return;const{active:f,over:b}=i;if(!b||f.id===b.id)return;const x=v.layout.findIndex(L=>L.id===String(f.id)),j=v.layout.findIndex(L=>L.id===String(b.id));if(x<0||j<0)return;const C=Ot(v.layout,x,j);await oe({...v,layout:C})},Be=async(i,f)=>{if(!v)return;const b=v.layout.findIndex(C=>C.id===i);if(b<0)return;const x=b+f;if(x<0||x>=v.layout.length)return;const j=Ot(v.layout,b,x);await oe({...v,layout:j})},Q=async(i,f)=>{if(!v||!f||f===v.id)return;const b=t.find(z=>z.id===f);if(!b)return;const x=Array.from(new Set(i));if(x.length===0)return;const j=v.layout.filter(z=>x.includes(z.id));if(j.length===0)return;const C=new Set(b.layout.map(z=>z.id)),L=j.filter(z=>!C.has(z.id)),F=v.layout.filter(z=>!x.includes(z.id)),I=[...b.layout,...L];if(await Promise.all([G.saveDashboard({...v,layout:F}),G.saveDashboard({...b,layout:I})]),r(z=>z.map(B=>B.id===v.id?{...B,layout:F}:B.id===b.id?{...B,layout:I}:B)),M(null),L.length<j.length){const z=j.length-L.length;await Ee.info(e("dashboard.tools_move_duplicate_skip","{{count}} widget(s) already existed in the target dashboard and were skipped.",{count:z}))}},ct=async(i=N[0]||"")=>{v&&await oe({...v,filters:[...v.filters||[],{column:i,operator:"=",value:""}]})},Ae=async(i,f)=>{if(!v)return;const b=[...v.filters||[]];if(b[i]={...b[i],...f},await oe({...v,filters:b}),typeof f.column=="string"){const x=f.column.trim();x&&!T[x]&&ie(x)}},ut=async i=>{v&&await oe({...v,filters:(v.filters||[]).filter((f,b)=>b!==i)})},ee=async()=>{v&&await oe({...v,filters:[]})},qe=i=>{if(i.type==="system"){const f=Lt.find(b=>b.id===i.id);return f?e(f.titleKey):i.id}return q?.find(f=>f.id===i.id)?.name||i.id},ve=async i=>{await Ee.confirm(e("dashboard.confirm_delete_report"))&&(await G.deleteUserWidget(i),$e(),be(i))},Ue=async i=>{const f=(i.name||"").trim(),b=(()=>{if(typeof i.visualization_config!="string")return null;try{return JSON.parse(i.visualization_config)}catch{return null}})(),x=(i.description||"").trim()||(b?.widgetDescription||"").trim(),j=await Ee.prompt2(e("dashboard.rename_report_name_label","Name des Berichts"),e("common.description","Description"),{title:e("dashboard.rename_report_title","Bericht umbenennen"),defaultValue:f,secondDefaultValue:x,secondPlaceholder:e("querybuilder.widget_description_placeholder","Kurze Einordnung oder Kontext (optional)")});if(!j)return;const C=j.value.trim(),L=j.secondValue.trim();if(!C||C===f||(q||[]).find(z=>z.id!==i.id&&(z.name||"").trim().toLowerCase()===C.toLowerCase())&&!await Ee.confirm(e("dashboard.rename_report_conflict_confirm",'Ein Bericht mit dem Namen "{{name}}" existiert bereits. Trotzdem umbenennen?',{name:C})))return;const I=(z,B)=>{if(typeof z!="string")return z??B;try{return JSON.parse(z)}catch{return B}};await G.saveUserWidget({id:i.id,name:C,description:L,sql_statement_id:i.sql_statement_id||null,sql_query:i.sql_query||"",visualization_config:I(i.visualization_config,{}),visual_builder_config:I(i.visual_builder_config,null)}),$e()},me=async()=>{const i=await Ee.prompt(e("dashboard.new_dashboard_placeholder","Dashboard name"),{title:e("dashboard.new_dashboard_title","Create new dashboard")});if(i===null)return;const f=i.trim();if(!f)return;const b={id:crypto.randomUUID(),name:f,layout:[],is_default:!1};await G.saveDashboard(b),r(x=>[...x,b]),a(x=>[...x.filter(j=>j!==b.id),b.id]),l(b.id)},Te=async i=>{const f=await Ee.prompt(e("dashboard.rename_dashboard_prompt","Name for dashboard:"),{defaultValue:i.name});if(!f)return;const b=f.trim();!b||b===i.name||await oe({...i,name:b})},ye=async i=>{if($.length<=1)return;const f=$.find(x=>x.id===i);if(!f||f.is_default||!await Ee.confirm(e("dashboard.delete_confirm")))return;await G.deleteDashboard(i);const b=t.filter(x=>x.id!==i);r(b),a(x=>x.filter(j=>j!==i)),o===i&&l(b[0].id)},Ke=(i,f)=>{const b=$.findIndex(C=>C.id===i);if(b<0)return;const x=b+f;if(x<0||x>=$.length)return;const j=Ot($,b,x);a(j.map(C=>C.id))},Ve=V.useCallback(i=>{const f=new Set,b=/\b(?:FROM|JOIN)\s+([a-zA-Z0-9_]+)/gi;let x=null;for(;(x=b.exec(i))!==null;)x[1]&&f.add(x[1]);return Array.from(f)},[]),_e=V.useCallback(i=>/^[A-Za-z_][A-Za-z0-9_]*$/.test(i),[]),ie=V.useCallback(async i=>{const f=i.trim();if(!f||!v||!q||!_e(f))return;const b=new Set(v.layout.map(O=>O.id)),x=q.filter(O=>b.has(O.id));if(x.length===0)return;const j=new Set;x.forEach(O=>{Ve(O.sql_query||"").forEach(te=>j.add(te))});const C=[];for(const O of Array.from(j))if(_e(O))try{(await G.getTableSchema(O)).some(re=>re.name===f)&&C.push(O)}catch(te){zt.error("Failed to inspect table schema for filter suggestions",O,te)}if(C.length===0){P(O=>({...O,[f]:[]}));return}const L=new Set;for(const O of C){const te=O.replace(/"/g,'""'),re=f.replace(/"/g,'""');try{(await G.executeRaw(`SELECT DISTINCT CAST("${re}" AS TEXT) AS value FROM "${te}" WHERE "${re}" IS NOT NULL AND TRIM(CAST("${re}" AS TEXT)) <> '' LIMIT 200`)).forEach(ht=>{const Xe=ht?.value;if(Xe==null)return;const Ye=String(Xe).trim();Ye&&L.add(Ye)})}catch(ke){zt.error("Failed to load filter value suggestions",{table:O,column:f},ke)}}const F=Array.from(L).sort((O,te)=>O.localeCompare(te,void 0,{numeric:!0,sensitivity:"base"})),I=f.toLowerCase(),B=["month","monat","year","jahr","status","type","typ","category","kategorie","quarter","quartal"].some(O=>I.includes(O))||F.length<=20?F:F.slice(0,10);P(O=>({...O,[f]:B}))},[v,q,_e,Ve]);return c.useEffect(()=>{if(!v)return;Array.from(new Set((v.filters||[]).map(f=>(f.column||"").trim()).filter(f=>f.length>0))).forEach(f=>{T[f]||ie(f)})},[v,T,ie]),d?n.jsxs(Kr,{header:{title:e("dashboard.title"),subtitle:e("dashboard.subtitle"),actions:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:K,className:"p-2 text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors border border-transparent hover:border-blue-100 dark:hover:border-blue-800/40",title:e("dashboard.presentation_mode"),children:n.jsx(cn,{className:"w-5 h-5"})}),n.jsxs("button",{onClick:()=>ce("dashboard-grid",`dashboard-${v?.name||"export"}`),disabled:U,className:"flex items-center gap-2 px-3 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors shadow-sm font-medium text-sm disabled:opacity-50",children:[n.jsx(un,{className:"w-4 h-4"}),e(U?"common.exporting":"common.export_pdf")]}),n.jsx("button",{onClick:()=>{k("filters"),S(!0)},className:`p-2 rounded-lg transition-colors border ${p&&y==="filters"?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800 text-blue-600 dark:text-blue-300":"text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 border-transparent hover:border-blue-100 dark:hover:border-blue-800/40"}`,title:e("querybuilder.filter"),children:n.jsx(hn,{className:"w-5 h-5"})}),!A&&n.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-sm font-medium text-sm",children:[n.jsx(bt,{className:"w-4 h-4"}),e("dashboard.add_title")]})]})},rightPanel:{title:e("dashboard.tools_title","Dashboard Tools"),enabled:!!v,triggerTitle:e("dashboard.tools_title","Dashboard Tools"),width:"sm",isOpen:p,onOpenChange:S,content:n.jsxs("div",{className:"h-full min-h-0 flex flex-col gap-4",children:[n.jsxs("div",{className:"inline-flex items-center rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-1 flex-shrink-0",children:[n.jsx("button",{type:"button",onClick:()=>k("dashboards"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${y==="dashboards"?"bg-blue-600 text-white":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:e("dashboard.tools_tab_dashboards","Dashboards")}),n.jsx("button",{type:"button",onClick:()=>k("layout"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${y==="layout"?"bg-blue-600 text-white":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:e("dashboard.tools_tab_layout","Widgets")}),n.jsx("button",{type:"button",onClick:()=>k("filters"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${y==="filters"?"bg-blue-600 text-white":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:e("dashboard.tools_tab_filters","Filters")})]}),v?y==="layout"?n.jsxs("div",{className:"flex-1 min-h-0 flex flex-col gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-500 dark:text-slate-400 whitespace-nowrap",children:e("dashboard.tools_active_dashboard","Dashboard")}),n.jsx("select",{value:o??"",onChange:i=>l(i.target.value),className:"flex-1 h-8 px-2 border border-slate-200 dark:border-slate-700 rounded bg-white dark:bg-slate-900 text-xs text-slate-700 dark:text-slate-200 outline-none",disabled:$.length===0,children:$.map(i=>n.jsx("option",{value:i.id,children:i.name},i.id))}),!A&&n.jsxs("button",{type:"button",onClick:()=>m(!0),className:"h-8 px-2 inline-flex items-center gap-1 rounded border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-[11px] font-semibold whitespace-nowrap",title:e("dashboard.add_title"),children:[n.jsx(bt,{className:"w-3.5 h-3.5"}),e("dashboard.add_title")]})]}),n.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:e("dashboard.tools_layout_hint","Reorder widgets and remove items without leaving the dashboard.")}),n.jsx("div",{className:"flex-1 min-h-0 overflow-auto border border-slate-200 dark:border-slate-700 rounded-lg divide-y divide-slate-100 dark:divide-slate-700",children:v.layout.length===0?n.jsx("div",{className:"p-3 text-xs text-slate-400 dark:text-slate-500",children:e("dashboard.no_reports")}):v.layout.map((i,f)=>{const b=i.type==="custom"?q?.find(x=>x.id===i.id):void 0;return n.jsxs("div",{className:"p-3 flex items-center justify-between gap-2",children:[n.jsx("div",{className:"min-w-0 flex items-center gap-2",children:n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-xs font-semibold text-slate-700 dark:text-slate-200 truncate",children:qe(i)}),n.jsx("div",{className:"text-[10px] text-slate-400 dark:text-slate-500 uppercase",children:i.type})]})}),!A&&n.jsxs("div",{className:"relative flex items-center gap-1",children:[n.jsx("button",{type:"button",onClick:()=>M(x=>x===i.id?null:i.id),disabled:he.length===0,className:"h-7 w-7 inline-flex items-center justify-center rounded border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 text-blue-700 dark:text-blue-300 disabled:opacity-40",title:e("dashboard.tools_move_to_dashboard","Move to dashboard"),children:n.jsx(ln,{className:"w-3.5 h-3.5"})}),We===i.id&&n.jsx("div",{className:"absolute right-0 top-8 z-30 w-56 rounded-md border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 shadow-lg p-1",children:he.length===0?n.jsx("div",{className:"px-2 py-1.5 text-[11px] text-slate-500 dark:text-slate-400",children:e("dashboard.tools_no_target_dashboard","No target dashboard available")}):he.map(x=>n.jsx("button",{type:"button",onClick:()=>{Q([i.id],x.id)},className:"w-full text-left px-2 py-1.5 text-xs rounded text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800",children:x.name},x.id))}),n.jsx("button",{type:"button",onClick:()=>{Be(i.id,-1)},disabled:f===0,className:"h-7 w-7 inline-flex items-center justify-center rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 disabled:opacity-40",title:e("dashboard.tools_move_up","Move up"),children:n.jsx(er,{className:"w-3.5 h-3.5"})}),n.jsx("button",{type:"button",onClick:()=>{Be(i.id,1)},disabled:f===v.layout.length-1,className:"h-7 w-7 inline-flex items-center justify-center rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 disabled:opacity-40",title:e("dashboard.tools_move_down","Move down"),children:n.jsx(tr,{className:"w-3.5 h-3.5"})}),n.jsx("button",{type:"button",onClick:()=>{i.type==="custom"&&b&&Ue(b)},disabled:!(i.type==="custom"&&b),className:"h-7 w-7 inline-flex items-center justify-center rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 disabled:opacity-40",title:i.type==="custom"&&b?e("common.rename","Rename"):e("dashboard.tools_rename_unavailable","System widgets cannot be renamed"),children:n.jsx(Rt,{className:"w-3.5 h-3.5"})}),n.jsx("button",{type:"button",onClick:()=>{be(i.id)},className:"h-7 w-7 inline-flex items-center justify-center rounded border border-rose-200 dark:border-rose-800 bg-rose-50 dark:bg-rose-900/20 hover:bg-rose-100 dark:hover:bg-rose-900/30 text-rose-700 dark:text-rose-300",title:e("common.remove"),children:n.jsx(Oe,{className:"w-3.5 h-3.5"})})]})]},`${i.type}:${i.id}`)})})]}):y==="filters"?n.jsxs("div",{className:"flex-1 min-h-0 flex flex-col gap-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:e("dashboard.tools_filters_hint","Manage global dashboard filters in one place.")}),!A&&n.jsx("button",{type:"button",onClick:()=>{ct()},disabled:N.length===0,className:"h-7 px-2 rounded border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-[11px] font-semibold disabled:opacity-40",children:e("dashboard.add_filter")})]}),N.length===0&&n.jsx("p",{className:"text-[11px] text-slate-400 dark:text-slate-500",children:e("dashboard.tools_filters_no_common_columns","No common filter fields are available across the current widgets.")}),!A&&n.jsx("div",{className:"flex items-center justify-end",children:n.jsx("button",{type:"button",onClick:()=>{ee()},className:"text-[11px] text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200",children:e("dashboard.tools_clear_filters","Clear filters")})}),n.jsx("div",{className:"flex-1 min-h-0 overflow-auto border border-slate-200 dark:border-slate-700 rounded-lg divide-y divide-slate-100 dark:divide-slate-700",children:(v.filters||[]).length===0?n.jsx("div",{className:"p-3 text-xs text-slate-400 dark:text-slate-500",children:e("dashboard.no_filters")}):(v.filters||[]).map((i,f)=>n.jsxs("div",{className:"p-3 space-y-2",children:[n.jsxs("select",{value:i.column,onChange:b=>{Ae(f,{column:b.target.value})},className:"w-full h-8 px-2 border border-slate-200 dark:border-slate-700 rounded bg-white dark:bg-slate-900 text-xs text-slate-700 dark:text-slate-200 outline-none",children:[n.jsx("option",{value:"",children:e("dashboard.filter_column")}),N.map(b=>n.jsx("option",{value:b,children:b},b)),i.column&&!N.includes(i.column)&&n.jsx("option",{value:i.column,children:i.column})]}),n.jsxs("div",{className:"grid grid-cols-[1fr_1fr_auto] gap-2",children:[n.jsxs("select",{value:i.operator,onChange:b=>{Ae(f,{operator:b.target.value})},className:"h-8 px-2 border border-slate-200 dark:border-slate-700 rounded bg-white dark:bg-slate-900 text-xs text-slate-700 dark:text-slate-200 outline-none",children:[n.jsx("option",{value:"=",children:"="}),n.jsx("option",{value:"!=",children:"!="}),n.jsx("option",{value:">",children:">"}),n.jsx("option",{value:"<",children:"<"}),n.jsx("option",{value:"contains",children:e("dashboard.op_contains")}),n.jsx("option",{value:"is null",children:e("dashboard.op_is_null")})]}),n.jsx("input",{list:i.column?`filter-value-suggestions-${f}`:void 0,value:i.value,onChange:b=>{Ae(f,{value:b.target.value})},placeholder:e("dashboard.filter_value"),className:"h-8 px-2 border border-slate-200 dark:border-slate-700 rounded bg-white dark:bg-slate-900 text-xs text-slate-700 dark:text-slate-200 outline-none"}),i.column&&n.jsx("datalist",{id:`filter-value-suggestions-${f}`,children:(T[i.column]||[]).map(b=>n.jsx("option",{value:b},b))}),!A&&n.jsx("button",{type:"button",onClick:()=>{ut(f)},className:"h-8 w-8 inline-flex items-center justify-center rounded border border-rose-200 dark:border-rose-800 bg-rose-50 dark:bg-rose-900/20 hover:bg-rose-100 dark:hover:bg-rose-900/30 text-rose-700 dark:text-rose-300",title:e("common.remove"),children:n.jsx(Oe,{className:"w-3.5 h-3.5"})})]})]},f))})]}):n.jsxs("div",{className:"flex-1 min-h-0 flex flex-col gap-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:e("dashboard.tools_dashboards_hint","Create, rename, and remove dashboards.")}),!A&&n.jsxs("button",{type:"button",onClick:()=>{me()},className:"h-7 px-2 rounded border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-[11px] font-semibold inline-flex items-center gap-1",title:e("dashboard.new_dashboard_title","Create new dashboard"),children:[n.jsx(bt,{className:"w-3.5 h-3.5"}),e("dashboard.new_short","Neu")]})]}),n.jsx("div",{className:"flex-1 min-h-0 overflow-auto border border-slate-200 dark:border-slate-700 rounded-lg divide-y divide-slate-100 dark:divide-slate-700",children:$.map((i,f)=>n.jsxs("div",{className:"p-3 flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-xs font-semibold text-slate-700 dark:text-slate-200 truncate",children:i.name}),n.jsx("div",{className:"text-[10px] text-slate-400 dark:text-slate-500 uppercase",children:i.is_default?e("dashboard.default_badge","Default"):""})]}),!A&&n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{type:"button",onClick:()=>l(i.id),className:`h-7 w-7 inline-flex items-center justify-center rounded border ${o===i.id?"border-blue-300 dark:border-blue-700 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300":"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700"}`,title:e("dashboard.tools_switch_dashboard","Switch dashboard"),children:n.jsx(dn,{className:"w-3.5 h-3.5"})}),n.jsx("button",{type:"button",onClick:()=>Ke(i.id,-1),disabled:f===0,className:"h-7 w-7 inline-flex items-center justify-center rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 disabled:opacity-40",title:e("dashboard.tools_move_up","Move up"),children:n.jsx(er,{className:"w-3.5 h-3.5"})}),n.jsx("button",{type:"button",onClick:()=>Ke(i.id,1),disabled:f===$.length-1,className:"h-7 w-7 inline-flex items-center justify-center rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 disabled:opacity-40",title:e("dashboard.tools_move_down","Move down"),children:n.jsx(tr,{className:"w-3.5 h-3.5"})}),n.jsx("button",{type:"button",onClick:()=>{Te(i)},className:"h-7 w-7 inline-flex items-center justify-center rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300",title:e("common.rename","Rename"),children:n.jsx(Rt,{className:"w-3.5 h-3.5"})}),n.jsx("button",{type:"button",onClick:()=>{ye(i.id)},disabled:$.length<=1||!!i.is_default,className:"h-7 w-7 inline-flex items-center justify-center rounded border border-rose-200 dark:border-rose-800 bg-rose-50 dark:bg-rose-900/20 hover:bg-rose-100 dark:hover:bg-rose-900/30 text-rose-700 dark:text-rose-300 disabled:opacity-30",title:i.is_default?e("dashboard.default_not_deletable","Default dashboard cannot be deleted"):e("common.remove"),children:n.jsx(Oe,{className:"w-3.5 h-3.5"})})]})]},i.id))})]}):n.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:e("common.no_data")})]})},children:[n.jsx("datalist",{id:"suggested-columns",children:N.map(i=>n.jsx("option",{value:i},i))}),n.jsxs("div",{className:"mb-6 flex items-center justify-between border-b border-slate-200 dark:border-slate-800",children:[n.jsxs("div",{className:"flex items-center gap-1 overflow-x-auto no-scrollbar pb-px",children:[$.map(i=>n.jsx("button",{onClick:()=>l(i.id),className:`px-4 py-2.5 text-sm font-bold transition-all border-b-2 whitespace-nowrap ${o===i.id?"text-blue-600 border-blue-600":"text-slate-400 border-transparent hover:text-slate-600"}`,children:i.name},i.id)),!A&&n.jsx("button",{onClick:()=>{me()},className:"px-4 py-2.5 text-slate-400 hover:text-blue-600 transition-all border-b-2 border-transparent",title:e("dashboard.new_dashboard_title"),children:n.jsx(bt,{className:"w-4 h-4"})})]}),!A&&n.jsx("button",{onClick:()=>{k("dashboards"),S(!0)},className:"p-2 text-slate-400 hover:text-slate-600",title:e("dashboard.manage_title"),children:n.jsx(wr,{className:"w-4 h-4"})})]}),v&&v.layout.length===0?n.jsxs("div",{className:"flex flex-col items-center justify-center p-12 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-xl bg-slate-50 dark:bg-slate-900/40 text-slate-400 dark:text-slate-500",children:[n.jsx(an,{className:"w-12 h-12 mb-4 opacity-50"}),n.jsx("h3",{className:"font-bold text-lg text-slate-600 dark:text-slate-200",children:e("dashboard.empty_msg",{name:v.name})}),n.jsx("p",{className:"mb-4 text-sm text-center text-slate-500 dark:text-slate-400",children:e("dashboard.empty_hint")}),!A&&n.jsx("button",{onClick:()=>m(!0),className:"px-6 py-2 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg text-blue-600 dark:text-blue-300 font-bold hover:shadow-sm transition-all text-sm",children:e("dashboard.add_title")})]}):v?n.jsx(Rs,{sensors:ue,collisionDetection:En,onDragEnd:i=>{Me(i)},children:n.jsx("div",{id:"dashboard-grid",className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 auto-rows-[300px]",children:v.layout.map(i=>{if(i.type==="system"){const x=Lt.find(C=>C.id===i.id);if(!x)return null;const j=Hs(x.id);return j?n.jsxs(mr,{id:i.id,className:`relative group h-full ${x.defaultColSpan===2?"md:col-span-2":""}`,children:[!A&&n.jsx("div",{className:"absolute -top-2 -right-2 z-20 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx("button",{onClick:C=>{C.stopPropagation(),be(i.id)},className:"p-1.5 bg-white/95 backdrop-blur-sm border border-slate-200 rounded-full text-slate-400 hover:text-red-500 shadow-sm",title:e("common.remove"),children:n.jsx(Oe,{className:"w-3 h-3"})})}),n.jsx("div",{className:"h-full",children:n.jsx(j,{onRemove:void 0,targetView:Qt.find(C=>C.component===x.id)?.targetView})})]},i.id):null}const f=q?.find(x=>x.id===i.id);if(!f)return null;let b;try{b=JSON.parse(f.visualization_config)}catch{b={type:"table"}}return n.jsxs(mr,{id:i.id,className:"relative group md:col-span-1 xl:col-span-2 h-full",children:[!A&&n.jsx("div",{className:"absolute -top-2 -right-2 z-20 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx("button",{onClick:()=>be(i.id),className:"p-1.5 bg-white/95 backdrop-blur-sm border border-slate-200 rounded-full text-slate-400 hover:text-red-500 shadow-sm",title:"Entfernen",children:n.jsx(Oe,{className:"w-3 h-3"})})}),n.jsx(Yr,{title:f.name,sql:f.sql_query,config:b,globalFilters:v.filters,showInspectorJump:!0,inspectorReturnHash:v?.id?`#/?dashboard=${encodeURIComponent(v.id)}`:"#/"})]},i.id)})})}):null,n.jsxs(Vr,{isOpen:g,onClose:()=>m(!1),title:e("dashboard.add_title"),children:[n.jsxs("div",{className:"flex gap-4 mb-4 border-b border-slate-200 dark:border-slate-700",children:[n.jsx("button",{onClick:()=>w("system"),className:`pb-2 text-sm font-bold ${h==="system"?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300"}`,children:e("dashboard.system_widgets")}),n.jsx("button",{onClick:()=>w("custom"),className:`pb-2 text-sm font-bold ${h==="custom"?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300"}`,children:e("dashboard.custom_widgets")})]}),n.jsxs("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto min-h-[300px]",children:[h==="system"&&n.jsx("div",{className:"grid grid-cols-1 gap-2",children:Lt.map(i=>{const f=v?.layout.some(C=>C.id===i.id),b=Qt.find(C=>C.component===i.id),x=!!b?.targetView,j=x&&D.includes(b.id);return n.jsxs("div",{className:"flex items-center justify-between p-3 border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800/60",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-2 bg-slate-100 dark:bg-slate-800 rounded-lg text-slate-500 dark:text-slate-300",children:n.jsx(i.icon,{className:"w-5 h-5"})}),n.jsxs("div",{children:[n.jsx("div",{className:"font-bold text-slate-700 dark:text-slate-100",children:e(i.titleKey)}),n.jsx("div",{className:"text-xs text-slate-400 dark:text-slate-500",children:e(i.descriptionKey)})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[x&&n.jsx("button",{onClick:C=>{C.stopPropagation(),R(j?D.filter(L=>L!==b.id):[...D,b.id])},title:e(j?"dashboard.unpin_sidebar":"dashboard.pin_sidebar"),className:`p-1.5 rounded-md border transition-all ${j?"bg-amber-50 dark:bg-amber-900/30 border-amber-200 dark:border-amber-700 text-amber-500 dark:text-amber-300":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-300 dark:text-slate-500 hover:text-amber-400 dark:hover:text-amber-300"}`,children:n.jsx(on,{className:`w-4 h-4 ${j?"fill-current":""}`})}),n.jsx("button",{onClick:()=>ge(i.id,"system"),disabled:f,className:`px-3 py-1.5 text-xs font-bold rounded ${f?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 hover:bg-blue-200 dark:hover:bg-blue-900/50"}`,children:e(f?"dashboard.active":"common.add")})]})]},i.id)})}),h==="custom"&&n.jsx("div",{className:"grid grid-cols-1 gap-2",children:q&&q.length>0?q.map(i=>{const f=v?.layout.some(x=>x.id===i.id),b=(()=>{const x=(typeof i.description=="string"?i.description:"").trim();if(x)return x;if(typeof i.visualization_config!="string")return"";try{return(JSON.parse(i.visualization_config).widgetDescription||"").trim()}catch{return""}})();return n.jsxs("div",{className:"flex items-center justify-between p-3 border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800/60",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/30 rounded-lg text-blue-500 dark:text-blue-300",children:n.jsx(Qe,{className:"w-5 h-5"})}),n.jsxs("div",{children:[n.jsx("div",{className:"font-bold text-slate-700 dark:text-slate-100",children:i.name}),n.jsx("div",{className:"text-xs text-slate-400 dark:text-slate-500 truncate max-w-[260px]",title:b||i.sql_query,children:b||i.sql_query})]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>{Ue(i)},className:"p-2 text-slate-400 dark:text-slate-500 hover:text-blue-500 dark:hover:text-blue-300",title:e("common.rename"),children:n.jsx(Rt,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>ve(i.id),className:"p-2 text-slate-400 dark:text-slate-500 hover:text-red-500 dark:hover:text-red-300",title:e("common.delete"),children:n.jsx(Oe,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>ge(i.id,"custom"),disabled:f,className:`px-3 py-1.5 text-xs font-bold rounded ${f?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 hover:bg-blue-200 dark:hover:bg-blue-900/50"}`,children:e(f?"dashboard.active":"common.add")})]})]},i.id)}):n.jsx("p",{className:"text-center text-slate-400 dark:text-slate-500 py-4",children:e("dashboard.no_reports")})})]})]})]}):null};export{ua as CustomDashboardView};
