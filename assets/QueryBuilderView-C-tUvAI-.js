import{u as er,a as tr,d as rr,e as xt,S as ue,j as e,P as ar,M as lr,b as Ce,c as sr}from"./index-QehNXi8v.js";import{r as d}from"./vendor-react-D64xOC9_.js";import{u as ir,f as y,M as nr,P as dr}from"./MarkdownContent-7007vf0M.js";import{D as bt}from"./DataTable-Dz-ruP56.js";import{R as or}from"./RecordDetailModal-BxgmvPoP.js";import{ad as w,ae as Ae,af as Ge,m as xe,ag as be,ah as He,ai as pt,aj as pe,$ as Te,g as Ze,ak as mt,u as cr,X as me,o as ur,al as ht,P as gt,t as xr,a0 as br}from"./vendor-icons-Du2dXQHa.js";import{R as pr,B as mr,C as he,X as ge,Y as fe,T as H,L as Z,a as ft,b as ke,c as hr,d as kt,A as gr,e as fr,P as kr,f as yr,g as vr,h as jr,i as _r,j as wr,k as Nr,l as qr,m as Sr,S as Cr,n as Ar}from"./vendor-charts-BtQqxQq4.js";import"./vendor-pdf-FXkUb51H.js";import"./vendor-ui-BNe0Xlio.js";import"./vendor-canvas-DXEQVQnt.js";import"./SchemaDocumentation-DaFppMNg.js";const yt="",g=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d"],Tr=sr("QueryBuilderView"),re=r=>r.replace(/\s+/g," ").trim().toLowerCase(),Lr=384,Vr=()=>{const{t:r}=er(),[S,L]=d.useState(yt),[o,$]=d.useState([]),[Le,z]=d.useState(""),[X,Xe]=d.useState(!1),[vt,W]=d.useState(""),[jt,_t]=d.useState(0),[ae,le]=d.useState("graphic"),[ye,ze]=d.useState(""),[We,Me]=d.useState("sql"),[wt,k]=d.useState("source"),[v,se]=d.useState("none"),[ve,Nt]=d.useState(!1),[h,C]=d.useState(1),[Ye,ie]=tr("query_builder_config",void 0),[c,A]=d.useState("table"),[a,n]=d.useState({type:"table",color:"#3b82f6"}),[j,K]=d.useState(null),[qt,je]=d.useState(!1),[T,B]=d.useState(""),[$e,St]=d.useState(""),[Be,Ct]=d.useState(""),[ne,R]=d.useState(""),[At,Je]=d.useState(!1),[Tt,Ie]=d.useState(!1),[Lt,et]=d.useState(0),[zt,Wt]=d.useState(null),{isExporting:Ke,exportToPdf:Mt}=ir(),{togglePresentationMode:$t,isReadOnly:de}=rr(),{data:_e,refresh:tt}=xt(async()=>await ue.getUserWidgets(),[]),{data:I}=xt(async()=>await ue.listSqlStatements("global"),[]);d.useEffect(()=>{Wt(null)},[]),d.useEffect(()=>{Je(!1)},[a.imageUrl]);const U=d.useCallback(async t=>{Xe(!0),z("");try{const l=t||S,s=await ue.executeRaw(l);if($(s),W(l),s.length>0){const i=Object.keys(s[0]).filter(f=>typeof s[0][f]=="number"),b=Object.keys(s[0]).filter(f=>typeof s[0][f]=="string");a.xAxis||n(f=>({...f,xAxis:b[0]||Object.keys(s[0])[0],yAxes:f.yAxes?.length?f.yAxes:i.length>0?[i[0]]:[]}))}return!0}catch(l){return z(l instanceof Error?l.message:String(l)),!1}finally{Xe(!1)}},[S,a.xAxis]),Bt=(t,l=!0)=>{let s={type:"table",color:"#3b82f6"},i="table",b="sql",f;const m=t.sql_statement_id?(I||[]).find(u=>u.id===t.sql_statement_id):void 0,_=(m?.sql_text||t.sql_query||"").trim()||yt;K(t.id),B(t.name),L(_);const ee=(I||[]).find(u=>re(u.sql_text)===re(_));R(m?.id||ee?.id||""),W(""),$([]),z(""),le("graphic"),ie(void 0),Me("sql"),A("table"),n({type:"table",color:"#3b82f6"});try{const u=JSON.parse(t.visualization_config),te=u.type==="kpu_manual"?"kpi_manual":u.type;s={...u,type:te||"table",kpiTitle:u.kpiTitle??u.kpuTitle??"",kpiValue:u.kpiValue??u.kpuValue??"",kpiUnit:u.kpiUnit??u.kpuUnit??"",kpiTarget:u.kpiTarget??u.kpuTarget??"",kpiTrend:u.kpiTrend??u.kpuTrend??"flat",kpiAlign:u.kpiAlign??u.kpuAlign??"left",kpiNote:u.kpiNote??u.kpuNote??""},i=te||"table",A(i),n(s),b="sql",t.visual_builder_config?f=JSON.parse(t.visual_builder_config):f=void 0,Me(b),ie(void 0)}catch(u){Tr.error("Error parsing widget config",u)}l&&k("source"),i==="text"||i==="markdown"||i==="status"||i==="section"||i==="kpi_manual"||i==="image"?(L(""),W(""),Me("sql"),ie(void 0),l&&(C(3),k("visual"))):(L(_),setTimeout(()=>U(_),100),l&&(C(3),k("visual"))),ze(qe({currentSql:i==="text"||i==="markdown"||i==="status"||i==="section"||i==="kpi_manual"||i==="image"?"":_,currentBuilderMode:b,currentQueryConfig:i==="text"||i==="markdown"||i==="status"||i==="section"||i==="kpi_manual"||i==="image"?void 0:f,currentVisType:i,currentVisConfig:s,currentWidgetName:t.name,currentActiveWidgetId:t.id}))},It=async(t="update")=>{if(!T||de)return;const l=t==="new";let s=l?crypto.randomUUID():j||crypto.randomUUID();const i=T.trim(),b=i.toLowerCase(),f=(_e||[]).find(m=>m.id!==s&&m.name.trim().toLowerCase()===b);if(f){if(!await Ce.confirm(r("querybuilder.confirm_overwrite_widget_name",{name:i,defaultValue:`Ein Widget mit dem Namen "${i}" existiert bereits. Ueberschreiben?`})))return;s=f.id}try{const m=(I||[]).find(te=>te.id===ne),_=x?"":S.trim(),ee=!x&&m&&re(m.sql_text)===re(_)?m.id:null,u={id:s,name:i,description:"",sql_statement_id:ee,sql_query:_,visualization_config:{...a,type:c},visual_builder_config:null};await ue.saveUserWidget(u),je(!1),tt(),K(u.id),ze(qe({currentSql:u.sql_query,currentBuilderMode:We,currentQueryConfig:void 0,currentVisType:c,currentVisConfig:{...a,type:c},currentWidgetName:u.name,currentActiveWidgetId:u.id})),C(1),k("source"),se("widget"),le("graphic")}catch(m){await Ce.error(r("querybuilder.error_save")+(m instanceof Error?m.message:String(m)));return}await Ce.info(r(l?"querybuilder.success_save":"querybuilder.success_update"))},Kt=async t=>{if(de)return;(!(localStorage.getItem("notifications_confirm_destructive")!=="false")||await Ce.confirm(r("dashboard.confirm_delete_report")))&&(await ue.deleteUserWidget(t),tt(),j===t&&(K(null),B("")))},rt=d.useMemo(()=>o.length===0?[]:Object.keys(o[0]).map(t=>({header:t,accessor:t,render:l=>y(l[t],t)})),[o]),Re=d.useMemo(()=>{const t=_e||[],l=$e.trim().toLowerCase();return l?t.filter(s=>s.name.toLowerCase().includes(l)||(s.sql_query||"").toLowerCase().includes(l)):t},[_e,$e]),Ue=d.useMemo(()=>{const t=I||[],l=Be.trim().toLowerCase();return l?t.filter(s=>s.name.toLowerCase().includes(l)||s.sql_text.toLowerCase().includes(l)||(s.description||"").toLowerCase().includes(l)):t},[I,Be]),Oe=d.useMemo(()=>(I||[]).find(t=>t.id===ne),[I,ne]),N=d.useMemo(()=>!!(Oe&&re(Oe.sql_text)===re(S)),[Oe,S]),O=d.useMemo(()=>o.length>0?Object.keys(o[0]):[],[o]),q=d.useMemo(()=>o.length===0?[]:O.filter(t=>o.some(l=>l[t]!==null&&l[t]!==void 0&&typeof l[t]=="number")),[o,O]),we=c==="text",D=c==="markdown",V=c==="status",P=c==="section",E=c==="kpi_manual",F=c==="image",x=we||D||V||P||E||F,Q=a.xAxis||"",G=(a.yAxes||[])[0]||"",De=d.useMemo(()=>c!=="scatter"||!Q||!G?[]:o.map(t=>{const l=Number(t[Q]),s=Number(t[G]);return{...t,[Q]:l,[G]:s}}).filter(t=>Number.isFinite(t[Q])&&Number.isFinite(t[G])),[o,Q,G,c]),p=h===2&&!x?"table":c,Ve=!x&&S.trim().length>0,at=p!=="table"&&p!=="pivot"&&p!=="text"&&p!=="markdown"&&p!=="status"&&p!=="section"&&p!=="kpi_manual"&&p!=="image",lt=x||o.length>0,st=Ke||!x&&o.length===0,Y=!lt||de||!x&&!N,Pe=de?r("common.read_only"):lt?!x&&!N?r("querybuilder.hint_select_sql_statement_before_save","Bitte ein SQL-Statement aus dem SQL-Manager auswaehlen."):"":r("querybuilder.hint_run_query_before_save"),Rt=Ke?r("common.exporting"):!x&&o.length===0?r("querybuilder.hint_run_query_before_export"):"",Ut=v==="none"?!0:v==="query"?N:!!j,Ne=x||N,oe=x||o.length>0&&!Le&&vt.trim()===S.trim(),M=d.useMemo(()=>{if(!N)return x?D?!!(a.markdownContent||"").trim():V?!!((a.statusTitle||"").trim()||(a.statusMessage||"").trim()):P?!!((a.sectionTitle||"").trim()||(a.sectionSubtitle||"").trim()):E?!!((a.kpiTitle||"").trim()||(a.kpiValue||"").trim()):F?!!(a.imageUrl||"").trim():!!(a.textContent||"").trim():!1;if(we)return!!(a.textContent||"").trim();if(D)return!!(a.markdownContent||"").trim();if(V)return!!((a.statusTitle||"").trim()||(a.statusMessage||"").trim());if(P)return!!((a.sectionTitle||"").trim()||(a.sectionSubtitle||"").trim());if(E)return!!((a.kpiTitle||"").trim()||(a.kpiValue||"").trim());if(F)return!!(a.imageUrl||"").trim();if(c==="table"||c==="pivot")return!0;const t=!!a.xAxis,l=!!(a.yAxes&&a.yAxes.length>0);if(!t||!l)return!1;if(c==="scatter"){const i=q.includes(Q),b=q.includes(G);return i&&b&&De.length>0}return c==="kpi"?o.length>0:o.some(i=>{const b=i[a.xAxis];return b==null||b===""?!1:(a.yAxes||[]).some(f=>{const m=i[f];return m!=null&&m!==""})})},[x,F,E,D,P,V,we,c,a,q,De.length,Q,G,o,N]),Ee=!x&&o.length>0&&p!=="table"&&p!=="pivot"&&!M,J=v==="none"?x&&M?4:3:v==="query"?N?oe?M?4:3:2:1:j?x||oe?M?4:3:2:1,Ot=t=>x&&t===2?!1:t<=J,it=X||(h===1?!Ut:h===2?x?!1:!Ne||!oe:h===3?!M:Y),Dt=h>=4?r("querybuilder.finish"):r("querybuilder.next"),Vt=h===2&&!x,Pt=X||(h===2?x||!Ne:h!==3),Et=r(X?"common.loading":"querybuilder.step_run"),nt=h===1?v==="query"&&!N?r("querybuilder.hint_select_sql_statement_for_widget","Bitte zuerst ein SQL-Statement im SQL-Manager auswaehlen."):v==="widget"&&!j?r("querybuilder.mode_open_select","Waehle ein bestehendes Widget aus der Liste."):"":h===2?N?oe?"":r("querybuilder.hint_run_query_before_continue","Bitte die Abfrage zuerst ausfuehren."):r("querybuilder.hint_select_sql_statement_for_widget","Bitte zuerst ein SQL-Statement im SQL-Manager auswaehlen."):h===3&&!M?r("querybuilder.hint_configure_visualization_before_continue","Bitte Visualisierung konfigurieren, um fortzufahren."):h===4&&Y?Pe:"",ce=wt,dt=J>=3,ot=J>=4,qe=d.useCallback(t=>JSON.stringify({sql:(t?.currentSql??S).trim(),builderMode:t?.currentBuilderMode??We,queryConfig:t?.currentQueryConfig??Ye??null,visType:t?.currentVisType??c,visConfig:t?.currentVisConfig??a,widgetName:(t?.currentWidgetName??T).trim(),activeWidgetId:t?.currentActiveWidgetId??j}),[S,We,Ye,c,a,T,j]),Fe=d.useMemo(()=>qe(),[qe]),ct=ye.length>0&&Fe!==ye,Ft=j?r("querybuilder.mode_widget_edit","Widget aendern"):v==="none"?r("querybuilder.mode_new_text_without_data","Neues Widget erstellen (Text - Ohne Daten)"):r("querybuilder.mode_new_query_widget","Neues Widget erstellen (Abfrage)"),Qt=d.useCallback(t=>{R(t.id),ie(void 0),L(t.sql_text),W(""),$([]),z("")},[ie]),Qe=d.useMemo(()=>{const t="w-5 h-5";switch(p){case"table":return{icon:e.jsx(Te,{className:t}),label:r("querybuilder.table")};case"bar":return{icon:e.jsx(pe,{className:t}),label:r("querybuilder.bar")};case"line":return{icon:e.jsx(pt,{className:t}),label:r("querybuilder.line")};case"text":return{icon:e.jsx(He,{className:t}),label:r("querybuilder.text")};case"markdown":return{icon:e.jsx(be,{className:t}),label:r("querybuilder.markdown","Markdown")};case"status":return{icon:e.jsx(xe,{className:t}),label:r("querybuilder.status","Status")};case"section":return{icon:e.jsx(w,{className:t}),label:r("querybuilder.section","Section")};case"kpi_manual":return{icon:e.jsx(Ge,{className:t}),label:r("querybuilder.kpi_manual","KPI Manual")};case"image":return{icon:e.jsx(Ae,{className:t}),label:r("querybuilder.image","Image")};default:return{icon:e.jsx(w,{className:t}),label:p.toUpperCase()}}},[p,r]),Gt=j?T.trim()||r("querybuilder.new_report"):r("querybuilder.preview_new_widget_title","Neues Widget ..."),Se=t=>{Ot(t)&&(C(t),t<=2&&k("source"),t===3&&k("visual"),t===4&&k("widget"))},Ht=async()=>{if(h===1){if(v==="none"){A("table"),R(""),L(""),W(""),$([]),z(""),C(3),k("visual");return}if(v==="query"){if(!N||(A("table"),!await U()))return;C(3),k("visual");return}if(!j)return;if(x){C(3),k("visual");return}if(!await U())return;C(3),k("visual");return}if(h===2){if(x){Se(3);return}if(!Ne||!oe)return;Se(3);return}if(h===3){if(!M)return;Se(4);return}h===4&&!Y&&je(!0)},Zt=async()=>{if(h===2){if(x||!Ne||X)return;await U();return}h===3&&_t(t=>t+1)};return d.useEffect(()=>{ye||ze(Fe)},[ye,Fe]),d.useEffect(()=>{const t=l=>{ct&&(l.preventDefault(),l.returnValue="")};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[ct]),d.useEffect(()=>{C(t=>t>J?J:t)},[J]),d.useEffect(()=>{if(c!=="scatter"||q.length===0)return;const t=a.xAxis||"",l=(a.yAxes||[])[0]||"",s=q.includes(t),i=q.includes(l);if(s&&i)return;const b=s?t:q[0],f=q[1]||q[0],m=i?l:f;n(_=>({..._,xAxis:b,yAxes:m?[m]:[]}))},[c,q,a.xAxis,a.yAxes]),d.useEffect(()=>{const t=l=>{if(!(l.ctrlKey||l.metaKey))return;const i=l.key.toLowerCase();i==="enter"&&(l.preventDefault(),X||U()),i==="s"&&(l.preventDefault(),Y||je(!0))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[X,Y,U]),e.jsxs(ar,{header:{title:r("sidebar.query_builder"),subtitle:r("querybuilder.subtitle"),actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:$t,className:"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors border border-transparent hover:border-blue-100",title:r("dashboard.presentation_mode"),children:e.jsx(ht,{className:"w-5 h-5"})}),e.jsxs("button",{onClick:()=>Mt("query-visualization",`report-${T||"query"}`),disabled:st,title:st?Rt:r("querybuilder.hint_export_shortcut"),className:"flex items-center gap-2 px-3 py-2 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors shadow-sm font-medium text-sm disabled:opacity-50",children:[e.jsx(br,{className:"w-4 h-4"}),r(Ke?"common.exporting":"common.export_pdf")]})]})},children:[e.jsx("div",{className:"flex flex-col gap-6 h-full min-h-0",children:e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-4 lg:gap-6 min-h-0 overflow-hidden relative",children:[e.jsx("div",{className:`${ve?"hidden":"w-full lg:w-96"} min-h-0 overflow-hidden transition-all duration-300`,children:e.jsxs("div",{className:"flex flex-col h-full max-h-[46vh] lg:max-h-none bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"border-b border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-900/50",children:e.jsx("div",{className:"p-3",children:e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-wider px-1",children:r("querybuilder.guided_panel")})})}),e.jsx("div",{className:"px-3 py-2 border-b border-slate-100 dark:border-slate-800 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsxs("button",{type:"button",onClick:()=>{k("source"),C(1)},className:`px-2 py-1.5 rounded text-[10px] font-bold border transition-colors flex items-center justify-center gap-1 ${ce==="source"?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700":"bg-white dark:bg-slate-900 text-slate-500 dark:text-slate-300 border-slate-200 dark:border-slate-700"}`,children:[e.jsx(Ze,{className:"w-3 h-3"}),r("querybuilder.tab_source","Quelle")]}),e.jsxs("button",{type:"button",onClick:()=>dt&&k("visual"),disabled:!dt,className:`px-2 py-1.5 rounded text-[10px] font-bold border transition-colors flex items-center justify-center gap-1 ${ce==="visual"?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700":"bg-white dark:bg-slate-900 text-slate-500 dark:text-slate-300 border-slate-200 dark:border-slate-700"} disabled:opacity-40`,children:[e.jsx(pe,{className:"w-3 h-3"}),r("querybuilder.tab_visualization","Visualisierung")]}),e.jsxs("button",{type:"button",onClick:()=>ot&&k("widget"),disabled:!ot,className:`px-2 py-1.5 rounded text-[10px] font-bold border transition-colors flex items-center justify-center gap-1 ${ce==="widget"?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700":"bg-white dark:bg-slate-900 text-slate-500 dark:text-slate-300 border-slate-200 dark:border-slate-700"} disabled:opacity-40`,children:[e.jsx(mt,{className:"w-3 h-3"}),r("querybuilder.tab_widget","Widget")]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar space-y-4",children:ce==="source"?e.jsxs("div",{className:"space-y-4",children:[h===1&&e.jsxs("div",{className:"rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950/30 overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 border-b border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/40",children:e.jsxs("div",{className:"inline-flex items-center rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-1",children:[e.jsx("button",{type:"button",onClick:()=>{se("none"),K(null),B(""),R(""),L(""),W(""),$([]),z(""),A("table")},className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${v==="none"?"bg-blue-600 text-white":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:r("querybuilder.source_tab_none","Kein")}),e.jsx("button",{type:"button",onClick:()=>{se("query"),K(null),B(""),R(""),L(""),W(""),$([]),z(""),A("table")},className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${v==="query"?"bg-blue-600 text-white":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:r("querybuilder.source_tab_query","Abfrage auswaehlen")}),e.jsx("button",{type:"button",onClick:()=>{se("widget")},className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${v==="widget"?"bg-blue-600 text-white":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:r("querybuilder.source_tab_widget","Widget auswaehlen")})]})}),e.jsx("div",{className:"p-3",children:v==="none"?e.jsx("div",{className:"p-3 rounded-lg border border-dashed border-slate-200 dark:border-slate-700 text-[11px] text-slate-500 dark:text-slate-300",children:r("querybuilder.source_tab_none_hint","Ohne Datenabfrage oder Widget mit Weiter zum naechsten Schritt gehen.")}):v==="query"?e.jsxs("div",{className:"space-y-2 animate-in fade-in duration-300",children:[e.jsxs("h3",{className:"text-[10px] font-black uppercase text-slate-400 px-2 py-1 flex items-center justify-between",children:[r("querybuilder.sql_manager_source","SQL Manager Source"),e.jsxs("span",{className:"bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded text-[9px]",children:[Ue.length,"/",I?.length||0]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-400"}),e.jsx("input",{value:Be,onChange:t=>Ct(t.target.value),placeholder:r("querybuilder.search_sql_statements","Search SQL statements..."),className:"w-full pl-8 pr-3 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-xs text-slate-700 dark:text-slate-200 outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"space-y-1 max-h-72 overflow-y-auto custom-scrollbar pr-1",children:[Ue.map(t=>e.jsxs("button",{type:"button",onClick:()=>{if(ne===t.id){R(""),L(""),W(""),$([]),z(""),A("table");return}se("query"),K(null),B(""),Qt(t),A("table"),U(t.sql_text)},className:`w-full text-left p-2.5 rounded-lg border transition-all ${ne===t.id?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700":"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800 hover:border-blue-200 dark:hover:border-blue-700"}`,children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 dark:text-slate-200 truncate",children:t.name}),e.jsx("div",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-mono truncate",children:t.sql_text})]},t.id)),Ue.length===0&&e.jsx("div",{className:"p-3 rounded-lg border border-dashed border-slate-200 dark:border-slate-700 text-[11px] text-slate-400 text-center",children:r("querybuilder.no_sql_statements","No SQL statements found.")})]}),e.jsx("p",{className:"text-[10px] text-slate-500 px-1",children:r("querybuilder.new_without_query_hint","Ohne Auswahl und mit Klick auf Weiter wird ein neues Text-Widget ohne Datenabfrage erstellt.")})]}):e.jsxs("div",{className:"space-y-2 animate-in fade-in duration-300",children:[e.jsxs("h3",{className:"text-[10px] font-black uppercase text-slate-400 px-2 py-1 flex items-center justify-between",children:[r("querybuilder.saved_reports"),e.jsxs("span",{className:"bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded text-[9px]",children:[Re.length,"/",_e?.length||0]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-400"}),e.jsx("input",{value:$e,onChange:t=>St(t.target.value),placeholder:r("querybuilder.search_saved_reports","Search saved widgets..."),className:"w-full pl-8 pr-3 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-xs text-slate-700 dark:text-slate-200 outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"space-y-1 max-h-72 overflow-y-auto custom-scrollbar pr-1",children:[Re.map(t=>e.jsxs("div",{className:`group p-2.5 rounded-lg border flex flex-col gap-1 transition-all cursor-pointer ${j===t.id?"bg-blue-50 border-blue-200 ring-1 ring-blue-100":"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800 hover:border-blue-200"}`,onClick:()=>{if(j===t.id){K(null),B(""),R(""),L(""),W(""),$([]),z(""),A("table"),k("source"),C(1);return}Bt(t,!1)},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-200 text-xs truncate",children:t.name}),!de&&e.jsx("button",{onClick:l=>{l.stopPropagation(),Kt(t.id)},className:"opacity-0 group-hover:opacity-100 p-1 text-slate-400 hover:text-red-500 rounded transition-all",children:e.jsx(cr,{className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[9px]",children:[e.jsx("span",{className:"text-slate-400 truncate max-w-[150px] font-mono",children:t.sql_query||"-"}),e.jsx("span",{className:"ml-auto text-blue-400 flex items-center gap-1 font-bold italic",children:(()=>{try{return(JSON.parse(t.visualization_config).type||"table").toUpperCase()}catch{return"TABLE"}})()})]})]},t.id)),Re.length===0&&e.jsx("div",{className:"p-3 rounded-lg border border-dashed border-slate-200 text-[11px] text-slate-400 text-center",children:r("querybuilder.no_saved_reports_filtered","No matching widgets found.")})]})]})})]}),h===1?null:e.jsx("div",{className:"space-y-0",children:e.jsxs("div",{className:"rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950/30 overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2 border-b border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/40 flex items-center justify-between",children:[e.jsxs("div",{className:"text-[10px] font-bold uppercase tracking-wide text-slate-600 dark:text-slate-300",children:[e.jsx("span",{className:"font-mono",children:"SQL"})," ",r("querybuilder.direct_editor")]}),e.jsx("span",{className:"text-[10px] text-slate-500",children:r("common.read_only")})]}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400",children:r("querybuilder.sql_query")}),!x&&e.jsx("span",{className:"text-[10px] text-slate-500",children:r("querybuilder.widget_studio_sql_locked_hint","SQL-Auswahl erfolgt im Startschritt unter Neu.")})]}),e.jsx("textarea",{value:S,readOnly:!0,className:"w-full font-mono text-xs p-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-100 rounded-lg outline-none resize-none cursor-default",style:{height:`${Lr}px`},placeholder:"SELECT * FROM..."})]})]})}),Le&&e.jsxs("div",{className:"bg-red-50 text-red-600 text-[10px] p-3 rounded-lg border border-red-100 flex items-start gap-2 font-mono break-all",children:[e.jsx(xe,{className:"w-3.5 h-3.5 flex-shrink-0 mt-0.5"}),Le]})]}):ce==="visual"?e.jsxs("div",{className:"p-4 rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950/30 space-y-4 animate-in slide-in-from-right-4 duration-300",children:[e.jsxs("h3",{className:"text-xs font-black uppercase text-slate-400 flex items-center gap-2",children:[e.jsx(w,{className:"w-3.5 h-3.5 text-blue-500"}),r("querybuilder.graph_type")]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:(N?[{id:"table",icon:Te,label:r("querybuilder.table")},{id:"bar",icon:pe,label:r("querybuilder.bar")},{id:"line",icon:pt,label:r("querybuilder.line")},{id:"area",icon:w,label:r("querybuilder.area")},{id:"pie",icon:w,label:r("querybuilder.pie")},{id:"kpi",icon:w,label:r("querybuilder.kpi")},{id:"composed",icon:w,label:r("querybuilder.composed")},{id:"radar",icon:w,label:r("querybuilder.radar")},{id:"scatter",icon:w,label:r("querybuilder.scatter")},{id:"pivot",icon:w,label:r("querybuilder.pivot")},{id:"text",icon:He,label:r("querybuilder.text")},{id:"markdown",icon:be,label:r("querybuilder.markdown","Markdown")},{id:"status",icon:xe,label:r("querybuilder.status","Status")},{id:"section",icon:w,label:r("querybuilder.section","Section")},{id:"kpi_manual",icon:Ge,label:r("querybuilder.kpi_manual","KPI Manual")},{id:"image",icon:Ae,label:r("querybuilder.image","Image")}]:[{id:"text",icon:He,label:r("querybuilder.text")},{id:"markdown",icon:be,label:r("querybuilder.markdown","Markdown")},{id:"status",icon:xe,label:r("querybuilder.status","Status")},{id:"section",icon:w,label:r("querybuilder.section","Section")},{id:"kpi_manual",icon:Ge,label:r("querybuilder.kpi_manual","KPI Manual")},{id:"image",icon:Ae,label:r("querybuilder.image","Image")}]).map(t=>e.jsxs("button",{onClick:()=>A(t.id),className:`p-2 rounded-lg flex flex-col items-center justify-center gap-1 border transition-all ${c===t.id?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 text-blue-600 shadow-sm":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-400 hover:border-slate-300"}`,children:[e.jsx(t.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-[9px] uppercase font-black",children:t.label})]},t.id))}),!N&&e.jsx("p",{className:"text-[10px] text-slate-500",children:r("querybuilder.visual_text_only_hint","Ohne ausgewaehlte Abfrage sind nur Text-, Markdown-, Status-, Section-, KPI-Manual- oder Image-Widgets verfuegbar.")}),c!=="table"&&c!=="pivot"&&c!=="text"&&c!=="markdown"&&c!=="status"&&c!=="section"&&c!=="kpi_manual"&&c!=="image"&&e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-slate-200 bg-slate-50 px-3 py-2",children:[e.jsxs("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:[r("querybuilder.labels"),":"]}),e.jsx("button",{onClick:()=>n({...a,showLabels:!a.showLabels}),className:`px-2 py-0.5 rounded text-[10px] font-black uppercase transition-all ${a.showLabels?"bg-blue-600 text-white":"bg-slate-200 text-slate-500"}`,children:a.showLabels?r("querybuilder.label_on"):r("querybuilder.label_off")})]}),at&&o.length>0&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.x_axis")}),e.jsxs("select",{value:a.xAxis||"",onChange:t=>n({...a,xAxis:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"",children:r("querybuilder.select_column")}),(c==="scatter"?q:O).map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.y_axes")}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:(a.yAxes||[]).map(t=>e.jsxs("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px] font-bold flex items-center gap-1",children:[t,e.jsx("button",{onClick:()=>n({...a,yAxes:(a.yAxes||[]).filter(l=>l!==t)}),children:e.jsx(me,{className:"w-2.5 h-2.5"})})]},t))}),e.jsxs("select",{onChange:t=>{t.target.value&&(n({...a,yAxes:[...a.yAxes||[],t.target.value]}),t.target.value="")},className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"",children:r("querybuilder.add_y_axis")}),(c==="scatter"?q:O).filter(t=>!(a.yAxes||[]).includes(t)).map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),c==="text"&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.text_content")}),e.jsx("textarea",{value:a.textContent||"",onChange:t=>n({...a,textContent:t.target.value}),className:"w-full h-32 p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none resize-y",placeholder:r("querybuilder.text_placeholder")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.text_size")}),e.jsxs("select",{value:a.textSize||"md",onChange:t=>n({...a,textSize:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"sm",children:r("querybuilder.text_size_sm")}),e.jsx("option",{value:"md",children:r("querybuilder.text_size_md")}),e.jsx("option",{value:"lg",children:r("querybuilder.text_size_lg")}),e.jsx("option",{value:"xl",children:r("querybuilder.text_size_xl")}),e.jsx("option",{value:"2xl",children:r("querybuilder.text_size_2xl")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.text_align")}),e.jsxs("select",{value:a.textAlign||"left",onChange:t=>n({...a,textAlign:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"left",children:r("querybuilder.text_align_left")}),e.jsx("option",{value:"center",children:r("querybuilder.text_align_center")}),e.jsx("option",{value:"right",children:r("querybuilder.text_align_right")})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.text_style")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n({...a,textBold:!a.textBold}),className:`px-2 py-1 rounded border text-[11px] font-bold ${a.textBold?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700 text-blue-700 dark:text-blue-200":"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-300"}`,children:r("querybuilder.text_bold")}),e.jsx("button",{onClick:()=>n({...a,textItalic:!a.textItalic}),className:`px-2 py-1 rounded border text-[11px] italic ${a.textItalic?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700 text-blue-700 dark:text-blue-200":"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-300"}`,children:r("querybuilder.text_italic")}),e.jsx("button",{onClick:()=>n({...a,textUnderline:!a.textUnderline}),className:`px-2 py-1 rounded border text-[11px] underline ${a.textUnderline?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700 text-blue-700 dark:text-blue-200":"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-300"}`,children:r("querybuilder.text_underline")})]})]})]}),c==="markdown"&&e.jsx("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.markdown_content","Markdown Inhalt")}),e.jsx("textarea",{value:a.markdownContent||"",onChange:t=>n({...a,markdownContent:t.target.value}),className:"w-full h-36 p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none resize-y font-mono",placeholder:r("querybuilder.markdown_placeholder",`# Titel
Text mit **Fett** und [Link](https://example.com)`)}),e.jsx("p",{className:"mt-1 text-[10px] text-slate-500",children:r("querybuilder.markdown_help","Unterstuetzt u. a. Ueberschriften, Listen, **Fett**, *Kursiv*, `Code` und Links.")})]})}),c==="status"&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.status_level","Status-Level")}),e.jsxs("select",{value:a.statusLevel||"ok",onChange:t=>n({...a,statusLevel:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"ok",children:r("querybuilder.status_level_ok","OK")}),e.jsx("option",{value:"info",children:r("querybuilder.status_level_info","Info")}),e.jsx("option",{value:"warning",children:r("querybuilder.status_level_warning","Warnung")}),e.jsx("option",{value:"critical",children:r("querybuilder.status_level_critical","Kritisch")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.status_title","Titel")}),e.jsx("input",{value:a.statusTitle||"",onChange:t=>n({...a,statusTitle:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:r("querybuilder.status_placeholder_title","Systemstatus")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.status_message","Nachricht")}),e.jsx("textarea",{value:a.statusMessage||"",onChange:t=>n({...a,statusMessage:t.target.value}),className:"w-full h-24 p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none resize-y",placeholder:r("querybuilder.status_placeholder_message","Alle Kernsysteme laufen stabil.")})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 px-3 py-2",children:[e.jsx("span",{className:"text-[10px] font-black text-slate-400 dark:text-slate-300 uppercase tracking-widest",children:r("querybuilder.status_pulse","Signal-Animation")}),e.jsx("button",{type:"button",onClick:()=>n({...a,statusPulse:!a.statusPulse}),className:`px-2 py-0.5 rounded text-[10px] font-black uppercase transition-all ${a.statusPulse?"bg-blue-600 text-white":"bg-slate-200 dark:bg-slate-700 text-slate-500 dark:text-slate-200"}`,children:a.statusPulse?r("querybuilder.label_on"):r("querybuilder.label_off")})]})]}),c==="section"&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.section_title","Ueberschrift")}),e.jsx("input",{value:a.sectionTitle||"",onChange:t=>n({...a,sectionTitle:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:r("querybuilder.section_placeholder_title","Abschnittstitel")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.section_subtitle","Untertitel")}),e.jsx("input",{value:a.sectionSubtitle||"",onChange:t=>n({...a,sectionSubtitle:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:r("querybuilder.section_placeholder_subtitle","Optionaler Hinweistext")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.section_align","Ausrichtung")}),e.jsxs("select",{value:a.sectionAlign||"left",onChange:t=>n({...a,sectionAlign:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"left",children:r("querybuilder.text_align_left")}),e.jsx("option",{value:"center",children:r("querybuilder.text_align_center")}),e.jsx("option",{value:"right",children:r("querybuilder.text_align_right")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.section_divider","Trennlinie")}),e.jsxs("select",{value:a.sectionDividerStyle||"line",onChange:t=>n({...a,sectionDividerStyle:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"line",children:r("querybuilder.section_divider_line","Linie")}),e.jsx("option",{value:"double",children:r("querybuilder.section_divider_double","Doppelt")}),e.jsx("option",{value:"none",children:r("querybuilder.section_divider_none","Keine")})]})]})]})]}),c==="kpi_manual"&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.kpi_title","Kennzahl-Titel")}),e.jsx("input",{value:a.kpiTitle||"",onChange:t=>n({...a,kpiTitle:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:r("querybuilder.kpi_placeholder_title","z. B. Verfuegbarkeit")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.kpi_value","Wert")}),e.jsx("input",{value:a.kpiValue||"",onChange:t=>n({...a,kpiValue:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:r("querybuilder.kpi_placeholder_value","99.9")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.kpi_unit","Einheit")}),e.jsx("input",{value:a.kpiUnit||"",onChange:t=>n({...a,kpiUnit:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:r("querybuilder.kpi_placeholder_unit","%")})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.kpi_target","Ziel")}),e.jsx("input",{value:a.kpiTarget||"",onChange:t=>n({...a,kpiTarget:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:r("querybuilder.kpi_placeholder_target","99.5")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.kpi_trend","Trend")}),e.jsxs("select",{value:a.kpiTrend||"flat",onChange:t=>n({...a,kpiTrend:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"up",children:r("querybuilder.kpi_trend_up","Steigend")}),e.jsx("option",{value:"flat",children:r("querybuilder.kpi_trend_flat","Stabil")}),e.jsx("option",{value:"down",children:r("querybuilder.kpi_trend_down","Fallend")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.text_align","Ausrichtung")}),e.jsxs("select",{value:a.kpiAlign||"left",onChange:t=>n({...a,kpiAlign:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"left",children:r("querybuilder.text_align_left","Links")}),e.jsx("option",{value:"center",children:r("querybuilder.text_align_center","Zentriert")}),e.jsx("option",{value:"right",children:r("querybuilder.text_align_right","Rechts")})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.kpi_note","Hinweis")}),e.jsx("textarea",{value:a.kpiNote||"",onChange:t=>n({...a,kpiNote:t.target.value}),className:"w-full h-20 p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none resize-y",placeholder:r("querybuilder.kpi_placeholder_note","Optionaler Kontext zur Kennzahl.")})]})]}),c==="image"&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.image_url","Bild-URL")}),e.jsx("input",{value:a.imageUrl||"",onChange:t=>n({...a,imageUrl:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:r("querybuilder.image_placeholder_url","https://...")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.image_alt","Alternativtext")}),e.jsx("input",{value:a.imageAlt||"",onChange:t=>n({...a,imageAlt:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:r("querybuilder.image_placeholder_alt","Beschreibung fuer Screenreader")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.image_fit","Darstellung")}),e.jsxs("select",{value:a.imageFit||"contain",onChange:t=>n({...a,imageFit:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"contain",children:r("querybuilder.image_fit_contain","Einpassen")}),e.jsx("option",{value:"cover",children:r("querybuilder.image_fit_cover","Ausfuellen")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.text_align","Ausrichtung")}),e.jsxs("select",{value:a.imageAlign||"center",onChange:t=>n({...a,imageAlign:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"left",children:r("querybuilder.text_align_left","Links")}),e.jsx("option",{value:"center",children:r("querybuilder.text_align_center","Zentriert")}),e.jsx("option",{value:"right",children:r("querybuilder.text_align_right","Rechts")})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.image_caption","Bildunterschrift")}),e.jsx("input",{value:a.imageCaption||"",onChange:t=>n({...a,imageCaption:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:r("querybuilder.image_placeholder_caption","Optional")})]})]}),c==="pivot"&&o.length>0&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.pivot_rows")}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:(a.pivotRows||[]).map(t=>e.jsxs("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px] font-bold flex items-center gap-1",children:[t,e.jsx("button",{onClick:()=>n({...a,pivotRows:(a.pivotRows||[]).filter(l=>l!==t)}),children:e.jsx(me,{className:"w-2.5 h-2.5"})})]},t))}),e.jsxs("select",{onChange:t=>{t.target.value&&(n({...a,pivotRows:[...a.pivotRows||[],t.target.value]}),t.target.value="")},className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"",children:r("querybuilder.pivot_add_row")}),O.filter(t=>!(a.pivotRows||[]).includes(t)).map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:r("querybuilder.pivot_cols")}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:(a.pivotCols||[]).map(t=>e.jsxs("span",{className:"px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded text-[10px] font-bold flex items-center gap-1",children:[t,e.jsx("button",{onClick:()=>n({...a,pivotCols:(a.pivotCols||[]).filter(l=>l!==t)}),children:e.jsx(me,{className:"w-2.5 h-2.5"})})]},t))}),e.jsxs("select",{onChange:t=>{t.target.value&&(n({...a,pivotCols:[...a.pivotCols||[],t.target.value]}),t.target.value="")},className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"",children:r("querybuilder.pivot_add_col")}),O.filter(t=>!(a.pivotCols||[]).includes(t)).map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-2",children:r("querybuilder.pivot_measures")}),e.jsxs("div",{className:"space-y-2",children:[(a.pivotMeasures||[]).map((t,l)=>e.jsxs("div",{className:"flex items-center gap-1 bg-slate-50 dark:bg-slate-800/50 p-2 rounded border border-slate-100",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-600 truncate flex-1",children:t.field}),e.jsxs("select",{value:t.agg,onChange:s=>{const i=[...a.pivotMeasures||[]],b=s.target.value;i[l]={...t,agg:b},n({...a,pivotMeasures:i})},className:"bg-transparent text-[10px] font-bold text-blue-600 outline-none",children:[e.jsx("option",{value:"sum",children:r("querybuilder.pivot_agg_sum")}),e.jsx("option",{value:"count",children:r("querybuilder.pivot_agg_count")}),e.jsx("option",{value:"avg",children:r("querybuilder.pivot_agg_avg")}),e.jsx("option",{value:"min",children:r("querybuilder.pivot_agg_min")}),e.jsx("option",{value:"max",children:r("querybuilder.pivot_agg_max")})]}),e.jsx("button",{onClick:()=>n({...a,pivotMeasures:(a.pivotMeasures||[]).filter((s,i)=>i!==l)}),className:"text-slate-300 hover:text-red-500",children:e.jsx(me,{className:"w-3"})})]},l)),e.jsxs("select",{onChange:t=>{t.target.value&&(n({...a,pivotMeasures:[...a.pivotMeasures||[],{field:t.target.value,agg:"sum"}]}),t.target.value="")},className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"",children:r("querybuilder.pivot_add_measure")}),O.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]})]}),c==="kpi"&&o.length>0&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-400",children:r("querybuilder.kpi_rules")}),e.jsxs("button",{onClick:()=>n({...a,rules:[...a.rules||[],{operator:">",value:0,color:"green"}]}),className:"p-1 px-2 bg-blue-50 text-blue-600 rounded text-[9px] font-bold hover:bg-blue-100 transition-colors",children:["+ ",r("querybuilder.add_rule")]})]}),e.jsx("div",{className:"space-y-2",children:(a.rules||[]).map((t,l)=>e.jsxs("div",{className:"flex items-center gap-1.5 p-2 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-100 dark:border-slate-800",children:[e.jsxs("select",{value:t.operator,onChange:s=>{const i=[...a.rules||[]],b=s.target.value;i[l]={...t,operator:b},n({...a,rules:i})},className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded p-1 text-[10px] outline-none",children:[e.jsx("option",{value:">",children:">"}),e.jsx("option",{value:"<",children:"<"}),e.jsx("option",{value:">=",children:">="}),e.jsx("option",{value:"<=",children:"<="}),e.jsx("option",{value:"==",children:"=="})]}),e.jsx("input",{type:"number",value:t.value,onChange:s=>{const i=[...a.rules||[]];i[l]={...t,value:Number(s.target.value)},n({...a,rules:i})},className:"w-16 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded p-1 text-[10px] outline-none"}),e.jsx("div",{className:"flex gap-1",children:["green","yellow","red","blue"].map(s=>e.jsx("button",{onClick:()=>{const i=[...a.rules||[]];i[l]={...t,color:s},n({...a,rules:i})},className:`w-4 h-4 rounded-full border-2 ${t.color===s?"border-slate-400 scale-110":"border-transparent opacity-40 hover:opacity-100"}`,style:{backgroundColor:s==="green"?"#10b981":s==="red"?"#f43f5e":s==="yellow"?"#fbbf24":"#3b82f6"}},s))}),e.jsx("button",{onClick:()=>n({...a,rules:(a.rules||[]).filter((s,i)=>i!==l)}),className:"ml-auto text-slate-300 hover:text-red-500",children:e.jsx(me,{className:"w-3.5 h-3.5"})})]},l))})]})]}):e.jsxs("div",{className:"p-4 rounded-xl border border-blue-200 bg-blue-50/60 dark:bg-blue-950/20 space-y-3 animate-in slide-in-from-right-4 duration-300",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-wide text-blue-500",children:r("querybuilder.step_finalize")}),e.jsxs("div",{className:"rounded-lg border border-blue-100 dark:border-blue-900 bg-white dark:bg-slate-900 px-3 py-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-wide text-slate-400",children:r("querybuilder.archive_name")}),e.jsx("input",{value:T,onChange:t=>B(t.target.value),placeholder:r("querybuilder.archive_placeholder"),className:"mt-1 w-full bg-transparent border border-slate-200 dark:border-slate-700 rounded-md px-2 py-1.5 text-xs font-semibold text-slate-800 dark:text-slate-100 outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"space-y-2 text-[11px]",children:[e.jsxs("div",{className:"rounded-lg border border-blue-100 dark:border-blue-900 bg-white dark:bg-slate-900 px-3 py-2",children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-wide text-slate-400",children:r("querybuilder.finalize_mode")}),e.jsx("div",{className:"mt-1 text-slate-700 dark:text-slate-200",children:Ft})]}),e.jsxs("div",{className:"rounded-lg border border-blue-100 dark:border-blue-900 bg-white dark:bg-slate-900 px-3 py-2",children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-wide text-slate-400",children:r("querybuilder.finalize_source")}),e.jsx("div",{className:"mt-1 text-slate-700 dark:text-slate-200",children:x?D?r("querybuilder.new_markdown_card_type","MARKDOWN"):V?r("querybuilder.new_status_card_type","STATUS"):P?r("querybuilder.new_section_card_type","SECTION"):E?r("querybuilder.new_kpi_manual_card_type","KPI MANUAL"):F?r("querybuilder.new_image_card_type","IMAGE"):r("querybuilder.new_text_card_type"):r("querybuilder.sql_manager_source","SQL Manager Source")})]}),e.jsxs("div",{className:"rounded-lg border border-blue-100 dark:border-blue-900 bg-white dark:bg-slate-900 px-3 py-2",children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-wide text-slate-400",children:r("querybuilder.finalize_chart")}),e.jsx("div",{className:"mt-1 text-slate-700 dark:text-slate-200 font-semibold",children:Qe.label}),!x&&e.jsx("div",{className:"mt-1 text-[10px] text-slate-500",children:r("querybuilder.finalize_axes",{x:a.xAxis||"-",count:(a.yAxes||[]).length})}),x&&e.jsx("div",{className:"mt-1 text-[10px] text-slate-500",children:V?r("querybuilder.finalize_status_level",{level:r(`querybuilder.status_level_${a.statusLevel||"ok"}`,a.statusLevel||"ok")}):P?r("querybuilder.finalize_section_style",{style:r(`querybuilder.section_divider_${a.sectionDividerStyle||"line"}`,a.sectionDividerStyle||"line")}):E?r("querybuilder.finalize_kpi_target",{target:a.kpiTarget||"-"}):F?r("querybuilder.finalize_image_url",{url:(a.imageUrl||"").trim()?"OK":"-"}):r("querybuilder.finalize_text_length",{count:D?(a.markdownContent||"").trim().length:(a.textContent||"").trim().length})})]}),e.jsxs("div",{className:"rounded-lg border border-blue-100 dark:border-blue-900 bg-white dark:bg-slate-900 px-3 py-2",children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-wide text-slate-400",children:r("querybuilder.preview",{count:o.length})}),e.jsx("div",{className:`mt-1 text-[11px] font-semibold ${Ee?"text-amber-700":"text-emerald-700"}`,children:r(Ee?"querybuilder.preview_not_renderable_title":"querybuilder.finalize_ready")})]})]}),Y&&Pe&&e.jsx("p",{className:"text-[10px] text-amber-700",children:Pe})]})}),e.jsxs("div",{className:"sticky bottom-0 z-20 border-t border-slate-200 dark:border-slate-700 bg-white/95 dark:bg-slate-900/95 backdrop-blur px-4 py-3 shadow-[0_-6px_18px_-14px_rgba(15,23,42,0.5)]",children:[e.jsx("div",{className:"flex items-center justify-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{const t=h===3?1:Math.max(1,h-1);Se(t)},disabled:h<=1,className:"px-3 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-xs font-bold text-slate-500 dark:text-slate-300 disabled:opacity-40",children:r("querybuilder.back")}),Vt&&e.jsx("button",{onClick:()=>{Zt()},disabled:Pt,className:"px-4 py-2 rounded-lg border border-blue-200 dark:border-blue-700 bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-200 text-xs font-bold disabled:opacity-40",children:Et}),e.jsx("button",{onClick:()=>{Ht()},disabled:it,className:"px-4 py-2 rounded-lg bg-blue-600 text-white text-xs font-bold shadow-sm disabled:opacity-40",children:Dt})]})}),it&&nt&&e.jsx("p",{className:"mt-2 text-center text-[10px] text-amber-700",children:nt})]})]})}),e.jsxs("div",{id:"query-visualization",className:"flex-1 min-w-0 bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden flex flex-col h-full min-h-[320px] sm:min-h-[380px] lg:min-h-[460px] relative",children:[e.jsxs("div",{className:"border-b border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-900/50",children:[e.jsxs("div",{className:"p-3 flex items-center justify-between gap-2",children:[e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-wider",children:r("querybuilder.preview_panel_title","Vorschau")}),e.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400 truncate",children:Gt})]}),e.jsx("div",{className:"px-3 pb-2 border-t border-slate-100 dark:border-slate-800",children:e.jsxs("div",{className:"pt-2 flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-1",children:[e.jsxs("button",{type:"button",onClick:()=>le("graphic"),className:`px-2 py-1.5 rounded text-[10px] font-bold border transition-colors flex items-center justify-center gap-1 ${ae==="graphic"?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700":"bg-white dark:bg-slate-900 text-slate-500 dark:text-slate-300 border-slate-200 dark:border-slate-700"}`,children:[e.jsx(pe,{className:"w-3 h-3"}),r("querybuilder.preview_tab_graphic","Grafisch")]}),e.jsxs("button",{type:"button",onClick:()=>{x||le("table")},disabled:x,className:`px-2 py-1.5 rounded text-[10px] font-bold border transition-colors flex items-center justify-center gap-1 ${ae==="table"?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700":"bg-white dark:bg-slate-900 text-slate-500 dark:text-slate-300 border-slate-200 dark:border-slate-700"} disabled:opacity-40 disabled:cursor-not-allowed`,children:[e.jsx(Te,{className:"w-3 h-3"}),r("querybuilder.preview_tab_table","Tabelle")]}),e.jsxs("button",{type:"button",onClick:()=>{x||le("sql")},disabled:x,className:`px-2 py-1.5 rounded text-[10px] font-bold border transition-colors flex items-center justify-center gap-1 ${ae==="sql"?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700":"bg-white dark:bg-slate-900 text-slate-500 dark:text-slate-300 border-slate-200 dark:border-slate-700"} disabled:opacity-40 disabled:cursor-not-allowed`,children:[e.jsx(be,{className:"w-3 h-3"}),r("querybuilder.preview_tab_sql","SQL")]})]}),e.jsxs("button",{onClick:()=>Nt(!ve),className:"px-2 py-1.5 rounded text-[10px] font-bold border bg-white dark:bg-slate-900 text-slate-500 dark:text-slate-300 border-slate-200 dark:border-slate-700 hover:text-slate-700 dark:hover:text-slate-100 transition-colors flex items-center justify-center gap-1",children:[ve?e.jsx(ur,{className:"w-3 h-3"}):e.jsx(ht,{className:"w-3 h-3"}),e.jsx("span",{children:r(ve?"querybuilder.centered":"querybuilder.focus")})]})]})})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 min-h-0 container-scrollbar",children:ae==="graphic"?we?e.jsx("div",{className:`h-full min-h-[260px] p-6 whitespace-pre-wrap break-words text-slate-800 dark:text-slate-100 ${a.textSize==="sm"?"text-sm":a.textSize==="lg"?"text-lg":a.textSize==="xl"?"text-xl":a.textSize==="2xl"?"text-2xl":"text-base"} ${a.textBold?"font-bold":"font-normal"} ${a.textItalic?"italic":"not-italic"} ${a.textUnderline?"underline":"no-underline"} ${a.textAlign==="center"?"text-center":a.textAlign==="right"?"text-right":"text-left"}`,children:(a.textContent||"").trim()||r("querybuilder.text_placeholder")}):D?e.jsx("div",{className:"h-full min-h-[260px] p-6 text-slate-800 dark:text-slate-100",children:e.jsx(nr,{markdown:(a.markdownContent||"").trim(),emptyText:r("querybuilder.markdown_placeholder",`# Titel
Text mit **Fett** und [Link](https://example.com)`),className:"text-sm leading-6"})}):V?e.jsx("div",{className:"h-full min-h-[260px] p-6 flex items-center justify-center",children:(()=>{const t=a.statusLevel||"ok",s={ok:{ring:"ring-emerald-200 bg-emerald-50 dark:bg-emerald-900/20",dot:"bg-emerald-500",title:"text-emerald-800 dark:text-emerald-300",text:"text-emerald-700/90 dark:text-emerald-200/90"},info:{ring:"ring-blue-200 bg-blue-50 dark:bg-blue-900/20",dot:"bg-blue-500",title:"text-blue-800 dark:text-blue-300",text:"text-blue-700/90 dark:text-blue-200/90"},warning:{ring:"ring-amber-200 bg-amber-50 dark:bg-amber-900/20",dot:"bg-amber-500",title:"text-amber-800 dark:text-amber-300",text:"text-amber-700/90 dark:text-amber-200/90"},critical:{ring:"ring-rose-200 bg-rose-50 dark:bg-rose-900/20",dot:"bg-rose-500",title:"text-rose-800 dark:text-rose-300",text:"text-rose-700/90 dark:text-rose-200/90"}}[t];return e.jsxs("div",{className:`w-full max-w-xl rounded-xl ring-1 ${s.ring} p-5`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`relative inline-flex h-3.5 w-3.5 rounded-full ${s.dot}`,children:a.statusPulse&&e.jsx("span",{className:`absolute inline-flex h-full w-full rounded-full ${s.dot} opacity-75 animate-ping`})}),e.jsx("span",{className:`text-[11px] font-black uppercase tracking-wider ${s.title}`,children:r(`querybuilder.status_level_${t}`,t)})]}),e.jsx("div",{className:`mt-3 text-lg font-bold ${s.title}`,children:(a.statusTitle||"").trim()||r("querybuilder.status_placeholder_title","Systemstatus")}),e.jsx("p",{className:`mt-2 text-sm ${s.text}`,children:(a.statusMessage||"").trim()||r("querybuilder.status_placeholder_message","Alle Kernsysteme laufen stabil.")})]})})()}):P?e.jsx("div",{className:"h-full min-h-[260px] p-6 flex flex-col justify-center",children:(()=>{const t=a.sectionAlign||"left",l=t==="center"?"text-center":t==="right"?"text-right":"text-left",s=a.sectionDividerStyle||"line";return e.jsxs("div",{className:`w-full ${l}`,children:[e.jsx("h2",{className:"text-2xl font-black tracking-tight text-slate-800 dark:text-slate-100",children:(a.sectionTitle||"").trim()||r("querybuilder.section_placeholder_title","Abschnittstitel")}),(a.sectionSubtitle||"").trim()&&e.jsx("p",{className:"mt-1 text-sm text-slate-500 dark:text-slate-400",children:a.sectionSubtitle}),s==="line"&&e.jsx("div",{className:`mt-4 h-px bg-slate-300 dark:bg-slate-700 ${t==="center"?"mx-auto w-2/3":t==="right"?"ml-auto w-2/3":"w-2/3"}`}),s==="double"&&e.jsxs("div",{className:`mt-4 space-y-1 ${t==="center"?"mx-auto w-2/3":t==="right"?"ml-auto w-2/3":"w-2/3"}`,children:[e.jsx("div",{className:"h-px bg-slate-300 dark:bg-slate-700"}),e.jsx("div",{className:"h-px bg-slate-300 dark:bg-slate-700"})]})]})})()}):E?e.jsx("div",{className:"h-full min-h-[260px] p-6 flex items-center justify-center",children:(()=>{const t=a.kpiTrend||"flat",l=ut=>{if(!ut)return Number.NaN;const Jt=ut.replace(/\s+/g,"").replace(",",".").replace(/[^0-9.+-]/g,"");return Number(Jt)},s=l(a.kpiValue),i=l(a.kpiTarget),b=a.kpiAlign||"left",f=b==="center"?"text-center":b==="right"?"text-right":"text-left",m=b==="center"?"justify-center":b==="right"?"justify-end":"justify-start",_=Number.isFinite(s)&&Number.isFinite(i)&&i!==0,ee=_?s/i:Number.NaN,u=_?ee>=1?"ok":ee>=.95?"warn":"crit":"neutral",te=t==="up"?"text-emerald-700 dark:text-emerald-300 bg-emerald-50 dark:bg-emerald-900/20":t==="down"?"text-rose-700 dark:text-rose-300 bg-rose-50 dark:bg-rose-900/20":"text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-700/40",Xt=u==="ok"?"text-emerald-700 dark:text-emerald-300 bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-800":u==="warn"?"text-amber-700 dark:text-amber-300 bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800":u==="crit"?"text-rose-700 dark:text-rose-300 bg-rose-50 dark:bg-rose-900/20 border-rose-200 dark:border-rose-800":"text-slate-600 dark:text-slate-300 bg-slate-100 dark:bg-slate-700/40 border-slate-200 dark:border-slate-700",Yt=u==="ok"?"text-emerald-700 dark:text-emerald-300":u==="warn"?"text-amber-700 dark:text-amber-300":u==="crit"?"text-rose-700 dark:text-rose-300":"text-slate-900 dark:text-slate-100";return e.jsxs("div",{className:`w-full max-w-xl rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-5 ${f}`,children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-wider text-slate-400",children:(a.kpiTitle||"").trim()||r("querybuilder.kpi_placeholder_title","Kennzahl")}),e.jsxs("div",{className:`mt-3 flex items-end gap-2 ${m}`,children:[e.jsx("div",{className:`text-4xl font-black tracking-tight ${Yt}`,children:(a.kpiValue||"").trim()||"--"}),(a.kpiUnit||"").trim()&&e.jsx("div",{className:"pb-1 text-sm font-bold text-slate-500 dark:text-slate-400",children:a.kpiUnit})]}),e.jsxs("div",{className:`mt-3 flex flex-wrap items-center gap-2 ${m}`,children:[e.jsxs("span",{className:"px-2 py-1 rounded-full text-[10px] font-black uppercase tracking-wide bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300",children:[r("querybuilder.kpi_target","Ziel"),": ",(a.kpiTarget||"").trim()||"-"]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-[10px] font-black uppercase tracking-wide ${te}`,children:r(`querybuilder.kpi_trend_${t}`,t)}),e.jsx("span",{className:`px-2 py-1 rounded-full border text-[10px] font-black uppercase tracking-wide ${Xt}`,children:u==="ok"?r("querybuilder.kpi_status_on_target","Im Ziel"):u==="warn"?r("querybuilder.kpi_status_near_target","Nahe am Ziel"):u==="crit"?r("querybuilder.kpi_status_below_target","Unter Ziel"):r("querybuilder.kpi_status_no_compare","Kein Zielvergleich")})]}),(a.kpiNote||"").trim()&&e.jsx("p",{className:"mt-3 text-xs text-slate-500 dark:text-slate-400",children:a.kpiNote})]})})()}):F?e.jsx("div",{className:"h-full min-h-[260px] p-6 flex items-center justify-center",children:(()=>{const t=a.imageAlign||"center",l=t==="left"?"items-start":t==="right"?"items-end":"items-center";return e.jsx("div",{className:`w-full h-full flex flex-col ${l} justify-center`,children:(a.imageUrl||"").trim()&&!At?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:(a.imageUrl||"").trim(),alt:(a.imageAlt||"").trim()||"Preview image",referrerPolicy:"no-referrer",crossOrigin:"anonymous",onError:()=>Je(!0),className:`max-h-[320px] w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 ${a.imageFit==="cover"?"object-cover":"object-contain"}`}),(a.imageCaption||"").trim()&&e.jsx("p",{className:"mt-2 text-xs text-slate-500 dark:text-slate-400",children:a.imageCaption})]}):(a.imageUrl||"").trim()?e.jsx("div",{className:"w-full rounded-lg border border-amber-300 bg-amber-50 dark:bg-amber-900/20 dark:border-amber-700 p-3 text-amber-900 dark:text-amber-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs font-bold",children:r("querybuilder.image_load_error_title","Bild konnte nicht geladen werden.")}),e.jsx("p",{className:"text-[11px] mt-1",children:r("querybuilder.image_load_error_hint","Bitte URL, Zugriff und CORS/Hotlink-Schutz pruefen.")}),e.jsx("p",{className:"text-[10px] mt-1 font-mono break-all opacity-80",children:(a.imageUrl||"").trim()})]})]})}):e.jsxs("div",{className:"h-[220px] w-full rounded-lg border border-dashed border-slate-300 dark:border-slate-700 flex flex-col items-center justify-center text-slate-400",children:[e.jsx(Ae,{className:"w-8 h-8 mb-2 opacity-60"}),e.jsx("p",{className:"text-xs font-semibold text-center",children:r("querybuilder.image_empty_hint","Bitte eine Bild-URL hinterlegen.")})]})})})()}):Ve?o.length===0?e.jsxs("div",{className:"h-full min-h-[260px] flex flex-col items-center justify-center text-slate-300",children:[e.jsx(gt,{className:"w-12 h-12 mb-4 opacity-10"}),e.jsx("p",{className:"text-xs font-black uppercase tracking-widest text-center whitespace-pre-wrap",children:r("querybuilder.no_data_prompt")})]}):p==="table"?e.jsx(bt,{columns:rt,data:o,onRowClick:t=>{et(o.indexOf(t)),Ie(!0)}}):p==="pivot"?e.jsx(dr,{data:o,rows:a.pivotRows||[],cols:a.pivotCols||[],measures:a.pivotMeasures||[]}):at?e.jsx("div",{className:"h-full min-h-[260px] w-full flex flex-col",children:Ee?e.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:e.jsx("div",{className:"max-w-md w-full rounded-xl border border-amber-200 bg-amber-50 text-amber-900 px-4 py-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 text-amber-600",children:Qe.icon}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs font-black uppercase tracking-wide text-amber-700",children:Qe.label}),e.jsx("p",{className:"text-sm font-bold mt-1",children:r("querybuilder.preview_not_renderable_title")}),e.jsx("p",{className:"text-xs text-amber-800/90 mt-1",children:r("querybuilder.preview_not_renderable_hint")})]})]})})}):p==="kpi"?(()=>{const t=o[0][Object.keys(o[0])[0]],l=Number(t);let s="text-slate-900 dark:text-white";if(a.rules&&!isNaN(l))for(const i of a.rules){let b=!1;switch(i.operator){case">":b=l>i.value;break;case"<":b=l<i.value;break;case">=":b=l>=i.value;break;case"<=":b=l<=i.value;break;case"==":b=l===i.value;break}if(b){i.color==="green"?s="text-emerald-500":i.color==="red"?s="text-rose-500":i.color==="yellow"?s="text-amber-500":i.color==="blue"&&(s="text-blue-500");break}}return e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 animate-in zoom-in-95 duration-500",children:[e.jsx("div",{className:`text-6xl lg:text-8xl font-black tracking-widest break-all transition-colors duration-300 ${s}`,children:y(t,Object.keys(o[0])[0])}),e.jsx("div",{className:"text-xs font-bold text-slate-400 mt-6 uppercase tracking-[0.4em] font-mono",children:(a.yAxes||[])[0]||Object.keys(o[0])[0]})]})})():e.jsx("div",{className:"flex-1 min-h-[280px] min-w-0",children:e.jsx(pr,{width:"100%",height:"100%",minWidth:320,minHeight:280,children:p==="bar"?e.jsxs(mr,{data:o,children:[e.jsx(he,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(ge,{dataKey:a.xAxis,axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"}}),e.jsx(fe,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"},tickFormatter:t=>y(t,(a.yAxes||[])[0])}),e.jsx(H,{contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.1)"},cursor:{fill:"#f8fafc"},formatter:(t,l)=>[y(t,l),l]}),e.jsx(Z,{verticalAlign:"top",height:36,iconType:"circle",wrapperStyle:{fontSize:"10px",fontWeight:"bold"}}),(a.yAxes||[]).map((t,l)=>e.jsx(ft,{dataKey:t,fill:l===0?a.color||g[0]:g[l%g.length],radius:[4,4,0,0],children:a.showLabels&&e.jsx(ke,{dataKey:t,position:"top",style:{fontSize:"10px",fontWeight:"bold",fill:"#64748b"},formatter:s=>y(s,t)})},t))]}):p==="line"?e.jsxs(hr,{data:o,children:[e.jsx(he,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(ge,{dataKey:a.xAxis,axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"}}),e.jsx(fe,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"},tickFormatter:t=>y(t,(a.yAxes||[])[0])}),e.jsx(H,{contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.1)"},formatter:(t,l)=>[y(t,l),l]}),e.jsx(Z,{verticalAlign:"top",height:36,iconType:"circle"}),(a.yAxes||[]).map((t,l)=>e.jsx(kt,{type:"monotone",dataKey:t,stroke:l===0?a.color||g[0]:g[l%g.length],strokeWidth:3,dot:{r:4},activeDot:{r:6},children:a.showLabels&&e.jsx(ke,{dataKey:t,position:"top",offset:10,style:{fontSize:"10px",fontWeight:"bold",fill:"#64748b"},formatter:s=>y(s,t)})},t))]}):p==="area"?e.jsxs(gr,{data:o,children:[e.jsx(he,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(ge,{dataKey:a.xAxis,axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"}}),e.jsx(fe,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"},tickFormatter:t=>y(t,(a.yAxes||[])[0])}),e.jsx(H,{contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.1)"},formatter:(t,l)=>[y(t,l),l]}),e.jsx(Z,{verticalAlign:"top",height:36,iconType:"circle",wrapperStyle:{fontSize:"10px",fontWeight:"bold"}}),(a.yAxes||[]).map((t,l)=>e.jsx(fr,{type:"monotone",dataKey:t,stroke:l===0?a.color||g[0]:g[l%g.length],fill:l===0?a.color||g[0]:g[l%g.length],fillOpacity:.2,strokeWidth:2,children:a.showLabels&&e.jsx(ke,{dataKey:t,position:"top",style:{fontSize:"10px",fontWeight:"bold",fill:"#64748b"},formatter:s=>y(s,t)})},t))]}):p==="pie"?e.jsxs(kr,{children:[e.jsx(yr,{data:o,cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:l})=>`${t} ${((l||0)*100).toFixed(0)}%`,outerRadius:120,innerRadius:80,paddingAngle:5,dataKey:(a.yAxes||[])[0]||"",nameKey:a.xAxis,children:o.map((t,l)=>e.jsx(vr,{fill:g[l%g.length]},`cell-${l}`))}),e.jsx(H,{contentStyle:{borderRadius:"12px",border:"none"}}),e.jsx(Z,{layout:"vertical",align:"right",verticalAlign:"middle",iconType:"circle",wrapperStyle:{fontSize:"10px",fontWeight:"bold"}})]}):p==="composed"?e.jsxs(jr,{data:o,children:[e.jsx(he,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(ge,{dataKey:a.xAxis,axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"}}),e.jsx(fe,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"},tickFormatter:t=>y(t,(a.yAxes||[])[0])}),e.jsx(H,{contentStyle:{borderRadius:"12px",border:"none"},formatter:(t,l)=>[y(t,l),l]}),e.jsx(Z,{verticalAlign:"top",height:36,wrapperStyle:{fontSize:"10px",fontWeight:"bold"}}),(a.yAxes||[]).map((t,l)=>l===0?e.jsx(ft,{dataKey:t,fill:g[0],radius:[4,4,0,0],children:a.showLabels&&e.jsx(ke,{dataKey:t,position:"top",style:{fontSize:"10px",fontWeight:"bold",fill:"#64748b"},formatter:s=>y(s,t)})},t):e.jsx(kt,{type:"monotone",dataKey:t,stroke:g[l%g.length],strokeWidth:3,children:a.showLabels&&e.jsx(ke,{dataKey:t,position:"top",style:{fontSize:"10px",fontWeight:"bold",fill:"#64748b"},formatter:s=>y(s,t)})},t))]}):p==="radar"?e.jsxs(_r,{cx:"50%",cy:"50%",outerRadius:"80%",data:o,children:[e.jsx(wr,{stroke:"#e2e8f0"}),e.jsx(Nr,{dataKey:a.xAxis,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"}}),e.jsx(qr,{angle:30,domain:[0,"auto"],tick:{fontSize:10,fill:"#94a3b8"}}),(a.yAxes||[]).map((t,l)=>e.jsx(Sr,{name:t,dataKey:t,stroke:g[l%g.length],fill:g[l%g.length],fillOpacity:.6},t)),e.jsx(Z,{iconType:"circle",wrapperStyle:{fontSize:"10px",fontWeight:"bold"}}),e.jsx(H,{contentStyle:{borderRadius:"12px",border:"none"}})]}):p==="scatter"?e.jsxs(Cr,{children:[e.jsx(he,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(ge,{type:"number",dataKey:a.xAxis,name:a.xAxis,axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"}}),e.jsx(fe,{type:"number",dataKey:(a.yAxes||[])[0],name:(a.yAxes||[])[0],axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"}}),e.jsx(H,{cursor:{strokeDasharray:"3 3"}}),e.jsx(Z,{verticalAlign:"top",height:36,iconType:"circle",wrapperStyle:{fontSize:"10px",fontWeight:"bold"}}),e.jsx(Ar,{name:T||"Scatter",data:De,fill:a.color||g[0]})]}):null})})},`${p}-${jt}`):e.jsxs("div",{className:"h-full min-h-[260px] flex flex-col items-center justify-center text-slate-400",children:[e.jsx(w,{className:"w-10 h-10 mb-3 opacity-40"}),e.jsx("p",{className:"text-xs font-bold text-center",children:r("querybuilder.preview_graphic_not_selected_hint","Fuer die grafische Ansicht bitte einen Diagrammtyp auswaehlen.")})]}):e.jsxs("div",{className:"h-full min-h-[260px] flex flex-col items-center justify-center text-slate-400",children:[e.jsx(pe,{className:"w-10 h-10 mb-3 opacity-40"}),e.jsx("p",{className:"text-xs font-bold text-center",children:r("querybuilder.preview_graphic_no_query_hint","Keine Abfrage vorhanden. Fuer Text/Markdown/Status/Section/KPI-Manual/Image-Widgets steht nur die Inhaltsvorschau zur Verfuegung.")})]}):ae==="table"?Ve?o.length===0?e.jsxs("div",{className:"h-full min-h-[260px] flex flex-col items-center justify-center text-slate-300",children:[e.jsx(gt,{className:"w-12 h-12 mb-4 opacity-10"}),e.jsx("p",{className:"text-xs font-black uppercase tracking-widest text-center whitespace-pre-wrap",children:r("querybuilder.no_data_prompt")})]}):e.jsx(bt,{columns:rt,data:o,onRowClick:t=>{et(o.indexOf(t)),Ie(!0)}}):e.jsxs("div",{className:"h-full min-h-[260px] flex flex-col items-center justify-center text-slate-400",children:[e.jsx(Te,{className:"w-10 h-10 mb-3 opacity-40"}),e.jsx("p",{className:"text-xs font-bold text-center",children:r("querybuilder.preview_no_data_source","Keine Datenquelle ausgewaehlt.")})]}):Ve?e.jsx("div",{className:"h-full",children:e.jsx("textarea",{value:S,readOnly:!0,className:"w-full h-full min-h-[260px] font-mono text-xs p-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-100 rounded-lg outline-none resize-none"})}):e.jsxs("div",{className:"h-full min-h-[260px] flex flex-col items-center justify-center text-slate-400",children:[e.jsx(be,{className:"w-10 h-10 mb-3 opacity-40"}),e.jsx("p",{className:"text-xs font-bold text-center",children:r("querybuilder.preview_no_data_source","Keine Datenquelle ausgewaehlt.")})]})})]})]})}),e.jsx(lr,{isOpen:qt,onClose:()=>je(!1),title:r(j?"querybuilder.update_title":"querybuilder.save_title"),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-100 flex items-center gap-3",children:[e.jsx(mt,{className:"w-8 h-8 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-blue-400",children:r("querybuilder.archive_name")}),e.jsx("input",{autoFocus:!0,value:T,onChange:t=>B(t.target.value),placeholder:r("querybuilder.archive_placeholder"),className:"w-full bg-transparent border-none outline-none font-bold text-blue-900 placeholder:text-blue-200"})]})]}),e.jsx("div",{className:"flex justify-end gap-2 pt-2",children:e.jsxs("button",{onClick:()=>{It("update")},disabled:!T,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold text-xs shadow-lg flex items-center gap-2",children:[e.jsx(xr,{className:"w-4 h-4"})," ",r("common.save")]})})]})}),e.jsx(or,{isOpen:Tt,onClose:()=>Ie(!1),items:o,initialIndex:Lt,tableName:void 0,schema:zt||void 0})]})};export{Vr as QueryBuilderView};
