import{r as Ie,q as ft,u as vt,d as kt,e as Ae,S as P,j as t,P as yt,R as wt,M as qe,b as y}from"./index-QehNXi8v.js";import{r as p}from"./vendor-react-D64xOC9_.js";import{u as jt}from"./MarkdownContent-7007vf0M.js";import{W as $e}from"./WidgetRenderer-L5tYndYJ.js";import{K as ie,al as Nt,o as _t,S as Re,ad as z,t as Ct,X as Pt,d as _,ax as St,az as Ot,u as de,aA as Tt,Y as It,G as At,ag as qt,_ as $t,aB as Rt,aC as Et,D as Ee,F as ce,U as Lt,ap as Dt}from"./vendor-icons-Du2dXQHa.js";import"./vendor-pdf-FXkUb51H.js";import"./vendor-ui-BNe0Xlio.js";import"./vendor-charts-BtQqxQq4.js";import"./vendor-canvas-DXEQVQnt.js";import"./DataTable-Dz-ruP56.js";import"./RecordDetailModal-BxgmvPoP.js";import"./SchemaDocumentation-DaFppMNg.js";import"./inspectorBridge-BnIEasIL.js";const B={async get(a){const w=await Ie("SELECT value FROM sys_settings WHERE key = ?",[a]);return w.length>0?w[0]?.value:null},async set(a,w){await Ie("INSERT OR REPLACE INTO sys_settings (key, value) VALUES (?, ?)",[a,w]),ft()}},Yt=()=>{const{t:a}=vt(),w="report_pack_categories",Q="report_pack_expanded_state",x=a("reports.default_category","General"),j="__all__",[u,pe]=p.useState([]),[A,q]=p.useState([]),[$,S]=p.useState(j),[Le,W]=p.useState(!1),[xe,L]=p.useState(""),[De,ge]=p.useState(!1),[C,m]=p.useState(null),[Ue,K]=p.useState({}),[Fe,V]=p.useState(!1),[Me,G]=p.useState(!1),[Je,D]=p.useState(null),[He,ue]=p.useState(null),me=p.useRef(null),X=p.useRef(null),Y=p.useRef(Promise.resolve()),[be,Z]=p.useState(null),[b,ze]=p.useState({general:!0,cover:!0,headerFooter:!0,pageOptions:!0,quality:!0,preview:!0}),[Be,he]=p.useState(!1),{isReadOnly:g}=kt(),{isExporting:O,exportProgress:fe,exportPackageToPdf:Qe,exportPackageToHtml:We,exportPackageToPpt:Ke}=jt(),{data:k}=Ae(()=>P.getDashboards(),[]),{data:h}=Ae(()=>P.getUserWidgets(),[]),R=p.useCallback(async()=>{const s=(await P.getReportPacks()).map(n=>({...n,category:typeof n.category=="string"&&n.category.trim().length>0?n.category:x})),l=await B.get(Q),o={};if(l)try{const n=JSON.parse(l);Object.entries(n).forEach(([i,d])=>{typeof d=="boolean"&&(o[i]=d)})}catch{}pe(s),s.length>0&&!C&&m(s[0].id),K(()=>{const n={};return s.forEach(i=>{n[i.id]=o[i.id]??!0}),n})},[C,x,Q]),ve=p.useCallback(async()=>{const e=await B.get(w);if(!e){q([]);return}try{const s=JSON.parse(e);if(!Array.isArray(s)){q([]);return}const l=Array.from(new Set(s.filter(o=>typeof o=="string").map(o=>o.trim()).filter(o=>o.length>0)));q(l)}catch{q([])}},[w]);p.useEffect(()=>{const e=window.setTimeout(()=>{R(),ve()},0);return()=>window.clearTimeout(e)},[ve,R]);const ke=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch{return{type:"table"}}return e&&typeof e=="object"?e:{type:"table"}},r=u.find(e=>e.id===C),U=(r?.config.coverLogoUrl||"").trim(),N=p.useMemo(()=>{const e=u.map(s=>s.category||x);return e.push(x),Array.from(new Set([...e,...A])).sort((s,l)=>s.localeCompare(l))},[A,x,u]),E=xe.trim(),Ve=N.some(e=>e.toLowerCase()===E.toLowerCase()),ee=E.length>0&&!Ve,T=$===j||N.includes($)?$:j,ye=T===j?u:u.filter(e=>(e.category||x)===T),te=e=>u.find(s=>s.id===e),I=e=>{ze(s=>({...s,[e]:!s[e]}))},ae=e=>e==="summary"?{orientation:"landscape",pageStatus:"info",statusThreshold:a("reports.template_summary_threshold","Top KPIs within plan"),pageComment:a("reports.template_summary_comment","Management summary with key trends and highlights.")}:e==="kpi"?{orientation:"portrait",pageStatus:"ok",statusThreshold:a("reports.template_kpi_threshold","Target >= 95%"),pageComment:a("reports.template_kpi_comment","Focused KPI page with target, variance and interpretation.")}:{orientation:"landscape",pageStatus:"warning",statusThreshold:a("reports.template_detail_threshold","Review outliers and exceptions"),pageComment:a("reports.template_detail_comment","Detailed analysis page with drilldown context and notes.")},Ge=(e,s,l)=>{if(!r)return;const o=[...r.config.items],n=o[e];if(!n)return;const i=ae(s);o[e]={...n,pageTemplate:s,titleOverride:n.titleOverride||`${a(`reports.template_${s}`,s)} - ${l}`,orientation:i.orientation,pageStatus:i.pageStatus,statusThreshold:i.statusThreshold,pageComment:i.pageComment},c({...r,config:{...r.config,items:o}})},F=p.useCallback(e=>e.type==="dashboard"?k?.find(s=>s.id===e.id)?.name||"Dashboard":h?.find(s=>s.id===e.id)?.name||"Widget",[k,h]),we=p.useCallback(e=>{if(e.type==="widget"){const o=h?.find(n=>n.id===e.id);return!!(o?.sql_query&&o.sql_query.trim().length>0)}const s=k?.find(o=>o.id===e.id);return(Array.isArray(s?.layout)?s?.layout||[]:[]).some(o=>{const n=typeof o?.id=="string"?o.id:"",i=h?.find(d=>d.id===n);return!!(i?.sql_query&&i.sql_query.trim().length>0)})},[k,h]),M=p.useCallback(e=>{const s=[];return e.titleOverride?.trim()||s.push(a("reports.quality_missing_title","Missing page title")),e.pageTemplate||s.push(a("reports.quality_missing_template","No template selected")),e.pageStatus||s.push(a("reports.quality_missing_status","No status set")),e.statusThreshold?.trim()||s.push(a("reports.quality_missing_threshold","No threshold/target note")),e.pageComment?.trim()||s.push(a("reports.quality_missing_comment","No page comment")),we(e)||s.push(a("reports.quality_missing_data_source","No data source linked")),s},[we,a]),je=p.useMemo(()=>r?r.config.items.map((e,s)=>{const l=M(e);return{index:s,name:F(e),issues:l}}):[],[r,M,F]),se=je.reduce((e,s)=>e+s.issues.length,0),re=p.useMemo(()=>u.map(e=>{const s=e.config.items.reduce((l,o)=>l+M(o).length,0);return{id:e.id,name:e.name,pageCount:e.config.items.length,issues:s}}).sort((e,s)=>s.issues-e.issues||e.name.localeCompare(s.name)),[u,M]),Ne=re.reduce((e,s)=>e+s.issues,0),Xe=u.reduce((e,s)=>e+s.config.items.length,0),Ye=e=>{if(!r)return;const s=[...r.config.items],l=s[e];if(!l)return;const o=F(l),n=l.pageTemplate||"summary",i=ae(n);s[e]={...l,pageTemplate:n,titleOverride:l.titleOverride?.trim()?l.titleOverride:o,pageStatus:l.pageStatus||i.pageStatus,statusThreshold:l.statusThreshold?.trim()?l.statusThreshold:i.statusThreshold,pageComment:l.pageComment?.trim()?l.pageComment:i.pageComment},c({...r,config:{...r.config,items:s}})},Ze=()=>{if(!r)return;const e=r.config.items.map(s=>{const l=F(s),o=s.pageTemplate||"summary",n=ae(o);return{...s,pageTemplate:o,titleOverride:s.titleOverride?.trim()?s.titleOverride:l,pageStatus:s.pageStatus||n.pageStatus,statusThreshold:s.statusThreshold?.trim()?s.statusThreshold:n.statusThreshold,pageComment:s.pageComment?.trim()?s.pageComment:n.pageComment}});c({...r,config:{...r.config,items:e}})},et=e=>new Promise((s,l)=>{const o=new FileReader;o.onload=()=>s(String(o.result||"")),o.onerror=()=>l(new Error("Failed to read file")),o.readAsDataURL(e)}),tt=async e=>{const s=e.target.files?.[0];if(!(!s||!r))try{const l=await et(s);D(null),await c({...r,config:{...r.config,coverLogoUrl:l}})}catch{await y.error(a("reports.logo_upload_failed","Logo upload failed."))}finally{e.target.value=""}},c=async e=>{if(g)return;const s=typeof e.category=="string"&&e.category.trim().length>0?e.category.trim():x,l={...e,category:s};pe(o=>{const n=o.findIndex(i=>i.id===l.id);if(n>=0){const i=[...o];return i[n]=l,i}return[l,...o]}),Y.current=Y.current.catch(()=>{}).then(async()=>{await P.saveReportPack({...l,category:s})}),await Y.current},oe=async e=>{const s=Array.from(new Set(e.map(l=>l.trim()).filter(l=>l.length>0)));q(s),await B.set(w,JSON.stringify(s))},_e=async e=>{await B.set(Q,JSON.stringify(e))},Ce=()=>{const e=localStorage.getItem("reports_default_author")||"LiteBI Studio",s=localStorage.getItem("reports_default_theme_color")||"#1e293b",l=localStorage.getItem("reports_default_show_header"),o=localStorage.getItem("reports_default_show_footer"),n=localStorage.getItem("reports_default_include_audit_appendix"),i=T===j?x:T,d={id:crypto.randomUUID(),name:a("reports.new_pack_name"),category:i,description:"",config:{coverTitle:a("reports.new_pack_name"),coverSubtitle:new Date().toLocaleDateString(void 0,{month:"long",year:"numeric"}),author:e,coverLogoUrl:"",themeColor:s,showTOC:!0,exportOptions:{showHeader:l===null?!0:l==="true",showFooter:o===null?!0:o==="true",headerText:"",footerText:"",footerMode:"content_only",dataAsOf:"",includeAuditAppendix:n===null?!1:n==="true"},items:[]}};c(d),m(d.id),S(i)},Pe=async()=>{g||!ee||(N.includes(E)||await oe([...A,E]),S(E),W(!1),L(""))},at=async e=>{if(g||e===x)return;const l=(await y.prompt(a("reports.rename_category_prompt","New category name:"),{defaultValue:e}))?.trim();if(!l||l===e)return;if(N.some(i=>i.toLowerCase()===l.toLowerCase()&&i!==e)){await y.warning(a("reports.category_exists","A category with this name already exists."));return}const n=u.filter(i=>(i.category||x)===e);await Promise.all(n.map(i=>P.saveReportPack({...i,category:l}))),await oe(A.map(i=>i===e?l:i)),$===e&&S(l),await R()},st=async e=>{if(g||e===x)return;const s=u.filter(n=>(n.category||x)===e),l=s.length;(l===0?await y.confirm(a("reports.delete_category_confirm","Delete this category?")):await y.confirm(a("reports.delete_category_with_packs_confirm",{count:l,category:e,defaultValue:`Delete category "${e}" and all ${l} report packages in it?`})))&&(l>0&&(await Promise.all(s.map(n=>P.deleteReportPack(n.id))),C&&s.some(n=>n.id===C)&&m(null)),await oe(A.filter(n=>n!==e)),$===e&&S(j),await R())},rt=async e=>{g||await y.confirm(a("common.confirm_delete"))&&(await P.deleteReportPack(e),await R(),C===e&&m(null))},ot=e=>{K(s=>{const l={...s,[e]:!s[e]};return _e(l),l})},J=e=>{K(s=>{const l={...s};return u.forEach(o=>{l[o.id]=e}),_e(l),l})},lt=e=>{m(e),G(!0)},nt=e=>{m(e),V(!0)},Se=(e,s,l)=>{const o=te(e);if(!o)return;const n=[...o.config.items],i=l==="up"?s-1:s+1;i<0||i>=n.length||([n[s],n[i]]=[n[i],n[s]],c({...o,config:{...o.config,items:n}}))},it=(e,s)=>{const l=te(e);if(!l)return;const o=l.config.items.filter((n,i)=>i!==s);c({...l,config:{...l.config,items:o}})},Oe=e=>{r&&(c({...r,config:{...r.config,items:[...r.config.items,e]}}),G(!1))},dt=async(e,s)=>{g||(await c({...e,category:s}),ue(null))},le=e=>{const s=[];return{exportItems:e.config.items.map(o=>{if(o.type==="dashboard"){const d=k?.find(H=>H.id===o.id),f=d?.name||"Dashboard";return(Array.isArray(d?.layout)?d.layout||[]:[]).forEach(H=>{const Te=typeof H?.id=="string"?H.id:"";if(!Te)return;const ne=h?.find(ht=>ht.id===Te);ne?.sql_query&&s.push({source:`${f} / ${ne.name}`,sql:ne.sql_query})}),{elementId:`export-dash-${o.id}`,title:o.titleOverride||f,subtitle:o.pageComment||"",status:o.pageStatus,threshold:o.statusThreshold||"",orientation:o.orientation||"landscape"}}const n=h?.find(d=>d.id===o.id),i=n?.name||"Widget";return n?.sql_query&&s.push({source:i,sql:n.sql_query}),{elementId:`export-widget-${o.id}`,title:o.titleOverride||i,subtitle:o.pageComment||"",status:o.pageStatus,threshold:o.statusThreshold||"",orientation:o.orientation||"landscape"}}),auditMeta:{packName:e.name,generatedAt:new Date().toISOString(),dataAsOf:e.config.exportOptions?.dataAsOf,sqlSources:s}}},ct=async e=>{m(e.id),await new Promise(o=>requestAnimationFrame(()=>o()));const{exportItems:s,auditMeta:l}=le(e);await Qe(e.name,s,{title:e.config.coverTitle,subtitle:e.config.coverSubtitle,author:e.config.author,logoUrl:e.config.coverLogoUrl?.trim(),themeColor:e.config.themeColor},e.config.exportOptions,l)},pt=async e=>{m(e.id),await new Promise(o=>requestAnimationFrame(()=>o()));const{exportItems:s,auditMeta:l}=le(e);await We(e.name,s,{title:e.config.coverTitle,subtitle:e.config.coverSubtitle,author:e.config.author,logoUrl:e.config.coverLogoUrl?.trim(),themeColor:e.config.themeColor},e.config.exportOptions,l)},xt=async e=>{m(e.id),await new Promise(o=>requestAnimationFrame(()=>o()));const{exportItems:s,auditMeta:l}=le(e);await Ke(e.name,s,{title:e.config.coverTitle,subtitle:e.config.coverSubtitle,author:e.config.author,logoUrl:e.config.coverLogoUrl?.trim(),themeColor:e.config.themeColor},e.config.exportOptions,l)},gt=e=>{const s={type:"litebi-report-pack",version:1,exportedAt:new Date().toISOString(),pack:e},l=new Blob([JSON.stringify(s,null,2)],{type:"application/json;charset=utf-8"}),o=document.createElement("a"),n=(e.name||"report-pack").trim().replace(/[<>:"/\\|?*]/g,"_");o.download=`${n||"report-pack"}.litebi-report-pack.json`,o.href=URL.createObjectURL(l),o.click(),URL.revokeObjectURL(o.href)},ut=e=>{Z(e),X.current?.click()},mt=()=>{Z(null),X.current?.click()},bt=async e=>{const s=e.target.files?.[0];if(e.target.value="",!!s)try{const l=await s.text(),o=JSON.parse(l),n=o&&typeof o=="object"&&"pack"in o?o.pack:o;if(!n||typeof n!="object")throw new Error("Invalid JSON structure");const i=n;if(!i.name||!i.config||!Array.isArray(i.config.items))throw new Error("Invalid report package payload");const d=be?te(be):void 0;if(d)if(await y.confirm(a("reports.import_overwrite_confirm",{name:d.name,defaultValue:`Replace "${d.name}" with the imported definition?`}))){const v={...i,id:d.id,category:d.category||x};await c(v),m(d.id)}else{const v={...i,id:crypto.randomUUID(),category:d.category||x,name:`${i.name} (Import)`};await c(v),m(v.id)}else{const f={...i,id:crypto.randomUUID(),category:i.category||x};await c(f),m(f.id)}await y.info(a("reports.import_success","Report package was imported successfully."))}catch{await y.error(a("reports.import_failed","Import failed. Invalid report package JSON."))}finally{Z(null)}};return t.jsxs(yt,{header:{title:a("reports.title","Reporting"),subtitle:a("reports.subtitle","Build and export multi-page management reports."),actions:t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("button",{onClick:Ce,disabled:g,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-sm font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx(ie,{className:"w-4 h-4"})," ",a("common.add")]})})},rightPanel:{title:a("reports.panel_title","Reporting Assistant"),triggerTitle:a("reports.panel_title","Reporting Assistant"),enabled:!0,width:"md",isOpen:Be,onOpenChange:he,content:t.jsxs("div",{className:"h-full min-h-0 flex flex-col gap-4",children:[t.jsxs("section",{className:"rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50/60 dark:bg-slate-900/40 p-3 space-y-3",children:[t.jsx("div",{className:"text-[10px] font-black uppercase tracking-wider text-slate-400",children:a("reports.panel_overview","Overview")}),t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("div",{className:"rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-2",children:[t.jsx("div",{className:"text-[10px] text-slate-400",children:a("reports.panel_metric_packs","Packs")}),t.jsx("div",{className:"text-sm font-bold text-slate-800 dark:text-slate-100",children:u.length})]}),t.jsxs("div",{className:"rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-2",children:[t.jsx("div",{className:"text-[10px] text-slate-400",children:a("reports.panel_metric_pages","Pages")}),t.jsx("div",{className:"text-sm font-bold text-slate-800 dark:text-slate-100",children:Xe})]}),t.jsxs("div",{className:"rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-2",children:[t.jsx("div",{className:"text-[10px] text-slate-400",children:a("reports.panel_metric_issues","Issues")}),t.jsx("div",{className:`text-sm font-bold ${Ne>0?"text-amber-600 dark:text-amber-300":"text-emerald-600 dark:text-emerald-300"}`,children:Ne})]})]})]}),t.jsxs("section",{className:"rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50/60 dark:bg-slate-900/40 p-3 space-y-2",children:[t.jsx("div",{className:"text-[10px] font-black uppercase tracking-wider text-slate-400",children:a("reports.panel_quick_actions","Quick Actions")}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("button",{type:"button",onClick:()=>{Ce(),he(!1)},disabled:g,className:"px-2 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-xs font-semibold text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800 disabled:opacity-40",children:a("reports.panel_action_new_pack","New Pack")}),t.jsx("button",{type:"button",onClick:mt,disabled:g,className:"px-2 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-xs font-semibold text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800 disabled:opacity-40",children:a("reports.panel_action_import_json","Import JSON")}),t.jsx("button",{type:"button",onClick:()=>J(!0),className:"px-2 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-xs font-semibold text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800",children:a("reports.panel_action_expand_all","Expand all")}),t.jsx("button",{type:"button",onClick:()=>J(!1),className:"px-2 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-xs font-semibold text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800",children:a("reports.panel_action_collapse_all","Collapse all")})]})]}),t.jsxs("section",{className:"rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50/60 dark:bg-slate-900/40 p-3 space-y-2 min-h-0 flex-1 flex flex-col",children:[t.jsx("div",{className:"text-[10px] font-black uppercase tracking-wider text-slate-400",children:a("reports.panel_quality_global","Quality (Global)")}),t.jsx("div",{className:"min-h-0 overflow-auto custom-scrollbar space-y-2 pr-1",children:re.length===0?t.jsx("div",{className:"text-xs text-slate-400",children:a("common.no_data","No data")}):re.slice(0,8).map(e=>t.jsxs("div",{className:"w-full text-left p-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 opacity-80",children:[t.jsx("div",{className:"text-xs font-semibold text-slate-700 dark:text-slate-200 truncate",children:e.name}),t.jsxs("div",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:[e.pageCount," ",a("reports.pages","Pages")," · ",e.issues," ",a("reports.panel_metric_issues","Issues")]})]},e.id))})]})]})},children:[t.jsxs("div",{className:`h-[calc(100vh-140px)] overflow-y-auto custom-scrollbar p-1 ${g?"pointer-events-none opacity-80":""}`,children:[t.jsxs("div",{className:"space-y-5",children:[t.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 dark:border-slate-800",children:[t.jsxs("div",{className:"flex items-center gap-1 overflow-x-auto no-scrollbar pb-px",children:[t.jsx("button",{onClick:()=>S(j),className:`px-4 py-2.5 text-sm font-bold transition-all border-b-2 whitespace-nowrap ${T===j?"text-blue-600 border-blue-600":"text-slate-400 border-transparent hover:text-slate-600"}`,children:a("common.all","All")}),N.map(e=>t.jsx("button",{onClick:()=>S(e),className:`px-4 py-2.5 text-sm font-bold transition-all border-b-2 whitespace-nowrap ${T===e?"text-blue-600 border-blue-600":"text-slate-400 border-transparent hover:text-slate-600"}`,children:e},e)),!g&&t.jsx("button",{onClick:()=>{W(!0),L("")},className:"px-4 py-2.5 text-slate-400 hover:text-blue-600 transition-all border-b-2 border-transparent",title:a("reports.new_category","New category"),children:t.jsx(ie,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>J(!0),className:"p-2 text-slate-400 hover:text-slate-600",title:a("reports.expand_all_packs","Expand all reports"),children:t.jsx(Nt,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>J(!1),className:"p-2 text-slate-400 hover:text-slate-600",title:a("reports.collapse_all_packs","Collapse all reports"),children:t.jsx(_t,{className:"w-4 h-4"})}),!g&&t.jsx("button",{onClick:()=>ge(!0),className:"p-2 text-slate-400 hover:text-slate-600",title:a("reports.manage_categories","Manage categories"),children:t.jsx(Re,{className:"w-4 h-4"})})]})]}),Le&&t.jsxs("div",{className:"mb-1 p-4 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-xl flex items-center gap-3",children:[t.jsx(z,{className:"w-5 h-5 text-slate-400"}),t.jsx("input",{autoFocus:!0,type:"text",placeholder:a("reports.new_category_placeholder","Category name (e.g. Management)"),className:"flex-1 bg-transparent border-none outline-none font-bold text-slate-700 dark:text-slate-200",value:xe,onChange:e=>L(e.target.value),onKeyDown:e=>e.key==="Enter"&&void Pe()}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>{Pe()},disabled:!ee,className:`p-1.5 rounded transition-colors ${ee?"text-green-600 hover:bg-green-50":"text-slate-300 cursor-not-allowed"}`,children:t.jsx(Ct,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{W(!1),L("")},className:"p-1.5 text-slate-400 hover:bg-slate-100 rounded",children:t.jsx(Pt,{className:"w-4 h-4"})})]})]}),ye.map(e=>{const s=Ue[e.id]??!0,l=C===e.id,o=e.category||x,n=N.filter(i=>i!==o);return t.jsxs("section",{className:`bg-white dark:bg-slate-900 border rounded-2xl shadow-sm transition-all ${l?"border-blue-200 dark:border-blue-800":"border-slate-200 dark:border-slate-800"}`,children:[t.jsxs("div",{className:"flex items-center justify-between p-4",children:[t.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[t.jsx("button",{onClick:()=>ot(e.id),className:"p-1 text-slate-400 hover:text-blue-600 rounded transition-colors",title:s?a("common.collapse","Collapse"):a("common.expand","Expand"),children:t.jsx(_,{className:`w-4 h-4 transition-transform ${s?"rotate-90":""}`})}),t.jsx("button",{onClick:()=>m(e.id),className:"w-10 h-10 bg-blue-50 dark:bg-blue-900/20 rounded-xl flex items-center justify-center text-blue-600 shrink-0",title:a("reports.pack_settings","Package Settings"),children:t.jsx(St,{className:"w-5 h-5"})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("h3",{className:"font-bold text-slate-800 dark:text-white leading-tight truncate",children:e.name}),t.jsxs("p",{className:"text-xs text-slate-400",children:[e.category||x," | ",e.config.items.length," ",a("reports.pages","Pages")]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[!g&&t.jsxs("div",{className:"relative",children:[t.jsx("button",{onClick:()=>ue(i=>i===e.id?null:e.id),disabled:n.length===0,className:"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors disabled:opacity-30 disabled:hover:text-slate-400 disabled:hover:bg-transparent",title:n.length===0?a("reports.move_category_unavailable","No other category available"):a("reports.move_category","Move to category"),children:t.jsx(Ot,{className:"w-4 h-4"})}),He===e.id&&n.length>0&&t.jsx("div",{className:"absolute right-0 top-10 z-20 min-w-[170px] rounded-xl border border-slate-200 bg-white shadow-lg p-1",children:n.map(i=>t.jsx("button",{onClick:()=>{dt(e,i)},className:"w-full text-left px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 rounded-lg transition-colors",children:i},`${e.id}-move-${i}`))})]}),!g&&t.jsxs("button",{onClick:()=>lt(e.id),className:"flex items-center gap-2 px-2 sm:px-3 py-2 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-500 dark:text-slate-300 hover:text-blue-600 hover:border-blue-200 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors font-bold text-sm",title:a("reports.add_page","Add Page"),"aria-label":a("reports.add_page","Add Page"),children:[t.jsx(ie,{className:"w-4 h-4"}),t.jsx("span",{className:"hidden sm:inline",children:a("reports.add_page","Add Page")})]}),!g&&t.jsx("button",{onClick:()=>nt(e.id),className:"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:a("common.settings"),children:t.jsx(Re,{className:"w-5 h-5"})}),!g&&t.jsx("button",{onClick:()=>rt(e.id),className:"p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:a("common.delete"),children:t.jsx(de,{className:"w-4 h-4"})}),t.jsxs("div",{className:"inline-flex items-center rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-1",children:[t.jsx("button",{onClick:()=>ct(e),disabled:O||e.config.items.length===0,className:"p-2 text-slate-500 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:O&&l?`${fe}%`:`${a("reports.export_batch")} (.pdf)`,"aria-label":O&&l?`${fe}%`:`${a("reports.export_batch")} (.pdf)`,children:t.jsx(Tt,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{xt(e)},disabled:O||e.config.items.length===0,className:"p-2 text-slate-500 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:`${a("reports.export_ppt","Export PPT")} (.ppt)`,"aria-label":`${a("reports.export_ppt","Export PPT")} (.ppt)`,children:t.jsx(It,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{pt(e)},disabled:O||e.config.items.length===0,className:"p-2 text-slate-500 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:`${a("reports.export_html","Export HTML")} (.html)`,"aria-label":`${a("reports.export_html","Export HTML")} (.html)`,children:t.jsx(At,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"inline-flex items-center rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-1",children:[t.jsx("button",{onClick:()=>gt(e),disabled:O,className:"p-2 text-slate-500 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:`${a("reports.export_json","Export JSON")} (.json)`,"aria-label":`${a("reports.export_json","Export JSON")} (.json)`,children:t.jsx(qt,{className:"w-4 h-4"})}),!g&&t.jsx("button",{onClick:()=>ut(e.id),className:"p-2 text-slate-500 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-md transition-colors",title:`${a("reports.import_json","Import JSON")} (.json)`,"aria-label":`${a("reports.import_json","Import JSON")} (.json)`,children:t.jsx($t,{className:"w-4 h-4"})})]})]})]}),s&&t.jsx("div",{className:"px-4 pb-4",children:e.config.items.length>0?t.jsx("div",{className:"space-y-3",children:e.config.items.map((i,d)=>{const f=i.type==="dashboard"?k?.find(v=>v.id===i.id):h?.find(v=>v.id===i.id);return f?t.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-50/70 dark:bg-slate-800/40 border border-slate-100 dark:border-slate-800 rounded-xl group hover:shadow-sm transition-all",children:[t.jsxs("div",{className:"flex flex-col gap-1 items-center",children:[t.jsx("button",{onClick:()=>Se(e.id,d,"up"),className:"text-slate-300 hover:text-blue-500 disabled:opacity-0",disabled:d===0,children:t.jsx(Rt,{className:"w-3.5 h-3.5"})}),t.jsx("div",{className:"w-6 h-6 bg-white dark:bg-slate-900 rounded flex items-center justify-center text-[10px] font-black text-slate-400",children:d+1}),t.jsx("button",{onClick:()=>Se(e.id,d,"down"),className:"text-slate-300 hover:text-blue-500 disabled:opacity-0",disabled:d===e.config.items.length-1,children:t.jsx(Et,{className:"w-3.5 h-3.5"})})]}),t.jsx("div",{className:"w-10 h-10 bg-slate-100 dark:bg-slate-800 rounded-lg flex items-center justify-center",children:i.type==="dashboard"?t.jsx(z,{className:"w-5 h-5 text-slate-400"}):t.jsx(Ee,{className:"w-5 h-5 text-slate-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-bold text-slate-700 dark:text-slate-200 truncate",children:f.name}),t.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:i.type})]}),t.jsx("button",{onClick:()=>it(e.id,d),className:"p-2 text-slate-200 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all",children:t.jsx(de,{className:"w-4 h-4"})})]},d):null})}):t.jsx("div",{className:"text-center py-8 border border-dashed border-slate-200 dark:border-slate-700 rounded-xl text-slate-400 text-sm",children:a("reports.add_page","Add Page")})})]},e.id)}),u.length===0&&t.jsxs("div",{className:"text-center py-16 border-2 border-dashed border-slate-100 dark:border-slate-800 rounded-2xl",children:[t.jsx(ce,{className:"w-10 h-10 mx-auto mb-3 text-slate-200"}),t.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-300",children:a("reports.no_packages")})]}),u.length>0&&ye.length===0&&t.jsxs("div",{className:"text-center py-16 border-2 border-dashed border-slate-100 dark:border-slate-800 rounded-2xl",children:[t.jsx(ce,{className:"w-10 h-10 mx-auto mb-3 text-slate-200"}),t.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-300",children:a("reports.no_packages_in_category","No packages in this category yet.")})]})]}),t.jsx("div",{className:"fixed -left-[10000px] top-0 opacity-0 pointer-events-none w-[1400px]",children:r?.config.items.map((e,s)=>{if(e.type==="dashboard"){const n=k?.find(i=>i.id===e.id);return n?t.jsxs("div",{id:`export-dash-${e.id}`,className:"bg-white p-10 min-h-[1000px]",children:[t.jsxs("div",{className:"mb-10 flex items-center justify-between border-b pb-4",children:[t.jsx("h1",{className:"text-3xl font-black text-slate-800",children:n.name}),t.jsxs("span",{className:"text-sm text-slate-400 font-mono",children:[a("reports.page")," ",s+1]})]}),t.jsx("div",{className:"grid grid-cols-2 gap-10",children:Array.isArray(n.layout)&&n.layout.map(i=>{const d=h?.find(v=>v.id===i.id);if(!d)return null;const f=ke(d.visualization_config);return t.jsx("div",{className:"h-[400px]",children:t.jsx($e,{title:d.name,sql:d.sql_query,config:f})},i.id)})})]},`ghost-dash-${s}`):null}const l=h?.find(n=>n.id===e.id);if(!l)return null;const o=ke(l.visualization_config);return t.jsx("div",{id:`export-widget-${e.id}`,className:"bg-white p-10 min-h-[1000px] flex flex-col items-center justify-center",children:t.jsx("div",{className:"w-full max-w-4xl h-[600px]",children:t.jsx($e,{title:l.name,sql:l.sql_query,config:o})})},`ghost-widget-${s}`)})}),t.jsx("input",{ref:X,type:"file",accept:".json,application/json",className:"hidden",onChange:e=>{bt(e)}})]}),t.jsx(wt,{isOpen:Fe,onClose:()=>V(!1),title:a("reports.pack_settings","Package Settings"),width:"md",noScroll:!0,children:r&&t.jsxs("div",{className:"flex h-full min-h-0 flex-col",children:[t.jsxs("div",{className:"flex-1 min-h-0 overflow-auto pr-1 space-y-6",children:[t.jsxs("section",{className:"space-y-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/40 p-3",children:[t.jsxs("button",{type:"button",onClick:()=>I("general"),className:"w-full flex items-center justify-between text-left rounded-lg px-1 py-1 hover:bg-slate-100/70 dark:hover:bg-slate-800/70",children:[t.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400 tracking-wider cursor-pointer",children:a("reports.general")}),t.jsx(_,{className:`w-4 h-4 text-slate-400 transition-transform ${b.general?"rotate-90":""}`})]}),b.general&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("input",{className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl font-bold text-slate-900 dark:text-slate-100 placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-blue-500",value:r.name,onChange:e=>c({...r,name:e.target.value}),placeholder:a("reports.pack_name_placeholder")}),t.jsx("input",{className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl font-medium text-slate-900 dark:text-slate-100 placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-blue-500",value:r.category||x,onChange:e=>c({...r,category:e.target.value}),placeholder:a("reports.category","Category")})]})]}),t.jsxs("section",{className:"space-y-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/40 p-3",children:[t.jsxs("button",{type:"button",onClick:()=>I("quality"),className:"w-full flex items-center justify-between text-left rounded-lg px-1 py-1 hover:bg-slate-100/70 dark:hover:bg-slate-800/70",children:[t.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400 tracking-wider cursor-pointer",children:a("reports.quality","Quality")}),t.jsx(_,{className:`w-4 h-4 text-slate-400 transition-transform ${b.quality?"rotate-90":""}`})]}),b.quality&&t.jsxs("div",{className:"space-y-3 p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-300",children:se===0?a("reports.quality_all_good","All pages look good."):a("reports.quality_issues_count",{count:se,defaultValue:"{{count}} quality issues found."})}),t.jsx("button",{type:"button",onClick:Ze,disabled:se===0,className:"px-2 py-1.5 rounded text-xs font-semibold border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800 disabled:opacity-40",children:a("reports.quality_fix_all","Fix all")})]}),t.jsx("div",{className:"space-y-2 max-h-56 overflow-auto custom-scrollbar pr-1",children:je.map(e=>t.jsxs("div",{className:"p-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900",children:[t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("div",{className:"text-xs font-semibold text-slate-700 dark:text-slate-200 truncate",children:[e.index+1,". ",e.name]}),t.jsx("button",{type:"button",onClick:()=>Ye(e.index),disabled:e.issues.length===0,className:"px-2 py-1 rounded text-[11px] font-semibold border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 disabled:opacity-40",children:a("reports.quality_fix","Fix")})]}),e.issues.length>0?t.jsx("ul",{className:"mt-2 space-y-1",children:e.issues.map((s,l)=>t.jsxs("li",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:["• ",s]},`${e.index}-${l}`))}):t.jsx("div",{className:"mt-2 text-[11px] text-emerald-600 dark:text-emerald-300",children:a("reports.quality_row_ok","No issues")})]},`quality-${e.index}`))})]})]}),t.jsxs("section",{className:"space-y-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/40 p-3",children:[t.jsxs("button",{type:"button",onClick:()=>I("cover"),className:"w-full flex items-center justify-between text-left rounded-lg px-1 py-1 hover:bg-slate-100/70 dark:hover:bg-slate-800/70",children:[t.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400 tracking-wider cursor-pointer",children:a("reports.cover_page")}),t.jsx(_,{className:`w-4 h-4 text-slate-400 transition-transform ${b.cover?"rotate-90":""}`})]}),b.cover&&t.jsxs("div",{className:"space-y-3 p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-bold text-slate-500 dark:text-slate-400",children:[t.jsx(ce,{className:"w-3 h-3"})," ",a("reports.title_label")]}),t.jsx("input",{className:"w-full bg-white dark:bg-slate-900 px-3 py-1.5 rounded-lg text-sm text-slate-900 dark:text-slate-100 border border-slate-100 dark:border-slate-700 placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-blue-500/50",value:r.config.coverTitle,onChange:e=>c({...r,config:{...r.config,coverTitle:e.target.value}})})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-bold text-slate-500 dark:text-slate-400",children:[t.jsx(_,{className:"w-3 h-3"})," ",a("reports.subtitle_label")]}),t.jsx("input",{className:"w-full bg-white dark:bg-slate-900 px-3 py-1.5 rounded-lg text-sm text-slate-900 dark:text-slate-100 border border-slate-100 dark:border-slate-700 placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-blue-500/50",value:r.config.coverSubtitle||"",onChange:e=>c({...r,config:{...r.config,coverSubtitle:e.target.value}})})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-bold text-slate-500 dark:text-slate-400",children:[t.jsx(Lt,{className:"w-3 h-3"})," ",a("reports.author")]}),t.jsx("input",{className:"w-full bg-white dark:bg-slate-900 px-3 py-1.5 rounded-lg text-sm text-slate-900 dark:text-slate-100 border border-slate-100 dark:border-slate-700 placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-blue-500/50",value:r.config.author||"",onChange:e=>c({...r,config:{...r.config,author:e.target.value}})})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"flex items-center gap-2 text-[11px] font-bold text-slate-500 dark:text-slate-400",children:a("reports.logo_url","Logo URL")}),t.jsx("input",{className:"w-full bg-white dark:bg-slate-900 px-3 py-1.5 rounded-lg text-sm text-slate-900 dark:text-slate-100 border border-slate-100 dark:border-slate-700 placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-blue-500/50",value:r.config.coverLogoUrl||"",onChange:e=>{D(null),c({...r,config:{...r.config,coverLogoUrl:e.target.value}})},placeholder:"https://..."}),t.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[t.jsx("input",{ref:me,type:"file",accept:"image/*",className:"hidden",onChange:e=>{tt(e)}}),t.jsx("button",{type:"button",onClick:()=>me.current?.click(),className:"px-2.5 py-1.5 rounded-lg text-xs font-semibold border border-slate-200 dark:border-slate-700 bg-slate-100 dark:bg-slate-900 hover:bg-slate-200 dark:hover:bg-slate-800 text-slate-700 dark:text-slate-200 transition-colors",children:a("reports.upload_logo","Upload logo")}),!!r.config.coverLogoUrl&&t.jsx("button",{type:"button",onClick:()=>{D(null),c({...r,config:{...r.config,coverLogoUrl:""}})},className:"px-2.5 py-1.5 rounded-lg text-xs font-semibold border border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 dark:text-red-300 transition-colors",children:a("common.remove","Remove")})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"flex items-center gap-2 text-[11px] font-bold text-slate-500 dark:text-slate-400",children:a("reports.theme_color","Theme Color")}),t.jsx("input",{type:"color",className:"w-full h-9 bg-white dark:bg-slate-900 px-1 py-1 rounded-lg border border-slate-100 dark:border-slate-700 outline-none",value:r.config.themeColor||"#1e293b",onChange:e=>c({...r,config:{...r.config,themeColor:e.target.value}})})]})]})]}),t.jsxs("section",{className:"space-y-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/40 p-3",children:[t.jsxs("button",{type:"button",onClick:()=>I("headerFooter"),className:"w-full flex items-center justify-between text-left rounded-lg px-1 py-1 hover:bg-slate-100/70 dark:hover:bg-slate-800/70",children:[t.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400 tracking-wider cursor-pointer",children:a("reports.export_options","Header / Footer")}),t.jsx(_,{className:`w-4 h-4 text-slate-400 transition-transform ${b.headerFooter?"rotate-90":""}`})]}),b.headerFooter&&t.jsxs("div",{className:"space-y-3 p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("label",{className:"flex items-center gap-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:[t.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-blue-600 dark:text-blue-400 accent-blue-600 dark:accent-blue-500 focus:ring-blue-500/50",checked:r.config.exportOptions?.showHeader??!0,onChange:e=>c({...r,config:{...r.config,exportOptions:{...r.config.exportOptions||{},showHeader:e.target.checked}}})}),a("reports.show_header","Show header")]}),t.jsxs("label",{className:"flex items-center gap-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:[t.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-blue-600 dark:text-blue-400 accent-blue-600 dark:accent-blue-500 focus:ring-blue-500/50",checked:r.config.exportOptions?.showFooter??!0,onChange:e=>c({...r,config:{...r.config,exportOptions:{...r.config.exportOptions||{},showFooter:e.target.checked}}})}),a("reports.show_footer","Show footer")]})]}),t.jsx("input",{className:"w-full bg-white dark:bg-slate-900 px-3 py-1.5 rounded-lg text-sm text-slate-900 dark:text-slate-100 border border-slate-100 dark:border-slate-700 placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-blue-500/50",value:r.config.exportOptions?.headerText||"",onChange:e=>c({...r,config:{...r.config,exportOptions:{...r.config.exportOptions||{},headerText:e.target.value}}}),placeholder:a("reports.header_text","Header text (optional)")}),t.jsx("input",{className:"w-full bg-white dark:bg-slate-900 px-3 py-1.5 rounded-lg text-sm text-slate-900 dark:text-slate-100 border border-slate-100 dark:border-slate-700 placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-blue-500/50",value:r.config.exportOptions?.footerText||"",onChange:e=>c({...r,config:{...r.config,exportOptions:{...r.config.exportOptions||{},footerText:e.target.value}}}),placeholder:a("reports.footer_text","Footer text (optional)")}),t.jsx("input",{className:"w-full bg-white dark:bg-slate-900 px-3 py-1.5 rounded-lg text-sm text-slate-900 dark:text-slate-100 border border-slate-100 dark:border-slate-700 placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-blue-500/50",value:r.config.exportOptions?.dataAsOf||"",onChange:e=>c({...r,config:{...r.config,exportOptions:{...r.config.exportOptions||{},dataAsOf:e.target.value}}}),placeholder:a("reports.data_as_of","Data as of")}),t.jsxs("label",{className:"flex items-center gap-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:[t.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-blue-600 dark:text-blue-400 accent-blue-600 dark:accent-blue-500 focus:ring-blue-500/50",checked:r.config.exportOptions?.includeAuditAppendix??!1,onChange:e=>c({...r,config:{...r.config,exportOptions:{...r.config.exportOptions||{},includeAuditAppendix:e.target.checked}}})}),a("reports.include_audit_appendix","Include audit appendix (SQL sources)")]})]})]}),t.jsxs("section",{className:"space-y-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/40 p-3",children:[t.jsxs("button",{type:"button",onClick:()=>I("pageOptions"),className:"w-full flex items-center justify-between text-left rounded-lg px-1 py-1 hover:bg-slate-100/70 dark:hover:bg-slate-800/70",children:[t.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400 tracking-wider cursor-pointer",children:a("reports.page_options","Per-Page Options")}),t.jsx(_,{className:`w-4 h-4 text-slate-400 transition-transform ${b.pageOptions?"rotate-90":""}`})]}),b.pageOptions&&t.jsxs("div",{className:"space-y-2 p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl",children:[r.config.items.length===0&&t.jsx("p",{className:"text-xs text-slate-400",children:a("reports.no_pages","No pages in this package yet.")}),r.config.items.map((e,s)=>{const l=e.type==="dashboard"?k?.find(o=>o.id===e.id):h?.find(o=>o.id===e.id);return l?t.jsxs("div",{className:"p-3 bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-700 rounded-xl space-y-2",children:[t.jsxs("div",{className:"text-xs font-bold text-slate-700 dark:text-slate-200",children:[s+1,". ",l.name]}),t.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] gap-2",children:[t.jsxs("select",{className:"w-full bg-slate-50 dark:bg-slate-800 px-2 py-1.5 rounded text-xs text-slate-900 dark:text-slate-100 border border-slate-200 dark:border-slate-700 outline-none focus:ring-2 focus:ring-blue-500/50",value:e.pageTemplate||"",onChange:o=>{const n=[...r.config.items];n[s]={...e,pageTemplate:o.target.value||void 0},c({...r,config:{...r.config,items:n}})},children:[t.jsx("option",{value:"",children:a("reports.template_none","No template")}),t.jsx("option",{value:"summary",children:a("reports.template_summary","Management Summary")}),t.jsx("option",{value:"kpi",children:a("reports.template_kpi","KPI Page")}),t.jsx("option",{value:"detail",children:a("reports.template_detail","Detail Page")})]}),t.jsx("button",{type:"button",disabled:!e.pageTemplate,onClick:()=>{e.pageTemplate&&Ge(s,e.pageTemplate,l.name)},className:"px-2 py-1.5 rounded text-xs font-semibold border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 disabled:opacity-40",children:a("common.apply","Apply")})]}),t.jsx("input",{className:"w-full bg-slate-50 dark:bg-slate-800 px-2 py-1.5 rounded text-xs text-slate-900 dark:text-slate-100 border border-slate-200 dark:border-slate-700 placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-blue-500/50",value:e.titleOverride||"",onChange:o=>{const n=[...r.config.items];n[s]={...e,titleOverride:o.target.value},c({...r,config:{...r.config,items:n}})},placeholder:a("reports.page_title_override","Page title override (optional)")}),t.jsxs("select",{className:"w-full bg-slate-50 dark:bg-slate-800 px-2 py-1.5 rounded text-xs text-slate-900 dark:text-slate-100 border border-slate-200 dark:border-slate-700 outline-none focus:ring-2 focus:ring-blue-500/50",value:e.orientation||"landscape",onChange:o=>{const n=[...r.config.items];n[s]={...e,orientation:o.target.value},c({...r,config:{...r.config,items:n}})},children:[t.jsx("option",{value:"landscape",children:a("reports.landscape","Landscape")}),t.jsx("option",{value:"portrait",children:a("reports.portrait","Portrait")})]}),t.jsxs("select",{className:"w-full bg-slate-50 dark:bg-slate-800 px-2 py-1.5 rounded text-xs text-slate-900 dark:text-slate-100 border border-slate-200 dark:border-slate-700 outline-none focus:ring-2 focus:ring-blue-500/50",value:e.pageStatus||"info",onChange:o=>{const n=[...r.config.items];n[s]={...e,pageStatus:o.target.value},c({...r,config:{...r.config,items:n}})},children:[t.jsx("option",{value:"info",children:a("reports.status_info","Info")}),t.jsx("option",{value:"ok",children:a("reports.status_ok","OK")}),t.jsx("option",{value:"warning",children:a("reports.status_warning","Warning")}),t.jsx("option",{value:"critical",children:a("reports.status_critical","Critical")})]}),t.jsx("input",{className:"w-full bg-slate-50 dark:bg-slate-800 px-2 py-1.5 rounded text-xs text-slate-900 dark:text-slate-100 border border-slate-200 dark:border-slate-700 placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-blue-500/50",value:e.statusThreshold||"",onChange:o=>{const n=[...r.config.items];n[s]={...e,statusThreshold:o.target.value},c({...r,config:{...r.config,items:n}})},placeholder:a("reports.status_threshold","Threshold / target note")}),t.jsx("textarea",{className:"w-full min-h-[58px] bg-slate-50 dark:bg-slate-800 px-2 py-1.5 rounded text-xs text-slate-900 dark:text-slate-100 border border-slate-200 dark:border-slate-700 placeholder:text-slate-400 dark:placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-blue-500/50",value:e.pageComment||"",onChange:o=>{const n=[...r.config.items];n[s]={...e,pageComment:o.target.value},c({...r,config:{...r.config,items:n}})},placeholder:a("reports.page_comment","Page comment (analysis note)")})]},`${e.id}-${s}`):null})]})]}),t.jsxs("section",{className:"space-y-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/40 p-3",children:[t.jsxs("button",{type:"button",onClick:()=>I("preview"),className:"w-full flex items-center justify-between text-left rounded-lg px-1 py-1 hover:bg-slate-100/70 dark:hover:bg-slate-800/70",children:[t.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400 tracking-wider cursor-pointer",children:a("reports.preview","Live Preview")}),t.jsx(_,{className:`w-4 h-4 text-slate-400 transition-transform ${b.preview?"rotate-90":""}`})]}),b.preview&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"rounded-2xl border border-slate-200 dark:border-slate-700 overflow-hidden shadow-sm",children:[t.jsxs("div",{className:"h-36 px-4 py-3 flex flex-col justify-between",style:{backgroundColor:r.config.themeColor||"#1e293b"},children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsx("div",{className:"text-white text-sm font-black truncate",children:r.config.coverTitle||a("reports.title_label")}),U&&Je!==U?t.jsx("img",{src:U,alt:"Logo preview",className:"w-10 h-10 object-contain rounded bg-white/80 p-1",referrerPolicy:"no-referrer",onError:()=>D(U)}):t.jsx("div",{className:"w-10 h-10 rounded bg-white/20 border border-white/30"})]}),t.jsx("div",{className:"text-xs text-slate-200",children:r.config.coverSubtitle||a("reports.subtitle_label")})]}),t.jsx("div",{className:"px-4 py-2 bg-white dark:bg-slate-900 border-t border-slate-100 dark:border-slate-800 text-[11px] text-slate-500",children:r.config.author||a("reports.author")})]}),t.jsxs("div",{className:"rounded-2xl border border-slate-200 dark:border-slate-700 overflow-hidden shadow-sm bg-white dark:bg-slate-900",children:[t.jsx("div",{className:"px-4 py-2 text-[10px] font-black uppercase tracking-wider text-slate-400 border-b border-slate-100 dark:border-slate-800",children:a("reports.content_page_preview","Content Page Preview")}),t.jsxs("div",{className:"p-4 space-y-3",children:[t.jsx("div",{className:`text-[11px] text-slate-500 ${r.config.exportOptions?.showHeader===!1?"opacity-30":""}`,children:r.config.exportOptions?.headerText||r.name||a("reports.header_text","Header text")}),!!r.config.items[0]&&t.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-slate-600 dark:text-slate-300",children:[t.jsx("span",{className:"px-2 py-0.5 rounded-full border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800",children:(r.config.items[0].pageStatus||"info").toUpperCase()}),r.config.items[0].statusThreshold&&t.jsx("span",{children:r.config.items[0].statusThreshold})]}),!!r.config.items[0]?.pageComment&&t.jsx("div",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:r.config.items[0].pageComment}),t.jsx("div",{className:"h-16 rounded border border-dashed border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 flex items-center justify-center text-xs text-slate-400",children:a("reports.page_content","Page content")}),t.jsxs("div",{className:`flex items-center justify-between text-[11px] text-slate-500 ${r.config.exportOptions?.showFooter===!1?"opacity-30":""}`,children:[t.jsx("span",{children:r.config.exportOptions?.footerText||a("reports.footer_text","Footer text")}),t.jsxs("span",{children:["1 / ",Math.max(1,r.config.items.length)]})]})]})]})]})]})]}),t.jsx("div",{className:"mt-4 -mx-5 -mb-5 px-5 py-3 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-950/90",children:t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{onClick:()=>V(!1),className:"px-6 py-2 rounded-xl font-bold text-sm bg-blue-600 hover:bg-blue-700 text-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500/60",children:a("common.done","Done")})})})]})}),t.jsx(qe,{isOpen:Me,onClose:()=>G(!1),title:a("reports.pick_content","Add Page"),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-400 mb-2",children:a("dashboard.dashboards")}),t.jsx("div",{className:"grid grid-cols-1 gap-1.5",children:k?.map(e=>t.jsxs("button",{onClick:()=>Oe({type:"dashboard",id:e.id}),className:"flex items-center gap-3 p-3 text-left bg-slate-50 dark:bg-slate-800 hover:bg-blue-50 dark:hover:bg-blue-900/40 rounded-xl transition-all border border-transparent hover:border-blue-200 group",children:[t.jsx(z,{className:"w-4 h-4 text-slate-400 group-hover:text-blue-500"}),t.jsx("span",{className:"text-sm font-bold text-slate-700 dark:text-slate-200",children:e.name})]},e.id))})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-400 mb-2",children:a("dashboard.reports")}),t.jsx("div",{className:"grid grid-cols-1 gap-1.5 max-h-[300px] overflow-y-auto custom-scrollbar",children:h?.map(e=>t.jsxs("button",{onClick:()=>Oe({type:"widget",id:e.id}),className:"flex items-center gap-3 p-3 text-left bg-slate-50 dark:bg-slate-800 hover:bg-blue-50 dark:hover:bg-blue-900/40 rounded-xl transition-all border border-transparent hover:border-blue-200 group",children:[t.jsx(Ee,{className:"w-4 h-4 text-slate-400 group-hover:text-blue-500"}),t.jsx("span",{className:"text-sm font-bold text-slate-700 dark:text-slate-200",children:e.name})]},e.id))})]})]})}),t.jsx(qe,{isOpen:De,onClose:()=>ge(!1),title:a("reports.manage_categories","Manage categories"),children:t.jsxs("div",{className:"space-y-3",children:[N.length===0&&t.jsx("div",{className:"text-center py-8 border border-dashed border-slate-200 dark:border-slate-700 rounded-xl text-slate-400 text-sm",children:a("reports.no_categories","No categories yet.")}),N.map(e=>{const s=e===x,l=u.filter(o=>(o.category||x)===e).length;return t.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg group",children:[t.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[t.jsx(z,{className:"w-4 h-4 text-slate-400 dark:text-slate-500 shrink-0"}),t.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-200 truncate",children:e}),s&&t.jsx("span",{className:"text-[10px] bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-200 px-1.5 py-0.5 rounded font-black uppercase tracking-wider",children:a("common.default","Default")}),t.jsxs("span",{className:"text-[10px] bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-300 px-1.5 py-0.5 rounded font-black uppercase tracking-wider",children:[l," ",a("reports.packages","packages")]})]}),!g&&t.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[t.jsx("button",{onClick:()=>{at(e)},disabled:s,className:"p-1.5 text-slate-400 dark:text-slate-500 hover:text-blue-600 dark:hover:text-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded disabled:opacity-30 disabled:hover:text-slate-400 dark:disabled:hover:text-slate-500 disabled:hover:bg-transparent",title:a("common.rename","Rename"),children:t.jsx(Dt,{className:"w-3.5 h-3.5"})}),t.jsx("button",{onClick:()=>{st(e)},disabled:s,className:"p-1.5 text-slate-400 dark:text-slate-500 hover:text-red-600 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20 rounded disabled:opacity-30 disabled:hover:text-slate-400 dark:disabled:hover:text-slate-500 disabled:hover:bg-transparent",title:s?a("reports.default_category_protected","Default category cannot be deleted"):l>0?a("reports.delete_with_content","Delete category and its report packages"):a("reports.delete_empty_category","Delete empty category"),children:t.jsx(de,{className:"w-3.5 h-3.5"})})]})]},e)})]})})]})};export{Yt as ReportPackView,Yt as default};
