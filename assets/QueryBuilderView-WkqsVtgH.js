import{u as jr,a as F,d as _r,e as Mt,S as we,b as Ne,j as e,P as wr,c as Nr}from"./index-7LPLAlBg.js";import{r as d}from"./vendor-react-D64xOC9_.js";import{H as Kt,t as f,E as Dt,s as qr,a as Sr,b as Cr,R as Ar}from"./index-DH9lOnbO.js";import{u as Tr,f as w,M as Lr,P as zr}from"./MarkdownContent-CAlm1i0z.js";import{D as $t}from"./DataTable-BpNqlfh8.js";import{R as Wr}from"./RecordDetailModal-BSkdUzn9.js";import{ad as L,ae as ct,af as Vt,m as Pe,ag as Ee,ah as Ot,ai as Ft,aj as Le,$ as Re,g as dt,ak as Mr,u as Bt,X as qe,o as Kr,al as It,P as Pt,a0 as Dr}from"./vendor-icons-Du2dXQHa.js";import{R as $r,B as Br,C as Se,X as Ce,Y as Ae,T as ie,L as ne,a as Et,b as Te,c as Ir,d as Rt,A as Pr,e as Er,P as Rr,f as Ur,g as Vr,h as Or,i as Fr,j as Qr,k as Gr,l as Hr,m as Yr,S as Zr,n as Xr}from"./vendor-charts-BtQqxQq4.js";import"./vendor-pdf-FXkUb51H.js";import"./vendor-ui-BNe0Xlio.js";import"./vendor-canvas-DXEQVQnt.js";import"./SchemaDocumentation-CqOaykNn.js";const Ut="",y=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d"],Jr=Nr("QueryBuilderView"),ot=new Set(["text","markdown","status","section","kpi_manual","image"]),ea=[{id:"table",icon:Re,labelKey:"querybuilder.table",fallback:"Table"},{id:"bar",icon:Le,labelKey:"querybuilder.bar",fallback:"Bar"},{id:"line",icon:Ft,labelKey:"querybuilder.line",fallback:"Line"},{id:"area",icon:L,labelKey:"querybuilder.area",fallback:"Area"},{id:"pie",icon:L,labelKey:"querybuilder.pie",fallback:"Pie"},{id:"kpi",icon:L,labelKey:"querybuilder.kpi",fallback:"KPI"},{id:"composed",icon:L,labelKey:"querybuilder.composed",fallback:"Composed"},{id:"radar",icon:L,labelKey:"querybuilder.radar",fallback:"Radar"},{id:"scatter",icon:L,labelKey:"querybuilder.scatter",fallback:"Scatter"},{id:"pivot",icon:L,labelKey:"querybuilder.pivot",fallback:"Pivot"}],ta=[{id:"text",icon:Ot,labelKey:"querybuilder.text",fallback:"Text"},{id:"markdown",icon:Ee,labelKey:"querybuilder.markdown",fallback:"Markdown"},{id:"status",icon:Pe,labelKey:"querybuilder.status",fallback:"Status"},{id:"section",icon:L,labelKey:"querybuilder.section",fallback:"Section"},{id:"kpi_manual",icon:Vt,labelKey:"querybuilder.kpi_manual",fallback:"KPI Manual"},{id:"image",icon:ct,labelKey:"querybuilder.image",fallback:"Image"}],me=a=>a.replace(/\s+/g," ").trim().toLowerCase(),ra=384,ma=()=>{const{t:a}=jr(),[S,W]=d.useState(Ut),[u,D]=d.useState([]),[Ue,M]=d.useState(""),[de,ut]=d.useState(!1),[Qt,K]=d.useState(""),[Gt,Ht]=d.useState(0),[oe,he]=d.useState("graphic"),[ze,Ve]=d.useState(""),[We,Oe]=d.useState("sql"),[Yt,j]=d.useState("source"),[N,ge]=d.useState("none"),[Me,Zt]=d.useState(!1),[k,C]=d.useState(1),[xt,fe]=F("query_builder_config",void 0),[c,z]=d.useState("table"),[r,o]=d.useState({type:"table",color:"#3b82f6"}),[_,R]=d.useState(null),[U,$]=d.useState(""),[Fe,Xt]=d.useState(""),[Qe,Jt]=d.useState(""),[ce,V]=d.useState(""),[er,bt]=d.useState(!1),[tr,Ge]=d.useState(!1),[rr,pt]=d.useState(0),[ar,lr]=d.useState(null),[mt]=F("sql_editor_syntax_highlighting",!0),[ht]=F("sql_editor_line_wrap",!0),[gt]=F("sql_editor_line_numbers",!1),[ft]=F("sql_editor_font_size",14),[kt]=F("sql_editor_tab_size",4),[ke]=F("sql_editor_theme_intensity","normal"),[Ke]=F("sql_editor_preview_highlighting",!0),[q,sr]=d.useState(typeof document<"u"&&document.documentElement.classList.contains("dark")),{isExporting:He,exportToPdf:ir}=Tr(),{togglePresentationMode:nr,isReadOnly:Q}=_r(),{data:ue,refresh:Ye}=Mt(async()=>await we.getUserWidgets(),[]),{data:B}=Mt(async()=>await we.listSqlStatements("global"),[]);d.useEffect(()=>{lr(null)},[]),d.useEffect(()=>{bt(!1)},[r.imageUrl]),d.useEffect(()=>{const t=document.documentElement,l=()=>sr(t.classList.contains("dark"));l();const s=new MutationObserver(l);return s.observe(t,{attributes:!0,attributeFilter:["class"]}),()=>s.disconnect()},[]);const yt=d.useMemo(()=>q?Kt.define([{tag:f.keyword,color:"#60a5fa",fontWeight:"700"},{tag:[f.string,f.special(f.string)],color:"#fbbf24"},{tag:[f.number,f.float],color:"#34d399"},{tag:[f.comment,f.lineComment,f.blockComment],color:"#94a3b8",fontStyle:"italic"},{tag:[f.propertyName,f.attributeName],color:"#7dd3fc"},{tag:f.operator,color:"#c084fc"}]):Kt.define([{tag:f.keyword,color:"#1d4ed8",fontWeight:"700"},{tag:[f.string,f.special(f.string)],color:"#b45309"},{tag:[f.number,f.float],color:"#059669"},{tag:[f.comment,f.lineComment,f.blockComment],color:"#64748b",fontStyle:"italic"},{tag:[f.propertyName,f.attributeName],color:"#0284c7"},{tag:f.operator,color:"#7c3aed"}]),[q]),vt=d.useMemo(()=>{const t=ke==="subtle"?"rgba(96, 165, 250, 0.08)":ke==="high"?"rgba(96, 165, 250, 0.18)":"rgba(96, 165, 250, 0.12)",l=ke==="subtle"?"rgba(59, 130, 246, 0.05)":ke==="high"?"rgba(59, 130, 246, 0.14)":"rgba(59, 130, 246, 0.08)";return Dt.theme({"&":{height:"100%",fontSize:`${Math.max(12,Math.min(15,ft))}px`,borderRadius:"0.5rem"},".cm-editor":{backgroundColor:q?"#0b1220":"#f8fafc",color:q?"#e2e8f0":"#0f172a"},".cm-scroller":{overflow:"auto",backgroundColor:q?"#0b1220":"#f8fafc",fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace'},".cm-content":{padding:"0.75rem"},".cm-activeLine":{backgroundColor:q?t:l},".cm-focused":{outline:"none"},".cm-gutters":{backgroundColor:"transparent",border:"none"},".cm-cursor, .cm-dropCursor":{borderLeftColor:"transparent"}},{dark:q})},[q,ft,ke]),dr=d.useMemo(()=>{const t=[qr(),vt,Sr.tabSize.of(Math.max(2,Math.min(4,kt)))];return Ke&&mt&&t.push(Cr(yt)),ht&&t.push(Dt.lineWrapping),t},[ht,Ke,mt,kt,yt,vt]),ye=d.useCallback(t=>JSON.stringify({sql:(t?.currentSql??S).trim(),builderMode:t?.currentBuilderMode??We,queryConfig:t?.currentQueryConfig??xt??null,visType:t?.currentVisType??c,visConfig:t?.currentVisConfig??r,widgetName:(t?.currentWidgetName??U).trim(),activeWidgetId:t?.currentActiveWidgetId??_}),[S,We,xt,c,r,U,_]),G=d.useCallback(async t=>{ut(!0),M("");try{const l=t||S,s=await we.executeRaw(l);if(D(s),K(l),s.length>0){const i=Object.keys(s[0]).filter(m=>typeof s[0][m]=="number"),b=Object.keys(s[0]).filter(m=>typeof s[0][m]=="string");r.xAxis||o(m=>({...m,xAxis:b[0]||Object.keys(s[0])[0],yAxes:m.yAxes?.length?m.yAxes:i.length>0?[i[0]]:[]}))}return!0}catch(l){return M(l instanceof Error?l.message:String(l)),!1}finally{ut(!1)}},[S,r.xAxis]),jt=(t,l=!0)=>{let s={type:"table",color:"#3b82f6"},i="table",b="sql",m;const h=t.sql_statement_id?(B||[]).find(n=>n.id===t.sql_statement_id):void 0,v=(h?.sql_text||t.sql_query||"").trim()||Ut;R(t.id),$(t.name),W(v);const P=(B||[]).find(n=>me(n.sql_text)===me(v));V(h?.id||P?.id||""),K(""),D([]),M(""),he("graphic"),fe(void 0),Oe("sql"),z("table"),o({type:"table",color:"#3b82f6"});try{const n=JSON.parse(t.visualization_config),x=n.type==="kpu_manual"?"kpi_manual":n.type;s={...n,type:x||"table",kpiTitle:n.kpiTitle??n.kpuTitle??"",kpiValue:n.kpiValue??n.kpuValue??"",kpiUnit:n.kpiUnit??n.kpuUnit??"",kpiTarget:n.kpiTarget??n.kpuTarget??"",kpiTrend:n.kpiTrend??n.kpuTrend??"flat",kpiAlign:n.kpiAlign??n.kpuAlign??"left",kpiNote:n.kpiNote??n.kpuNote??""},i=x||"table",z(i),o(s),b="sql",t.visual_builder_config?m=JSON.parse(t.visual_builder_config):m=void 0,Oe(b),fe(void 0)}catch(n){Jr.error("Error parsing widget config",n)}l&&j("source"),i==="text"||i==="markdown"||i==="status"||i==="section"||i==="kpi_manual"||i==="image"?(W(""),K(""),Oe("sql"),fe(void 0),l&&(C(3),j("visual"))):(W(v),setTimeout(()=>G(v),100),l&&(C(3),j("visual"))),Ve(ye({currentSql:i==="text"||i==="markdown"||i==="status"||i==="section"||i==="kpi_manual"||i==="image"?"":v,currentBuilderMode:b,currentQueryConfig:i==="text"||i==="markdown"||i==="status"||i==="section"||i==="kpi_manual"||i==="image"?void 0:m,currentVisType:i,currentVisConfig:s,currentWidgetName:t.name,currentActiveWidgetId:t.id}))},Ze=d.useCallback(async(t="update")=>{if(Q)return;const l=ot.has(c),s=t==="new";let i=s?crypto.randomUUID():_||crypto.randomUUID();const b=(ue||[]).find(x=>x.id===i),m=await Ne.prompt2(a("querybuilder.archive_name"),a("common.description","Description"),{title:a(_?"querybuilder.update_title":"querybuilder.save_title"),defaultValue:(U||b?.name||"").trim(),secondDefaultValue:(b?.description||"").trim(),placeholder:a("querybuilder.archive_placeholder"),secondPlaceholder:a("querybuilder.widget_description_placeholder","Short context or note (optional)")});if(!m)return;const h=m.value.trim();if(!h)return;const v=m.secondValue.trim(),P=h.toLowerCase(),n=(ue||[]).find(x=>x.id!==i&&x.name.trim().toLowerCase()===P);if(n){if(!await Ne.confirm(a("querybuilder.confirm_overwrite_widget_name",{name:h,defaultValue:`Ein Widget mit dem Namen "${h}" existiert bereits. Ueberschreiben?`})))return;i=n.id}try{const x=(B||[]).find(nt=>nt.id===ce),pe=l?"":S.trim(),it=!l&&x&&me(x.sql_text)===me(pe)?x.id:null,E={id:i,name:h,description:v,sql_statement_id:it,sql_query:pe,visualization_config:{...r,type:c},visual_builder_config:null};await we.saveUserWidget(E),Ye(),R(E.id),$(E.name),Ve(ye({currentSql:E.sql_query,currentBuilderMode:We,currentQueryConfig:void 0,currentVisType:c,currentVisConfig:{...r,type:c},currentWidgetName:E.name,currentActiveWidgetId:E.id})),C(1),j("source"),ge("widget"),he("graphic")}catch(x){await Ne.error(a("querybuilder.error_save")+(x instanceof Error?x.message:String(x)));return}await Ne.info(a(s?"querybuilder.success_save":"querybuilder.success_update"))},[_,We,ye,Q,Ye,ue,ce,S,B,a,r,c,U]),_t=async t=>{if(Q)return;(!(localStorage.getItem("notifications_confirm_destructive")!=="false")||await Ne.confirm(a("dashboard.confirm_delete_report")))&&(await we.deleteUserWidget(t),Ye(),_===t&&(R(null),$("")))},wt=d.useMemo(()=>u.length===0?[]:Object.keys(u[0]).map(t=>({header:t,accessor:t,render:l=>w(l[t],t)})),[u]),ve=d.useCallback(t=>{try{const s=JSON.parse(t.visualization_config).type||"table";return s==="kpu_manual"?"kpi_manual":s}catch{return"table"}},[]),O=d.useMemo(()=>{const t=ue||[],l=Fe.trim().toLowerCase(),s=l?t.filter(m=>m.name.toLowerCase().includes(l)||(m.sql_query||"").toLowerCase().includes(l)):t,i=s.filter(m=>!ot.has(ve(m))),b=s.filter(m=>ot.has(ve(m)));return{queryBased:i,nonData:b}},[ue,Fe,ve]),Xe=d.useMemo(()=>{const t=B||[],l=Qe.trim().toLowerCase();return l?t.filter(s=>s.name.toLowerCase().includes(l)||s.sql_text.toLowerCase().includes(l)||(s.description||"").toLowerCase().includes(l)):t},[B,Qe]),Je=d.useMemo(()=>(B||[]).find(t=>t.id===ce),[B,ce]),A=d.useMemo(()=>!!(Je&&me(Je.sql_text)===me(S)),[Je,S]),H=d.useMemo(()=>u.length>0?Object.keys(u[0]):[],[u]),T=d.useMemo(()=>u.length===0?[]:H.filter(t=>u.some(l=>l[t]!==null&&l[t]!==void 0&&typeof l[t]=="number")),[u,H]),De=c==="text",Y=c==="markdown",Z=c==="status",X=c==="section",J=c==="kpi_manual",ee=c==="image",p=De||Y||Z||X||J||ee,te=r.xAxis||"",re=(r.yAxes||[])[0]||"",et=d.useMemo(()=>c!=="scatter"||!te||!re?[]:u.map(t=>{const l=Number(t[te]),s=Number(t[re]);return{...t,[te]:l,[re]:s}}).filter(t=>Number.isFinite(t[te])&&Number.isFinite(t[re])),[u,te,re,c]),g=k===2&&!p?"table":c,tt=!p&&S.trim().length>0,Nt=g!=="table"&&g!=="pivot"&&g!=="text"&&g!=="markdown"&&g!=="status"&&g!=="section"&&g!=="kpi_manual"&&g!=="image",qt=p||u.length>0,St=He||!p&&u.length===0,xe=!qt||Q||!p&&!A,rt=Q?a("common.read_only"):qt?!p&&!A?a("querybuilder.hint_select_sql_statement_before_save","Bitte ein SQL-Statement aus dem SQL-Manager auswaehlen."):"":a("querybuilder.hint_run_query_before_save"),or=He?a("common.exporting"):!p&&u.length===0?a("querybuilder.hint_run_query_before_export"):"",cr=N==="none"?!0:N==="query"?A:!!_,$e=p||A,je=p||u.length>0&&!Ue&&Qt.trim()===S.trim(),I=d.useMemo(()=>{if(!A)return p?Y?!!(r.markdownContent||"").trim():Z?!!((r.statusTitle||"").trim()||(r.statusMessage||"").trim()):X?!!((r.sectionTitle||"").trim()||(r.sectionSubtitle||"").trim()):J?!!((r.kpiTitle||"").trim()||(r.kpiValue||"").trim()):ee?!!(r.imageUrl||"").trim():!!(r.textContent||"").trim():!1;if(De)return!!(r.textContent||"").trim();if(Y)return!!(r.markdownContent||"").trim();if(Z)return!!((r.statusTitle||"").trim()||(r.statusMessage||"").trim());if(X)return!!((r.sectionTitle||"").trim()||(r.sectionSubtitle||"").trim());if(J)return!!((r.kpiTitle||"").trim()||(r.kpiValue||"").trim());if(ee)return!!(r.imageUrl||"").trim();if(c==="table"||c==="pivot")return!0;const t=!!r.xAxis,l=!!(r.yAxes&&r.yAxes.length>0);if(!t||!l)return!1;if(c==="scatter"){const i=T.includes(te),b=T.includes(re);return i&&b&&et.length>0}return c==="kpi"?u.length>0:u.some(i=>{const b=i[r.xAxis];return b==null||b===""?!1:(r.yAxes||[]).some(m=>{const h=i[m];return h!=null&&h!==""})})},[p,ee,J,Y,X,Z,De,c,r,T,et.length,te,re,u,A]),at=!p&&u.length>0&&g!=="table"&&g!=="pivot"&&!I,be=N==="none"?p&&I?4:3:N==="query"?A?je?I?4:3:2:1:_?p||je?I?4:3:2:1,ur=t=>p&&t===2?!1:t<=be,Ct=de||(k===1?!cr:k===2?p?!1:!$e||!je:k===3?!I:xe),xr=k>=4?a("querybuilder.finish"):a("querybuilder.next"),br=k===2&&!p,pr=de||(k===2?p||!$e:k!==3),mr=a(de?"common.loading":"querybuilder.step_run"),At=k===1?N==="query"&&!A?a("querybuilder.hint_select_sql_statement_for_widget","Bitte zuerst ein SQL-Statement im SQL-Manager auswaehlen."):N==="widget"&&!_?a("querybuilder.mode_open_select","Waehle ein bestehendes Widget aus der Liste."):"":k===2?A?je?"":a("querybuilder.hint_run_query_before_continue","Bitte die Abfrage zuerst ausfuehren."):a("querybuilder.hint_select_sql_statement_for_widget","Bitte zuerst ein SQL-Statement im SQL-Manager auswaehlen."):k===3&&!I?a("querybuilder.hint_configure_visualization_before_continue","Bitte Visualisierung konfigurieren, um fortzufahren."):k===4&&xe?rt:"",_e=Yt,Tt=be>=3,Lt=be>=4,lt=d.useMemo(()=>ye(),[ye]),zt=ze.length>0&&lt!==ze,hr=_?a("querybuilder.mode_widget_edit","Widget aendern"):N==="none"?a("querybuilder.mode_new_text_without_data","Neues Widget erstellen (Text - Ohne Daten)"):a("querybuilder.mode_new_query_widget","Neues Widget erstellen (Abfrage)"),gr=d.useCallback(t=>{V(t.id),fe(void 0),W(t.sql_text),K(""),D([]),M("")},[fe]),st=d.useMemo(()=>{const t="w-5 h-5";switch(g){case"table":return{icon:e.jsx(Re,{className:t}),label:a("querybuilder.table")};case"bar":return{icon:e.jsx(Le,{className:t}),label:a("querybuilder.bar")};case"line":return{icon:e.jsx(Ft,{className:t}),label:a("querybuilder.line")};case"text":return{icon:e.jsx(Ot,{className:t}),label:a("querybuilder.text")};case"markdown":return{icon:e.jsx(Ee,{className:t}),label:a("querybuilder.markdown","Markdown")};case"status":return{icon:e.jsx(Pe,{className:t}),label:a("querybuilder.status","Status")};case"section":return{icon:e.jsx(L,{className:t}),label:a("querybuilder.section","Section")};case"kpi_manual":return{icon:e.jsx(Vt,{className:t}),label:a("querybuilder.kpi_manual","KPI Manual")};case"image":return{icon:e.jsx(ct,{className:t}),label:a("querybuilder.image","Image")};default:return{icon:e.jsx(L,{className:t}),label:g.toUpperCase()}}},[g,a]),fr=_?U.trim()||a("querybuilder.new_report"):a("querybuilder.preview_new_widget_title","Neues Widget ..."),ae={borderRadius:"12px",border:q?"1px solid #334155":"1px solid #e2e8f0",backgroundColor:q?"#0f172a":"#ffffff",boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.18)"},le={color:q?"#e2e8f0":"#0f172a",fontWeight:700,fontSize:"12px"},se={color:q?"#cbd5e1":"#334155",fontWeight:600,fontSize:"12px"},kr={fill:q?"rgba(148, 163, 184, 0.14)":"#f8fafc"},Be=(r.widgetDescription||"").trim(),Wt=r.widgetDescriptionPosition==="top"?"top":"bottom",Ie=t=>{ur(t)&&(C(t),t<=2&&j("source"),t===3&&j("visual"),t===4&&j("widget"))},yr=async()=>{if(k===1){if(N==="none"){z("table"),V(""),W(""),K(""),D([]),M(""),C(3),j("visual");return}if(N==="query"){if(!A||(z("table"),!await G()))return;C(3),j("visual");return}if(!_)return;if(p){C(3),j("visual");return}if(!await G())return;C(3),j("visual");return}if(k===2){if(p){Ie(3);return}if(!$e||!je)return;Ie(3);return}if(k===3){if(!I)return;Ie(4);return}k===4&&!xe&&await Ze("update")},vr=async()=>{if(k===2){if(p||!$e||de)return;await G();return}k===3&&Ht(t=>t+1)};return d.useEffect(()=>{ze||Ve(lt)},[ze,lt]),d.useEffect(()=>{const t=l=>{zt&&(l.preventDefault(),l.returnValue="")};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[zt]),d.useEffect(()=>{C(t=>t>be?be:t)},[be]),d.useEffect(()=>{if(c!=="scatter"||T.length===0)return;const t=r.xAxis||"",l=(r.yAxes||[])[0]||"",s=T.includes(t),i=T.includes(l);if(s&&i)return;const b=s?t:T[0],m=T[1]||T[0],h=i?l:m;o(v=>({...v,xAxis:b,yAxes:h?[h]:[]}))},[c,T,r.xAxis,r.yAxes]),d.useEffect(()=>{const t=l=>{if(!(l.ctrlKey||l.metaKey))return;const i=l.key.toLowerCase();i==="enter"&&(l.preventDefault(),de||G()),i==="s"&&(l.preventDefault(),xe||Ze("update"))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[de,xe,G,Ze]),e.jsxs(wr,{header:{title:a("sidebar.query_builder"),subtitle:a("querybuilder.subtitle"),actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:nr,className:"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors border border-transparent hover:border-blue-100",title:a("dashboard.presentation_mode"),children:e.jsx(It,{className:"w-5 h-5"})}),e.jsxs("button",{onClick:()=>ir("query-visualization",`report-${U||"query"}`),disabled:St,title:St?or:a("querybuilder.hint_export_shortcut"),className:"flex items-center gap-2 px-3 py-2 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors shadow-sm font-medium text-sm disabled:opacity-50",children:[e.jsx(Dr,{className:"w-4 h-4"}),a(He?"common.exporting":"common.export_pdf")]})]})},children:[e.jsx("div",{className:"flex flex-col gap-6 h-full min-h-0",children:e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-4 lg:gap-6 min-h-0 overflow-hidden relative",children:[e.jsx("div",{className:`${Me?"hidden":"w-full lg:w-96"} min-h-0 overflow-hidden transition-all duration-300`,children:e.jsxs("div",{className:"flex flex-col h-full max-h-[46vh] lg:max-h-none bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"border-b border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-900/50",children:e.jsx("div",{className:"p-3",children:e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-wider px-1",children:a("querybuilder.guided_panel")})})}),e.jsx("div",{className:"px-3 py-2 border-b border-slate-100 dark:border-slate-800 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsxs("button",{type:"button",onClick:()=>{j("source"),C(1)},className:`px-2 py-1.5 rounded text-[10px] font-bold border transition-colors flex items-center justify-center gap-1 ${_e==="source"?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700":"bg-white dark:bg-slate-900 text-slate-500 dark:text-slate-300 border-slate-200 dark:border-slate-700"}`,children:[e.jsx(dt,{className:"w-3 h-3"}),a("querybuilder.tab_source","Quelle")]}),e.jsxs("button",{type:"button",onClick:()=>Tt&&j("visual"),disabled:!Tt,className:`px-2 py-1.5 rounded text-[10px] font-bold border transition-colors flex items-center justify-center gap-1 ${_e==="visual"?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700":"bg-white dark:bg-slate-900 text-slate-500 dark:text-slate-300 border-slate-200 dark:border-slate-700"} disabled:opacity-40`,children:[e.jsx(Le,{className:"w-3 h-3"}),a("querybuilder.tab_visualization","Visualisierung")]}),e.jsxs("button",{type:"button",onClick:()=>Lt&&j("widget"),disabled:!Lt,className:`px-2 py-1.5 rounded text-[10px] font-bold border transition-colors flex items-center justify-center gap-1 ${_e==="widget"?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700":"bg-white dark:bg-slate-900 text-slate-500 dark:text-slate-300 border-slate-200 dark:border-slate-700"} disabled:opacity-40`,children:[e.jsx(Mr,{className:"w-3 h-3"}),a("querybuilder.tab_widget","Widget")]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar space-y-4",children:_e==="source"?e.jsxs("div",{className:"space-y-4",children:[k===1&&e.jsxs("div",{className:"rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950/30 overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 border-b border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/40",children:e.jsxs("div",{className:"inline-flex items-center rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-1",children:[e.jsx("button",{type:"button",onClick:()=>{ge("none"),R(null),$(""),V(""),W(""),K(""),D([]),M(""),z("table")},className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${N==="none"?"bg-blue-600 text-white":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:a("querybuilder.source_tab_none","Kein")}),e.jsx("button",{type:"button",onClick:()=>{ge("query"),R(null),$(""),V(""),W(""),K(""),D([]),M(""),z("table")},className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${N==="query"?"bg-blue-600 text-white":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:a("querybuilder.source_tab_query","Abfrage auswaehlen")}),e.jsx("button",{type:"button",onClick:()=>{ge("widget")},className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${N==="widget"?"bg-blue-600 text-white":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:a("querybuilder.source_tab_widget","Widget auswaehlen")})]})}),e.jsx("div",{className:"p-3",children:N==="none"?e.jsx("div",{className:"p-3 rounded-lg border border-dashed border-slate-200 dark:border-slate-700 text-[11px] text-slate-500 dark:text-slate-300",children:a("querybuilder.source_tab_none_hint","Ohne Datenabfrage oder Widget mit Weiter zum naechsten Schritt gehen.")}):N==="query"?e.jsxs("div",{className:"space-y-2 animate-in fade-in duration-300",children:[e.jsxs("h3",{className:"text-[10px] font-black uppercase text-slate-400 px-2 py-1 flex items-center justify-between",children:[a("querybuilder.sql_manager_source","SQL Manager Source"),e.jsxs("span",{className:"bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded text-[9px]",children:[Xe.length,"/",B?.length||0]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(dt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-400"}),e.jsx("input",{value:Qe,onChange:t=>Jt(t.target.value),placeholder:a("querybuilder.search_sql_statements","Search SQL statements..."),className:"w-full pl-8 pr-3 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-xs text-slate-700 dark:text-slate-200 outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"space-y-1 max-h-72 overflow-y-auto custom-scrollbar pr-1",children:[Xe.map(t=>e.jsxs("button",{type:"button",onClick:()=>{if(ce===t.id){V(""),W(""),K(""),D([]),M(""),z("table");return}ge("query"),R(null),$(""),gr(t),z("table"),G(t.sql_text)},className:`w-full text-left p-2.5 rounded-lg border transition-all ${ce===t.id?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700":"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800 hover:border-blue-200 dark:hover:border-blue-700"}`,children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 dark:text-slate-200 truncate",children:t.name}),e.jsx("div",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-mono truncate",children:t.sql_text})]},t.id)),Xe.length===0&&e.jsx("div",{className:"p-3 rounded-lg border border-dashed border-slate-200 dark:border-slate-700 text-[11px] text-slate-400 text-center",children:a("querybuilder.no_sql_statements","No SQL statements found.")})]}),e.jsx("p",{className:"text-[10px] text-slate-500 px-1",children:a("querybuilder.new_without_query_hint","Ohne Auswahl und mit Klick auf Weiter wird ein neues Text-Widget ohne Datenabfrage erstellt.")})]}):e.jsxs("div",{className:"space-y-2 animate-in fade-in duration-300",children:[e.jsxs("h3",{className:"text-[10px] font-black uppercase text-slate-400 px-2 py-1 flex items-center justify-between",children:[a("querybuilder.saved_reports"),e.jsxs("span",{className:"bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded text-[9px]",children:[O.queryBased.length+O.nonData.length,"/",ue?.length||0]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(dt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-400"}),e.jsx("input",{value:Fe,onChange:t=>Xt(t.target.value),placeholder:a("querybuilder.search_saved_reports","Search saved widgets..."),className:"w-full pl-8 pr-3 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-xs text-slate-700 dark:text-slate-200 outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"space-y-1 max-h-72 overflow-y-auto custom-scrollbar pr-1",children:[O.queryBased.length>0&&e.jsx("div",{className:"px-1 pt-1 pb-0.5 text-[10px] font-black uppercase tracking-wide text-slate-400",children:a("querybuilder.saved_reports_query_based","Abfragebasierte Widgets")}),O.queryBased.map(t=>e.jsxs("div",{className:`group p-2.5 rounded-lg border flex flex-col gap-1 transition-all cursor-pointer ${_===t.id?"bg-blue-50 border-blue-200 ring-1 ring-blue-100 dark:bg-blue-900/20 dark:border-blue-700 dark:ring-blue-800/60":"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800 hover:border-blue-200 dark:hover:border-blue-700"}`,onClick:()=>{if(_===t.id){R(null),$(""),V(""),W(""),K(""),D([]),M(""),z("table"),j("source"),C(1);return}jt(t,!1)},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-200 text-xs truncate",children:t.name}),!Q&&e.jsx("button",{onClick:l=>{l.stopPropagation(),_t(t.id)},className:"opacity-0 group-hover:opacity-100 p-1 text-slate-400 hover:text-red-500 rounded transition-all",children:e.jsx(Bt,{className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[9px]",children:[e.jsx("span",{className:"text-slate-400 truncate max-w-[150px] font-mono",children:t.sql_query||"-"}),e.jsx("span",{className:"ml-auto text-blue-400 flex items-center gap-1 font-bold italic",children:ve(t).toUpperCase()})]})]},t.id)),O.nonData.length>0&&e.jsx("div",{className:"px-1 pt-2 pb-0.5 text-[10px] font-black uppercase tracking-wide text-slate-400",children:a("querybuilder.saved_reports_non_data","Nicht-datenbasierte Widgets")}),O.nonData.map(t=>e.jsxs("div",{className:`group p-2.5 rounded-lg border flex flex-col gap-1 transition-all cursor-pointer ${_===t.id?"bg-blue-50 border-blue-200 ring-1 ring-blue-100 dark:bg-blue-900/20 dark:border-blue-700 dark:ring-blue-800/60":"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800 hover:border-blue-200 dark:hover:border-blue-700"}`,onClick:()=>{if(_===t.id){R(null),$(""),V(""),W(""),K(""),D([]),M(""),z("table"),j("source"),C(1);return}jt(t,!1)},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-200 text-xs truncate",children:t.name}),!Q&&e.jsx("button",{onClick:l=>{l.stopPropagation(),_t(t.id)},className:"opacity-0 group-hover:opacity-100 p-1 text-slate-400 hover:text-red-500 rounded transition-all",children:e.jsx(Bt,{className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[9px]",children:[e.jsx("span",{className:"text-slate-400 truncate max-w-[150px] font-mono",children:t.sql_query||"-"}),e.jsx("span",{className:"ml-auto text-blue-400 flex items-center gap-1 font-bold italic",children:ve(t).toUpperCase()})]})]},t.id)),O.queryBased.length===0&&O.nonData.length===0&&e.jsx("div",{className:"p-3 rounded-lg border border-dashed border-slate-200 text-[11px] text-slate-400 text-center",children:a("querybuilder.no_saved_reports_filtered","No matching widgets found.")})]})]})})]}),k===1?null:e.jsx("div",{className:"space-y-0",children:e.jsxs("div",{className:"rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950/30 overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2 border-b border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/40 flex items-center justify-between",children:[e.jsxs("div",{className:"text-[10px] font-bold uppercase tracking-wide text-slate-600 dark:text-slate-300",children:[e.jsx("span",{className:"font-mono",children:"SQL"})," ",a("querybuilder.direct_editor")]}),e.jsx("span",{className:"text-[10px] text-slate-500",children:a("common.read_only")})]}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400",children:a("querybuilder.sql_query")}),!p&&e.jsx("span",{className:"text-[10px] text-slate-500",children:a("querybuilder.widget_studio_sql_locked_hint","SQL-Auswahl erfolgt im Startschritt unter Neu.")})]}),e.jsx("textarea",{value:S,readOnly:!0,className:"w-full font-mono text-xs p-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-100 rounded-lg outline-none resize-none cursor-default",style:{height:`${ra}px`},placeholder:"SELECT * FROM..."})]})]})}),Ue&&e.jsxs("div",{className:"bg-red-50 text-red-600 text-[10px] p-3 rounded-lg border border-red-100 flex items-start gap-2 font-mono break-all",children:[e.jsx(Pe,{className:"w-3.5 h-3.5 flex-shrink-0 mt-0.5"}),Ue]})]}):_e==="visual"?e.jsxs("div",{className:"p-4 rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950/30 space-y-4 animate-in slide-in-from-right-4 duration-300",children:[e.jsxs("h3",{className:"text-xs font-black uppercase text-slate-400 flex items-center gap-2",children:[e.jsx(L,{className:"w-3.5 h-3.5 text-blue-500"}),a("querybuilder.graph_type")]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:(A?ea:ta).map(t=>e.jsxs("button",{onClick:()=>z(t.id),className:`p-2 rounded-lg flex flex-col items-center justify-center gap-1 border transition-all ${c===t.id?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 text-blue-600 shadow-sm":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-400 hover:border-slate-300"}`,children:[e.jsx(t.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-[9px] uppercase font-black",children:a(t.labelKey,t.fallback)})]},t.id))}),!A&&e.jsx("p",{className:"text-[10px] text-slate-500",children:a("querybuilder.visual_text_only_hint","Ohne ausgewaehlte Abfrage sind nur Text-, Markdown-, Status-, Section-, KPI-Manual- oder Image-Widgets verfuegbar.")}),c!=="table"&&c!=="pivot"&&c!=="text"&&c!=="markdown"&&c!=="status"&&c!=="section"&&c!=="kpi_manual"&&c!=="image"&&e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 px-3 py-2",children:[e.jsxs("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:[a("querybuilder.labels"),":"]}),e.jsx("button",{onClick:()=>o({...r,showLabels:!r.showLabels}),className:`px-2 py-0.5 rounded text-[10px] font-black uppercase transition-all ${r.showLabels?"bg-blue-600 text-white":"bg-slate-200 dark:bg-slate-700 text-slate-500 dark:text-slate-200"}`,children:r.showLabels?a("querybuilder.label_on"):a("querybuilder.label_off")})]}),Nt&&u.length>0&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.x_axis")}),e.jsxs("select",{value:r.xAxis||"",onChange:t=>o({...r,xAxis:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"",children:a("querybuilder.select_column")}),(c==="scatter"?T:H).map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.y_axes")}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:(r.yAxes||[]).map(t=>e.jsxs("span",{className:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-200 rounded text-[10px] font-bold flex items-center gap-1 border border-blue-200 dark:border-blue-700/60",children:[t,e.jsx("button",{onClick:()=>o({...r,yAxes:(r.yAxes||[]).filter(l=>l!==t)}),className:"text-blue-600 dark:text-blue-300 hover:text-blue-800 dark:hover:text-blue-100",children:e.jsx(qe,{className:"w-2.5 h-2.5"})})]},t))}),e.jsxs("select",{onChange:t=>{t.target.value&&(o({...r,yAxes:[...r.yAxes||[],t.target.value]}),t.target.value="")},className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"",children:a("querybuilder.add_y_axis")}),(c==="scatter"?T:H).filter(t=>!(r.yAxes||[]).includes(t)).map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),c==="text"&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.text_content")}),e.jsx("textarea",{value:r.textContent||"",onChange:t=>o({...r,textContent:t.target.value}),className:"w-full h-32 p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none resize-y",placeholder:a("querybuilder.text_placeholder")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.text_size")}),e.jsxs("select",{value:r.textSize||"md",onChange:t=>o({...r,textSize:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"sm",children:a("querybuilder.text_size_sm")}),e.jsx("option",{value:"md",children:a("querybuilder.text_size_md")}),e.jsx("option",{value:"lg",children:a("querybuilder.text_size_lg")}),e.jsx("option",{value:"xl",children:a("querybuilder.text_size_xl")}),e.jsx("option",{value:"2xl",children:a("querybuilder.text_size_2xl")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.text_align")}),e.jsxs("select",{value:r.textAlign||"left",onChange:t=>o({...r,textAlign:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"left",children:a("querybuilder.text_align_left")}),e.jsx("option",{value:"center",children:a("querybuilder.text_align_center")}),e.jsx("option",{value:"right",children:a("querybuilder.text_align_right")})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.text_style")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>o({...r,textBold:!r.textBold}),className:`px-2 py-1 rounded border text-[11px] font-bold ${r.textBold?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700 text-blue-700 dark:text-blue-200":"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-300"}`,children:a("querybuilder.text_bold")}),e.jsx("button",{onClick:()=>o({...r,textItalic:!r.textItalic}),className:`px-2 py-1 rounded border text-[11px] italic ${r.textItalic?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700 text-blue-700 dark:text-blue-200":"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-300"}`,children:a("querybuilder.text_italic")}),e.jsx("button",{onClick:()=>o({...r,textUnderline:!r.textUnderline}),className:`px-2 py-1 rounded border text-[11px] underline ${r.textUnderline?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700 text-blue-700 dark:text-blue-200":"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-300"}`,children:a("querybuilder.text_underline")})]})]})]}),c==="markdown"&&e.jsx("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.markdown_content","Markdown Inhalt")}),e.jsx("textarea",{value:r.markdownContent||"",onChange:t=>o({...r,markdownContent:t.target.value}),className:"w-full h-36 p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none resize-y font-mono",placeholder:a("querybuilder.markdown_placeholder",`# Titel
Text mit **Fett** und [Link](https://example.com)`)}),e.jsx("p",{className:"mt-1 text-[10px] text-slate-500",children:a("querybuilder.markdown_help","Unterstuetzt u. a. Ueberschriften, Listen, **Fett**, *Kursiv*, `Code` und Links.")})]})}),c==="status"&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.status_level","Status-Level")}),e.jsxs("select",{value:r.statusLevel||"ok",onChange:t=>o({...r,statusLevel:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"ok",children:a("querybuilder.status_level_ok","OK")}),e.jsx("option",{value:"info",children:a("querybuilder.status_level_info","Info")}),e.jsx("option",{value:"warning",children:a("querybuilder.status_level_warning","Warnung")}),e.jsx("option",{value:"critical",children:a("querybuilder.status_level_critical","Kritisch")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.status_title","Titel")}),e.jsx("input",{value:r.statusTitle||"",onChange:t=>o({...r,statusTitle:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:a("querybuilder.status_placeholder_title","Systemstatus")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.status_message","Nachricht")}),e.jsx("textarea",{value:r.statusMessage||"",onChange:t=>o({...r,statusMessage:t.target.value}),className:"w-full h-24 p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none resize-y",placeholder:a("querybuilder.status_placeholder_message","Alle Kernsysteme laufen stabil.")})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 px-3 py-2",children:[e.jsx("span",{className:"text-[10px] font-black text-slate-400 dark:text-slate-300 uppercase tracking-widest",children:a("querybuilder.status_pulse","Signal-Animation")}),e.jsx("button",{type:"button",onClick:()=>o({...r,statusPulse:!r.statusPulse}),className:`px-2 py-0.5 rounded text-[10px] font-black uppercase transition-all ${r.statusPulse?"bg-blue-600 text-white":"bg-slate-200 dark:bg-slate-700 text-slate-500 dark:text-slate-200"}`,children:r.statusPulse?a("querybuilder.label_on"):a("querybuilder.label_off")})]})]}),c==="section"&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.section_title","Ueberschrift")}),e.jsx("input",{value:r.sectionTitle||"",onChange:t=>o({...r,sectionTitle:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:a("querybuilder.section_placeholder_title","Abschnittstitel")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.section_subtitle","Untertitel")}),e.jsx("input",{value:r.sectionSubtitle||"",onChange:t=>o({...r,sectionSubtitle:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:a("querybuilder.section_placeholder_subtitle","Optionaler Hinweistext")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.section_align","Ausrichtung")}),e.jsxs("select",{value:r.sectionAlign||"left",onChange:t=>o({...r,sectionAlign:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"left",children:a("querybuilder.text_align_left")}),e.jsx("option",{value:"center",children:a("querybuilder.text_align_center")}),e.jsx("option",{value:"right",children:a("querybuilder.text_align_right")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.section_divider","Trennlinie")}),e.jsxs("select",{value:r.sectionDividerStyle||"line",onChange:t=>o({...r,sectionDividerStyle:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"line",children:a("querybuilder.section_divider_line","Linie")}),e.jsx("option",{value:"double",children:a("querybuilder.section_divider_double","Doppelt")}),e.jsx("option",{value:"none",children:a("querybuilder.section_divider_none","Keine")})]})]})]})]}),c==="kpi_manual"&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.kpi_title","Kennzahl-Titel")}),e.jsx("input",{value:r.kpiTitle||"",onChange:t=>o({...r,kpiTitle:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:a("querybuilder.kpi_placeholder_title","z. B. Verfuegbarkeit")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.kpi_value","Wert")}),e.jsx("input",{value:r.kpiValue||"",onChange:t=>o({...r,kpiValue:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:a("querybuilder.kpi_placeholder_value","99.9")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.kpi_unit","Einheit")}),e.jsx("input",{value:r.kpiUnit||"",onChange:t=>o({...r,kpiUnit:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:a("querybuilder.kpi_placeholder_unit","%")})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.kpi_target","Ziel")}),e.jsx("input",{value:r.kpiTarget||"",onChange:t=>o({...r,kpiTarget:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:a("querybuilder.kpi_placeholder_target","99.5")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.kpi_trend","Trend")}),e.jsxs("select",{value:r.kpiTrend||"flat",onChange:t=>o({...r,kpiTrend:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"up",children:a("querybuilder.kpi_trend_up","Steigend")}),e.jsx("option",{value:"flat",children:a("querybuilder.kpi_trend_flat","Stabil")}),e.jsx("option",{value:"down",children:a("querybuilder.kpi_trend_down","Fallend")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.text_align","Ausrichtung")}),e.jsxs("select",{value:r.kpiAlign||"left",onChange:t=>o({...r,kpiAlign:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"left",children:a("querybuilder.text_align_left","Links")}),e.jsx("option",{value:"center",children:a("querybuilder.text_align_center","Zentriert")}),e.jsx("option",{value:"right",children:a("querybuilder.text_align_right","Rechts")})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.kpi_note","Hinweis")}),e.jsx("textarea",{value:r.kpiNote||"",onChange:t=>o({...r,kpiNote:t.target.value}),className:"w-full h-20 p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none resize-y",placeholder:a("querybuilder.kpi_placeholder_note","Optionaler Kontext zur Kennzahl.")})]})]}),c==="image"&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.image_url","Bild-URL")}),e.jsx("input",{value:r.imageUrl||"",onChange:t=>o({...r,imageUrl:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:a("querybuilder.image_placeholder_url","https://...")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.image_alt","Alternativtext")}),e.jsx("input",{value:r.imageAlt||"",onChange:t=>o({...r,imageAlt:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:a("querybuilder.image_placeholder_alt","Beschreibung fuer Screenreader")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.image_fit","Darstellung")}),e.jsxs("select",{value:r.imageFit||"contain",onChange:t=>o({...r,imageFit:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"contain",children:a("querybuilder.image_fit_contain","Einpassen")}),e.jsx("option",{value:"cover",children:a("querybuilder.image_fit_cover","Ausfuellen")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.text_align","Ausrichtung")}),e.jsxs("select",{value:r.imageAlign||"center",onChange:t=>o({...r,imageAlign:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"left",children:a("querybuilder.text_align_left","Links")}),e.jsx("option",{value:"center",children:a("querybuilder.text_align_center","Zentriert")}),e.jsx("option",{value:"right",children:a("querybuilder.text_align_right","Rechts")})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.image_caption","Bildunterschrift")}),e.jsx("input",{value:r.imageCaption||"",onChange:t=>o({...r,imageCaption:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:a("querybuilder.image_placeholder_caption","Optional")})]})]}),c==="pivot"&&u.length>0&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.pivot_rows")}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:(r.pivotRows||[]).map(t=>e.jsxs("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px] font-bold flex items-center gap-1",children:[t,e.jsx("button",{onClick:()=>o({...r,pivotRows:(r.pivotRows||[]).filter(l=>l!==t)}),children:e.jsx(qe,{className:"w-2.5 h-2.5"})})]},t))}),e.jsxs("select",{onChange:t=>{t.target.value&&(o({...r,pivotRows:[...r.pivotRows||[],t.target.value]}),t.target.value="")},className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"",children:a("querybuilder.pivot_add_row")}),H.filter(t=>!(r.pivotRows||[]).includes(t)).map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.pivot_cols")}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:(r.pivotCols||[]).map(t=>e.jsxs("span",{className:"px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded text-[10px] font-bold flex items-center gap-1",children:[t,e.jsx("button",{onClick:()=>o({...r,pivotCols:(r.pivotCols||[]).filter(l=>l!==t)}),children:e.jsx(qe,{className:"w-2.5 h-2.5"})})]},t))}),e.jsxs("select",{onChange:t=>{t.target.value&&(o({...r,pivotCols:[...r.pivotCols||[],t.target.value]}),t.target.value="")},className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"",children:a("querybuilder.pivot_add_col")}),H.filter(t=>!(r.pivotCols||[]).includes(t)).map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-2",children:a("querybuilder.pivot_measures")}),e.jsxs("div",{className:"space-y-2",children:[(r.pivotMeasures||[]).map((t,l)=>e.jsxs("div",{className:"flex items-center gap-1 bg-slate-50 dark:bg-slate-800/50 p-2 rounded border border-slate-100",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-600 truncate flex-1",children:t.field}),e.jsxs("select",{value:t.agg,onChange:s=>{const i=[...r.pivotMeasures||[]],b=s.target.value;i[l]={...t,agg:b},o({...r,pivotMeasures:i})},className:"bg-transparent text-[10px] font-bold text-blue-600 outline-none",children:[e.jsx("option",{value:"sum",children:a("querybuilder.pivot_agg_sum")}),e.jsx("option",{value:"count",children:a("querybuilder.pivot_agg_count")}),e.jsx("option",{value:"avg",children:a("querybuilder.pivot_agg_avg")}),e.jsx("option",{value:"min",children:a("querybuilder.pivot_agg_min")}),e.jsx("option",{value:"max",children:a("querybuilder.pivot_agg_max")})]}),e.jsx("button",{onClick:()=>o({...r,pivotMeasures:(r.pivotMeasures||[]).filter((s,i)=>i!==l)}),className:"text-slate-300 hover:text-red-500",children:e.jsx(qe,{className:"w-3"})})]},l)),e.jsxs("select",{onChange:t=>{t.target.value&&(o({...r,pivotMeasures:[...r.pivotMeasures||[],{field:t.target.value,agg:"sum"}]}),t.target.value="")},className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"",children:a("querybuilder.pivot_add_measure")}),H.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]})]}),c==="kpi"&&u.length>0&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.kpi_unit","Einheit")}),e.jsx("input",{value:r.kpiUnit||"",onChange:t=>o({...r,kpiUnit:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",placeholder:a("querybuilder.kpi_placeholder_unit","%")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-400",children:a("querybuilder.kpi_rules")}),e.jsxs("button",{onClick:()=>o({...r,rules:[...r.rules||[],{operator:">",value:0,color:"green"}]}),className:"p-1 px-2 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-200 rounded text-[9px] font-bold hover:bg-blue-100 dark:hover:bg-blue-900/50 border border-blue-200 dark:border-blue-700/60 transition-colors",children:["+ ",a("querybuilder.add_rule")]})]}),e.jsx("div",{className:"space-y-2",children:(r.rules||[]).map((t,l)=>e.jsxs("div",{className:"flex items-center gap-1.5 p-2 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-100 dark:border-slate-800",children:[e.jsxs("select",{value:t.operator,onChange:s=>{const i=[...r.rules||[]],b=s.target.value;i[l]={...t,operator:b},o({...r,rules:i})},className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded p-1 text-[10px] outline-none",children:[e.jsx("option",{value:">",children:">"}),e.jsx("option",{value:"<",children:"<"}),e.jsx("option",{value:">=",children:">="}),e.jsx("option",{value:"<=",children:"<="}),e.jsx("option",{value:"==",children:"=="})]}),e.jsx("input",{type:"number",value:t.value,onChange:s=>{const i=[...r.rules||[]];i[l]={...t,value:Number(s.target.value)},o({...r,rules:i})},className:"w-16 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded p-1 text-[10px] outline-none"}),e.jsx("div",{className:"flex gap-1",children:["green","yellow","red","blue"].map(s=>e.jsx("button",{onClick:()=>{const i=[...r.rules||[]];i[l]={...t,color:s},o({...r,rules:i})},className:`w-4 h-4 rounded-full border-2 ${t.color===s?"border-slate-400 scale-110":"border-transparent opacity-40 hover:opacity-100"}`,style:{backgroundColor:s==="green"?"#10b981":s==="red"?"#f43f5e":s==="yellow"?"#fbbf24":"#3b82f6"}},s))}),e.jsx("button",{onClick:()=>o({...r,rules:(r.rules||[]).filter((s,i)=>i!==l)}),className:"ml-auto text-slate-300 hover:text-red-500",children:e.jsx(qe,{className:"w-3.5 h-3.5"})})]},l))})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.widget_description","Widget-Beschreibung")}),e.jsx("textarea",{value:r.widgetDescription||"",onChange:t=>o({...r,widgetDescription:t.target.value}),className:"w-full h-20 p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none resize-y",placeholder:a("querybuilder.widget_description_placeholder","Kurze Einordnung oder Kontext (optional)")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-left text-[10px] font-black uppercase text-slate-400 mb-1",children:a("querybuilder.widget_description_position","Position")}),e.jsxs("select",{value:r.widgetDescriptionPosition||"bottom",onChange:t=>o({...r,widgetDescriptionPosition:t.target.value}),className:"w-full p-2 border border-slate-200 dark:border-slate-700 rounded text-[11px] bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-100 outline-none",children:[e.jsx("option",{value:"top",children:a("querybuilder.widget_description_position_top","Oben")}),e.jsx("option",{value:"bottom",children:a("querybuilder.widget_description_position_bottom","Unten")})]})]}),e.jsx("p",{className:"text-[10px] text-slate-500",children:a("querybuilder.widget_description_hint","Die Beschreibung wird im Widget oberhalb oder unterhalb des Inhalts angezeigt.")})]})]}):e.jsxs("div",{className:"p-4 rounded-xl border border-blue-200 bg-blue-50/60 dark:bg-blue-950/20 space-y-3 animate-in slide-in-from-right-4 duration-300",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-wide text-blue-500",children:a("querybuilder.step_finalize")}),e.jsxs("div",{className:"rounded-lg border border-blue-100 dark:border-blue-900 bg-white dark:bg-slate-900 px-3 py-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-wide text-slate-400",children:a("querybuilder.archive_name")}),e.jsx("input",{value:U,onChange:t=>$(t.target.value),placeholder:a("querybuilder.archive_placeholder"),className:"mt-1 w-full bg-transparent border border-slate-200 dark:border-slate-700 rounded-md px-2 py-1.5 text-xs font-semibold text-slate-800 dark:text-slate-100 outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"space-y-2 text-[11px]",children:[e.jsxs("div",{className:"rounded-lg border border-blue-100 dark:border-blue-900 bg-white dark:bg-slate-900 px-3 py-2",children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-wide text-slate-400",children:a("querybuilder.finalize_mode")}),e.jsx("div",{className:"mt-1 text-slate-700 dark:text-slate-200",children:hr})]}),e.jsxs("div",{className:"rounded-lg border border-blue-100 dark:border-blue-900 bg-white dark:bg-slate-900 px-3 py-2",children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-wide text-slate-400",children:a("querybuilder.finalize_source")}),e.jsx("div",{className:"mt-1 text-slate-700 dark:text-slate-200",children:p?Y?a("querybuilder.new_markdown_card_type","MARKDOWN"):Z?a("querybuilder.new_status_card_type","STATUS"):X?a("querybuilder.new_section_card_type","SECTION"):J?a("querybuilder.new_kpi_manual_card_type","KPI MANUAL"):ee?a("querybuilder.new_image_card_type","IMAGE"):a("querybuilder.new_text_card_type"):a("querybuilder.sql_manager_source","SQL Manager Source")})]}),e.jsxs("div",{className:"rounded-lg border border-blue-100 dark:border-blue-900 bg-white dark:bg-slate-900 px-3 py-2",children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-wide text-slate-400",children:a("querybuilder.finalize_chart")}),e.jsx("div",{className:"mt-1 text-slate-700 dark:text-slate-200 font-semibold",children:st.label}),!p&&e.jsx("div",{className:"mt-1 text-[10px] text-slate-500",children:a("querybuilder.finalize_axes",{x:r.xAxis||"-",count:(r.yAxes||[]).length})}),p&&e.jsx("div",{className:"mt-1 text-[10px] text-slate-500",children:Z?a("querybuilder.finalize_status_level",{level:a(`querybuilder.status_level_${r.statusLevel||"ok"}`,r.statusLevel||"ok")}):X?a("querybuilder.finalize_section_style",{style:a(`querybuilder.section_divider_${r.sectionDividerStyle||"line"}`,r.sectionDividerStyle||"line")}):J?a("querybuilder.finalize_kpi_target",{target:r.kpiTarget||"-"}):ee?a("querybuilder.finalize_image_url",{url:(r.imageUrl||"").trim()?"OK":"-"}):a("querybuilder.finalize_text_length",{count:Y?(r.markdownContent||"").trim().length:(r.textContent||"").trim().length})})]}),e.jsxs("div",{className:"rounded-lg border border-blue-100 dark:border-blue-900 bg-white dark:bg-slate-900 px-3 py-2",children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-wide text-slate-400",children:a("querybuilder.preview",{count:u.length})}),e.jsx("div",{className:`mt-1 text-[11px] font-semibold ${at?"text-amber-700":"text-emerald-700"}`,children:a(at?"querybuilder.preview_not_renderable_title":"querybuilder.finalize_ready")})]})]}),xe&&rt&&e.jsx("p",{className:"text-[10px] text-amber-700",children:rt})]})}),e.jsxs("div",{className:"sticky bottom-0 z-20 border-t border-slate-200 dark:border-slate-700 bg-white/95 dark:bg-slate-900/95 backdrop-blur px-4 py-3 shadow-[0_-6px_18px_-14px_rgba(15,23,42,0.5)]",children:[e.jsx("div",{className:"flex items-center justify-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{const t=k===3?1:Math.max(1,k-1);Ie(t)},disabled:k<=1,className:"px-3 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-xs font-bold text-slate-500 dark:text-slate-300 disabled:opacity-40",children:a("querybuilder.back")}),br&&e.jsx("button",{onClick:()=>{vr()},disabled:pr,className:"px-4 py-2 rounded-lg border border-blue-200 dark:border-blue-700 bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-200 text-xs font-bold disabled:opacity-40",children:mr}),e.jsx("button",{onClick:()=>{yr()},disabled:Ct,className:"px-4 py-2 rounded-lg bg-blue-600 text-white text-xs font-bold shadow-sm disabled:opacity-40",children:xr})]})}),Ct&&At&&e.jsx("p",{className:"mt-2 text-center text-[10px] text-amber-700",children:At})]})]})}),e.jsxs("div",{id:"query-visualization",className:"flex-1 min-w-0 bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden flex flex-col h-full min-h-[320px] sm:min-h-[380px] lg:min-h-[460px] relative",children:[e.jsxs("div",{className:"border-b border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-900/50",children:[e.jsxs("div",{className:"p-3 flex items-center justify-between gap-2",children:[e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-wider",children:a("querybuilder.preview_panel_title","Vorschau")}),e.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400 truncate",children:fr})]}),e.jsx("div",{className:"px-3 pb-2 border-t border-slate-100 dark:border-slate-800",children:e.jsxs("div",{className:"pt-2 flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-1",children:[e.jsxs("button",{type:"button",onClick:()=>he("graphic"),className:`px-2 py-1.5 rounded text-[10px] font-bold border transition-colors flex items-center justify-center gap-1 ${oe==="graphic"?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700":"bg-white dark:bg-slate-900 text-slate-500 dark:text-slate-300 border-slate-200 dark:border-slate-700"}`,children:[e.jsx(Le,{className:"w-3 h-3"}),a("querybuilder.preview_tab_graphic","Grafisch")]}),e.jsxs("button",{type:"button",onClick:()=>{p||he("table")},disabled:p,className:`px-2 py-1.5 rounded text-[10px] font-bold border transition-colors flex items-center justify-center gap-1 ${oe==="table"?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700":"bg-white dark:bg-slate-900 text-slate-500 dark:text-slate-300 border-slate-200 dark:border-slate-700"} disabled:opacity-40 disabled:cursor-not-allowed`,children:[e.jsx(Re,{className:"w-3 h-3"}),a("querybuilder.preview_tab_table","Tabelle")]}),e.jsxs("button",{type:"button",onClick:()=>{p||he("sql")},disabled:p,className:`px-2 py-1.5 rounded text-[10px] font-bold border transition-colors flex items-center justify-center gap-1 ${oe==="sql"?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-700":"bg-white dark:bg-slate-900 text-slate-500 dark:text-slate-300 border-slate-200 dark:border-slate-700"} disabled:opacity-40 disabled:cursor-not-allowed`,children:[e.jsx(Ee,{className:"w-3 h-3"}),a("querybuilder.preview_tab_sql","SQL")]})]}),e.jsxs("button",{onClick:()=>Zt(!Me),className:"px-2 py-1.5 rounded text-[10px] font-bold border bg-white dark:bg-slate-900 text-slate-500 dark:text-slate-300 border-slate-200 dark:border-slate-700 hover:text-slate-700 dark:hover:text-slate-100 transition-colors flex items-center justify-center gap-1",children:[Me?e.jsx(Kr,{className:"w-3 h-3"}):e.jsx(It,{className:"w-3 h-3"}),e.jsx("span",{children:a(Me?"querybuilder.centered":"querybuilder.focus")})]})]})})]}),e.jsx("div",{className:`flex-1 min-h-0 flex flex-col ${oe==="sql"?"overflow-hidden p-0":"overflow-auto p-4 container-scrollbar"}`,children:oe==="graphic"?e.jsxs("div",{className:"h-full min-h-[260px] flex flex-col",children:[Be&&Wt==="top"&&e.jsx("div",{className:"px-4 py-2 text-[11px] text-slate-600 dark:text-slate-300 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-md mb-3",children:Be}),e.jsx("div",{className:"flex-1 min-h-0",children:De?e.jsx("div",{className:`h-full min-h-[260px] p-6 whitespace-pre-wrap break-words text-slate-800 dark:text-slate-100 ${r.textSize==="sm"?"text-sm":r.textSize==="lg"?"text-lg":r.textSize==="xl"?"text-xl":r.textSize==="2xl"?"text-2xl":"text-base"} ${r.textBold?"font-bold":"font-normal"} ${r.textItalic?"italic":"not-italic"} ${r.textUnderline?"underline":"no-underline"} ${r.textAlign==="center"?"text-center":r.textAlign==="right"?"text-right":"text-left"}`,children:(r.textContent||"").trim()||a("querybuilder.text_placeholder")}):Y?e.jsx("div",{className:"h-full min-h-[260px] p-6 text-slate-800 dark:text-slate-100",children:e.jsx(Lr,{markdown:(r.markdownContent||"").trim(),emptyText:a("querybuilder.markdown_placeholder",`# Titel
Text mit **Fett** und [Link](https://example.com)`),className:"text-sm leading-6"})}):Z?e.jsx("div",{className:"h-full min-h-[260px] p-6 flex items-center justify-center",children:(()=>{const t=r.statusLevel||"ok",s={ok:{ring:"ring-emerald-200 bg-emerald-50 dark:bg-emerald-900/20",dot:"bg-emerald-500",title:"text-emerald-800 dark:text-emerald-300",text:"text-emerald-700/90 dark:text-emerald-200/90"},info:{ring:"ring-blue-200 bg-blue-50 dark:bg-blue-900/20",dot:"bg-blue-500",title:"text-blue-800 dark:text-blue-300",text:"text-blue-700/90 dark:text-blue-200/90"},warning:{ring:"ring-amber-200 bg-amber-50 dark:bg-amber-900/20",dot:"bg-amber-500",title:"text-amber-800 dark:text-amber-300",text:"text-amber-700/90 dark:text-amber-200/90"},critical:{ring:"ring-rose-200 bg-rose-50 dark:bg-rose-900/20",dot:"bg-rose-500",title:"text-rose-800 dark:text-rose-300",text:"text-rose-700/90 dark:text-rose-200/90"}}[t];return e.jsxs("div",{className:`w-full max-w-xl rounded-xl ring-1 ${s.ring} p-5`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`relative inline-flex h-3.5 w-3.5 rounded-full ${s.dot}`,children:r.statusPulse&&e.jsx("span",{className:`absolute inline-flex h-full w-full rounded-full ${s.dot} opacity-75 animate-ping`})}),e.jsx("span",{className:`text-[11px] font-black uppercase tracking-wider ${s.title}`,children:a(`querybuilder.status_level_${t}`,t)})]}),e.jsx("div",{className:`mt-3 text-lg font-bold ${s.title}`,children:(r.statusTitle||"").trim()||a("querybuilder.status_placeholder_title","Systemstatus")}),e.jsx("p",{className:`mt-2 text-sm ${s.text}`,children:(r.statusMessage||"").trim()||a("querybuilder.status_placeholder_message","Alle Kernsysteme laufen stabil.")})]})})()}):X?e.jsx("div",{className:"h-full min-h-[260px] p-6 flex flex-col justify-center",children:(()=>{const t=r.sectionAlign||"left",l=t==="center"?"text-center":t==="right"?"text-right":"text-left",s=r.sectionDividerStyle||"line";return e.jsxs("div",{className:`w-full ${l}`,children:[e.jsx("h2",{className:"text-2xl font-black tracking-tight text-slate-800 dark:text-slate-100",children:(r.sectionTitle||"").trim()||a("querybuilder.section_placeholder_title","Abschnittstitel")}),(r.sectionSubtitle||"").trim()&&e.jsx("p",{className:"mt-1 text-sm text-slate-500 dark:text-slate-400",children:r.sectionSubtitle}),s==="line"&&e.jsx("div",{className:`mt-4 h-px bg-slate-300 dark:bg-slate-700 ${t==="center"?"mx-auto w-2/3":t==="right"?"ml-auto w-2/3":"w-2/3"}`}),s==="double"&&e.jsxs("div",{className:`mt-4 space-y-1 ${t==="center"?"mx-auto w-2/3":t==="right"?"ml-auto w-2/3":"w-2/3"}`,children:[e.jsx("div",{className:"h-px bg-slate-300 dark:bg-slate-700"}),e.jsx("div",{className:"h-px bg-slate-300 dark:bg-slate-700"})]})]})})()}):J?e.jsx("div",{className:"h-full min-h-[260px] p-6 flex items-center justify-center",children:(()=>{const t=r.kpiTrend||"flat",l=E=>{if(!E)return Number.NaN;const nt=E.replace(/\s+/g,"").replace(",",".").replace(/[^0-9.+-]/g,"");return Number(nt)},s=l(r.kpiValue),i=l(r.kpiTarget),b=r.kpiAlign||"left",m=b==="center"?"text-center":b==="right"?"text-right":"text-left",h=b==="center"?"justify-center":b==="right"?"justify-end":"justify-start",v=Number.isFinite(s)&&Number.isFinite(i)&&i!==0,P=v?s/i:Number.NaN,n=v?P>=1?"ok":P>=.95?"warn":"crit":"neutral",x=t==="up"?"text-emerald-700 dark:text-emerald-300 bg-emerald-50 dark:bg-emerald-900/20":t==="down"?"text-rose-700 dark:text-rose-300 bg-rose-50 dark:bg-rose-900/20":"text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-700/40",pe=n==="ok"?"text-emerald-700 dark:text-emerald-300 bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-800":n==="warn"?"text-amber-700 dark:text-amber-300 bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800":n==="crit"?"text-rose-700 dark:text-rose-300 bg-rose-50 dark:bg-rose-900/20 border-rose-200 dark:border-rose-800":"text-slate-600 dark:text-slate-300 bg-slate-100 dark:bg-slate-700/40 border-slate-200 dark:border-slate-700",it=n==="ok"?"text-emerald-700 dark:text-emerald-300":n==="warn"?"text-amber-700 dark:text-amber-300":n==="crit"?"text-rose-700 dark:text-rose-300":"text-slate-900 dark:text-slate-100";return e.jsxs("div",{className:`w-full max-w-xl rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-5 ${m}`,children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-wider text-slate-400",children:(r.kpiTitle||"").trim()||a("querybuilder.kpi_placeholder_title","Kennzahl")}),e.jsxs("div",{className:`mt-3 flex items-end gap-2 ${h}`,children:[e.jsx("div",{className:`text-4xl font-black tracking-tight ${it}`,children:(r.kpiValue||"").trim()||"--"}),(r.kpiUnit||"").trim()&&e.jsx("div",{className:"pb-1 text-sm font-bold text-slate-500 dark:text-slate-400",children:r.kpiUnit})]}),e.jsxs("div",{className:`mt-3 flex flex-wrap items-center gap-2 ${h}`,children:[e.jsxs("span",{className:"px-2 py-1 rounded-full text-[10px] font-black uppercase tracking-wide bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300",children:[a("querybuilder.kpi_target","Ziel"),": ",(r.kpiTarget||"").trim()||"-"]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-[10px] font-black uppercase tracking-wide ${x}`,children:a(`querybuilder.kpi_trend_${t}`,t)}),e.jsx("span",{className:`px-2 py-1 rounded-full border text-[10px] font-black uppercase tracking-wide ${pe}`,children:n==="ok"?a("querybuilder.kpi_status_on_target","Im Ziel"):n==="warn"?a("querybuilder.kpi_status_near_target","Nahe am Ziel"):n==="crit"?a("querybuilder.kpi_status_below_target","Unter Ziel"):a("querybuilder.kpi_status_no_compare","Kein Zielvergleich")})]}),(r.kpiNote||"").trim()&&e.jsx("p",{className:"mt-3 text-xs text-slate-500 dark:text-slate-400",children:r.kpiNote})]})})()}):ee?e.jsx("div",{className:"h-full min-h-[260px] p-6 flex items-center justify-center",children:(()=>{const t=r.imageAlign||"center",l=t==="left"?"items-start":t==="right"?"items-end":"items-center";return e.jsx("div",{className:`w-full h-full flex flex-col ${l} justify-center`,children:(r.imageUrl||"").trim()&&!er?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:(r.imageUrl||"").trim(),alt:(r.imageAlt||"").trim()||"Preview image",referrerPolicy:"no-referrer",crossOrigin:"anonymous",onError:()=>bt(!0),className:`max-h-[320px] w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 ${r.imageFit==="cover"?"object-cover":"object-contain"}`}),(r.imageCaption||"").trim()&&e.jsx("p",{className:"mt-2 text-xs text-slate-500 dark:text-slate-400",children:r.imageCaption})]}):(r.imageUrl||"").trim()?e.jsx("div",{className:"w-full rounded-lg border border-amber-300 bg-amber-50 dark:bg-amber-900/20 dark:border-amber-700 p-3 text-amber-900 dark:text-amber-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs font-bold",children:a("querybuilder.image_load_error_title","Bild konnte nicht geladen werden.")}),e.jsx("p",{className:"text-[11px] mt-1",children:a("querybuilder.image_load_error_hint","Bitte URL, Zugriff und CORS/Hotlink-Schutz pruefen.")}),e.jsx("p",{className:"text-[10px] mt-1 font-mono break-all opacity-80",children:(r.imageUrl||"").trim()})]})]})}):e.jsxs("div",{className:"h-[220px] w-full rounded-lg border border-dashed border-slate-300 dark:border-slate-700 flex flex-col items-center justify-center text-slate-400",children:[e.jsx(ct,{className:"w-8 h-8 mb-2 opacity-60"}),e.jsx("p",{className:"text-xs font-semibold text-center",children:a("querybuilder.image_empty_hint","Bitte eine Bild-URL hinterlegen.")})]})})})()}):tt?u.length===0?e.jsxs("div",{className:"h-full min-h-[260px] flex flex-col items-center justify-center text-slate-300",children:[e.jsx(Pt,{className:"w-12 h-12 mb-4 opacity-10"}),e.jsx("p",{className:"text-xs font-black uppercase tracking-widest text-center whitespace-pre-wrap",children:a("querybuilder.no_data_prompt")})]}):g==="table"?e.jsx($t,{columns:wt,data:u,onRowClick:t=>{pt(u.indexOf(t)),Ge(!0)}}):g==="pivot"?e.jsx(zr,{data:u,rows:r.pivotRows||[],cols:r.pivotCols||[],measures:r.pivotMeasures||[]}):Nt?e.jsx("div",{className:"h-full min-h-[260px] w-full flex flex-col",children:at?e.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:e.jsx("div",{className:"max-w-md w-full rounded-xl border border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/20 text-amber-900 dark:text-amber-100 px-4 py-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 text-amber-600 dark:text-amber-300",children:st.icon}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs font-black uppercase tracking-wide text-amber-700 dark:text-amber-300",children:st.label}),e.jsx("p",{className:"text-sm font-bold mt-1",children:a("querybuilder.preview_not_renderable_title")}),e.jsx("p",{className:"text-xs text-amber-800/90 dark:text-amber-200/90 mt-1",children:a("querybuilder.preview_not_renderable_hint")})]})]})})}):g==="kpi"?(()=>{const t=u[0],l=Object.keys(t),s=(r.yAxes||[])[0]||r.yAxis||"",i=l.includes(s)?s:l.find(n=>{const x=t[n];if(typeof x=="number")return Number.isFinite(x);if(typeof x=="string"){const pe=x.replace(/\s+/g,"").replace(",",".");return Number.isFinite(Number(pe))}return!1})||l[0],b=t[i],h=(n=>{if(typeof n=="number")return n;if(typeof n=="string"){const x=n.replace(/\s+/g,"").replace(",",".");return Number(x)}return Number.NaN})(b);let v="text-slate-900 dark:text-white",P;if(r.rules&&!isNaN(h))for(const n of r.rules){let x=!1;switch(n.operator){case">":x=h>n.value;break;case"<":x=h<n.value;break;case">=":x=h>=n.value;break;case"<=":x=h<=n.value;break;case"==":x=h===n.value;break}if(x){n.color==="green"?v="text-emerald-500":n.color==="red"?v="text-rose-500":n.color==="yellow"?v="text-amber-500":n.color==="blue"?v="text-blue-500":P={color:n.color};break}}return e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 animate-in zoom-in-95 duration-500",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:`text-6xl lg:text-8xl font-black tracking-widest break-all transition-colors duration-300 ${v}`,style:P,children:w(b,i)}),(r.kpiUnit||"").trim()&&e.jsx("div",{className:"pb-1 text-xl lg:text-2xl font-bold text-slate-500 dark:text-slate-400",children:r.kpiUnit})]}),e.jsx("div",{className:"text-xs font-bold text-slate-400 mt-6 uppercase tracking-[0.4em] font-mono",children:i})]})})():e.jsx("div",{className:"flex-1 min-h-[280px] min-w-0",children:e.jsx($r,{width:"100%",height:"100%",minWidth:320,minHeight:280,children:g==="bar"?e.jsxs(Br,{data:u,children:[e.jsx(Se,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(Ce,{dataKey:r.xAxis,axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"}}),e.jsx(Ae,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"},tickFormatter:t=>w(t,(r.yAxes||[])[0])}),e.jsx(ie,{contentStyle:ae,labelStyle:le,itemStyle:se,cursor:kr,formatter:(t,l)=>[w(t,l),l]}),e.jsx(ne,{verticalAlign:"top",height:36,iconType:"circle",wrapperStyle:{fontSize:"10px",fontWeight:"bold"}}),(r.yAxes||[]).map((t,l)=>e.jsx(Et,{dataKey:t,fill:l===0?r.color||y[0]:y[l%y.length],radius:[4,4,0,0],children:r.showLabels&&e.jsx(Te,{dataKey:t,position:"top",style:{fontSize:"10px",fontWeight:"bold",fill:"#64748b"},formatter:s=>w(s,t)})},t))]}):g==="line"?e.jsxs(Ir,{data:u,children:[e.jsx(Se,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(Ce,{dataKey:r.xAxis,axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"}}),e.jsx(Ae,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"},tickFormatter:t=>w(t,(r.yAxes||[])[0])}),e.jsx(ie,{contentStyle:ae,labelStyle:le,itemStyle:se,formatter:(t,l)=>[w(t,l),l]}),e.jsx(ne,{verticalAlign:"top",height:36,iconType:"circle"}),(r.yAxes||[]).map((t,l)=>e.jsx(Rt,{type:"monotone",dataKey:t,stroke:l===0?r.color||y[0]:y[l%y.length],strokeWidth:3,dot:{r:4},activeDot:{r:6},children:r.showLabels&&e.jsx(Te,{dataKey:t,position:"top",offset:10,style:{fontSize:"10px",fontWeight:"bold",fill:"#64748b"},formatter:s=>w(s,t)})},t))]}):g==="area"?e.jsxs(Pr,{data:u,children:[e.jsx(Se,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(Ce,{dataKey:r.xAxis,axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"}}),e.jsx(Ae,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"},tickFormatter:t=>w(t,(r.yAxes||[])[0])}),e.jsx(ie,{contentStyle:ae,labelStyle:le,itemStyle:se,formatter:(t,l)=>[w(t,l),l]}),e.jsx(ne,{verticalAlign:"top",height:36,iconType:"circle",wrapperStyle:{fontSize:"10px",fontWeight:"bold"}}),(r.yAxes||[]).map((t,l)=>e.jsx(Er,{type:"monotone",dataKey:t,stroke:l===0?r.color||y[0]:y[l%y.length],fill:l===0?r.color||y[0]:y[l%y.length],fillOpacity:.2,strokeWidth:2,children:r.showLabels&&e.jsx(Te,{dataKey:t,position:"top",style:{fontSize:"10px",fontWeight:"bold",fill:"#64748b"},formatter:s=>w(s,t)})},t))]}):g==="pie"?e.jsxs(Rr,{children:[e.jsx(Ur,{data:u,cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:l})=>`${t} ${((l||0)*100).toFixed(0)}%`,outerRadius:120,innerRadius:80,paddingAngle:5,dataKey:(r.yAxes||[])[0]||"",nameKey:r.xAxis,children:u.map((t,l)=>e.jsx(Vr,{fill:y[l%y.length]},`cell-${l}`))}),e.jsx(ie,{contentStyle:ae,labelStyle:le,itemStyle:se}),e.jsx(ne,{layout:"vertical",align:"right",verticalAlign:"middle",iconType:"circle",wrapperStyle:{fontSize:"10px",fontWeight:"bold"}})]}):g==="composed"?e.jsxs(Or,{data:u,children:[e.jsx(Se,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(Ce,{dataKey:r.xAxis,axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"}}),e.jsx(Ae,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"},tickFormatter:t=>w(t,(r.yAxes||[])[0])}),e.jsx(ie,{contentStyle:ae,labelStyle:le,itemStyle:se,formatter:(t,l)=>[w(t,l),l]}),e.jsx(ne,{verticalAlign:"top",height:36,wrapperStyle:{fontSize:"10px",fontWeight:"bold"}}),(r.yAxes||[]).map((t,l)=>l===0?e.jsx(Et,{dataKey:t,fill:y[0],radius:[4,4,0,0],children:r.showLabels&&e.jsx(Te,{dataKey:t,position:"top",style:{fontSize:"10px",fontWeight:"bold",fill:"#64748b"},formatter:s=>w(s,t)})},t):e.jsx(Rt,{type:"monotone",dataKey:t,stroke:y[l%y.length],strokeWidth:3,children:r.showLabels&&e.jsx(Te,{dataKey:t,position:"top",style:{fontSize:"10px",fontWeight:"bold",fill:"#64748b"},formatter:s=>w(s,t)})},t))]}):g==="radar"?e.jsxs(Fr,{cx:"50%",cy:"50%",outerRadius:"80%",data:u,children:[e.jsx(Qr,{stroke:"#e2e8f0"}),e.jsx(Gr,{dataKey:r.xAxis,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"}}),e.jsx(Hr,{angle:30,domain:[0,"auto"],tick:{fontSize:10,fill:"#94a3b8"}}),(r.yAxes||[]).map((t,l)=>e.jsx(Yr,{name:t,dataKey:t,stroke:y[l%y.length],fill:y[l%y.length],fillOpacity:.6},t)),e.jsx(ne,{iconType:"circle",wrapperStyle:{fontSize:"10px",fontWeight:"bold"}}),e.jsx(ie,{contentStyle:ae,labelStyle:le,itemStyle:se})]}):g==="scatter"?e.jsxs(Zr,{children:[e.jsx(Se,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(Ce,{type:"number",dataKey:r.xAxis,name:r.xAxis,axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"}}),e.jsx(Ae,{type:"number",dataKey:(r.yAxes||[])[0],name:(r.yAxes||[])[0],axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8",fontWeight:"bold"}}),e.jsx(ie,{contentStyle:ae,labelStyle:le,itemStyle:se,cursor:{strokeDasharray:"3 3"}}),e.jsx(ne,{verticalAlign:"top",height:36,iconType:"circle",wrapperStyle:{fontSize:"10px",fontWeight:"bold"}}),e.jsx(Xr,{name:U||"Scatter",data:et,fill:r.color||y[0]})]}):null})})},`${g}-${Gt}`):e.jsxs("div",{className:"h-full min-h-[260px] flex flex-col items-center justify-center text-slate-400",children:[e.jsx(L,{className:"w-10 h-10 mb-3 opacity-40"}),e.jsx("p",{className:"text-xs font-bold text-center",children:a("querybuilder.preview_graphic_not_selected_hint","Fuer die grafische Ansicht bitte einen Diagrammtyp auswaehlen.")})]}):e.jsxs("div",{className:"h-full min-h-[260px] flex flex-col items-center justify-center text-slate-400",children:[e.jsx(Le,{className:"w-10 h-10 mb-3 opacity-40"}),e.jsx("p",{className:"text-xs font-bold text-center",children:a("querybuilder.preview_graphic_no_query_hint","Keine Abfrage vorhanden. Fuer Text/Markdown/Status/Section/KPI-Manual/Image-Widgets steht nur die Inhaltsvorschau zur Verfuegung.")})]})}),Be&&Wt==="bottom"&&e.jsx("div",{className:"px-4 py-2 text-[11px] text-slate-600 dark:text-slate-300 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-md mt-3",children:Be})]}):oe==="table"?tt?u.length===0?e.jsxs("div",{className:"h-full min-h-[260px] flex flex-col items-center justify-center text-slate-300",children:[e.jsx(Pt,{className:"w-12 h-12 mb-4 opacity-10"}),e.jsx("p",{className:"text-xs font-black uppercase tracking-widest text-center whitespace-pre-wrap",children:a("querybuilder.no_data_prompt")})]}):e.jsx($t,{columns:wt,data:u,onRowClick:t=>{pt(u.indexOf(t)),Ge(!0)}}):e.jsxs("div",{className:"h-full min-h-[260px] flex flex-col items-center justify-center text-slate-400",children:[e.jsx(Re,{className:"w-10 h-10 mb-3 opacity-40"}),e.jsx("p",{className:"text-xs font-bold text-center",children:a("querybuilder.preview_no_data_source","Keine Datenquelle ausgewaehlt.")})]}):tt?e.jsx("div",{className:"flex-1 min-h-0 flex flex-col",children:e.jsx("div",{className:"flex-1 min-h-0 w-full border-t border-slate-200 dark:border-slate-700 overflow-hidden",children:e.jsx(Ar,{value:S,height:"100%",readOnly:!0,editable:!1,basicSetup:{lineNumbers:gt,foldGutter:!1,highlightActiveLine:Ke,highlightActiveLineGutter:gt&&Ke},extensions:dr})})}):e.jsxs("div",{className:"h-full min-h-[260px] flex flex-col items-center justify-center text-slate-400",children:[e.jsx(Ee,{className:"w-10 h-10 mb-3 opacity-40"}),e.jsx("p",{className:"text-xs font-bold text-center",children:a("querybuilder.preview_no_data_source","Keine Datenquelle ausgewaehlt.")})]})})]})]})}),e.jsx(Wr,{isOpen:tr,onClose:()=>Ge(!1),items:u,initialIndex:rr,tableName:void 0,schema:ar||void 0})]})};export{ma as QueryBuilderView};
