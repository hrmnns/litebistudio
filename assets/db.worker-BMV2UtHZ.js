(function(){"use strict";async function Rt(oe={}){var re,c=oe,me=!!globalThis.window,Ae=!!globalThis.WorkerGlobalScope;globalThis.process?.versions?.node&&globalThis.process?.type;var qe="./this.program",Te=self.location.href,je="";function De(e){return c.locateFile?c.locateFile(e,je):je+e}var ke,Be;if(me||Ae){try{je=new URL(".",Te).href}catch{}Ae&&(Be=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),ke=async e=>{var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw new Error(t.status+" : "+t.url)}}var he=console.log.bind(console),xe=console.error.bind(console),We,st=!1,Ot,Pt,Xe,_t,vt,Ne,Me,Ge,Ht=!1;function Gt(){var e=lt.buffer;Xe=new Int8Array(e),vt=new Int16Array(e),_t=new Uint8Array(e),Ne=new Int32Array(e),Me=new Uint32Array(e),Ge=new BigInt64Array(e),new BigUint64Array(e)}function qr(){if(c.wasmMemory)lt=c.wasmMemory;else{var e=c.INITIAL_MEMORY||8388608;lt=new WebAssembly.Memory({initial:e/65536,maximum:32768})}Gt()}function vr(){if(c.preRun)for(typeof c.preRun=="function"&&(c.preRun=[c.preRun]);c.preRun.length;)Fr(c.preRun.shift());$t(Jt)}function Er(){Ht=!0,!c.noFSInit&&!a.initialized&&a.init(),yt.__wasm_call_ctors(),a.ignorePermissions=!1}function Sr(){if(c.postRun)for(typeof c.postRun=="function"&&(c.postRun=[c.postRun]);c.postRun.length;)xr(c.postRun.shift());$t(Kt)}function ot(e){c.onAbort?.(e),e="Aborted("+e+")",xe(e),st=!0,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw Pt?.(t),t}var Ct;function wr(){return c.locateFile?De("sqlite3.wasm"):new URL("/litebistudio/assets/sqlite3-DGXXSD5r.wasm",self.location.href).href}function Ar(e){if(e==Ct&&We)return new Uint8Array(We);if(Be)return Be(e);throw"both async and sync fetching of the wasm failed"}async function Tr(e){if(!We)try{var t=await ke(e);return new Uint8Array(t)}catch{}return Ar(e)}async function Ir(e,t){try{var o=await Tr(e);return await WebAssembly.instantiate(o,t)}catch(s){xe(`failed to asynchronously prepare wasm: ${s}`),ot(s)}}async function kr(e,t,o){if(!e)try{var s=fetch(t,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(s,o)}catch(r){xe(`wasm streaming compile failed: ${r}`),xe("falling back to ArrayBuffer instantiation")}return Ir(t,o)}function Or(){return{env:ur,wasi_snapshot_preview1:ur}}async function Pr(){function e(s,r){return yt=s.exports,Rn(yt),yt}function t(s){return e(s.instance)}var o=Or();return c.instantiateWasm?new Promise((s,r)=>{c.instantiateWasm(o,(i,n)=>{s(e(i))})}):(Ct??=wr(),t(await kr(We,Ct,o)))}var $t=e=>{for(;e.length>0;)e.shift()(c)},Kt=[],xr=e=>Kt.push(e),Jt=[],Fr=e=>Jt.push(e),lt,Le={isAbs:e=>e.charAt(0)==="/",splitPath:e=>/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1),normalizeArray:(e,t)=>{for(var o=0,s=e.length-1;s>=0;s--){var r=e[s];r==="."?e.splice(s,1):r===".."?(e.splice(s,1),o++):o&&(e.splice(s,1),o--)}if(t)for(;o;o--)e.unshift("..");return e},normalize:e=>{var t=Le.isAbs(e),o=e.slice(-1)==="/";return e=Le.normalizeArray(e.split("/").filter(s=>!!s),!t).join("/"),!e&&!t&&(e="."),e&&o&&(e+="/"),(t?"/":"")+e},dirname:e=>{var t=Le.splitPath(e),o=t[0],s=t[1];return!o&&!s?".":(s&&(s=s.slice(0,-1)),o+s)},basename:e=>e&&e.match(/([^\/]+|\/)\/*$/)[1],join:(...e)=>Le.normalize(e.join("/")),join2:(e,t)=>Le.normalize(e+"/"+t)},Nr=()=>e=>crypto.getRandomValues(e),Xt=e=>{(Xt=Nr())(e)},gt={resolve:(...e)=>{for(var t="",o=!1,s=e.length-1;s>=-1&&!o;s--){var r=s>=0?e[s]:a.cwd();if(typeof r!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!r)return"";t=r+"/"+t,o=Le.isAbs(r)}return t=Le.normalizeArray(t.split("/").filter(i=>!!i),!o).join("/"),(o?"/":"")+t||"."},relative:(e,t)=>{e=gt.resolve(e).slice(1),t=gt.resolve(t).slice(1);function o(I){for(var J=0;J<I.length&&I[J]==="";J++);for(var L=I.length-1;L>=0&&I[L]==="";L--);return J>L?[]:I.slice(J,L-J+1)}for(var s=o(e.split("/")),r=o(t.split("/")),i=Math.min(s.length,r.length),n=i,u=0;u<i;u++)if(s[u]!==r[u]){n=u;break}for(var F=[],u=n;u<s.length;u++)F.push("..");return F=F.concat(r.slice(n)),F.join("/")}},Yt=new TextDecoder,Zt=(e,t,o,s)=>{for(var r=t+o;e[t]&&!(t>=r);)++t;return t},Et=(e,t=0,o,s)=>{var r=Zt(e,t,o);return Yt.decode(e.buffer?e.subarray(t,r):new Uint8Array(e.slice(t,r)))},Dt=[],xt=e=>{for(var t=0,o=0;o<e.length;++o){var s=e.charCodeAt(o);s<=127?t++:s<=2047?t+=2:s>=55296&&s<=57343?(t+=4,++o):t+=3}return t},er=(e,t,o,s)=>{if(!(s>0))return 0;for(var r=o,i=o+s-1,n=0;n<e.length;++n){var u=e.codePointAt(n);if(u<=127){if(o>=i)break;t[o++]=u}else if(u<=2047){if(o+1>=i)break;t[o++]=192|u>>6,t[o++]=128|u&63}else if(u<=65535){if(o+2>=i)break;t[o++]=224|u>>12,t[o++]=128|u>>6&63,t[o++]=128|u&63}else{if(o+3>=i)break;t[o++]=240|u>>18,t[o++]=128|u>>12&63,t[o++]=128|u>>6&63,t[o++]=128|u&63,n++}}return t[o]=0,o-r},Mt=(e,t,o)=>{var s=xt(e)+1,r=new Array(s),i=er(e,r,0,r.length);return r.length=i,r},Lr=()=>{if(!Dt.length){var e=null;if(globalThis.window?.prompt&&(e=window.prompt("Input: "),e!==null&&(e+=`
`)),!e)return null;Dt=Mt(e)}return Dt.shift()},ft={ttys:[],init(){},shutdown(){},register(e,t){ft.ttys[e]={input:[],output:[],ops:t},a.registerDevice(e,ft.stream_ops)},stream_ops:{open(e){var t=ft.ttys[e.node.rdev];if(!t)throw new a.ErrnoError(43);e.tty=t,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,t,o,s,r){if(!e.tty||!e.tty.ops.get_char)throw new a.ErrnoError(60);for(var i=0,n=0;n<s;n++){var u;try{u=e.tty.ops.get_char(e.tty)}catch{throw new a.ErrnoError(29)}if(u===void 0&&i===0)throw new a.ErrnoError(6);if(u==null)break;i++,t[o+n]=u}return i&&(e.node.atime=Date.now()),i},write(e,t,o,s,r){if(!e.tty||!e.tty.ops.put_char)throw new a.ErrnoError(60);try{for(var i=0;i<s;i++)e.tty.ops.put_char(e.tty,t[o+i])}catch{throw new a.ErrnoError(29)}return s&&(e.node.mtime=e.node.ctime=Date.now()),i}},default_tty_ops:{get_char(e){return Lr()},put_char(e,t){t===null||t===10?(he(Et(e.output)),e.output=[]):t!=0&&e.output.push(t)},fsync(e){e.output?.length>0&&(he(Et(e.output)),e.output=[])},ioctl_tcgets(e){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(e,t,o){return 0},ioctl_tiocgwinsz(e){return[24,80]}},default_tty1_ops:{put_char(e,t){t===null||t===10?(xe(Et(e.output)),e.output=[]):t!=0&&e.output.push(t)},fsync(e){e.output?.length>0&&(xe(Et(e.output)),e.output=[])}}},Rr=(e,t)=>_t.fill(0,e,e+t),tr=(e,t)=>Math.ceil(e/t)*t,rr=e=>{e=tr(e,65536);var t=cr(65536,e);return t&&Rr(t,e),t},ve={ops_table:null,mount(e){return ve.createNode(null,"/",16895,0)},createNode(e,t,o,s){if(a.isBlkdev(o)||a.isFIFO(o))throw new a.ErrnoError(63);ve.ops_table||={dir:{node:{getattr:ve.node_ops.getattr,setattr:ve.node_ops.setattr,lookup:ve.node_ops.lookup,mknod:ve.node_ops.mknod,rename:ve.node_ops.rename,unlink:ve.node_ops.unlink,rmdir:ve.node_ops.rmdir,readdir:ve.node_ops.readdir,symlink:ve.node_ops.symlink},stream:{llseek:ve.stream_ops.llseek}},file:{node:{getattr:ve.node_ops.getattr,setattr:ve.node_ops.setattr},stream:{llseek:ve.stream_ops.llseek,read:ve.stream_ops.read,write:ve.stream_ops.write,mmap:ve.stream_ops.mmap,msync:ve.stream_ops.msync}},link:{node:{getattr:ve.node_ops.getattr,setattr:ve.node_ops.setattr,readlink:ve.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ve.node_ops.getattr,setattr:ve.node_ops.setattr},stream:a.chrdev_stream_ops}};var r=a.createNode(e,t,o,s);return a.isDir(r.mode)?(r.node_ops=ve.ops_table.dir.node,r.stream_ops=ve.ops_table.dir.stream,r.contents={}):a.isFile(r.mode)?(r.node_ops=ve.ops_table.file.node,r.stream_ops=ve.ops_table.file.stream,r.usedBytes=0,r.contents=null):a.isLink(r.mode)?(r.node_ops=ve.ops_table.link.node,r.stream_ops=ve.ops_table.link.stream):a.isChrdev(r.mode)&&(r.node_ops=ve.ops_table.chrdev.node,r.stream_ops=ve.ops_table.chrdev.stream),r.atime=r.mtime=r.ctime=Date.now(),e&&(e.contents[t]=r,e.atime=e.mtime=e.ctime=r.atime),r},getFileDataAsTypedArray(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage(e,t){var o=e.contents?e.contents.length:0;if(!(o>=t)){t=Math.max(t,o*(o<1024*1024?2:1.125)>>>0),o!=0&&(t=Math.max(t,256));var s=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(s.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,t){if(e.usedBytes!=t)if(t==0)e.contents=null,e.usedBytes=0;else{var o=e.contents;e.contents=new Uint8Array(t),o&&e.contents.set(o.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr(e){var t={};return t.dev=a.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,a.isDir(e.mode)?t.size=4096:a.isFile(e.mode)?t.size=e.usedBytes:a.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.atime),t.mtime=new Date(e.mtime),t.ctime=new Date(e.ctime),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr(e,t){for(const o of["mode","atime","mtime","ctime"])t[o]!=null&&(e[o]=t[o]);t.size!==void 0&&ve.resizeFileStorage(e,t.size)},lookup(e,t){throw ve.doesNotExistError||(ve.doesNotExistError=new a.ErrnoError(44),ve.doesNotExistError.stack="<generic error, no stack>"),ve.doesNotExistError},mknod(e,t,o,s){return ve.createNode(e,t,o,s)},rename(e,t,o){var s;try{s=a.lookupNode(t,o)}catch{}if(s){if(a.isDir(e.mode))for(var r in s.contents)throw new a.ErrnoError(55);a.hashRemoveNode(s)}delete e.parent.contents[e.name],t.contents[o]=e,e.name=o,t.ctime=t.mtime=e.parent.ctime=e.parent.mtime=Date.now()},unlink(e,t){delete e.contents[t],e.ctime=e.mtime=Date.now()},rmdir(e,t){for(var o in a.lookupNode(e,t).contents)throw new a.ErrnoError(55);delete e.contents[t],e.ctime=e.mtime=Date.now()},readdir(e){return[".","..",...Object.keys(e.contents)]},symlink(e,t,o){var s=ve.createNode(e,t,41471,0);return s.link=o,s},readlink(e){if(!a.isLink(e.mode))throw new a.ErrnoError(28);return e.link}},stream_ops:{read(e,t,o,s,r){var i=e.node.contents;if(r>=e.node.usedBytes)return 0;var n=Math.min(e.node.usedBytes-r,s);if(n>8&&i.subarray)t.set(i.subarray(r,r+n),o);else for(var u=0;u<n;u++)t[o+u]=i[r+u];return n},write(e,t,o,s,r,i){if(t.buffer===Xe.buffer&&(i=!1),!s)return 0;var n=e.node;if(n.mtime=n.ctime=Date.now(),t.subarray&&(!n.contents||n.contents.subarray)){if(i)return n.contents=t.subarray(o,o+s),n.usedBytes=s,s;if(n.usedBytes===0&&r===0)return n.contents=t.slice(o,o+s),n.usedBytes=s,s;if(r+s<=n.usedBytes)return n.contents.set(t.subarray(o,o+s),r),s}if(ve.expandFileStorage(n,r+s),n.contents.subarray&&t.subarray)n.contents.set(t.subarray(o,o+s),r);else for(var u=0;u<s;u++)n.contents[r+u]=t[o+u];return n.usedBytes=Math.max(n.usedBytes,r+s),s},llseek(e,t,o){var s=t;if(o===1?s+=e.position:o===2&&a.isFile(e.node.mode)&&(s+=e.node.usedBytes),s<0)throw new a.ErrnoError(28);return s},mmap(e,t,o,s,r){if(!a.isFile(e.node.mode))throw new a.ErrnoError(43);var i,n,u=e.node.contents;if(!(r&2)&&u&&u.buffer===Xe.buffer)n=!1,i=u.byteOffset;else{if(n=!0,i=rr(t),!i)throw new a.ErrnoError(48);u&&((o>0||o+t<u.length)&&(u.subarray?u=u.subarray(o,o+t):u=Array.prototype.slice.call(u,o,o+t)),Xe.set(u,i))}return{ptr:i,allocated:n}},msync(e,t,o,s,r){return ve.stream_ops.write(e,t,0,s,o,!1),0}}},Cr=e=>{var t={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[e];if(typeof t>"u")throw new Error(`Unknown file open mode: ${e}`);return t},jt=(e,t)=>{var o=0;return e&&(o|=365),t&&(o|=146),o},Dr=async e=>{var t=await ke(e);return new Uint8Array(t)},Mr=(...e)=>a.createDataFile(...e),dt=0,St=null,jr=e=>{if(dt--,c.monitorRunDependencies?.(dt),dt==0&&St){var t=St;St=null,t()}},zr=e=>{dt++,c.monitorRunDependencies?.(dt)},nr=[],Br=async(e,t)=>{typeof Browser<"u"&&Browser.init();for(var o of nr)if(o.canHandle(t))return o.handle(e,t);return e},ir=async(e,t,o,s,r,i,n,u)=>{var F=t?gt.resolve(Le.join2(e,t)):e;zr();try{var I=o;typeof o=="string"&&(I=await Dr(o)),I=await Br(I,F),u?.(),i||Mr(e,t,I,s,r,n)}finally{jr()}},Ur=(e,t,o,s,r,i,n,u,F,I)=>{ir(e,t,o,s,r,u,F,I).then(i).catch(n)},a={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,filesystems:null,syncFSRequests:0,readFiles:{},ErrnoError:class{name="ErrnoError";constructor(e){this.errno=e}},FSStream:class{shared={};get object(){return this.node}set object(e){this.node=e}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(e){this.shared.flags=e}get position(){return this.shared.position}set position(e){this.shared.position=e}},FSNode:class{node_ops={};stream_ops={};readMode=365;writeMode=146;mounted=null;constructor(e,t,o,s){e||(e=this),this.parent=e,this.mount=e.mount,this.id=a.nextInode++,this.name=t,this.mode=o,this.rdev=s,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(e){e?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(e){e?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return a.isDir(this.mode)}get isDevice(){return a.isChrdev(this.mode)}},lookupPath(e,t={}){if(!e)throw new a.ErrnoError(44);t.follow_mount??=!0,Le.isAbs(e)||(e=a.cwd()+"/"+e);e:for(var o=0;o<40;o++){for(var s=e.split("/").filter(I=>!!I),r=a.root,i="/",n=0;n<s.length;n++){var u=n===s.length-1;if(u&&t.parent)break;if(s[n]!=="."){if(s[n]===".."){if(i=Le.dirname(i),a.isRoot(r)){e=i+"/"+s.slice(n+1).join("/"),o--;continue e}else r=r.parent;continue}i=Le.join2(i,s[n]);try{r=a.lookupNode(r,s[n])}catch(I){if(I?.errno===44&&u&&t.noent_okay)return{path:i};throw I}if(a.isMountpoint(r)&&(!u||t.follow_mount)&&(r=r.mounted.root),a.isLink(r.mode)&&(!u||t.follow)){if(!r.node_ops.readlink)throw new a.ErrnoError(52);var F=r.node_ops.readlink(r);Le.isAbs(F)||(F=Le.dirname(i)+"/"+F),e=F+"/"+s.slice(n+1).join("/");continue e}}}return{path:i,node:r}}throw new a.ErrnoError(32)},getPath(e){for(var t;;){if(a.isRoot(e)){var o=e.mount.mountpoint;return t?o[o.length-1]!=="/"?`${o}/${t}`:o+t:o}t=t?`${e.name}/${t}`:e.name,e=e.parent}},hashName(e,t){for(var o=0,s=0;s<t.length;s++)o=(o<<5)-o+t.charCodeAt(s)|0;return(e+o>>>0)%a.nameTable.length},hashAddNode(e){var t=a.hashName(e.parent.id,e.name);e.name_next=a.nameTable[t],a.nameTable[t]=e},hashRemoveNode(e){var t=a.hashName(e.parent.id,e.name);if(a.nameTable[t]===e)a.nameTable[t]=e.name_next;else for(var o=a.nameTable[t];o;){if(o.name_next===e){o.name_next=e.name_next;break}o=o.name_next}},lookupNode(e,t){var o=a.mayLookup(e);if(o)throw new a.ErrnoError(o);for(var s=a.hashName(e.id,t),r=a.nameTable[s];r;r=r.name_next){var i=r.name;if(r.parent.id===e.id&&i===t)return r}return a.lookup(e,t)},createNode(e,t,o,s){var r=new a.FSNode(e,t,o,s);return a.hashAddNode(r),r},destroyNode(e){a.hashRemoveNode(e)},isRoot(e){return e===e.parent},isMountpoint(e){return!!e.mounted},isFile(e){return(e&61440)===32768},isDir(e){return(e&61440)===16384},isLink(e){return(e&61440)===40960},isChrdev(e){return(e&61440)===8192},isBlkdev(e){return(e&61440)===24576},isFIFO(e){return(e&61440)===4096},isSocket(e){return(e&49152)===49152},flagsToPermissionString(e){var t=["r","w","rw"][e&3];return e&512&&(t+="w"),t},nodePermissions(e,t){return a.ignorePermissions?0:t.includes("r")&&!(e.mode&292)||t.includes("w")&&!(e.mode&146)||t.includes("x")&&!(e.mode&73)?2:0},mayLookup(e){if(!a.isDir(e.mode))return 54;var t=a.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate(e,t){if(!a.isDir(e.mode))return 54;try{return a.lookupNode(e,t),20}catch{}return a.nodePermissions(e,"wx")},mayDelete(e,t,o){var s;try{s=a.lookupNode(e,t)}catch(i){return i.errno}var r=a.nodePermissions(e,"wx");if(r)return r;if(o){if(!a.isDir(s.mode))return 54;if(a.isRoot(s)||a.getPath(s)===a.cwd())return 10}else if(a.isDir(s.mode))return 31;return 0},mayOpen(e,t){return e?a.isLink(e.mode)?32:a.isDir(e.mode)&&(a.flagsToPermissionString(t)!=="r"||t&576)?31:a.nodePermissions(e,a.flagsToPermissionString(t)):44},checkOpExists(e,t){if(!e)throw new a.ErrnoError(t);return e},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=a.MAX_OPEN_FDS;e++)if(!a.streams[e])return e;throw new a.ErrnoError(33)},getStreamChecked(e){var t=a.getStream(e);if(!t)throw new a.ErrnoError(8);return t},getStream:e=>a.streams[e],createStream(e,t=-1){return e=Object.assign(new a.FSStream,e),t==-1&&(t=a.nextfd()),e.fd=t,a.streams[t]=e,e},closeStream(e){a.streams[e]=null},dupStream(e,t=-1){var o=a.createStream(e,t);return o.stream_ops?.dup?.(o),o},doSetAttr(e,t,o){var s=e?.stream_ops.setattr,r=s?e:t;s??=t.node_ops.setattr,a.checkOpExists(s,63),s(r,o)},chrdev_stream_ops:{open(e){e.stream_ops=a.getDevice(e.node.rdev).stream_ops,e.stream_ops.open?.(e)},llseek(){throw new a.ErrnoError(70)}},major:e=>e>>8,minor:e=>e&255,makedev:(e,t)=>e<<8|t,registerDevice(e,t){a.devices[e]={stream_ops:t}},getDevice:e=>a.devices[e],getMounts(e){for(var t=[],o=[e];o.length;){var s=o.pop();t.push(s),o.push(...s.mounts)}return t},syncfs(e,t){typeof e=="function"&&(t=e,e=!1),a.syncFSRequests++,a.syncFSRequests>1&&xe(`warning: ${a.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var o=a.getMounts(a.root.mount),s=0;function r(u){return a.syncFSRequests--,t(u)}function i(u){if(u)return i.errored?void 0:(i.errored=!0,r(u));++s>=o.length&&r(null)}for(var n of o)n.type.syncfs?n.type.syncfs(n,e,i):i(null)},mount(e,t,o){var s=o==="/",r=!o,i;if(s&&a.root)throw new a.ErrnoError(10);if(!s&&!r){var n=a.lookupPath(o,{follow_mount:!1});if(o=n.path,i=n.node,a.isMountpoint(i))throw new a.ErrnoError(10);if(!a.isDir(i.mode))throw new a.ErrnoError(54)}var u={type:e,opts:t,mountpoint:o,mounts:[]},F=e.mount(u);return F.mount=u,u.root=F,s?a.root=F:i&&(i.mounted=u,i.mount&&i.mount.mounts.push(u)),F},unmount(e){var t=a.lookupPath(e,{follow_mount:!1});if(!a.isMountpoint(t.node))throw new a.ErrnoError(28);var o=t.node,s=o.mounted,r=a.getMounts(s);for(var[i,n]of Object.entries(a.nameTable))for(;n;){var u=n.name_next;r.includes(n.mount)&&a.destroyNode(n),n=u}o.mounted=null;var F=o.mount.mounts.indexOf(s);o.mount.mounts.splice(F,1)},lookup(e,t){return e.node_ops.lookup(e,t)},mknod(e,t,o){var s=a.lookupPath(e,{parent:!0}).node,r=Le.basename(e);if(!r)throw new a.ErrnoError(28);if(r==="."||r==="..")throw new a.ErrnoError(20);var i=a.mayCreate(s,r);if(i)throw new a.ErrnoError(i);if(!s.node_ops.mknod)throw new a.ErrnoError(63);return s.node_ops.mknod(s,r,t,o)},statfs(e){return a.statfsNode(a.lookupPath(e,{follow:!0}).node)},statfsStream(e){return a.statfsNode(e.node)},statfsNode(e){var t={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:a.nextInode,ffree:a.nextInode-1,fsid:42,flags:2,namelen:255};return e.node_ops.statfs&&Object.assign(t,e.node_ops.statfs(e.mount.opts.root)),t},create(e,t=438){return t&=4095,t|=32768,a.mknod(e,t,0)},mkdir(e,t=511){return t&=1023,t|=16384,a.mknod(e,t,0)},mkdirTree(e,t){var o=e.split("/"),s="";for(var r of o)if(r){(s||Le.isAbs(e))&&(s+="/"),s+=r;try{a.mkdir(s,t)}catch(i){if(i.errno!=20)throw i}}},mkdev(e,t,o){return typeof o>"u"&&(o=t,t=438),t|=8192,a.mknod(e,t,o)},symlink(e,t){if(!gt.resolve(e))throw new a.ErrnoError(44);var o=a.lookupPath(t,{parent:!0}).node;if(!o)throw new a.ErrnoError(44);var s=Le.basename(t),r=a.mayCreate(o,s);if(r)throw new a.ErrnoError(r);if(!o.node_ops.symlink)throw new a.ErrnoError(63);return o.node_ops.symlink(o,s,e)},rename(e,t){var o=Le.dirname(e),s=Le.dirname(t),r=Le.basename(e),i=Le.basename(t),n=a.lookupPath(e,{parent:!0}),u=n.node,F;if(n=a.lookupPath(t,{parent:!0}),F=n.node,!u||!F)throw new a.ErrnoError(44);if(u.mount!==F.mount)throw new a.ErrnoError(75);var I=a.lookupNode(u,r),J=gt.relative(e,s);if(J.charAt(0)!==".")throw new a.ErrnoError(28);if(J=gt.relative(t,o),J.charAt(0)!==".")throw new a.ErrnoError(55);var L;try{L=a.lookupNode(F,i)}catch{}if(I!==L){var G=a.isDir(I.mode),p=a.mayDelete(u,r,G);if(p)throw new a.ErrnoError(p);if(p=L?a.mayDelete(F,i,G):a.mayCreate(F,i),p)throw new a.ErrnoError(p);if(!u.node_ops.rename)throw new a.ErrnoError(63);if(a.isMountpoint(I)||L&&a.isMountpoint(L))throw new a.ErrnoError(10);if(F!==u&&(p=a.nodePermissions(u,"w"),p))throw new a.ErrnoError(p);a.hashRemoveNode(I);try{u.node_ops.rename(I,F,i),I.parent=F}catch(z){throw z}finally{a.hashAddNode(I)}}},rmdir(e){var t=a.lookupPath(e,{parent:!0}).node,o=Le.basename(e),s=a.lookupNode(t,o),r=a.mayDelete(t,o,!0);if(r)throw new a.ErrnoError(r);if(!t.node_ops.rmdir)throw new a.ErrnoError(63);if(a.isMountpoint(s))throw new a.ErrnoError(10);t.node_ops.rmdir(t,o),a.destroyNode(s)},readdir(e){var t=a.lookupPath(e,{follow:!0}).node;return a.checkOpExists(t.node_ops.readdir,54)(t)},unlink(e){var t=a.lookupPath(e,{parent:!0}).node;if(!t)throw new a.ErrnoError(44);var o=Le.basename(e),s=a.lookupNode(t,o),r=a.mayDelete(t,o,!1);if(r)throw new a.ErrnoError(r);if(!t.node_ops.unlink)throw new a.ErrnoError(63);if(a.isMountpoint(s))throw new a.ErrnoError(10);t.node_ops.unlink(t,o),a.destroyNode(s)},readlink(e){var t=a.lookupPath(e).node;if(!t)throw new a.ErrnoError(44);if(!t.node_ops.readlink)throw new a.ErrnoError(28);return t.node_ops.readlink(t)},stat(e,t){var o=a.lookupPath(e,{follow:!t}).node;return a.checkOpExists(o.node_ops.getattr,63)(o)},fstat(e){var t=a.getStreamChecked(e),o=t.node,s=t.stream_ops.getattr,r=s?t:o;return s??=o.node_ops.getattr,a.checkOpExists(s,63),s(r)},lstat(e){return a.stat(e,!0)},doChmod(e,t,o,s){a.doSetAttr(e,t,{mode:o&4095|t.mode&-4096,ctime:Date.now(),dontFollow:s})},chmod(e,t,o){var s;typeof e=="string"?s=a.lookupPath(e,{follow:!o}).node:s=e,a.doChmod(null,s,t,o)},lchmod(e,t){a.chmod(e,t,!0)},fchmod(e,t){var o=a.getStreamChecked(e);a.doChmod(o,o.node,t,!1)},doChown(e,t,o){a.doSetAttr(e,t,{timestamp:Date.now(),dontFollow:o})},chown(e,t,o,s){var r;typeof e=="string"?r=a.lookupPath(e,{follow:!s}).node:r=e,a.doChown(null,r,s)},lchown(e,t,o){a.chown(e,t,o,!0)},fchown(e,t,o){var s=a.getStreamChecked(e);a.doChown(s,s.node,!1)},doTruncate(e,t,o){if(a.isDir(t.mode))throw new a.ErrnoError(31);if(!a.isFile(t.mode))throw new a.ErrnoError(28);var s=a.nodePermissions(t,"w");if(s)throw new a.ErrnoError(s);a.doSetAttr(e,t,{size:o,timestamp:Date.now()})},truncate(e,t){if(t<0)throw new a.ErrnoError(28);var o;typeof e=="string"?o=a.lookupPath(e,{follow:!0}).node:o=e,a.doTruncate(null,o,t)},ftruncate(e,t){var o=a.getStreamChecked(e);if(t<0||(o.flags&2097155)===0)throw new a.ErrnoError(28);a.doTruncate(o,o.node,t)},utime(e,t,o){var s=a.lookupPath(e,{follow:!0}).node;a.checkOpExists(s.node_ops.setattr,63)(s,{atime:t,mtime:o})},open(e,t,o=438){if(e==="")throw new a.ErrnoError(44);t=typeof t=="string"?Cr(t):t,t&64?o=o&4095|32768:o=0;var s,r;if(typeof e=="object")s=e;else{r=e.endsWith("/");var i=a.lookupPath(e,{follow:!(t&131072),noent_okay:!0});s=i.node,e=i.path}var n=!1;if(t&64)if(s){if(t&128)throw new a.ErrnoError(20)}else{if(r)throw new a.ErrnoError(31);s=a.mknod(e,o|511,0),n=!0}if(!s)throw new a.ErrnoError(44);if(a.isChrdev(s.mode)&&(t&=-513),t&65536&&!a.isDir(s.mode))throw new a.ErrnoError(54);if(!n){var u=a.mayOpen(s,t);if(u)throw new a.ErrnoError(u)}t&512&&!n&&a.truncate(s,0),t&=-131713;var F=a.createStream({node:s,path:a.getPath(s),flags:t,seekable:!0,position:0,stream_ops:s.stream_ops,ungotten:[],error:!1});return F.stream_ops.open&&F.stream_ops.open(F),n&&a.chmod(s,o&511),c.logReadFiles&&!(t&1)&&(e in a.readFiles||(a.readFiles[e]=1)),F},close(e){if(a.isClosed(e))throw new a.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(t){throw t}finally{a.closeStream(e.fd)}e.fd=null},isClosed(e){return e.fd===null},llseek(e,t,o){if(a.isClosed(e))throw new a.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new a.ErrnoError(70);if(o!=0&&o!=1&&o!=2)throw new a.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,o),e.ungotten=[],e.position},read(e,t,o,s,r){if(s<0||r<0)throw new a.ErrnoError(28);if(a.isClosed(e))throw new a.ErrnoError(8);if((e.flags&2097155)===1)throw new a.ErrnoError(8);if(a.isDir(e.node.mode))throw new a.ErrnoError(31);if(!e.stream_ops.read)throw new a.ErrnoError(28);var i=typeof r<"u";if(!i)r=e.position;else if(!e.seekable)throw new a.ErrnoError(70);var n=e.stream_ops.read(e,t,o,s,r);return i||(e.position+=n),n},write(e,t,o,s,r,i){if(s<0||r<0)throw new a.ErrnoError(28);if(a.isClosed(e))throw new a.ErrnoError(8);if((e.flags&2097155)===0)throw new a.ErrnoError(8);if(a.isDir(e.node.mode))throw new a.ErrnoError(31);if(!e.stream_ops.write)throw new a.ErrnoError(28);e.seekable&&e.flags&1024&&a.llseek(e,0,2);var n=typeof r<"u";if(!n)r=e.position;else if(!e.seekable)throw new a.ErrnoError(70);var u=e.stream_ops.write(e,t,o,s,r,i);return n||(e.position+=u),u},mmap(e,t,o,s,r){if((s&2)!==0&&(r&2)===0&&(e.flags&2097155)!==2)throw new a.ErrnoError(2);if((e.flags&2097155)===1)throw new a.ErrnoError(2);if(!e.stream_ops.mmap)throw new a.ErrnoError(43);if(!t)throw new a.ErrnoError(28);return e.stream_ops.mmap(e,t,o,s,r)},msync(e,t,o,s,r){return e.stream_ops.msync?e.stream_ops.msync(e,t,o,s,r):0},ioctl(e,t,o){if(!e.stream_ops.ioctl)throw new a.ErrnoError(59);return e.stream_ops.ioctl(e,t,o)},readFile(e,t={}){t.flags=t.flags||0,t.encoding=t.encoding||"binary",t.encoding!=="utf8"&&t.encoding!=="binary"&&ot(`Invalid encoding type "${t.encoding}"`);var o=a.open(e,t.flags),s=a.stat(e).size,r=new Uint8Array(s);return a.read(o,r,0,s,0),t.encoding==="utf8"&&(r=Et(r)),a.close(o),r},writeFile(e,t,o={}){o.flags=o.flags||577;var s=a.open(e,o.flags,o.mode);typeof t=="string"&&(t=new Uint8Array(Mt(t))),ArrayBuffer.isView(t)?a.write(s,t,0,t.byteLength,void 0,o.canOwn):ot("Unsupported data type"),a.close(s)},cwd:()=>a.currentPath,chdir(e){var t=a.lookupPath(e,{follow:!0});if(t.node===null)throw new a.ErrnoError(44);if(!a.isDir(t.node.mode))throw new a.ErrnoError(54);var o=a.nodePermissions(t.node,"x");if(o)throw new a.ErrnoError(o);a.currentPath=t.path},createDefaultDirectories(){a.mkdir("/tmp"),a.mkdir("/home"),a.mkdir("/home/web_user")},createDefaultDevices(){a.mkdir("/dev"),a.registerDevice(a.makedev(1,3),{read:()=>0,write:(s,r,i,n,u)=>n,llseek:()=>0}),a.mkdev("/dev/null",a.makedev(1,3)),ft.register(a.makedev(5,0),ft.default_tty_ops),ft.register(a.makedev(6,0),ft.default_tty1_ops),a.mkdev("/dev/tty",a.makedev(5,0)),a.mkdev("/dev/tty1",a.makedev(6,0));var e=new Uint8Array(1024),t=0,o=()=>(t===0&&(Xt(e),t=e.byteLength),e[--t]);a.createDevice("/dev","random",o),a.createDevice("/dev","urandom",o),a.mkdir("/dev/shm"),a.mkdir("/dev/shm/tmp")},createSpecialDirectories(){a.mkdir("/proc");var e=a.mkdir("/proc/self");a.mkdir("/proc/self/fd"),a.mount({mount(){var t=a.createNode(e,"fd",16895,73);return t.stream_ops={llseek:ve.stream_ops.llseek},t.node_ops={lookup(o,s){var r=+s,i=a.getStreamChecked(r),n={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>i.path},id:r+1};return n.parent=n,n},readdir(){return Array.from(a.streams.entries()).filter(([o,s])=>s).map(([o,s])=>o.toString())}},t}},{},"/proc/self/fd")},createStandardStreams(e,t,o){e?a.createDevice("/dev","stdin",e):a.symlink("/dev/tty","/dev/stdin"),t?a.createDevice("/dev","stdout",null,t):a.symlink("/dev/tty","/dev/stdout"),o?a.createDevice("/dev","stderr",null,o):a.symlink("/dev/tty1","/dev/stderr"),a.open("/dev/stdin",0),a.open("/dev/stdout",1),a.open("/dev/stderr",1)},staticInit(){a.nameTable=new Array(4096),a.mount(ve,{},"/"),a.createDefaultDirectories(),a.createDefaultDevices(),a.createSpecialDirectories(),a.filesystems={MEMFS:ve}},init(e,t,o){a.initialized=!0,e??=c.stdin,t??=c.stdout,o??=c.stderr,a.createStandardStreams(e,t,o)},quit(){a.initialized=!1;for(var e of a.streams)e&&a.close(e)},findObject(e,t){var o=a.analyzePath(e,t);return o.exists?o.object:null},analyzePath(e,t){try{var o=a.lookupPath(e,{follow:!t});e=o.path}catch{}var s={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var o=a.lookupPath(e,{parent:!0});s.parentExists=!0,s.parentPath=o.path,s.parentObject=o.node,s.name=Le.basename(e),o=a.lookupPath(e,{follow:!t}),s.exists=!0,s.path=o.path,s.object=o.node,s.name=o.node.name,s.isRoot=o.path==="/"}catch(r){s.error=r.errno}return s},createPath(e,t,o,s){e=typeof e=="string"?e:a.getPath(e);for(var r=t.split("/").reverse();r.length;){var i=r.pop();if(i){var n=Le.join2(e,i);try{a.mkdir(n)}catch(u){if(u.errno!=20)throw u}e=n}}return n},createFile(e,t,o,s,r){var i=Le.join2(typeof e=="string"?e:a.getPath(e),t),n=jt(s,r);return a.create(i,n)},createDataFile(e,t,o,s,r,i){var n=t;e&&(e=typeof e=="string"?e:a.getPath(e),n=t?Le.join2(e,t):e);var u=jt(s,r),F=a.create(n,u);if(o){if(typeof o=="string"){for(var I=new Array(o.length),J=0,L=o.length;J<L;++J)I[J]=o.charCodeAt(J);o=I}a.chmod(F,u|146);var G=a.open(F,577);a.write(G,o,0,o.length,0,i),a.close(G),a.chmod(F,u)}},createDevice(e,t,o,s){var r=Le.join2(typeof e=="string"?e:a.getPath(e),t),i=jt(!!o,!!s);a.createDevice.major??=64;var n=a.makedev(a.createDevice.major++,0);return a.registerDevice(n,{open(u){u.seekable=!1},close(u){s?.buffer?.length&&s(10)},read(u,F,I,J,L){for(var G=0,p=0;p<J;p++){var z;try{z=o()}catch{throw new a.ErrnoError(29)}if(z===void 0&&G===0)throw new a.ErrnoError(6);if(z==null)break;G++,F[I+p]=z}return G&&(u.node.atime=Date.now()),G},write(u,F,I,J,L){for(var G=0;G<J;G++)try{s(F[I+G])}catch{throw new a.ErrnoError(29)}return J&&(u.node.mtime=u.node.ctime=Date.now()),G}}),a.mkdev(r,i,n)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if(globalThis.XMLHttpRequest)ot("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");else try{e.contents=Be(e.url)}catch{throw new a.ErrnoError(29)}},createLazyFile(e,t,o,s,r){class i{lengthKnown=!1;chunks=[];get(L){if(!(L>this.length-1||L<0)){var G=L%this.chunkSize,p=L/this.chunkSize|0;return this.getter(p)[G]}}setDataGetter(L){this.getter=L}cacheLength(){var L=new XMLHttpRequest;L.open("HEAD",o,!1),L.send(null),L.status>=200&&L.status<300||L.status===304||ot("Couldn't load "+o+". Status: "+L.status);var G=Number(L.getResponseHeader("Content-length")),p,z=(p=L.getResponseHeader("Accept-Ranges"))&&p==="bytes",R=(p=L.getResponseHeader("Content-Encoding"))&&p==="gzip",te=1024*1024;z||(te=G);var y=(C,U)=>{C>U&&ot("invalid range ("+C+", "+U+") or no bytes requested!"),U>G-1&&ot("only "+G+" bytes available! programmer error!");var w=new XMLHttpRequest;return w.open("GET",o,!1),G!==te&&w.setRequestHeader("Range","bytes="+C+"-"+U),w.responseType="arraybuffer",w.overrideMimeType&&w.overrideMimeType("text/plain; charset=x-user-defined"),w.send(null),w.status>=200&&w.status<300||w.status===304||ot("Couldn't load "+o+". Status: "+w.status),w.response!==void 0?new Uint8Array(w.response||[]):Mt(w.responseText||"")},b=this;b.setDataGetter(C=>{var U=C*te,w=(C+1)*te-1;return w=Math.min(w,G-1),typeof b.chunks[C]>"u"&&(b.chunks[C]=y(U,w)),typeof b.chunks[C]>"u"&&ot("doXHR failed!"),b.chunks[C]}),(R||!G)&&(te=G=1,G=this.getter(0).length,te=G,he("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=G,this._chunkSize=te,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(globalThis.XMLHttpRequest){Ae||ot("Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc");var n={isDevice:!1,contents:new i}}else var n={isDevice:!1,url:o};var u=a.createFile(e,t,n,s,r);n.contents?u.contents=n.contents:n.url&&(u.contents=null,u.url=n.url),Object.defineProperties(u,{usedBytes:{get:function(){return this.contents.length}}});var F={};for(const[J,L]of Object.entries(u.stream_ops))F[J]=(...G)=>(a.forceLoadFile(u),L(...G));function I(J,L,G,p,z){var R=J.node.contents;if(z>=R.length)return 0;var te=Math.min(R.length-z,p);if(R.slice)for(var y=0;y<te;y++)L[G+y]=R[z+y];else for(var y=0;y<te;y++)L[G+y]=R.get(z+y);return te}return F.read=(J,L,G,p,z)=>(a.forceLoadFile(u),I(J,L,G,p,z)),F.mmap=(J,L,G,p,z)=>{a.forceLoadFile(u);var R=rr(L);if(!R)throw new a.ErrnoError(48);return I(J,Xe,R,L,G),{ptr:R,allocated:!0}},u.stream_ops=F,u}},Wr=(e,t,o)=>{if(!e)return"";var s=Zt(_t,e,t);return Yt.decode(_t.subarray(e,s))},Ie={calculateAt(e,t,o){if(Le.isAbs(t))return t;var s;if(e===-100?s=a.cwd():s=Ie.getStreamFromFD(e).path,t.length==0){if(!o)throw new a.ErrnoError(44);return s}return s+"/"+t},writeStat(e,t){Me[e>>2]=t.dev,Me[e+4>>2]=t.mode,Me[e+8>>2]=t.nlink,Me[e+12>>2]=t.uid,Me[e+16>>2]=t.gid,Me[e+20>>2]=t.rdev,Ge[e+24>>3]=BigInt(t.size),Ne[e+32>>2]=4096,Ne[e+36>>2]=t.blocks;var o=t.atime.getTime(),s=t.mtime.getTime(),r=t.ctime.getTime();return Ge[e+40>>3]=BigInt(Math.floor(o/1e3)),Me[e+48>>2]=o%1e3*1e3*1e3,Ge[e+56>>3]=BigInt(Math.floor(s/1e3)),Me[e+64>>2]=s%1e3*1e3*1e3,Ge[e+72>>3]=BigInt(Math.floor(r/1e3)),Me[e+80>>2]=r%1e3*1e3*1e3,Ge[e+88>>3]=BigInt(t.ino),0},writeStatFs(e,t){Me[e+4>>2]=t.bsize,Me[e+60>>2]=t.bsize,Ge[e+8>>3]=BigInt(t.blocks),Ge[e+16>>3]=BigInt(t.bfree),Ge[e+24>>3]=BigInt(t.bavail),Ge[e+32>>3]=BigInt(t.files),Ge[e+40>>3]=BigInt(t.ffree),Me[e+48>>2]=t.fsid,Me[e+64>>2]=t.flags,Me[e+56>>2]=t.namelen},doMsync(e,t,o,s,r){if(!a.isFile(t.node.mode))throw new a.ErrnoError(43);if(s&2)return 0;var i=_t.slice(e,e+o);a.msync(t,i,r,o,s)},getStreamFromFD(e){return a.getStreamChecked(e)},varargs:void 0,getStr(e){return Wr(e)}};function Qr(e,t){try{return e=Ie.getStr(e),a.chmod(e,t),0}catch(o){if(typeof a>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}function Vr(e,t,o,s){try{if(t=Ie.getStr(t),t=Ie.calculateAt(e,t),o&-8)return-28;var r=a.lookupPath(t,{follow:!0}).node;if(!r)return-44;var i="";return o&4&&(i+="r"),o&2&&(i+="w"),o&1&&(i+="x"),i&&a.nodePermissions(r,i)?-2:0}catch(n){if(typeof a>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}function Hr(e,t){try{return a.fchmod(e,t),0}catch(o){if(typeof a>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}function Gr(e,t,o){try{return a.fchown(e,t,o),0}catch(s){if(typeof a>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}var Ft=()=>{var e=Ne[+Ie.varargs>>2];return Ie.varargs+=4,e},bt=Ft;function $r(e,t,o){Ie.varargs=o;try{var s=Ie.getStreamFromFD(e);switch(t){case 0:var r=Ft();if(r<0)return-28;for(;a.streams[r];)r++;return a.dupStream(s,r).fd;case 1:case 2:return 0;case 3:return s.flags;case 4:var r=Ft();return s.flags|=r,0;case 12:var r=bt(),i=0;return vt[r+i>>1]=2,0;case 13:case 14:return 0}return-28}catch(n){if(typeof a>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}function Kr(e,t){try{return Ie.writeStat(t,a.fstat(e))}catch(o){if(typeof a>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}var Jr=9007199254740992,Xr=-9007199254740992,wt=e=>e<Xr||e>Jr?NaN:Number(e);function Yr(e,t){t=wt(t);try{return isNaN(t)?-61:(a.ftruncate(e,t),0)}catch(o){if(typeof a>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}var pt=(e,t,o)=>er(e,_t,t,o);function Zr(e,t){try{if(t===0)return-28;var o=a.cwd(),s=xt(o)+1;return t<s?-68:(pt(o,e,t),s)}catch(r){if(typeof a>"u"||r.name!=="ErrnoError")throw r;return-r.errno}}function en(e,t,o){Ie.varargs=o;try{var s=Ie.getStreamFromFD(e);switch(t){case 21509:return s.tty?0:-59;case 21505:if(!s.tty)return-59;if(s.tty.ops.ioctl_tcgets){var r=s.tty.ops.ioctl_tcgets(s),L=bt();Ne[L>>2]=r.c_iflag||0,Ne[L+4>>2]=r.c_oflag||0,Ne[L+8>>2]=r.c_cflag||0,Ne[L+12>>2]=r.c_lflag||0;for(var i=0;i<32;i++)Xe[L+i+17]=r.c_cc[i]||0;return 0}return 0;case 21510:case 21511:case 21512:return s.tty?0:-59;case 21506:case 21507:case 21508:if(!s.tty)return-59;if(s.tty.ops.ioctl_tcsets){for(var L=bt(),n=Ne[L>>2],u=Ne[L+4>>2],F=Ne[L+8>>2],I=Ne[L+12>>2],J=[],i=0;i<32;i++)J.push(Xe[L+i+17]);return s.tty.ops.ioctl_tcsets(s.tty,t,{c_iflag:n,c_oflag:u,c_cflag:F,c_lflag:I,c_cc:J})}return 0;case 21519:if(!s.tty)return-59;var L=bt();return Ne[L>>2]=0,0;case 21520:return s.tty?-28:-59;case 21537:case 21531:var L=bt();return a.ioctl(s,t,L);case 21523:if(!s.tty)return-59;if(s.tty.ops.ioctl_tiocgwinsz){var G=s.tty.ops.ioctl_tiocgwinsz(s.tty),L=bt();vt[L>>1]=G[0],vt[L+2>>1]=G[1]}return 0;case 21524:return s.tty?0:-59;case 21515:return s.tty?0:-59;default:return-28}}catch(p){if(typeof a>"u"||p.name!=="ErrnoError")throw p;return-p.errno}}function tn(e,t){try{return e=Ie.getStr(e),Ie.writeStat(t,a.lstat(e))}catch(o){if(typeof a>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}function rn(e,t,o){try{return t=Ie.getStr(t),t=Ie.calculateAt(e,t),a.mkdir(t,o,0),0}catch(s){if(typeof a>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}function nn(e,t,o,s){try{t=Ie.getStr(t);var r=s&256,i=s&4096;return s=s&-6401,t=Ie.calculateAt(e,t,i),Ie.writeStat(o,r?a.lstat(t):a.stat(t))}catch(n){if(typeof a>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}function sn(e,t,o,s){Ie.varargs=s;try{t=Ie.getStr(t),t=Ie.calculateAt(e,t);var r=s?Ft():0;return a.open(t,o,r).fd}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}function on(e,t,o,s){try{if(t=Ie.getStr(t),t=Ie.calculateAt(e,t),s<=0)return-28;var r=a.readlink(t),i=Math.min(s,xt(r)),n=Xe[o+i];return pt(r,o,s+1),Xe[o+i]=n,i}catch(u){if(typeof a>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function ln(e){try{return e=Ie.getStr(e),a.rmdir(e),0}catch(t){if(typeof a>"u"||t.name!=="ErrnoError")throw t;return-t.errno}}function an(e,t){try{return e=Ie.getStr(e),Ie.writeStat(t,a.stat(e))}catch(o){if(typeof a>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}function cn(e,t,o){try{if(t=Ie.getStr(t),t=Ie.calculateAt(e,t),!o)a.unlink(t);else if(o===512)a.rmdir(t);else return-28;return 0}catch(s){if(typeof a>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}var sr=e=>Me[e>>2]+Ne[e+4>>2]*4294967296;function un(e,t,o,s){try{t=Ie.getStr(t),t=Ie.calculateAt(e,t,!0);var r=Date.now(),i,n;if(!o)i=r,n=r;else{var u=sr(o),F=Ne[o+8>>2];F==1073741823?i=r:F==1073741822?i=null:i=u*1e3+F/(1e3*1e3),o+=16,u=sr(o),F=Ne[o+8>>2],F==1073741823?n=r:F==1073741822?n=null:n=u*1e3+F/(1e3*1e3)}return(n??i)!==null&&a.utime(t,i,n),0}catch(I){if(typeof a>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}var _n=e=>e%4===0&&(e%100!==0||e%400===0),fn=[0,31,60,91,121,152,182,213,244,274,305,335],dn=[0,31,59,90,120,151,181,212,243,273,304,334],pn=e=>(_n(e.getFullYear())?fn:dn)[e.getMonth()]+e.getDate()-1;function hn(e,t){e=wt(e);var o=new Date(e*1e3);Ne[t>>2]=o.getSeconds(),Ne[t+4>>2]=o.getMinutes(),Ne[t+8>>2]=o.getHours(),Ne[t+12>>2]=o.getDate(),Ne[t+16>>2]=o.getMonth(),Ne[t+20>>2]=o.getFullYear()-1900,Ne[t+24>>2]=o.getDay();var s=pn(o)|0;Ne[t+28>>2]=s,Ne[t+36>>2]=-(o.getTimezoneOffset()*60);var r=new Date(o.getFullYear(),0,1),i=new Date(o.getFullYear(),6,1).getTimezoneOffset(),n=r.getTimezoneOffset(),u=(i!=n&&o.getTimezoneOffset()==Math.min(n,i))|0;Ne[t+32>>2]=u}function mn(e,t,o,s,r,i,n){r=wt(r);try{var u=Ie.getStreamFromFD(s),F=a.mmap(u,e,r,t,o),I=F.ptr;return Ne[i>>2]=F.allocated,Me[n>>2]=I,0}catch(J){if(typeof a>"u"||J.name!=="ErrnoError")throw J;return-J.errno}}function gn(e,t,o,s,r,i){i=wt(i);try{var n=Ie.getStreamFromFD(r);o&2&&Ie.doMsync(e,n,t,s,i)}catch(u){if(typeof a>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}var bn=(e,t,o,s)=>{var r=new Date().getFullYear(),i=new Date(r,0,1),n=new Date(r,6,1),u=i.getTimezoneOffset(),F=n.getTimezoneOffset(),I=Math.max(u,F);Me[e>>2]=I*60,Ne[t>>2]=+(u!=F);var J=p=>{var z=p>=0?"-":"+",R=Math.abs(p);return`UTC${z}${String(Math.floor(R/60)).padStart(2,"0")}${String(R%60).padStart(2,"0")}`},L=J(u),G=J(F);F<u?(pt(L,o,17),pt(G,s,17)):(pt(L,s,17),pt(G,o,17))},or=()=>performance.now(),lr=()=>Date.now(),yn=e=>e>=0&&e<=3;function qn(e,t,o){if(!yn(e))return 28;var s;e===0?s=lr():s=or();var r=Math.round(s*1e3*1e3);return Ge[o>>3]=BigInt(r),0}var ar=()=>2147483648,vn=()=>ar(),En=e=>{var t=(e-lt.buffer.byteLength+65535)/65536|0;try{return lt.grow(t),Gt(),1}catch{}},Sn=e=>{var t=_t.length;e>>>=0;var o=ar();if(e>o)return!1;for(var s=1;s<=4;s*=2){var r=t*(1+.2/s);if(r=Math.min(r,e+100663296),En(Math.min(o,tr(Math.max(e,r),65536))))return!0}return!1},zt={},wn=()=>qe||"./this.program",At=()=>{if(!At.strings){var e=(globalThis.navigator?.language??"C").replace("-","_")+".UTF-8",t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:wn()};for(var o in zt)zt[o]===void 0?delete t[o]:t[o]=zt[o];var s=[];for(var o in t)s.push(`${o}=${t[o]}`);At.strings=s}return At.strings},An=(e,t)=>{var o=0,s=0;for(var r of At()){var i=t+o;Me[e+s>>2]=i,o+=pt(r,i,1/0)+1,s+=4}return 0},Tn=(e,t)=>{var o=At();Me[e>>2]=o.length;var s=0;for(var r of o)s+=xt(r)+1;return Me[t>>2]=s,0};function In(e){try{var t=Ie.getStreamFromFD(e);return a.close(t),0}catch(o){if(typeof a>"u"||o.name!=="ErrnoError")throw o;return o.errno}}function kn(e,t){try{var o=0,s=0,r=0,i=Ie.getStreamFromFD(e),n=i.tty?2:a.isDir(i.mode)?3:a.isLink(i.mode)?7:4;return Xe[t]=n,vt[t+2>>1]=r,Ge[t+8>>3]=BigInt(o),Ge[t+16>>3]=BigInt(s),0}catch(u){if(typeof a>"u"||u.name!=="ErrnoError")throw u;return u.errno}}var On=(e,t,o,s)=>{for(var r=0,i=0;i<o;i++){var n=Me[t>>2],u=Me[t+4>>2];t+=8;var F=a.read(e,Xe,n,u,s);if(F<0)return-1;if(r+=F,F<u)break}return r};function Pn(e,t,o,s){try{var r=On(Ie.getStreamFromFD(e),t,o);return Me[s>>2]=r,0}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return i.errno}}function xn(e,t,o,s){t=wt(t);try{if(isNaN(t))return 61;var r=Ie.getStreamFromFD(e);return a.llseek(r,t,o),Ge[s>>3]=BigInt(r.position),r.getdents&&t===0&&o===0&&(r.getdents=null),0}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return i.errno}}function Fn(e){try{var t=Ie.getStreamFromFD(e);return t.stream_ops?.fsync?.(t)}catch(o){if(typeof a>"u"||o.name!=="ErrnoError")throw o;return o.errno}}var Nn=(e,t,o,s)=>{for(var r=0,i=0;i<o;i++){var n=Me[t>>2],u=Me[t+4>>2];t+=8;var F=a.write(e,Xe,n,u,s);if(F<0)return-1;if(r+=F,F<u)break}return r};function Ln(e,t,o,s){try{var r=Nn(Ie.getStreamFromFD(e),t,o);return Me[s>>2]=r,0}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return i.errno}}if(a.createPreloadedFile=Ur,a.preloadFile=ir,a.staticInit(),qr(),c.noExitRuntime&&c.noExitRuntime,c.preloadPlugins&&(nr=c.preloadPlugins),c.print&&(he=c.print),c.printErr&&(xe=c.printErr),c.wasmBinary&&(We=c.wasmBinary),c.arguments&&c.arguments,c.thisProgram&&(qe=c.thisProgram),c.preInit)for(typeof c.preInit=="function"&&(c.preInit=[c.preInit]);c.preInit.length>0;)c.preInit.shift()();c.wasmMemory=lt;var cr;function Rn(e){c._sqlite3_status64=e.sqlite3_status64,c._sqlite3_status=e.sqlite3_status,c._sqlite3_db_status64=e.sqlite3_db_status64,c._sqlite3_msize=e.sqlite3_msize,c._sqlite3_db_status=e.sqlite3_db_status,c._sqlite3_vfs_find=e.sqlite3_vfs_find,c._sqlite3_initialize=e.sqlite3_initialize,c._sqlite3_malloc=e.sqlite3_malloc,c._sqlite3_free=e.sqlite3_free,c._sqlite3_vfs_register=e.sqlite3_vfs_register,c._sqlite3_vfs_unregister=e.sqlite3_vfs_unregister,c._sqlite3_malloc64=e.sqlite3_malloc64,c._sqlite3_realloc=e.sqlite3_realloc,c._sqlite3_realloc64=e.sqlite3_realloc64,c._sqlite3_value_text=e.sqlite3_value_text,c._sqlite3_randomness=e.sqlite3_randomness,c._sqlite3_stricmp=e.sqlite3_stricmp,c._sqlite3_strnicmp=e.sqlite3_strnicmp,c._sqlite3_uri_parameter=e.sqlite3_uri_parameter,c._sqlite3_uri_boolean=e.sqlite3_uri_boolean,c._sqlite3_serialize=e.sqlite3_serialize,c._sqlite3_prepare_v2=e.sqlite3_prepare_v2,c._sqlite3_step=e.sqlite3_step,c._sqlite3_column_int64=e.sqlite3_column_int64,c._sqlite3_reset=e.sqlite3_reset,c._sqlite3_exec=e.sqlite3_exec,c._sqlite3_column_int=e.sqlite3_column_int,c._sqlite3_finalize=e.sqlite3_finalize,c._sqlite3_file_control=e.sqlite3_file_control,c._sqlite3_column_name=e.sqlite3_column_name,c._sqlite3_column_text=e.sqlite3_column_text,c._sqlite3_column_type=e.sqlite3_column_type,c._sqlite3_errmsg=e.sqlite3_errmsg,c._sqlite3_deserialize=e.sqlite3_deserialize,c._sqlite3_clear_bindings=e.sqlite3_clear_bindings,c._sqlite3_value_blob=e.sqlite3_value_blob,c._sqlite3_value_bytes=e.sqlite3_value_bytes,c._sqlite3_value_double=e.sqlite3_value_double,c._sqlite3_value_int=e.sqlite3_value_int,c._sqlite3_value_int64=e.sqlite3_value_int64,c._sqlite3_value_subtype=e.sqlite3_value_subtype,c._sqlite3_value_pointer=e.sqlite3_value_pointer,c._sqlite3_value_type=e.sqlite3_value_type,c._sqlite3_value_nochange=e.sqlite3_value_nochange,c._sqlite3_value_frombind=e.sqlite3_value_frombind,c._sqlite3_value_dup=e.sqlite3_value_dup,c._sqlite3_value_free=e.sqlite3_value_free,c._sqlite3_result_blob=e.sqlite3_result_blob,c._sqlite3_result_error_toobig=e.sqlite3_result_error_toobig,c._sqlite3_result_error_nomem=e.sqlite3_result_error_nomem,c._sqlite3_result_double=e.sqlite3_result_double,c._sqlite3_result_error=e.sqlite3_result_error,c._sqlite3_result_int=e.sqlite3_result_int,c._sqlite3_result_int64=e.sqlite3_result_int64,c._sqlite3_result_null=e.sqlite3_result_null,c._sqlite3_result_pointer=e.sqlite3_result_pointer,c._sqlite3_result_subtype=e.sqlite3_result_subtype,c._sqlite3_result_text=e.sqlite3_result_text,c._sqlite3_result_zeroblob=e.sqlite3_result_zeroblob,c._sqlite3_result_zeroblob64=e.sqlite3_result_zeroblob64,c._sqlite3_result_error_code=e.sqlite3_result_error_code,c._sqlite3_user_data=e.sqlite3_user_data,c._sqlite3_context_db_handle=e.sqlite3_context_db_handle,c._sqlite3_vtab_nochange=e.sqlite3_vtab_nochange,c._sqlite3_vtab_in_first=e.sqlite3_vtab_in_first,c._sqlite3_vtab_in_next=e.sqlite3_vtab_in_next,c._sqlite3_aggregate_context=e.sqlite3_aggregate_context,c._sqlite3_get_auxdata=e.sqlite3_get_auxdata,c._sqlite3_set_auxdata=e.sqlite3_set_auxdata,c._sqlite3_column_count=e.sqlite3_column_count,c._sqlite3_data_count=e.sqlite3_data_count,c._sqlite3_column_blob=e.sqlite3_column_blob,c._sqlite3_column_bytes=e.sqlite3_column_bytes,c._sqlite3_column_double=e.sqlite3_column_double,c._sqlite3_column_value=e.sqlite3_column_value,c._sqlite3_column_decltype=e.sqlite3_column_decltype,c._sqlite3_column_database_name=e.sqlite3_column_database_name,c._sqlite3_column_table_name=e.sqlite3_column_table_name,c._sqlite3_column_origin_name=e.sqlite3_column_origin_name,c._sqlite3_bind_blob=e.sqlite3_bind_blob,c._sqlite3_bind_double=e.sqlite3_bind_double,c._sqlite3_bind_int=e.sqlite3_bind_int,c._sqlite3_bind_int64=e.sqlite3_bind_int64,c._sqlite3_bind_null=e.sqlite3_bind_null,c._sqlite3_bind_pointer=e.sqlite3_bind_pointer,c._sqlite3_bind_text=e.sqlite3_bind_text,c._sqlite3_bind_parameter_count=e.sqlite3_bind_parameter_count,c._sqlite3_bind_parameter_name=e.sqlite3_bind_parameter_name,c._sqlite3_bind_parameter_index=e.sqlite3_bind_parameter_index,c._sqlite3_db_handle=e.sqlite3_db_handle,c._sqlite3_stmt_readonly=e.sqlite3_stmt_readonly,c._sqlite3_stmt_isexplain=e.sqlite3_stmt_isexplain,c._sqlite3_stmt_explain=e.sqlite3_stmt_explain,c._sqlite3_stmt_busy=e.sqlite3_stmt_busy,c._sqlite3_next_stmt=e.sqlite3_next_stmt,c._sqlite3_stmt_status=e.sqlite3_stmt_status,c._sqlite3_sql=e.sqlite3_sql,c._sqlite3_expanded_sql=e.sqlite3_expanded_sql,c._sqlite3_preupdate_old=e.sqlite3_preupdate_old,c._sqlite3_preupdate_count=e.sqlite3_preupdate_count,c._sqlite3_preupdate_depth=e.sqlite3_preupdate_depth,c._sqlite3_preupdate_blobwrite=e.sqlite3_preupdate_blobwrite,c._sqlite3_preupdate_new=e.sqlite3_preupdate_new,c._sqlite3_value_numeric_type=e.sqlite3_value_numeric_type,c._sqlite3_set_authorizer=e.sqlite3_set_authorizer,c._sqlite3_strglob=e.sqlite3_strglob,c._sqlite3_strlike=e.sqlite3_strlike,c._sqlite3_auto_extension=e.sqlite3_auto_extension,c._sqlite3_cancel_auto_extension=e.sqlite3_cancel_auto_extension,c._sqlite3_reset_auto_extension=e.sqlite3_reset_auto_extension,c._sqlite3_prepare_v3=e.sqlite3_prepare_v3,c._sqlite3_create_module=e.sqlite3_create_module,c._sqlite3_create_module_v2=e.sqlite3_create_module_v2,c._sqlite3_drop_modules=e.sqlite3_drop_modules,c._sqlite3_declare_vtab=e.sqlite3_declare_vtab,c._sqlite3_vtab_on_conflict=e.sqlite3_vtab_on_conflict,c._sqlite3_vtab_collation=e.sqlite3_vtab_collation,c._sqlite3_vtab_in=e.sqlite3_vtab_in,c._sqlite3_vtab_rhs_value=e.sqlite3_vtab_rhs_value,c._sqlite3_vtab_distinct=e.sqlite3_vtab_distinct,c._sqlite3_keyword_name=e.sqlite3_keyword_name,c._sqlite3_keyword_count=e.sqlite3_keyword_count,c._sqlite3_keyword_check=e.sqlite3_keyword_check,c._sqlite3_complete=e.sqlite3_complete,c._sqlite3_libversion=e.sqlite3_libversion,c._sqlite3_libversion_number=e.sqlite3_libversion_number,c._sqlite3_shutdown=e.sqlite3_shutdown,c._sqlite3_last_insert_rowid=e.sqlite3_last_insert_rowid,c._sqlite3_set_last_insert_rowid=e.sqlite3_set_last_insert_rowid,c._sqlite3_changes64=e.sqlite3_changes64,c._sqlite3_changes=e.sqlite3_changes,c._sqlite3_total_changes64=e.sqlite3_total_changes64,c._sqlite3_total_changes=e.sqlite3_total_changes,c._sqlite3_txn_state=e.sqlite3_txn_state,c._sqlite3_close_v2=e.sqlite3_close_v2,c._sqlite3_busy_handler=e.sqlite3_busy_handler,c._sqlite3_progress_handler=e.sqlite3_progress_handler,c._sqlite3_busy_timeout=e.sqlite3_busy_timeout,c._sqlite3_interrupt=e.sqlite3_interrupt,c._sqlite3_is_interrupted=e.sqlite3_is_interrupted,c._sqlite3_create_function=e.sqlite3_create_function,c._sqlite3_create_function_v2=e.sqlite3_create_function_v2,c._sqlite3_create_window_function=e.sqlite3_create_window_function,c._sqlite3_overload_function=e.sqlite3_overload_function,c._sqlite3_trace_v2=e.sqlite3_trace_v2,c._sqlite3_commit_hook=e.sqlite3_commit_hook,c._sqlite3_update_hook=e.sqlite3_update_hook,c._sqlite3_rollback_hook=e.sqlite3_rollback_hook,c._sqlite3_preupdate_hook=e.sqlite3_preupdate_hook,c._sqlite3_set_errmsg=e.sqlite3_set_errmsg,c._sqlite3_error_offset=e.sqlite3_error_offset,c._sqlite3_errcode=e.sqlite3_errcode,c._sqlite3_extended_errcode=e.sqlite3_extended_errcode,c._sqlite3_errstr=e.sqlite3_errstr,c._sqlite3_limit=e.sqlite3_limit,c._sqlite3_open=e.sqlite3_open,c._sqlite3_open_v2=e.sqlite3_open_v2,c._sqlite3_create_collation=e.sqlite3_create_collation,c._sqlite3_create_collation_v2=e.sqlite3_create_collation_v2,c._sqlite3_collation_needed=e.sqlite3_collation_needed,c._sqlite3_get_autocommit=e.sqlite3_get_autocommit,c._sqlite3_table_column_metadata=e.sqlite3_table_column_metadata,c._sqlite3_extended_result_codes=e.sqlite3_extended_result_codes,c._sqlite3_uri_key=e.sqlite3_uri_key,c._sqlite3_uri_int64=e.sqlite3_uri_int64,c._sqlite3_db_name=e.sqlite3_db_name,c._sqlite3_db_filename=e.sqlite3_db_filename,c._sqlite3_db_readonly=e.sqlite3_db_readonly,c._sqlite3_compileoption_used=e.sqlite3_compileoption_used,c._sqlite3_compileoption_get=e.sqlite3_compileoption_get,c._sqlite3session_diff=e.sqlite3session_diff,c._sqlite3session_attach=e.sqlite3session_attach,c._sqlite3session_create=e.sqlite3session_create,c._sqlite3session_delete=e.sqlite3session_delete,c._sqlite3session_table_filter=e.sqlite3session_table_filter,c._sqlite3session_changeset=e.sqlite3session_changeset,c._sqlite3session_changeset_strm=e.sqlite3session_changeset_strm,c._sqlite3session_patchset_strm=e.sqlite3session_patchset_strm,c._sqlite3session_patchset=e.sqlite3session_patchset,c._sqlite3session_enable=e.sqlite3session_enable,c._sqlite3session_indirect=e.sqlite3session_indirect,c._sqlite3session_isempty=e.sqlite3session_isempty,c._sqlite3session_memory_used=e.sqlite3session_memory_used,c._sqlite3session_object_config=e.sqlite3session_object_config,c._sqlite3session_changeset_size=e.sqlite3session_changeset_size,c._sqlite3changeset_start=e.sqlite3changeset_start,c._sqlite3changeset_start_v2=e.sqlite3changeset_start_v2,c._sqlite3changeset_start_strm=e.sqlite3changeset_start_strm,c._sqlite3changeset_start_v2_strm=e.sqlite3changeset_start_v2_strm,c._sqlite3changeset_next=e.sqlite3changeset_next,c._sqlite3changeset_op=e.sqlite3changeset_op,c._sqlite3changeset_pk=e.sqlite3changeset_pk,c._sqlite3changeset_old=e.sqlite3changeset_old,c._sqlite3changeset_new=e.sqlite3changeset_new,c._sqlite3changeset_conflict=e.sqlite3changeset_conflict,c._sqlite3changeset_fk_conflicts=e.sqlite3changeset_fk_conflicts,c._sqlite3changeset_finalize=e.sqlite3changeset_finalize,c._sqlite3changeset_invert=e.sqlite3changeset_invert,c._sqlite3changeset_invert_strm=e.sqlite3changeset_invert_strm,c._sqlite3changeset_apply_v2=e.sqlite3changeset_apply_v2,c._sqlite3changeset_apply_v3=e.sqlite3changeset_apply_v3,c._sqlite3changeset_apply=e.sqlite3changeset_apply,c._sqlite3changeset_apply_v3_strm=e.sqlite3changeset_apply_v3_strm,c._sqlite3changeset_apply_v2_strm=e.sqlite3changeset_apply_v2_strm,c._sqlite3changeset_apply_strm=e.sqlite3changeset_apply_strm,c._sqlite3changegroup_new=e.sqlite3changegroup_new,c._sqlite3changegroup_add=e.sqlite3changegroup_add,c._sqlite3changegroup_output=e.sqlite3changegroup_output,c._sqlite3changegroup_add_strm=e.sqlite3changegroup_add_strm,c._sqlite3changegroup_output_strm=e.sqlite3changegroup_output_strm,c._sqlite3changegroup_delete=e.sqlite3changegroup_delete,c._sqlite3changeset_concat=e.sqlite3changeset_concat,c._sqlite3changeset_concat_strm=e.sqlite3changeset_concat_strm,c._sqlite3session_config=e.sqlite3session_config,c._sqlite3_sourceid=e.sqlite3_sourceid,c._sqlite3__wasm_pstack_ptr=e.sqlite3__wasm_pstack_ptr,c._sqlite3__wasm_pstack_restore=e.sqlite3__wasm_pstack_restore,c._sqlite3__wasm_pstack_alloc=e.sqlite3__wasm_pstack_alloc,c._sqlite3__wasm_pstack_remaining=e.sqlite3__wasm_pstack_remaining,c._sqlite3__wasm_pstack_quota=e.sqlite3__wasm_pstack_quota,c._sqlite3__wasm_test_struct=e.sqlite3__wasm_test_struct,c._sqlite3__wasm_enum_json=e.sqlite3__wasm_enum_json,c._sqlite3__wasm_vfs_unlink=e.sqlite3__wasm_vfs_unlink,c._sqlite3__wasm_db_vfs=e.sqlite3__wasm_db_vfs,c._sqlite3__wasm_db_reset=e.sqlite3__wasm_db_reset,c._sqlite3__wasm_db_export_chunked=e.sqlite3__wasm_db_export_chunked,c._sqlite3__wasm_db_serialize=e.sqlite3__wasm_db_serialize,c._sqlite3__wasm_vfs_create_file=e.sqlite3__wasm_vfs_create_file,c._sqlite3__wasm_posix_create_file=e.sqlite3__wasm_posix_create_file,c._sqlite3__wasm_kvvfsMakeKey=e.sqlite3__wasm_kvvfsMakeKey,c._sqlite3__wasm_kvvfs_methods=e.sqlite3__wasm_kvvfs_methods,c._sqlite3__wasm_vtab_config=e.sqlite3__wasm_vtab_config,c._sqlite3__wasm_db_config_ip=e.sqlite3__wasm_db_config_ip,c._sqlite3__wasm_db_config_pii=e.sqlite3__wasm_db_config_pii,c._sqlite3__wasm_db_config_s=e.sqlite3__wasm_db_config_s,c._sqlite3__wasm_config_i=e.sqlite3__wasm_config_i,c._sqlite3__wasm_config_ii=e.sqlite3__wasm_config_ii,c._sqlite3__wasm_config_j=e.sqlite3__wasm_config_j,c._sqlite3__wasm_qfmt_token=e.sqlite3__wasm_qfmt_token,c._sqlite3__wasm_kvvfs_decode=e.sqlite3__wasm_kvvfs_decode,c._sqlite3__wasm_kvvfs_encode=e.sqlite3__wasm_kvvfs_encode,c._sqlite3__wasm_init_wasmfs=e.sqlite3__wasm_init_wasmfs,c._sqlite3__wasm_test_intptr=e.sqlite3__wasm_test_intptr,c._sqlite3__wasm_test_voidptr=e.sqlite3__wasm_test_voidptr,c._sqlite3__wasm_test_int64_max=e.sqlite3__wasm_test_int64_max,c._sqlite3__wasm_test_int64_min=e.sqlite3__wasm_test_int64_min,c._sqlite3__wasm_test_int64_times2=e.sqlite3__wasm_test_int64_times2,c._sqlite3__wasm_test_int64_minmax=e.sqlite3__wasm_test_int64_minmax,c._sqlite3__wasm_test_int64ptr=e.sqlite3__wasm_test_int64ptr,c._sqlite3__wasm_test_stack_overflow=e.sqlite3__wasm_test_stack_overflow,c._sqlite3__wasm_test_str_hello=e.sqlite3__wasm_test_str_hello,c._sqlite3__wasm_SQLTester_strglob=e.sqlite3__wasm_SQLTester_strglob,c._malloc=e.malloc,c._free=e.free,c._realloc=e.realloc,cr=e.emscripten_builtin_memalign,e._emscripten_stack_restore,e._emscripten_stack_alloc,e.emscripten_stack_get_current,e.__indirect_function_table}var ur={__syscall_chmod:Qr,__syscall_faccessat:Vr,__syscall_fchmod:Hr,__syscall_fchown32:Gr,__syscall_fcntl64:$r,__syscall_fstat64:Kr,__syscall_ftruncate64:Yr,__syscall_getcwd:Zr,__syscall_ioctl:en,__syscall_lstat64:tn,__syscall_mkdirat:rn,__syscall_newfstatat:nn,__syscall_openat:sn,__syscall_readlinkat:on,__syscall_rmdir:ln,__syscall_stat64:an,__syscall_unlinkat:cn,__syscall_utimensat:un,_localtime_js:hn,_mmap_js:mn,_munmap_js:gn,_tzset_js:bn,clock_time_get:qn,emscripten_date_now:lr,emscripten_get_heap_max:vn,emscripten_get_now:or,emscripten_resize_heap:Sn,environ_get:An,environ_sizes_get:Tn,fd_close:In,fd_fdstat_get:kn,fd_read:Pn,fd_seek:xn,fd_sync:Fn,fd_write:Ln,memory:lt};function Bt(){if(dt>0){St=Bt;return}if(vr(),dt>0){St=Bt;return}function e(){c.calledRun=!0,!st&&(Er(),Ot?.(c),c.onRuntimeInitialized?.(),Sr())}c.setStatus?(c.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>c.setStatus(""),1),e()},1)):e()}var yt=await Pr();return Bt(),c.runSQLite3PostLoadInit=async function(e,t,o){delete t.runSQLite3PostLoadInit,globalThis.sqlite3ApiBootstrap=async function s(r=globalThis.sqlite3ApiConfig||s.defaultConfig){if(s.sqlite3)return(s.sqlite3.config||console).warn("sqlite3ApiBootstrap() called multiple times.","Config and external initializers are ignored on calls after the first."),s.sqlite3;const i=Object.assign(Object.create(null),{exports:void 0,memory:void 0,bigIntEnabled:!!globalThis.BigInt64Array,debug:console.debug.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),log:console.log.bind(console),wasmfsOpfsDir:"/opfs",useStdAlloc:!1},r||{});Object.assign(i,{allocExportName:i.useStdAlloc?"malloc":"sqlite3_malloc",deallocExportName:i.useStdAlloc?"free":"sqlite3_free",reallocExportName:i.useStdAlloc?"realloc":"sqlite3_realloc"}),["exports","memory","functionTable","wasmfsOpfsDir"].forEach(f=>{typeof i[f]=="function"&&(i[f]=i[f]())});const n=Object.create(null),u=Object.create(null),F=f=>n.sqlite3_js_rc_str&&n.sqlite3_js_rc_str(f)||"Unknown result code #"+f,I=f=>typeof f=="number"&&f===(f|0)&&f<=2147483647&&f>=-2147483648;class J extends Error{constructor(...m){let q;if(m.length)if(I(m[0]))if(q=m[0],m.length===1)super(F(m[0]));else{const M=F(q);typeof m[1]=="object"?super(M,m[1]):(m[0]=M+":",super(m.join(" ")))}else m.length===2&&typeof m[1]=="object"?super(...m):super(m.join(" "));this.resultCode=q||n.SQLITE_ERROR,this.name="SQLite3Error"}}J.toss=(...f)=>{throw new J(...f)};const L=J.toss;i.wasmfsOpfsDir&&!/^\/[^/]+$/.test(i.wasmfsOpfsDir)&&L("config.wasmfsOpfsDir must be falsy or in the form '/dir-name'.");const G=function f(m){return f._max||(f._max=BigInt("0x7fffffffffffffff"),f._min=~f._max),m>=f._min&&m<=f._max},p=f=>f>=-2147483647n-1n&&f<=2147483647n,z=function f(m){return f._min||(f._min=Number.MIN_SAFE_INTEGER,f._max=Number.MAX_SAFE_INTEGER),m>=f._min&&m<=f._max},R=f=>f&&f.constructor&&I(f.constructor.BYTES_PER_ELEMENT)?f:!1,te=f=>f&&(f instanceof Uint8Array||f instanceof Int8Array||f instanceof ArrayBuffer),y=f=>f&&(f instanceof Uint8Array||f instanceof Int8Array||f instanceof ArrayBuffer),b=f=>te(f)||L("Value is not of a supported TypedArray type."),C=function(f){return y(f)?u.typedArrayToString(f instanceof ArrayBuffer?new Uint8Array(f):f,0,f.length):Array.isArray(f)?f.join(""):(u.isPtr(f)&&(f=u.cstrToJs(f)),f)};class U extends Error{constructor(...m){m.length===2&&typeof m[1]=="object"?super(...m):m.length?super(m.join(" ")):super("Allocation failed."),this.resultCode=n.SQLITE_NOMEM,this.name="WasmAllocError"}}U.toss=(...f)=>{throw new U(...f)},Object.assign(n,{sqlite3_bind_blob:void 0,sqlite3_bind_text:void 0,sqlite3_create_function_v2:(f,m,q,M,Y,le,ye,Ee,de)=>{},sqlite3_create_function:(f,m,q,M,Y,le,ye,Ee)=>{},sqlite3_create_window_function:(f,m,q,M,Y,le,ye,Ee,de,V)=>{},sqlite3_prepare_v3:(f,m,q,M,Y,le)=>{},sqlite3_prepare_v2:(f,m,q,M,Y)=>{},sqlite3_exec:(f,m,q,M,Y)=>{},sqlite3_randomness:(f,m)=>{}});const w={affirmBindableTypedArray:b,flexibleString:C,bigIntFits32:p,bigIntFits64:G,bigIntFitsDouble:z,isBindableTypedArray:te,isInt32:I,isSQLableTypedArray:y,isTypedArray:R,isUIThread:()=>globalThis.window===globalThis&&!!globalThis.document,toss:function(...f){throw new Error(f.join(" "))},toss3:L,typedArrayPart:u.typedArrayPart,assert:function(f,m){f||w.toss("Assertion failed:",m)},affirmDbHeader:function(f){f instanceof ArrayBuffer&&(f=new Uint8Array(f));const m="SQLite format 3";15>f.byteLength&&L("Input does not contain an SQLite3 database header.");for(let q=0;q<15;++q)m.charCodeAt(q)!==f[q]&&L("Input does not contain an SQLite3 database header.")},affirmIsDb:function(f){f instanceof ArrayBuffer&&(f=new Uint8Array(f));const m=f.byteLength;(m<512||m%512!==0)&&L("Byte array size",m,"is invalid for an SQLite3 db."),w.affirmDbHeader(f)}};Object.assign(u,{exports:i.exports||L("Missing API config.exports (WASM module exports)."),memory:i.memory||i.exports.memory||L("API config object requires a WebAssembly.Memory object","in either config.exports.memory (exported)","or config.memory (imported)."),pointerSize:typeof i.exports.sqlite3_libversion()=="number"?4:8,bigIntEnabled:!!i.bigIntEnabled,functionTable:i.functionTable,alloc:void 0,realloc:void 0,dealloc:void 0}),u.allocFromTypedArray=function(f){f instanceof ArrayBuffer&&(f=new Uint8Array(f)),b(f);const m=u.alloc(f.byteLength||1);return u.heapForSize(f.constructor).set(f.byteLength?f:[0],Number(m)),m};{const f=i.allocExportName,m=i.deallocExportName,q=i.reallocExportName;for(const M of[f,m,q])u.exports[M]instanceof Function||L("Missing required exports[",M,"] function.");u.alloc=function M(Y){return M.impl(Y)||U.toss("Failed to allocate",Y," bytes.")},u.alloc.impl=u.exports[f],u.realloc=function M(Y,le){const ye=M.impl(u.ptr.coerce(Y),le);return le?ye||U.toss("Failed to reallocate",le," bytes."):u.ptr.null},u.realloc.impl=u.exports[q],u.dealloc=function M(Y){M.impl(u.ptr.coerce(Y))},u.dealloc.impl=u.exports[m]}u.compileOptionUsed=function f(m){if(arguments.length){if(Array.isArray(m)){const q=Object.create(null);return m.forEach(M=>{q[M]=n.sqlite3_compileoption_used(M)}),q}else if(typeof m=="object")return Object.keys(m).forEach(q=>{m[q]=n.sqlite3_compileoption_used(q)}),m}else{if(f._result)return f._result;f._opt||(f._rx=/^([^=]+)=(.+)/,f._rxInt=/^-?\d+$/,f._opt=function(ye,Ee){const de=f._rx.exec(ye);Ee[0]=de?de[1]:ye,Ee[1]=de?f._rxInt.test(de[2])?+de[2]:de[2]:!0});const q=Object.create(null),M=[0,0];let Y=0,le;for(;le=n.sqlite3_compileoption_get(Y++);)f._opt(le,M),q[M[0]]=M[1];return f._result=q}return typeof m=="string"?!!n.sqlite3_compileoption_used(m):!1},u.pstack=Object.assign(Object.create(null),{restore:u.exports.sqlite3__wasm_pstack_restore,alloc:function(f){return typeof f=="string"&&!(f=u.sizeofIR(f))&&U.toss("Invalid value for pstack.alloc(",arguments[0],")"),u.exports.sqlite3__wasm_pstack_alloc(f)||U.toss("Could not allocate",f,"bytes from the pstack.")},allocChunks:function(f,m){typeof m=="string"&&!(m=u.sizeofIR(m))&&U.toss("Invalid size value for allocChunks(",arguments[1],")");const q=u.pstack.alloc(f*m),M=[q];let Y=1,le=m;for(;Y<f;++Y,le+=m)M.push(u.ptr.add(q,le));return M},allocPtr:(f=1,m=!0)=>f===1?u.pstack.alloc(m?8:u.ptr.size):u.pstack.allocChunks(f,m?8:u.ptr.size),call:function(f){const m=u.pstack.pointer;try{return f(O)}finally{u.pstack.restore(m)}}}),Object.defineProperties(u.pstack,{pointer:{configurable:!1,iterable:!0,writeable:!1,get:u.exports.sqlite3__wasm_pstack_ptr},quota:{configurable:!1,iterable:!0,writeable:!1,get:u.exports.sqlite3__wasm_pstack_quota},remaining:{configurable:!1,iterable:!0,writeable:!1,get:u.exports.sqlite3__wasm_pstack_remaining}}),n.sqlite3_randomness=(...f)=>{if(f.length===1&&w.isTypedArray(f[0])&&f[0].BYTES_PER_ELEMENT===1){const m=f[0];if(m.byteLength===0)return u.exports.sqlite3_randomness(0,u.ptr.null),m;const q=u.pstack.pointer;try{let M=m.byteLength,Y=0;const le=u.exports.sqlite3_randomness,ye=u.heap8u(),Ee=M<512?M:512,de=u.pstack.alloc(Ee);do{const V=M>Ee?Ee:M;le(V,de),m.set(u.typedArrayPart(ye,de,u.ptr.add(de,V)),Y),M-=V,Y+=V}while(M>0)}catch(M){i.error("Highly unexpected (and ignored!) exception in sqlite3_randomness():",M)}finally{u.pstack.restore(q)}return m}u.exports.sqlite3_randomness(...f)},n.sqlite3_wasmfs_opfs_dir=(function(){if(this.dir!==void 0)return this.dir;const f=i.wasmfsOpfsDir;if(!f||!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!u.exports.sqlite3__wasm_init_wasmfs)return this.dir="";try{return f&&u.xCallWrapped("sqlite3__wasm_init_wasmfs","i32",["string"],f)===0?this.dir=f:this.dir=""}catch{return this.dir=""}}).bind(Object.create(null)),n.sqlite3_wasmfs_filename_is_persistent=function(f){const m=n.sqlite3_wasmfs_opfs_dir();return m&&f?f.startsWith(m+"/"):!1},n.sqlite3_js_db_uses_vfs=function(f,m,q=0){try{const M=n.sqlite3_vfs_find(m);return M?f?M===n.sqlite3_js_db_vfs(f,q)?M:!1:M===n.sqlite3_vfs_find(0)?M:!1:!1}catch{return!1}},n.sqlite3_js_vfs_list=function(){const f=[];let m=n.sqlite3_vfs_find(u.ptr.null);for(;m;){const q=new n.sqlite3_vfs(m);f.push(u.cstrToJs(q.$zName)),m=q.$pNext,q.dispose()}return f},n.sqlite3_js_db_export=function(f,m=0){f=u.xWrap.testConvertArg("sqlite3*",f),f||L("Invalid sqlite3* argument."),u.bigIntEnabled||L("BigInt support is not enabled.");const q=u.scopedAllocPush();let M;try{const Y=u.scopedAlloc(8+u.ptr.size),le=u.ptr.add(Y,8),ye=m?u.isPtr(m)?m:u.scopedAllocCString(""+m):u.ptr.null;let Ee=u.exports.sqlite3__wasm_db_serialize(f,ye,le,Y,0);Ee&&L("Database serialization failed with code",O.capi.sqlite3_js_rc_str(Ee)),M=u.peekPtr(le);const de=u.peek(Y,"i64");return Ee=de?u.heap8u().slice(Number(M),Number(M)+Number(de)):new Uint8Array,Ee}finally{M&&u.exports.sqlite3_free(M),u.scopedAllocPop(q)}},n.sqlite3_js_db_vfs=(f,m=u.ptr.null)=>w.sqlite3__wasm_db_vfs(f,m),n.sqlite3_js_aggregate_context=(f,m)=>n.sqlite3_aggregate_context(f,m)||(m?U.toss("Cannot allocate",m,"bytes for sqlite3_aggregate_context()"):0),n.sqlite3_js_posix_create_file=function(f,m,q){let M;m&&u.isPtr(m)?M=m:m instanceof ArrayBuffer||m instanceof Uint8Array?(M=u.allocFromTypedArray(m),(arguments.length<3||!w.isInt32(q)||q<0)&&(q=m.byteLength)):J.toss("Invalid 2nd argument for sqlite3_js_posix_create_file().");try{(!w.isInt32(q)||q<0)&&J.toss("Invalid 3rd argument for sqlite3_js_posix_create_file().");const Y=w.sqlite3__wasm_posix_create_file(f,M,q);Y&&J.toss("Creation of file failed with sqlite3 result code",n.sqlite3_js_rc_str(Y))}finally{M&&M!==m&&u.dealloc(M)}},n.sqlite3_js_vfs_create_file=function(f,m,q,M){i.warn("sqlite3_js_vfs_create_file() is deprecated and","should be avoided because it can lead to C-level crashes.","See its documentation for alternatives.");let Y;q?u.isPtr(q)?Y=q:(q instanceof ArrayBuffer&&(q=new Uint8Array(q)),q instanceof Uint8Array?(Y=u.allocFromTypedArray(q),(arguments.length<4||!w.isInt32(M)||M<0)&&(M=q.byteLength)):J.toss("Invalid 3rd argument type for sqlite3_js_vfs_create_file().")):Y=0,(!w.isInt32(M)||M<0)&&(Y&&Y!==q&&u.dealloc(Y),J.toss("Invalid 4th argument for sqlite3_js_vfs_create_file()."));try{const le=w.sqlite3__wasm_vfs_create_file(f,m,Y,M);le&&J.toss("Creation of file failed with sqlite3 result code",n.sqlite3_js_rc_str(le))}finally{Y&&Y!==q&&u.dealloc(Y)}},n.sqlite3_js_sql_to_string=f=>{if(typeof f=="string")return f;const m=C(v);return m===v?void 0:m},n.sqlite3_db_config=(function(f,m,...q){switch(m){case n.SQLITE_DBCONFIG_ENABLE_FKEY:case n.SQLITE_DBCONFIG_ENABLE_TRIGGER:case n.SQLITE_DBCONFIG_ENABLE_FTS3_TOKENIZER:case n.SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION:case n.SQLITE_DBCONFIG_NO_CKPT_ON_CLOSE:case n.SQLITE_DBCONFIG_ENABLE_QPSG:case n.SQLITE_DBCONFIG_TRIGGER_EQP:case n.SQLITE_DBCONFIG_RESET_DATABASE:case n.SQLITE_DBCONFIG_DEFENSIVE:case n.SQLITE_DBCONFIG_WRITABLE_SCHEMA:case n.SQLITE_DBCONFIG_LEGACY_ALTER_TABLE:case n.SQLITE_DBCONFIG_DQS_DML:case n.SQLITE_DBCONFIG_DQS_DDL:case n.SQLITE_DBCONFIG_ENABLE_VIEW:case n.SQLITE_DBCONFIG_LEGACY_FILE_FORMAT:case n.SQLITE_DBCONFIG_TRUSTED_SCHEMA:case n.SQLITE_DBCONFIG_STMT_SCANSTATUS:case n.SQLITE_DBCONFIG_REVERSE_SCANORDER:case n.SQLITE_DBCONFIG_ENABLE_ATTACH_CREATE:case n.SQLITE_DBCONFIG_ENABLE_ATTACH_WRITE:case n.SQLITE_DBCONFIG_ENABLE_COMMENTS:return this.ip||(this.ip=u.xWrap("sqlite3__wasm_db_config_ip","int",["sqlite3*","int","int","*"])),this.ip(f,m,q[0],q[1]||0);case n.SQLITE_DBCONFIG_LOOKASIDE:return this.pii||(this.pii=u.xWrap("sqlite3__wasm_db_config_pii","int",["sqlite3*","int","*","int","int"])),this.pii(f,m,q[0],q[1],q[2]);case n.SQLITE_DBCONFIG_MAINDBNAME:return this.s||(this.s=u.xWrap("sqlite3__wasm_db_config_s","int",["sqlite3*","int","string:static"])),this.s(f,m,q[0]);default:return n.SQLITE_MISUSE}}).bind(Object.create(null)),n.sqlite3_value_to_js=function(f,m=!0){let q;const M=n.sqlite3_value_type(f);switch(M){case n.SQLITE_INTEGER:u.bigIntEnabled?(q=n.sqlite3_value_int64(f),w.bigIntFitsDouble(q)&&(q=Number(q))):q=n.sqlite3_value_double(f);break;case n.SQLITE_FLOAT:q=n.sqlite3_value_double(f);break;case n.SQLITE_TEXT:q=n.sqlite3_value_text(f);break;case n.SQLITE_BLOB:{const Y=n.sqlite3_value_bytes(f),le=n.sqlite3_value_blob(f);Y&&!le&&O.WasmAllocError.toss("Cannot allocate memory for blob argument of",Y,"byte(s)"),q=Y?u.heap8u().slice(Number(le),Number(le)+Number(Y)):null;break}case n.SQLITE_NULL:q=null;break;default:m&&L(n.SQLITE_MISMATCH,"Unhandled sqlite3_value_type():",M),q=void 0}return q},n.sqlite3_values_to_js=function(f,m,q=!0){let M;const Y=[];for(M=0;M<f;++M)Y.push(n.sqlite3_value_to_js(u.peekPtr(u.ptr.add(m,u.ptr.size*M)),q));return Y},n.sqlite3_result_error_js=function(f,m){m instanceof U?n.sqlite3_result_error_nomem(f):n.sqlite3_result_error(f,""+m,-1)},n.sqlite3_result_js=function(f,m){if(m instanceof Error){n.sqlite3_result_error_js(f,m);return}try{switch(typeof m){case"undefined":break;case"boolean":n.sqlite3_result_int(f,m?1:0);break;case"bigint":w.bigIntFits32(m)?n.sqlite3_result_int(f,Number(m)):w.bigIntFitsDouble(m)?n.sqlite3_result_double(f,Number(m)):u.bigIntEnabled?w.bigIntFits64(m)?n.sqlite3_result_int64(f,m):L("BigInt value",m.toString(),"is too BigInt for int64."):L("BigInt value",m.toString(),"is too BigInt.");break;case"number":{let q;w.isInt32(m)?q=n.sqlite3_result_int:u.bigIntEnabled&&Number.isInteger(m)&&w.bigIntFits64(BigInt(m))?q=n.sqlite3_result_int64:q=n.sqlite3_result_double,q(f,m);break}case"string":{const[q,M]=u.allocCString(m,!0);n.sqlite3_result_text(f,q,M,n.SQLITE_WASM_DEALLOC);break}case"object":if(m===null){n.sqlite3_result_null(f);break}else if(w.isBindableTypedArray(m)){const q=u.allocFromTypedArray(m);n.sqlite3_result_blob(f,q,m.byteLength,n.SQLITE_WASM_DEALLOC);break}default:L("Don't not how to handle this UDF result value:",typeof m,m)}}catch(q){n.sqlite3_result_error_js(f,q)}},n.sqlite3_column_js=function(f,m,q=!0){const M=n.sqlite3_column_value(f,m);return M===0?void 0:n.sqlite3_value_to_js(M,q)};{const f=(function(m,q,M){M=n[M],this.ptr?u.pokePtr(this.ptr,0):this.ptr=u.allocPtr();const Y=M(m,q,this.ptr);if(Y)return J.toss(Y,arguments[2]+"() failed with code "+Y);const le=u.peekPtr(this.ptr);return le?n.sqlite3_value_to_js(le,!0):void 0}).bind(Object.create(null));n.sqlite3_preupdate_new_js=(m,q)=>f(m,q,"sqlite3_preupdate_new"),n.sqlite3_preupdate_old_js=(m,q)=>f(m,q,"sqlite3_preupdate_old"),n.sqlite3changeset_new_js=(m,q)=>f(m,q,"sqlite3changeset_new"),n.sqlite3changeset_old_js=(m,q)=>f(m,q,"sqlite3changeset_old")}const O={WasmAllocError:U,SQLite3Error:J,capi:n,util:w,wasm:u,config:i,version:Object.create(null),client:void 0,asyncPostInit:(async function f(){if(f.isReady instanceof Promise)return f.isReady;let m=this.initializersAsync;delete this.initializersAsync;const q=async()=>(O.__isUnderTest||(delete O.util,delete O.StructBinder),O),M=le=>{throw i.error("an async sqlite3 initializer failed:",le),le};if(!m||!m.length)return f.isReady=q().catch(M);m=m.map(le=>le instanceof Function?async ye=>le(O):le),m.push(q);let Y=Promise.resolve(O);for(;m.length;)Y=Y.then(m.shift());return f.isReady=Y.catch(M)}).bind(s),scriptInfo:void 0};typeof o<"u"&&(O.__isUnderTest=!!o);try{s.initializers.forEach(f=>{f(O)})}catch(f){throw console.error("sqlite3 bootstrap initializer threw:",f),f}if(delete s.initializers,s.sqlite3=O,typeof e<"u"&&(e.debugModule("sqlite3ApiBootstrap() complete",O),O.scriptInfo=e),O.__isUnderTest){typeof t<"u"&&(O.config.emscripten=t);const f=O.scriptInfo?.instantiateWasm;f&&(O.wasm.module=f.module,O.wasm.instance=f.instance,O.wasm.imports=f.imports)}return delete globalThis.sqlite3ApiConfig,delete globalThis.sqlite3ApiBootstrap,delete s.defaultConfig,O.asyncPostInit().then(f=>(typeof e<"u"&&e.debugModule("sqlite3.asyncPostInit() complete",f),delete f.asyncPostInit,delete f.scriptInfo,delete f.emscripten,f))},globalThis.sqlite3ApiBootstrap.initializers=[],globalThis.sqlite3ApiBootstrap.initializersAsync=[],globalThis.sqlite3ApiBootstrap.defaultConfig=Object.create(null),globalThis.sqlite3ApiBootstrap.sqlite3=void 0,globalThis.sqlite3ApiBootstrap.initializers.push(function(s){s.version={libVersion:"3.52.0",libVersionNumber:3052e3,sourceId:"2026-01-30 06:37:34 407724c4e80efdf93d885e95b5209a100a3f470fe0298138be57201f65f9817e",downloadVersion:352e4,scm:{"sha3-256":"407724c4e80efdf93d885e95b5209a100a3f470fe0298138be57201f65f9817e",branch:"trunk",tags:"",datetime:"2026-01-30T06:37:34.096Z"}}}),globalThis.WhWasmUtilInstaller=function(r){r.bigIntEnabled===void 0&&(r.bigIntEnabled=!!globalThis.BigInt64Array);const i=(...l)=>{throw new Error(l.join(" "))};if(!r.pointerSize&&!r.pointerIR&&r.alloc&&r.dealloc){const l=r.alloc(1);r.pointerSize=typeof l=="bigint"?8:4,r.dealloc(l)}r.pointerSize&&!r.pointerIR&&(r.pointerIR=r.pointerSize===4?"i32":"i64");const n=r.pointerIR??="i32",u=r.pointerSize??=n==="i32"?4:n==="i64"?8:0;delete r.pointerSize,delete r.pointerIR,n!=="i32"&&n!=="i64"?i("Invalid pointerIR:",n):u!==8&&u!==4&&i("Invalid pointerSize:",u);const F=r.bigIntEnabled?l=>BigInt(l||0):l=>i("BigInt support is disabled in this build."),J=u===4?l=>Number(l||0):F,L=J(0),G=function(...l){let _=J(0);for(const d of l)_+=J(d);return _};{const l=Object.create(null);Object.defineProperty(r,"ptr",{enumerable:!0,get:()=>l,set:()=>i("The ptr property is read-only.")}),(function _(d,E){return Object.defineProperty(l,d,{enumerable:!0,get:()=>E,set:()=>i("ptr["+d+"] is read-only.")}),_})("null",L)("size",u)("ir",n)("coerce",J)("add",G)("addn",n===4?G:(..._)=>Number(G(..._)))}r.exports||Object.defineProperty(r,"exports",{enumerable:!0,configurable:!0,get:()=>r.instance?.exports});const p=Object.create(null);p.heapSize=0,p.memory=null,p.freeFuncIndexes=[],p.scopedAlloc=[],p.scopedAlloc.pushPtr=l=>(p.scopedAlloc[p.scopedAlloc.length-1].push(l),l),p.utf8Decoder=new TextDecoder,p.utf8Encoder=new TextEncoder("utf-8"),r.sizeofIR=l=>{switch(l){case"i8":return 1;case"i16":return 2;case"i32":case"f32":case"float":return 4;case"i64":case"f64":case"double":return 8;case"*":return u;default:return(""+l).endsWith("*")?u:void 0}};const z=function(){if(!p.memory)p.memory=r.memory instanceof WebAssembly.Memory?r.memory:r.exports.memory;else if(p.heapSize===p.memory.buffer.byteLength)return p;const l=p.memory.buffer;return p.HEAP8=new Int8Array(l),p.HEAP8U=new Uint8Array(l),p.HEAP16=new Int16Array(l),p.HEAP16U=new Uint16Array(l),p.HEAP32=new Int32Array(l),p.HEAP32U=new Uint32Array(l),p.HEAP32F=new Float32Array(l),p.HEAP64F=new Float64Array(l),r.bigIntEnabled&&(typeof BigInt64Array<"u"?(p.HEAP64=new BigInt64Array(l),p.HEAP64U=new BigUint64Array(l)):i("BigInt support is enabled, but the BigInt64Array type is missing.")),p.heapSize=l.byteLength,p};r.heap8=()=>z().HEAP8,r.heap8u=()=>z().HEAP8U,r.heap16=()=>z().HEAP16,r.heap16u=()=>z().HEAP16U,r.heap32=()=>z().HEAP32,r.heap32u=()=>z().HEAP32U,r.heapForSize=function(l,_=!0){const d=p.memory&&p.heapSize===p.memory.buffer.byteLength?p:z();switch(l){case Int8Array:return d.HEAP8;case Uint8Array:return d.HEAP8U;case Int16Array:return d.HEAP16;case Uint16Array:return d.HEAP16U;case Int32Array:return d.HEAP32;case Uint32Array:return d.HEAP32U;case 8:return _?d.HEAP8U:d.HEAP8;case 16:return _?d.HEAP16U:d.HEAP16;case 32:return _?d.HEAP32U:d.HEAP32;case 64:if(d.HEAP64)return _?d.HEAP64U:d.HEAP64;break;default:if(r.bigIntEnabled){if(l===globalThis.BigUint64Array)return d.HEAP64U;if(l===globalThis.BigInt64Array)return d.HEAP64;break}}i("Invalid heapForSize() size: expecting 8, 16, 32,","or (if BigInt is enabled) 64.")};const R=r.functionTable;delete r.functionTable,r.functionTable=R?()=>R:()=>r.exports.__indirect_function_table,r.functionEntry=function(l){const _=r.functionTable();return l<_.length?_.get(J(l)):void 0},r.jsFuncToWasm=function l(_,d){if(l._||(l._={sigTypes:Object.assign(Object.create(null),{i:"i32",p:n,P:n,s:n,j:"i64",f:"f32",d:"f64"}),typeCodes:Object.assign(Object.create(null),{f64:124,f32:125,i64:126,i32:127}),uleb128Encode:(D,h,P)=>{P<128?D[h](P):D[h](P%128|128,P>>7)},rxJSig:/^(\w)\((\w*)\)$/,sigParams:D=>{const h=l._.rxJSig.exec(D);return h?h[2]:D.substr(1)},letterType:D=>l._.sigTypes[D]||i("Invalid signature letter:",D),pushSigType:(D,h)=>D.push(l._.typeCodes[l._.letterType(h)])}),typeof _=="string"){const D=d;d=_,_=D}const E=l._,W=E.sigParams(d),K=[1,96];E.uleb128Encode(K,"push",W.length);for(const D of W)E.pushSigType(K,D);return d[0]==="v"?K.push(0):(K.push(1),E.pushSigType(K,d[0])),E.uleb128Encode(K,"unshift",K.length),K.unshift(0,97,115,109,1,0,0,0,1),K.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array(K)),{e:{f:_}}).exports.f};const te=function(_,d,E){if(E&&!p.scopedAlloc.length&&i("No scopedAllocPush() scope is active."),typeof _=="string"){const h=d;d=_,_=h}(typeof d!="string"||!(_ instanceof Function))&&i("Invalid arguments: expecting (function,signature) or (signature,function).");const W=r.functionTable(),K=J(W.length);let D;for(;(D=p.freeFuncIndexes.pop())&&W.get(D);){D=null;continue}D||(D=J(K),W.grow(J(1)));try{return W.set(D,_),E&&p.scopedAlloc.pushPtr(D),D}catch(h){if(!(h instanceof TypeError))throw D===K&&p.freeFuncIndexes.push(K),h}try{const h=r.jsFuncToWasm(_,d);W.set(D,h),E&&p.scopedAlloc.pushPtr(D)}catch(h){throw D===K&&p.freeFuncIndexes.push(K),h}return D};r.installFunction=(l,_)=>te(l,_,!1),r.scopedInstallFunction=(l,_)=>te(l,_,!0),r.uninstallFunction=function(l){if(!l&&L!==l)return;const _=r.functionTable();p.freeFuncIndexes.push(l);const d=_.get(l);return _.set(l,null),d},r.peek=function(_,d="i8"){d.endsWith("*")&&(d=n);const E=p.memory&&p.heapSize===p.memory.buffer.byteLength?p:z(),W=Array.isArray(_)?[]:void 0;let K;do{switch(W&&(_=arguments[0].shift()),d){case"i1":case"i8":K=E.HEAP8[Number(_)>>0];break;case"i16":K=E.HEAP16[Number(_)>>1];break;case"i32":K=E.HEAP32[Number(_)>>2];break;case"float":case"f32":K=E.HEAP32F[Number(_)>>2];break;case"double":case"f64":K=Number(E.HEAP64F[Number(_)>>3]);break;case"i64":if(E.HEAP64){K=F(E.HEAP64[Number(_)>>3]);break}default:i("Invalid type for peek():",d)}W&&W.push(K)}while(W&&arguments[0].length);return W||K},r.poke=function(l,_,d="i8"){d.endsWith("*")&&(d=n);const E=p.memory&&p.heapSize===p.memory.buffer.byteLength?p:z();for(const W of Array.isArray(l)?l:[l])switch(d){case"i1":case"i8":E.HEAP8[Number(W)>>0]=_;continue;case"i16":E.HEAP16[Number(W)>>1]=_;continue;case"i32":E.HEAP32[Number(W)>>2]=_;continue;case"float":case"f32":E.HEAP32F[Number(W)>>2]=_;continue;case"double":case"f64":E.HEAP64F[Number(W)>>3]=_;continue;case"i64":if(E.HEAP64){E.HEAP64[Number(W)>>3]=F(_);continue}default:i("Invalid type for poke(): "+d)}return this},r.peekPtr=(...l)=>r.peek(l.length===1?l[0]:l,n),r.pokePtr=(l,_=0)=>r.poke(l,_,n),r.peek8=(...l)=>r.peek(l.length===1?l[0]:l,"i8"),r.poke8=(l,_)=>r.poke(l,_,"i8"),r.peek16=(...l)=>r.peek(l.length===1?l[0]:l,"i16"),r.poke16=(l,_)=>r.poke(l,_,"i16"),r.peek32=(...l)=>r.peek(l.length===1?l[0]:l,"i32"),r.poke32=(l,_)=>r.poke(l,_,"i32"),r.peek64=(...l)=>r.peek(l.length===1?l[0]:l,"i64"),r.poke64=(l,_)=>r.poke(l,_,"i64"),r.peek32f=(...l)=>r.peek(l.length===1?l[0]:l,"f32"),r.poke32f=(l,_)=>r.poke(l,_,"f32"),r.peek64f=(...l)=>r.peek(l.length===1?l[0]:l,"f64"),r.poke64f=(l,_)=>r.poke(l,_,"f64"),r.getMemValue=r.peek,r.getPtrValue=r.peekPtr,r.setMemValue=r.poke,r.setPtrValue=r.pokePtr,r.isPtr32=l=>typeof l=="number"&&l>=0&&l===(l|0),r.isPtr64=l=>typeof l=="bigint"?l>=0:r.isPtr32(l),r.isPtr=u===4?r.isPtr32:r.isPtr64,r.cstrlen=function(l){if(!l||!r.isPtr(l))return null;l=Number(l);const _=z().HEAP8U;let d=l;for(;_[d]!==0;++d);return d-l};const y=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,b=l=>l.buffer instanceof y;r.isSharedTypedArray=b;const C=(l,_,d)=>(u===8&&(typeof _=="bigint"&&(_=Number(_)),typeof d=="bigint"&&(d=Number(d))),b(l)?l.slice(_,d):l.subarray(_,d));r.typedArrayPart=C;const U=(l,_,d)=>p.utf8Decoder.decode(C(l,_,d));r.typedArrayToString=U,r.cstrToJs=function(l){const _=r.cstrlen(l);return _?U(z().HEAP8U,Number(l),Number(l)+_):_===null?_:""},r.jstrlen=function(l){if(typeof l!="string")return null;const _=l.length;let d=0;for(let E=0;E<_;++E){let W=l.charCodeAt(E);W>=55296&&W<=57343&&(W=65536+((W&1023)<<10)|l.charCodeAt(++E)&1023),W<=127?++d:W<=2047?d+=2:W<=65535?d+=3:d+=4}return d},r.jstrcpy=function(l,_,d=0,E=-1,W=!0){if((!_||!(_ instanceof Int8Array)&&!(_ instanceof Uint8Array))&&i("jstrcpy() target must be an Int8Array or Uint8Array."),E=Number(E),d=Number(d),E<0&&(E=_.length-d),!(E>0)||!(d>=0))return 0;let K=0,D=l.length;const h=d,P=d+E-(W?1:0);for(;K<D&&d<P;++K){let Q=l.charCodeAt(K);if(Q>=55296&&Q<=57343&&(Q=65536+((Q&1023)<<10)|l.charCodeAt(++K)&1023),Q<=127){if(d>=P)break;_[d++]=Q}else if(Q<=2047){if(d+1>=P)break;_[d++]=192|Q>>6,_[d++]=128|Q&63}else if(Q<=65535){if(d+2>=P)break;_[d++]=224|Q>>12,_[d++]=128|Q>>6&63,_[d++]=128|Q&63}else{if(d+3>=P)break;_[d++]=240|Q>>18,_[d++]=128|Q>>12&63,_[d++]=128|Q>>6&63,_[d++]=128|Q&63}}return W&&(_[d++]=0),d-h},r.cstrncpy=function(l,_,d){if((!l||!_)&&i("cstrncpy() does not accept NULL strings."),d<0)d=r.cstrlen(strPtr)+1;else if(!(d>0))return 0;const E=r.heap8u();let W=0,K;const D=Number(l),h=Number(_);for(;W<d&&(K=E[h+W]);++W)E[D+W]=K;return W<d&&(E[D+W++]=0),W},r.jstrToUintArray=(l,_=!1)=>p.utf8Encoder.encode(_?l+"\0":l);const w=(l,_)=>{(!(l.alloc instanceof Function)||!(l.dealloc instanceof Function))&&i("Object is missing alloc() and/or dealloc() function(s)","required by",_+"().")},O=function(l,_,d,E){if(w(r,E),typeof l!="string")return null;const W=p.utf8Encoder.encode(l),K=d(W.length+1);let D=K;try{const h=z().HEAP8U;return h.set(W,Number(K)),h[G(K,W.length)]=0,D=L,_?[K,W.length]:K}finally{D&&r.dealloc(D)}};r.allocCString=(l,_=!1)=>O(l,_,r.alloc,"allocCString()"),r.scopedAllocPush=function(){w(r,"scopedAllocPush");const l=[];return p.scopedAlloc.push(l),l},r.scopedAllocPop=function(l){w(r,"scopedAllocPop");const _=arguments.length?p.scopedAlloc.indexOf(l):p.scopedAlloc.length-1;_<0&&i("Invalid state object for scopedAllocPop()."),arguments.length===0&&(l=p.scopedAlloc[_]),p.scopedAlloc.splice(_,1);for(let d;d=l.pop();)r.functionEntry(d)?r.uninstallFunction(d):r.dealloc(d)},r.scopedAlloc=function(l){p.scopedAlloc.length||i("No scopedAllocPush() scope is active.");const _=J(r.alloc(l));return p.scopedAlloc.pushPtr(_)},Object.defineProperty(r.scopedAlloc,"level",{configurable:!1,enumerable:!1,get:()=>p.scopedAlloc.length,set:()=>i("The 'active' property is read-only.")}),r.scopedAllocCString=(l,_=!1)=>O(l,_,r.scopedAlloc,"scopedAllocCString()");const f=function(l,_){const d=r[l?"scopedAlloc":"alloc"]((_.length+1)*r.ptr.size);let E=0;return _.forEach(W=>{r.pokePtr(G(d,r.ptr.size*E++),r[l?"scopedAllocCString":"allocCString"](""+W))}),r.pokePtr(G(d,r.ptr.size*E),0),d};r.scopedAllocMainArgv=l=>f(!0,l),r.allocMainArgv=l=>f(!1,l),r.cArgvToJs=(l,_)=>{const d=[];for(let E=0;E<l;++E){const W=r.peekPtr(G(_,r.ptr.size*E));d.push(W?r.cstrToJs(W):null)}return d},r.scopedAllocCall=function(l){r.scopedAllocPush();try{return l()}finally{r.scopedAllocPop()}};const m=function(l,_,d){w(r,d);const E=_?"i64":n;let W=r[d](l*(_?8:u));if(r.poke(W,0,E),l===1)return W;const K=[W];for(let D=1;D<l;++D)W=G(W,_?8:u),K[D]=W,r.poke(W,0,E);return K};r.allocPtr=(l=1,_=!0)=>m(l,_,"alloc"),r.scopedAllocPtr=(l=1,_=!0)=>m(l,_,"scopedAlloc"),r.xGet=function(l){return r.exports[l]||i("Cannot find exported symbol:",l)};const q=(l,_)=>i(l+"() requires",_,"argument(s).");r.xCall=function(l,..._){const d=l instanceof Function?l:r.xGet(l);return d instanceof Function||i("Exported symbol",l,"is not a function."),d.length!==_.length&&q(d===l?d.name:l,d.length),arguments.length===2&&Array.isArray(arguments[1])?d.apply(null,arguments[1]):d.apply(null,_)},p.xWrap=Object.create(null),p.xWrap.convert=Object.create(null),p.xWrap.convert.arg=new Map,p.xWrap.convert.result=new Map;const M=p.xWrap.convert.arg,Y=p.xWrap.convert.result,le=J;M.set("i64",F).set("i32",l=>l|0).set("i16",l=>(l|0)&65535).set("i8",l=>(l|0)&255).set("f32",l=>Number(l).valueOf()).set("float",M.get("f32")).set("f64",M.get("f32")).set("double",M.get("f64")).set("int",M.get("i32")).set("null",l=>l).set(null,M.get("null")).set("**",le).set("*",le),Y.set("*",le).set("pointer",le).set("number",l=>Number(l)).set("void",l=>{}).set(void 0,Y.get("void")).set("null",l=>l).set(null,Y.get("null"));for(const l of["i8","i16","i32","i64","int","f32","float","f64","double"])M.set(l+"*",le),Y.set(l+"*",le),Y.set(l,M.get(l)||i("Maintenance required: missing arg converter for",l));const ye=l=>typeof l=="string"?r.scopedAllocCString(l):J(l);M.set("string",ye).set("utf8",ye),Y.set("string",l=>r.cstrToJs(l)).set("utf8",Y.get("string")).set("string:dealloc",l=>{try{return l?r.cstrToJs(l):null}finally{r.dealloc(l)}}).set("utf8:dealloc",Y.get("string:dealloc")).set("json",l=>JSON.parse(r.cstrToJs(l))).set("json:dealloc",l=>{try{return l?JSON.parse(r.cstrToJs(l)):null}finally{r.dealloc(l)}});const Ee=class{constructor(l){this.name=l.name||"unnamed adapter"}convertArg(l,_,d){i("AbstractArgAdapter must be subclassed.")}};M.FuncPtrAdapter=class at extends Ee{constructor(_){super(_),M.FuncPtrAdapter.warnOnUse&&console.warn("xArg.FuncPtrAdapter is an internal-only API","and is not intended to be invoked from","client-level code. Invoked with:",_),this.name=_.name||"unnamed",this.signature=_.signature,_.contextKey instanceof Function&&(this.contextKey=_.contextKey,_.bindScope||(_.bindScope="context")),this.bindScope=_.bindScope||i("FuncPtrAdapter options requires a bindScope (explicit or implied)."),at.bindScopes.indexOf(_.bindScope)<0&&i("Invalid options.bindScope ("+_.bindMod+") for FuncPtrAdapter. Expecting one of: ("+at.bindScopes.join(", ")+")"),this.isTransient=this.bindScope==="transient",this.isContext=this.bindScope==="context",this.isPermanent=this.bindScope==="permanent",this.singleton=this.bindScope==="singleton"?[]:void 0,this.callProxy=_.callProxy instanceof Function?_.callProxy:void 0}contextKey(_,d){return this}contextMap(_){const d=this.__cmap||(this.__cmap=new Map);let E=d.get(_);return E===void 0&&d.set(_,E=[]),E}convertArg(_,d,E){let W=this.singleton;if(!W&&this.isContext&&(W=this.contextMap(this.contextKey(d,E))),W&&W.length===2&&W[0]===_)return W[1];if(_ instanceof Function){this.callProxy&&(_=this.callProxy(_));const K=te(_,this.signature,this.isTransient);if(at.debugFuncInstall&&at.debugOut("FuncPtrAdapter installed",this,this.contextKey(d,E),"@"+K,_),W){if(W[1]){at.debugFuncInstall&&at.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(d,E),"@"+W[1],_);try{p.scopedAlloc.pushPtr(W[1])}catch{}}W[0]=arguments[0]||L,W[1]=K}return K}else if(r.isPtr(_)||_===null||_===void 0){if(W&&W[1]&&W[1]!==_){at.debugFuncInstall&&at.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(d,E),"@"+W[1],_);try{p.scopedAlloc.pushPtr(W[1])}catch{}W[0]=W[1]=_||L}return _||L}else throw new TypeError("Invalid FuncPtrAdapter argument type. Expecting a function pointer or a "+(this.name?this.name+" ":"")+"function matching signature "+this.signature+".")}},M.FuncPtrAdapter.warnOnUse=!1,M.FuncPtrAdapter.debugFuncInstall=!1,M.FuncPtrAdapter.debugOut=console.debug.bind(console),M.FuncPtrAdapter.bindScopes=["transient","context","singleton","permanent"];const de=l=>M.get(l)||i("Argument adapter not found:",l),V=l=>Y.get(l)||i("Result adapter not found:",l);p.xWrap.convertArg=(l,..._)=>de(l)(..._),p.xWrap.convertArgNoCheck=(l,..._)=>M.get(l)(..._),p.xWrap.convertResult=(l,_)=>l===null?_:l?V(l)(_):void 0,p.xWrap.convertResultNoCheck=(l,_)=>l===null?_:l?Y.get(l)(_):void 0,r.xWrap=function l(_,d,...E){arguments.length===3&&Array.isArray(arguments[2])&&(E=arguments[2]),r.isPtr(_)&&(_=r.functionEntry(_)||i("Function pointer not found in WASM function table."));const W=_ instanceof Function,K=W?_:r.xGet(_);if(W&&(_=K.name||"unnamed function"),E.length!==K.length&&q(_,K.length),K.length===0&&(d===null||d==="null"))return K;V(d);for(const h of E)h instanceof Ee?M.set(h,(...P)=>h.convertArg(...P)):de(h);const D=p.xWrap;return K.length===0?(...h)=>h.length?q(_,K.length):D.convertResult(d,K.call(null)):function(...h){h.length!==K.length&&q(_,K.length);const P=r.scopedAllocPush();try{let Q=0;for(l.debug&&console.debug("xWrap() preparing: resultType ",d,"xf",K,"argTypes",E,"args",h);Q<h.length;++Q)h[Q]=D.convertArgNoCheck(E[Q],h[Q],h,Q);return l.debug&&console.debug("xWrap() calling: resultType ",d,"xf",K,"argTypes",E,"args",h),D.convertResultNoCheck(d,K.apply(null,h))}finally{r.scopedAllocPop(P)}}};const A=function(l,_,d,E,W,K){if(typeof d=="string"){if(_===1)return K.get(d);if(_===2){if(E)E instanceof Function||i(W,"requires a function argument.");else return K.delete(d),l;return K.set(d,E),l}}i("Invalid arguments to",W)};return r.xWrap.resultAdapter=function l(_,d){return A(l,arguments.length,_,d,"resultAdapter()",Y)},r.xWrap.argAdapter=function l(_,d){return A(l,arguments.length,_,d,"argAdapter()",M)},r.xWrap.FuncPtrAdapter=M.FuncPtrAdapter,r.xCallWrapped=function(l,_,d,...E){return Array.isArray(arguments[3])&&(E=arguments[3]),r.xWrap(l,_,d||[]).apply(null,E||[])},r.xWrap.testConvertArg=p.xWrap.convertArg,r.xWrap.testConvertResult=p.xWrap.convertResult,r},globalThis.WhWasmUtilInstaller.yawl=(function(r){const i=()=>fetch(r.uri,{credentials:"same-origin"}),n=this,u=function(F){if(r.wasmUtilTarget){const I=(...L)=>{throw new Error(L.join(" "))},J=r.wasmUtilTarget;if(J.module=F.module,J.instance=F.instance,J.instance.exports.memory||(J.memory=r?.imports?.env?.memory||I("Missing 'memory' object!")),!J.alloc&&F.instance.exports.malloc){const L=F.instance.exports;J.alloc=function(G){return L.malloc(G)||I("Allocation of",G,"bytes failed.")},J.dealloc=function(G){G&&L.free(G)}}n(J)}return F.config=r,r.onload&&r.onload(F),F};return WebAssembly.instantiateStreaming?()=>WebAssembly.instantiateStreaming(i(),r.imports||{}).then(u):()=>i().then(F=>F.arrayBuffer()).then(F=>WebAssembly.instantiate(F,r.imports||{})).then(u)}).bind(globalThis.WhWasmUtilInstaller),globalThis.Jaccwabyt=function s(r){const i=(...T)=>{throw new Error(T.join(" "))};{let T=r.heap;T instanceof WebAssembly.Memory?T=(function(){return new Uint8Array(this.buffer)}).bind(T):T instanceof Function||i("config.heap must be WebAssembly.Memory instance or","a function which returns one."),r.heap=T}["alloc","dealloc"].forEach(function(T){r[T]instanceof Function||i("Config option '"+T+"' must be a function.")});const n=s,u=r.heap,F=r.alloc,I=r.dealloc;r.realloc;const J=r.log||console.debug.bind(console),L=r.memberPrefix||"",G=r.memberSuffix||"",p=globalThis.BigInt,z=globalThis.BigInt64Array,R=r.bigIntEnabled??!!z;let te;const y=r.pointerSize||r.ptrSize||(typeof(te=F(1))=="bigint"?8:4),b=r.pointerIR||r.ptrIR||(y===4?"i32":"i64");te&&(I(te),te=void 0),y!==4&&y!==8&&i("Invalid pointer size:",y),b!=="i32"&&b!=="i64"&&i("Invalid pointer representation:",b);const C=R&&p?T=>p(T||0):T=>i("BigInt support is disabled in this build."),U=b=="i32"?Number:C,w=U(0),O=function(...T){let $=w;for(let X=0;X<T.length;++X)$+=U(T[X]);return $},f=function(...T){return O(this.pointer,...T)};n.debugFlags||(n.__makeDebugFlags=function(T=null){T&&T.__flags&&(T=T.__flags);const $=function X(se){return arguments.length===0?X.__flags:(se<0?(delete X.__flags.getter,delete X.__flags.setter,delete X.__flags.alloc,delete X.__flags.dealloc):(X.__flags.getter=(1&se)!==0,X.__flags.setter=(2&se)!==0,X.__flags.alloc=(4&se)!==0,X.__flags.dealloc=(8&se)!==0),X._flags)};return Object.defineProperty($,"__flags",{iterable:!1,writable:!1,value:Object.create(T)}),T||$(0),$},n.debugFlags=n.__makeDebugFlags());const m=!0,q=T=>T[1]==="(",M=T=>T==="p"||T==="P"||T==="s",Y=T=>T==="P",le=T=>T?q(T)?"p":T[0]:void 0,ye=function(T){switch(le(T)){case"c":case"C":return"i8";case"i":return"i32";case"p":case"P":case"s":return b;case"j":return"i64";case"f":return"float";case"d":return"double"}i("Unhandled signature IR:",T)},Ee=function(T){switch(le(T)){case"c":case"C":return 1;case"i":return 4;case"p":case"P":case"s":return y;case"j":return 8;case"f":return 4;case"d":return 8}i("Unhandled signature sizeof:",T)},de=z?()=>!0:()=>i("BigInt64Array is not available."),V=function(T){switch(le(T)){case"p":case"P":case"s":switch(y){case 4:return"getInt32";case 8:return de()&&"getBigInt64"}break;case"i":return"getInt32";case"c":return"getInt8";case"C":return"getUint8";case"j":return de()&&"getBigInt64";case"f":return"getFloat32";case"d":return"getFloat64"}i("Unhandled DataView getter for signature:",T)},A=function(T){switch(le(T)){case"p":case"P":case"s":switch(y){case 4:return"setInt32";case 8:return de()&&"setBigInt64"}break;case"i":return"setInt32";case"c":return"setInt8";case"C":return"setUint8";case"j":return de()&&"setBigInt64";case"f":return"setFloat32";case"d":return"setFloat64"}i("Unhandled DataView setter for signature:",T)},l=function(T){switch(le(T)){case"i":case"f":case"c":case"C":case"d":return Number;case"j":return C;case"p":case"P":case"s":switch(y){case 4:return Number;case 8:return C}break}i("Unhandled DataView set wrapper for signature:",T)},_=(T,$)=>T+"::"+$,d=function(T,$){return()=>i(_(T,$),"is read-only.")},E=function T($,X=!0){let se=T.map.get($);return!se&&X&&T.map.set($,se=T.create($)),se};E.map=new WeakMap,E.create=T=>Object.assign(Object.create(null),{o:T,p:void 0,ownsPointer:!1,zod:!1,xb:0});const W=T=>E.map.delete(T),K=T=>typeof T=="number"&&T===(T|0)&&T>=0,h=y===4?K:T=>typeof T=="bigint"&&T>=0||K(T),P=T=>h(T)&&T>0,Q=function(T,$,X){const se=E($,!1);if(se){if(W($),!X&&!(X=se.p)){console.warn("Cannot(?) happen: __freeStruct() found no instanceInfo");return}if(Array.isArray($.ondispose)){let pe;for(;pe=$.ondispose.pop();)try{pe instanceof Function?pe.call($):pe instanceof Ze?pe.dispose():h(pe)&&I(pe)}catch(Fe){console.warn("ondispose() for",T.structName,"@",X,"threw. NOT propagating it.",Fe)}}else if($.ondispose instanceof Function)try{$.ondispose()}catch(pe){console.warn("ondispose() for",T.structName,"@",X,"threw. NOT propagating it.",pe)}delete $.ondispose,T.debugFlags.__flags.dealloc&&J("debug.dealloc:",se.ownsPointer?"":"EXTERNAL",T.structName,"instance:",T.structInfo.sizeof,"bytes @"+X),se.ownsPointer&&((se.zod||T.structInfo.zeroOnDispose)&&u().fill(0,Number(X),Number(X)+T.structInfo.sizeof+se.xb),I(X))}},ne=()=>({configurable:!1,writable:!1,iterable:!1}),g=T=>({...ne(),value:T}),N=function($,X,se){let pe;const Fe=Pe=>{P(Pe)||i("Invalid pointer value",arguments[0],"for",$.structName,"constructor.")};arguments.length>=3?se&&typeof se=="object"?(pe=se,se=pe?.wrap):(Fe(se),pe={wrap:se}):pe={};const Qe=!se;let $e=0,Ke=!1;if(se)Fe(se),Ke=!!pe?.takeOwnership;else{const Pe=pe?.extraBytes??0;(Pe<0||Pe!==(Pe|0))&&i("Invalid extraBytes value:",pe?.extraBytes),$e=$.structInfo.sizeof+Pe,se=F($e)||i("Allocation of",$.structName,"structure failed."),Ke=!0}try{pe?.debugFlags&&X.debugFlags(pe.debugFlags),$.debugFlags.__flags.alloc&&J("debug.alloc:",Qe?"":"EXTERNAL",$.structName,"instance:",$.structInfo.sizeof,"bytes @"+se),Qe&&u().fill(0,Number(se),Number(se)+$e);const Pe=E(X);Pe.p=se,Pe.ownsPointer=Ke,Pe.xb=$e?$e-$.structInfo.sizeof:0,Pe.zod=!!pe?.zeroOnDispose,pe?.ondispose&&pe.ondispose!==se&&X.addOnDispose(pe.ondispose)}catch(Pe){throw Q($,X,se),Pe}},H=function T($){return T.rxSig1??=/^[ipPsjfdcC]$/,T.rxSig2??=/^[vipPsjfdcC]\([ipPsjfdcC]*\)$/,T.rxSig1.test($)||T.rxSig2.test($)},ie=(function(T){let $=this.get(T);return $||($=[Object.create(null),Object.create(null),Object.create(null)],this.set(T,$)),$}).bind(new WeakMap),Z=function(T,$,X,se){const pe=ie(T)[$];return arguments.length===3?pe[X]:se?pe[X]=se:delete pe[X]},ue=function(T,...$){return Z(this,0,T,...$)},Se=function(T,$){H($)&&i(T,"(",$,") collides with a data type signature.")},_e=function(T,...$){return Se("Setter adaptor",T),Z(this,1,T,...$)},S=function(T,...$){return Se("Struct adaptor",T),Z(this,2,T,...$)},x=function(T,$){const X=typeof $=="string"?Z(T,2,$):$;return typeof X!="object"&&i("Invalid struct mapping object. Arg =",$,JSON.stringify(X)),X},B=g(T=>L+T+G),ee=function(T,$,X=!0){let se=T.members[$];if(!se&&(L||G)){for(const pe of Object.values(T.members))if(pe.key===$){se=pe;break}!se&&X&&i(_(T.name||T.structName,$),"is not a mapped struct member.")}return se},ae=function T($,X,se=!1){T._||(T._=Fe=>Fe.replace(/[^vipPsjrdcC]/g,"").replace(/[pPscC]/g,"i"));const pe=ee($.structInfo,X,!0);return se?T._(pe.signature):pe.signature},fe=g(function(){const T=[];for(const $ of Object.keys(this.structInfo.members))T.push(this.memberKey($));return T}),ce=new TextDecoder("utf-8"),be=new TextEncoder,Oe=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,Re=function(T,$,X){return y===8&&($=Number($),X=Number(X)),ce.decode(T.buffer instanceof Oe?T.slice($,X):T.subarray($,X))},we=function(T,$,X=!1){const se=ee(T.structInfo,$,X);return se&&se.signature.length===1&&se.signature[0]==="s"?se:!1},He=function(T){T.signature!=="s"&&i("Invalid member type signature for C-string value:",JSON.stringify(T))},rt=function($,X){const se=ee($.structInfo,X,!0);He(se);const pe=$[se.key];if(!pe)return null;let Fe=pe;const Qe=u();for(;Qe[Fe]!==0;++Fe);return pe===Fe?"":Re(Qe,pe,Fe)},ht=function(T,...$){T.ondispose?Array.isArray(T.ondispose)||(T.ondispose=[T.ondispose]):T.ondispose=[],T.ondispose.push(...$)},Ye=function(T){const $=be.encode(T),X=F($.length+1);X||i("Allocation error while duplicating string:",T);const se=u();return se.set($,Number(X)),se[O(X,$.length)]=0,X},Tt=function(T,$,X){const se=ee(T.structInfo,$,!0);He(se);const pe=Ye(X);return T[se.key]=pe,ht(T,pe),T},Ze=function($,X){arguments[2]!==g&&i("Do not call the StructType constructor","from client-level code."),Object.defineProperties(this,{structName:g($),structInfo:g(X)})};Ze.prototype=Object.create(null,{dispose:g(function(){Q(this.constructor,this)}),lookupMember:g(function(T,$=!0){return ee(this.structInfo,T,$)}),memberToJsString:g(function(T){return rt(this,T)}),memberIsString:g(function(T,$=!0){return we(this,T,$)}),memberKey:B,memberKeys:fe,memberSignature:g(function(T,$=!1){return ae(this,T,$)}),memoryDump:g(function(){const T=this.pointer;return T?new Uint8Array(u().slice(Number(T),Number(T)+this.structInfo.sizeof)):null}),extraBytes:{configurable:!1,enumerable:!1,get:function(){return E(this,!1)?.xb??0}},zeroOnDispose:{configurable:!1,enumerable:!1,get:function(){return E(this,!1)?.zod??!!this.structInfo.zeroOnDispose}},pointer:{configurable:!1,enumerable:!1,get:function(){return E(this,!1)?.p},set:()=>i("Cannot assign the 'pointer' property of a struct.")},setMemberCString:g(function(T,$){return Tt(this,T,$)})}),Object.assign(Ze.prototype,{addOnDispose:function(...T){return ht(this,...T),this}}),Object.defineProperties(Ze,{allocCString:g(Ye),isA:g(T=>T instanceof Ze),hasExternalPointer:g(T=>{const $=E(T,!1);return!!($?.p&&!$?.ownsPointer)}),memberKey:B});const ut=function(T){return T.get||(T.adaptGet?Je.adaptGet(T.adaptGet):void 0)},Nt=function(T){return T.set||(T.adaptSet?Je.adaptSet(T.adaptSet):void 0)},Cn=function T($,X,se){const pe=T.innerStructs??=new Map,Fe=$.memberKey(X);se.signature!==void 0&&i("'signature' cannot be used on an embedded struct (",$.structName,".",Fe,")."),Nt(se)&&i("'set' and 'adaptSet' are not permitted for nested struct members."),se.structName??=$.structName+"::"+X,se.key=Fe,se.name=X,se.constructor=this.call(this,se.structName,se);const Qe=ut(se),$e=Object.assign(Object.create(null),{configurable:!1,enumerable:!1,set:d($.structName,Fe),get:function(){const Ke=this.debugFlags.__flags,Pe=this.pointer,Ve=Pe+"."+Fe;let ge=pe.get(Ve);return Ke.getter&&J("debug.getter: k =",Ve),ge||(ge=new se.constructor(O(Pe,se.offset)),pe.set(Ve,ge),this.addOnDispose(()=>ge.dispose()),ge.addOnDispose(()=>pe.delete(Ve))),Qe&&(ge=Qe.apply(this,[ge,Fe])),Ke.getter&&J("debug.getter: result =",ge),ge}});Object.defineProperty($.prototype,Fe,$e)},Dn=function T($,X,se){if(se=x(this,se),se.members)return Cn.call(this,$,X,se);if(!T.cache){T.cache={getters:{},setters:{},sw:{}};const Ve=["i","c","C","p","P","s","f","d","v()"];R&&Ve.push("j"),Ve.forEach(function(ge){T.cache.getters[ge]=V(ge),T.cache.setters[ge]=A(ge),T.cache.sw[ge]=l(ge)}),T.sigCheck=function(ge,Ue,Lt,fr){Object.prototype.hasOwnProperty.call(ge,Lt)&&i(ge.structName,"already has a property named",Lt+"."),H(fr)||i("Malformed signature for",_(ge.structName,Ue)+":",fr)}}const pe=$.memberKey(X);T.sigCheck($.prototype,X,pe,se.signature),se.key=pe,se.name=X;const Fe=le(se.signature),Qe=_($.structName,pe),$e=$.debugFlags.__flags,Ke=ut(se),Pe=Object.create(null);if(Pe.configurable=!1,Pe.enumerable=!1,Pe.get=function(){$e.getter&&J("debug.getter:",T.cache.getters[Fe],"for",ye(Fe),Qe,"@",this.pointer,"+",se.offset,"sz",se.sizeof);let Ve=new DataView(u().buffer,Number(this.pointer)+se.offset,se.sizeof)[T.cache.getters[Fe]](0,m);return Ke&&(Ve=Ke.apply(this,[pe,Ve])),$e.getter&&J("debug.getter:",Qe,"result =",Ve),Ve},se.readOnly)Pe.set=d($.prototype.structName,pe);else{const Ve=Nt(se);Pe.set=function(ge){$e.setter&&J("debug.setter:",T.cache.setters[Fe],"for",ye(Fe),Qe,"@",this.pointer,"+",se.offset,"sz",se.sizeof,ge),this.pointer||i("Cannot set native property on a disposed",this.structName,"instance."),Ve&&(ge=Ve.apply(this,[pe,ge])),ge==null?ge=w:M(se.signature)&&!h(ge)&&(Y(se.signature)&&ge instanceof Ze?(ge=ge.pointer||w,$e.setter&&J("debug.setter:",Qe,"resolved to",ge)):i("Invalid value for pointer-type",Qe+".")),new DataView(u().buffer,Number(this.pointer)+se.offset,se.sizeof)[T.cache.setters[Fe]](0,T.cache.sw[Fe](ge),m)}}Object.defineProperty($.prototype,pe,Pe)},_r=function T($,X,se=Object.create(null)){const pe=function ge(Ue){this instanceof ge||i("The",$,"constructor may only be called via 'new'."),N(ge,this,...arguments)},Fe=this,Qe=ge=>typeof ge=="string"&&H(ge)?{signature:ge}:x(Fe,ge);arguments.length===1?(X=Qe($),$=X.structName||X.name):arguments.length===2?(X=Qe(X),X.name??=$):X=Qe(X),$??=X.structName,$??=se.structName,$||i("One of 'name' or 'structName' are required."),X.adapt&&(Object.keys(X.adapt.struct||{}).forEach(ge=>{S.call(T,ge,X.adapt.struct[ge])}),Object.keys(X.adapt.set||{}).forEach(ge=>{_e.call(T,ge,X.adapt.set[ge])}),Object.keys(X.adapt.get||{}).forEach(ge=>{ue.call(T,ge,X.adapt.get[ge])})),!X.members&&!X.sizeof&&(X.sizeof=Ee(X.signature));const $e=g(n.__makeDebugFlags(Je.debugFlags));Object.defineProperties(pe,{debugFlags:$e,isA:g(ge=>ge instanceof pe),memberKey:B,memberKeys:fe,structInfo:g(X),structName:g($),ptrAdd:g(O)}),pe.prototype=new Ze($,X,g),Object.defineProperties(pe.prototype,{debugFlags:$e,constructor:g(pe),ptrAdd:g(f)});let Ke=!1,Pe=0;const Ve=!!X.autoCalcSizeOffset;return Ve||X.sizeof||i($,"description is missing its sizeof property."),X.offset??=0,Object.keys(X.members||{}).forEach(ge=>{let Ue=Qe(X.members[ge]);!Ue.members&&!Ue.sizeof&&(Ue.sizeof=Ee(Ue.signature),Ue.sizeof||i(_($,ge),"is missing a sizeof property.",Ue)),Ue.offset===void 0&&(Ve?Ue.offset=Pe:i(_($,ge),"is missing its offset.",JSON.stringify(Ue))),X.members[ge]=Ue,(!Ke||Ke.offset<Ue.offset)&&(Ke=Ue);const Lt=!!Ue.autoCalc;Ve&&(Ue.autoCalcSizeOffset=!0),Dn.call(Fe,pe,ge,Ue),Lt?Ue.autoCalcSizeOffset=!0:delete Ue.autoCalcSizeOffset,Pe+=Ue.sizeof}),Ke||i("No member property descriptions found."),X.sizeof||(X.sizeof=Pe),X.sizeof===1?X.signature==="c"||X.signature==="C"||i("Unexpected sizeof==1 member",_($,k),"with signature",X.signature):(X.sizeof%4!==0&&(console.warn("Invalid struct member description",X),i($,"sizeof is not aligned. sizeof="+X.sizeof)),X.offset%4!==0&&(console.warn("Invalid struct member description",X),i($,"offset is not aligned. offset="+X.offset))),X.sizeof<Pe&&(console.warn("Suspect struct description:",X,"offset =",Pe),i("Mismatch in the calculated vs. the provided sizeof/offset info.","Expected sizeof",Pe,"but got",X.sizeof,"for",X)),delete X.autoCalcSizeOffset,pe},Je=function T($,X){return arguments.length==1?_r.call(T,$):_r.call(T,$,X)};return Je.StructType=Ze,Je.config=r,Je.allocCString=Ye,Je.adaptGet=ue,Je.adaptSet=_e,Je.adaptStruct=S,Je.ptrAdd=O,Je.debugFlags||(Je.debugFlags=n.__makeDebugFlags(n.debugFlags)),Je},globalThis.sqlite3ApiBootstrap.initializers.push(function(s){const r=(...y)=>{throw new Error(y.join(" "))},i=s.capi,n=s.wasm,u=s.util;globalThis.WhWasmUtilInstaller(n),delete globalThis.WhWasmUtilInstaller;const F={core:[["sqlite3_aggregate_context","void*","sqlite3_context*","int"],["sqlite3_bind_double","int","sqlite3_stmt*","int","f64"],["sqlite3_bind_int","int","sqlite3_stmt*","int","int"],["sqlite3_bind_null",void 0,"sqlite3_stmt*","int"],["sqlite3_bind_parameter_count","int","sqlite3_stmt*"],["sqlite3_bind_parameter_index","int","sqlite3_stmt*","string"],["sqlite3_bind_parameter_name","string","sqlite3_stmt*","int"],["sqlite3_bind_pointer","int","sqlite3_stmt*","int","*","string:static","*"],["sqlite3_busy_handler","int",["sqlite3*",new n.xWrap.FuncPtrAdapter({signature:"i(pi)",contextKey:(y,b)=>y[0]}),"*"]],["sqlite3_busy_timeout","int","sqlite3*","int"],["sqlite3_changes","int","sqlite3*"],["sqlite3_clear_bindings","int","sqlite3_stmt*"],["sqlite3_collation_needed","int","sqlite3*","*","*"],["sqlite3_column_blob","*","sqlite3_stmt*","int"],["sqlite3_column_bytes","int","sqlite3_stmt*","int"],["sqlite3_column_count","int","sqlite3_stmt*"],["sqlite3_column_decltype","string","sqlite3_stmt*","int"],["sqlite3_column_double","f64","sqlite3_stmt*","int"],["sqlite3_column_int","int","sqlite3_stmt*","int"],["sqlite3_column_name","string","sqlite3_stmt*","int"],["sqlite3_column_type","int","sqlite3_stmt*","int"],["sqlite3_column_value","sqlite3_value*","sqlite3_stmt*","int"],["sqlite3_commit_hook","void*",["sqlite3*",new n.xWrap.FuncPtrAdapter({name:"sqlite3_commit_hook",signature:"i(p)",contextKey:y=>y[0]}),"*"]],["sqlite3_compileoption_get","string","int"],["sqlite3_compileoption_used","int","string"],["sqlite3_complete","int","string:flexible"],["sqlite3_context_db_handle","sqlite3*","sqlite3_context*"],["sqlite3_data_count","int","sqlite3_stmt*"],["sqlite3_db_filename","string","sqlite3*","string"],["sqlite3_db_handle","sqlite3*","sqlite3_stmt*"],["sqlite3_db_name","string","sqlite3*","int"],["sqlite3_db_readonly","int","sqlite3*","string"],["sqlite3_db_status","int","sqlite3*","int","*","*","int"],["sqlite3_errcode","int","sqlite3*"],["sqlite3_errmsg","string","sqlite3*"],["sqlite3_error_offset","int","sqlite3*"],["sqlite3_errstr","string","int"],["sqlite3_exec","int",["sqlite3*","string:flexible",new n.xWrap.FuncPtrAdapter({signature:"i(pipp)",bindScope:"transient",callProxy:y=>{let b;return(C,U,w,O)=>{try{const f=n.cArgvToJs(U,w);return b||(b=n.cArgvToJs(U,O)),y(f,b)|0}catch(f){return f.resultCode||i.SQLITE_ERROR}}}}),"*","**"]],["sqlite3_expanded_sql","string","sqlite3_stmt*"],["sqlite3_extended_errcode","int","sqlite3*"],["sqlite3_extended_result_codes","int","sqlite3*","int"],["sqlite3_file_control","int","sqlite3*","string","int","*"],["sqlite3_finalize","int","sqlite3_stmt*"],["sqlite3_free",void 0,"*"],["sqlite3_get_autocommit","int","sqlite3*"],["sqlite3_get_auxdata","*","sqlite3_context*","int"],["sqlite3_initialize",void 0],["sqlite3_interrupt",void 0,"sqlite3*"],["sqlite3_is_interrupted","int","sqlite3*"],["sqlite3_keyword_count","int"],["sqlite3_keyword_name","int",["int","**","*"]],["sqlite3_keyword_check","int",["string","int"]],["sqlite3_libversion","string"],["sqlite3_libversion_number","int"],["sqlite3_limit","int",["sqlite3*","int","int"]],["sqlite3_malloc","*","int"],["sqlite3_next_stmt","sqlite3_stmt*",["sqlite3*","sqlite3_stmt*"]],["sqlite3_open","int","string","*"],["sqlite3_open_v2","int","string","*","int","string"],["sqlite3_realloc","*","*","int"],["sqlite3_reset","int","sqlite3_stmt*"],["sqlite3_result_blob",void 0,"sqlite3_context*","*","int","*"],["sqlite3_result_double",void 0,"sqlite3_context*","f64"],["sqlite3_result_error",void 0,"sqlite3_context*","string","int"],["sqlite3_result_error_code",void 0,"sqlite3_context*","int"],["sqlite3_result_error_nomem",void 0,"sqlite3_context*"],["sqlite3_result_error_toobig",void 0,"sqlite3_context*"],["sqlite3_result_int",void 0,"sqlite3_context*","int"],["sqlite3_result_null",void 0,"sqlite3_context*"],["sqlite3_result_pointer",void 0,"sqlite3_context*","*","string:static","*"],["sqlite3_result_subtype",void 0,"sqlite3_value*","int"],["sqlite3_result_text",void 0,"sqlite3_context*","string","int","*"],["sqlite3_result_zeroblob",void 0,"sqlite3_context*","int"],["sqlite3_rollback_hook","void*",["sqlite3*",new n.xWrap.FuncPtrAdapter({name:"sqlite3_rollback_hook",signature:"v(p)",contextKey:y=>y[0]}),"*"]],["sqlite3_set_auxdata",void 0,["sqlite3_context*","int","*","*"]],["sqlite3_set_errmsg","int","sqlite3*","int","string"],["sqlite3_shutdown",void 0],["sqlite3_sourceid","string"],["sqlite3_sql","string","sqlite3_stmt*"],["sqlite3_status","int","int","*","*","int"],["sqlite3_step","int","sqlite3_stmt*"],["sqlite3_stmt_busy","int","sqlite3_stmt*"],["sqlite3_stmt_readonly","int","sqlite3_stmt*"],["sqlite3_stmt_status","int","sqlite3_stmt*","int","int"],["sqlite3_strglob","int","string","string"],["sqlite3_stricmp","int","string","string"],["sqlite3_strlike","int","string","string","int"],["sqlite3_strnicmp","int","string","string","int"],["sqlite3_table_column_metadata","int","sqlite3*","string","string","string","**","**","*","*","*"],["sqlite3_total_changes","int","sqlite3*"],["sqlite3_trace_v2","int",["sqlite3*","int",new n.xWrap.FuncPtrAdapter({name:"sqlite3_trace_v2::callback",signature:"i(ippp)",contextKey:(y,b)=>y[0]}),"*"]],["sqlite3_txn_state","int",["sqlite3*","string"]],["sqlite3_uri_boolean","int","sqlite3_filename","string","int"],["sqlite3_uri_key","string","sqlite3_filename","int"],["sqlite3_uri_parameter","string","sqlite3_filename","string"],["sqlite3_user_data","void*","sqlite3_context*"],["sqlite3_value_blob","*","sqlite3_value*"],["sqlite3_value_bytes","int","sqlite3_value*"],["sqlite3_value_double","f64","sqlite3_value*"],["sqlite3_value_dup","sqlite3_value*","sqlite3_value*"],["sqlite3_value_free",void 0,"sqlite3_value*"],["sqlite3_value_frombind","int","sqlite3_value*"],["sqlite3_value_int","int","sqlite3_value*"],["sqlite3_value_nochange","int","sqlite3_value*"],["sqlite3_value_numeric_type","int","sqlite3_value*"],["sqlite3_value_pointer","*","sqlite3_value*","string:static"],["sqlite3_value_subtype","int","sqlite3_value*"],["sqlite3_value_type","int","sqlite3_value*"],["sqlite3_vfs_find","*","string"],["sqlite3_vfs_register","int","sqlite3_vfs*","int"],["sqlite3_vfs_unregister","int","sqlite3_vfs*"]],int64:[["sqlite3_bind_int64","int",["sqlite3_stmt*","int","i64"]],["sqlite3_changes64","i64",["sqlite3*"]],["sqlite3_column_int64","i64",["sqlite3_stmt*","int"]],["sqlite3_deserialize","int","sqlite3*","string","*","i64","i64","int"],["sqlite3_last_insert_rowid","i64",["sqlite3*"]],["sqlite3_malloc64","*","i64"],["sqlite3_msize","i64","*"],["sqlite3_overload_function","int",["sqlite3*","string","int"]],["sqlite3_realloc64","*","*","i64"],["sqlite3_result_int64",void 0,"*","i64"],["sqlite3_result_zeroblob64","int","*","i64"],["sqlite3_serialize","*","sqlite3*","string","*","int"],["sqlite3_set_last_insert_rowid",void 0,["sqlite3*","i64"]],["sqlite3_status64","int","int","*","*","int"],["sqlite3_db_status64","int","sqlite3*","int","*","*","int"],["sqlite3_total_changes64","i64",["sqlite3*"]],["sqlite3_update_hook","*",["sqlite3*",new n.xWrap.FuncPtrAdapter({name:"sqlite3_update_hook::callback",signature:"v(pippj)",contextKey:y=>y[0],callProxy:y=>(b,C,U,w,O)=>{y(b,C,n.cstrToJs(U),n.cstrToJs(w),O)}}),"*"]],["sqlite3_uri_int64","i64",["sqlite3_filename","string","i64"]],["sqlite3_value_int64","i64","sqlite3_value*"]],wasmInternal:[["sqlite3__wasm_db_reset","int","sqlite3*"],["sqlite3__wasm_db_vfs","sqlite3_vfs*","sqlite3*","string"],["sqlite3__wasm_vfs_create_file","int","sqlite3_vfs*","string","*","int"],["sqlite3__wasm_posix_create_file","int","string","*","int"],["sqlite3__wasm_vfs_unlink","int","sqlite3_vfs*","string"],["sqlite3__wasm_qfmt_token","string:dealloc","string","int"]]};if(n.exports.sqlite3_progress_handler&&F.core.push(["sqlite3_progress_handler",void 0,["sqlite3*","int",new n.xWrap.FuncPtrAdapter({name:"xProgressHandler",signature:"i(p)",bindScope:"context",contextKey:(y,b)=>y[0]}),"*"]]),n.exports.sqlite3_stmt_explain&&F.core.push(["sqlite3_stmt_explain","int","sqlite3_stmt*","int"],["sqlite3_stmt_isexplain","int","sqlite3_stmt*"]),n.exports.sqlite3_set_authorizer&&F.core.push(["sqlite3_set_authorizer","int",["sqlite3*",new n.xWrap.FuncPtrAdapter({name:"sqlite3_set_authorizer::xAuth",signature:"i(pissss)",contextKey:(y,b)=>y[0],callProxy:y=>(b,C,U,w,O,f)=>{try{return U=U&&n.cstrToJs(U),w=w&&n.cstrToJs(w),O=O&&n.cstrToJs(O),f=f&&n.cstrToJs(f),y(b,C,U,w,O,f)|0}catch(m){return m.resultCode||i.SQLITE_ERROR}}}),"*"]]),n.exports.sqlite3_column_origin_name&&F.core.push(["sqlite3_column_database_name","string","sqlite3_stmt*","int"],["sqlite3_column_origin_name","string","sqlite3_stmt*","int"],["sqlite3_column_table_name","string","sqlite3_stmt*","int"]),n.bigIntEnabled&&n.exports.sqlite3_declare_vtab&&F.int64.push(["sqlite3_create_module","int",["sqlite3*","string","sqlite3_module*","*"]],["sqlite3_create_module_v2","int",["sqlite3*","string","sqlite3_module*","*","*"]],["sqlite3_declare_vtab","int",["sqlite3*","string:flexible"]],["sqlite3_drop_modules","int",["sqlite3*","**"]],["sqlite3_vtab_collation","string","sqlite3_index_info*","int"],["sqlite3_vtab_distinct","int","sqlite3_index_info*"],["sqlite3_vtab_in","int","sqlite3_index_info*","int","int"],["sqlite3_vtab_in_first","int","sqlite3_value*","**"],["sqlite3_vtab_in_next","int","sqlite3_value*","**"],["sqlite3_vtab_nochange","int","sqlite3_context*"],["sqlite3_vtab_on_conflict","int","sqlite3*"],["sqlite3_vtab_rhs_value","int","sqlite3_index_info*","int","**"]),n.bigIntEnabled&&n.exports.sqlite3_preupdate_hook&&F.int64.push(["sqlite3_preupdate_blobwrite","int","sqlite3*"],["sqlite3_preupdate_count","int","sqlite3*"],["sqlite3_preupdate_depth","int","sqlite3*"],["sqlite3_preupdate_hook","*",["sqlite3*",new n.xWrap.FuncPtrAdapter({name:"sqlite3_preupdate_hook",signature:"v(ppippjj)",contextKey:y=>y[0],callProxy:y=>(b,C,U,w,O,f,m)=>{y(b,C,U,n.cstrToJs(w),n.cstrToJs(O),f,m)}}),"*"]],["sqlite3_preupdate_new","int",["sqlite3*","int","**"]],["sqlite3_preupdate_old","int",["sqlite3*","int","**"]]),n.bigIntEnabled&&n.exports.sqlite3changegroup_add&&n.exports.sqlite3session_create&&n.exports.sqlite3_preupdate_hook){const y={signature:"i(ps)",callProxy:b=>(C,U)=>{try{return b(C,n.cstrToJs(U))|0}catch(w){return w.resultCode||i.SQLITE_ERROR}}};F.int64.push(["sqlite3changegroup_add","int",["sqlite3_changegroup*","int","void*"]],["sqlite3changegroup_add_strm","int",["sqlite3_changegroup*",new n.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changegroup_delete",void 0,["sqlite3_changegroup*"]],["sqlite3changegroup_new","int",["**"]],["sqlite3changegroup_output","int",["sqlite3_changegroup*","int*","**"]],["sqlite3changegroup_output_strm","int",["sqlite3_changegroup*",new n.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply","int",["sqlite3*","int","void*",new n.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...y}),new n.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_strm","int",["sqlite3*",new n.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new n.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...y}),new n.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_v2","int",["sqlite3*","int","void*",new n.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...y}),new n.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v2_strm","int",["sqlite3*",new n.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new n.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...y}),new n.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v3","int",["sqlite3*","int","void*",new n.xWrap.FuncPtrAdapter({name:"xFilter",signature:"i(pp)",bindScope:"transient"}),new n.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v3_strm","int",["sqlite3*",new n.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new n.xWrap.FuncPtrAdapter({name:"xFilter",signature:"i(pp)",bindScope:"transient"}),new n.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_concat","int",["int","void*","int","void*","int*","**"]],["sqlite3changeset_concat_strm","int",[new n.xWrap.FuncPtrAdapter({name:"xInputA",signature:"i(ppp)",bindScope:"transient"}),"void*",new n.xWrap.FuncPtrAdapter({name:"xInputB",signature:"i(ppp)",bindScope:"transient"}),"void*",new n.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_conflict","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_finalize","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_fk_conflicts","int",["sqlite3_changeset_iter*","int*"]],["sqlite3changeset_invert","int",["int","void*","int*","**"]],["sqlite3changeset_invert_strm","int",[new n.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new n.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_new","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_next","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_old","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_op","int",["sqlite3_changeset_iter*","**","int*","int*","int*"]],["sqlite3changeset_pk","int",["sqlite3_changeset_iter*","**","int*"]],["sqlite3changeset_start","int",["**","int","*"]],["sqlite3changeset_start_strm","int",["**",new n.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changeset_start_v2","int",["**","int","*","int"]],["sqlite3changeset_start_v2_strm","int",["**",new n.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*","int"]],["sqlite3session_attach","int",["sqlite3_session*","string"]],["sqlite3session_changeset","int",["sqlite3_session*","int*","**"]],["sqlite3session_changeset_size","i64",["sqlite3_session*"]],["sqlite3session_changeset_strm","int",["sqlite3_session*",new n.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_config","int",["int","void*"]],["sqlite3session_create","int",["sqlite3*","string","**"]],["sqlite3session_diff","int",["sqlite3_session*","string","string","**"]],["sqlite3session_enable","int",["sqlite3_session*","int"]],["sqlite3session_indirect","int",["sqlite3_session*","int"]],["sqlite3session_isempty","int",["sqlite3_session*"]],["sqlite3session_memory_used","i64",["sqlite3_session*"]],["sqlite3session_object_config","int",["sqlite3_session*","int","void*"]],["sqlite3session_patchset","int",["sqlite3_session*","*","**"]],["sqlite3session_patchset_strm","int",["sqlite3_session*",new n.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_table_filter",void 0,["sqlite3_session*",new n.xWrap.FuncPtrAdapter({name:"xFilter",...y,contextKey:(b,C)=>b[0]}),"*"]])}s.StructBinder=globalThis.Jaccwabyt({heap:n.heap8u,alloc:n.alloc,dealloc:n.dealloc,bigIntEnabled:n.bigIntEnabled,pointerIR:n.ptr.ir,memberPrefix:"$"}),delete globalThis.Jaccwabyt;{const y=n.xWrap.argAdapter("string");n.xWrap.argAdapter("string:flexible",w=>y(u.flexibleString(w))),n.xWrap.argAdapter("string:static",(function(w){return n.isPtr(w)?w:(w=""+w,this[w]||(this[w]=n.allocCString(w)))}).bind(Object.create(null)));const b=n.xWrap.argAdapter("*"),C=function(){};n.xWrap.argAdapter("sqlite3_filename",b)("sqlite3_context*",b)("sqlite3_value*",b)("void*",b)("sqlite3_changegroup*",b)("sqlite3_changeset_iter*",b)("sqlite3_session*",b)("sqlite3_stmt*",w=>b(w instanceof(s?.oo1?.Stmt||C)?w.pointer:w))("sqlite3*",w=>b(w instanceof(s?.oo1?.DB||C)?w.pointer:w))("sqlite3_vfs*",w=>typeof w=="string"?i.sqlite3_vfs_find(w)||s.SQLite3Error.toss(i.SQLITE_NOTFOUND,"Unknown sqlite3_vfs name:",w):b(w instanceof(i.sqlite3_vfs||C)?w.pointer:w)),n.exports.sqlite3_declare_vtab&&n.xWrap.argAdapter("sqlite3_index_info*",w=>b(w instanceof(i.sqlite3_index_info||C)?w.pointer:w))("sqlite3_module*",w=>b(w instanceof(i.sqlite3_module||C)?w.pointer:w));const U=n.xWrap.resultAdapter("*");n.xWrap.resultAdapter("sqlite3*",U)("sqlite3_context*",U)("sqlite3_stmt*",U)("sqlite3_value*",U)("sqlite3_vfs*",U)("void*",U);for(const w of F.core)i[w[0]]=n.xWrap.apply(null,w);for(const w of F.wasmInternal)u[w[0]]=n.xWrap.apply(null,w);for(const w of F.int64)i[w[0]]=n.bigIntEnabled?n.xWrap.apply(null,w):()=>r(w[0]+"() is unavailable due to lack","of BigInt support in this build.");delete F.core,delete F.int64,delete F.wasmInternal,u.sqlite3__wasm_db_error=function(w,O,f){return w?(O instanceof s.WasmAllocError?(O=i.SQLITE_NOMEM,f=0):O instanceof Error&&(f=f||""+O,O=O.resultCode||i.SQLITE_ERROR),i.sqlite3_set_errmsg(w,O,f)||O):i.SQLITE_MISUSE}}{const y=n.xCall("sqlite3__wasm_enum_json");y||r("Maintenance required: increase sqlite3__wasm_enum_json()'s","static buffer size!"),n.ctype=JSON.parse(n.cstrToJs(y));const b=["access","authorizer","blobFinalizers","changeset","config","dataTypes","dbConfig","dbStatus","encodings","fcntl","flock","ioCap","limits","openFlags","prepareFlags","resultCodes","sqlite3Status","stmtStatus","syncFlags","trace","txnState","udfFlags","version"];n.bigIntEnabled&&b.push("serialize","session","vtab");for(const w of b)for(const O of Object.entries(n.ctype[w]))i[O[0]]=O[1];n.functionEntry(i.SQLITE_WASM_DEALLOC)||r("Internal error: cannot resolve exported function","entry SQLITE_WASM_DEALLOC (=="+i.SQLITE_WASM_DEALLOC+").");const C=Object.create(null);for(const w of Object.entries(n.ctype.resultCodes))C[w[1]]=w[0];i.sqlite3_js_rc_str=w=>C[w];const U=Object.assign(Object.create(null),{WasmTestStruct:!0,sqlite3_index_info:!n.bigIntEnabled,sqlite3_index_constraint:!n.bigIntEnabled,sqlite3_index_orderby:!n.bigIntEnabled,sqlite3_index_constraint_usage:!n.bigIntEnabled});for(const w of n.ctype.structs)U[w.name]||(i[w.name]=s.StructBinder(w));if(i.sqlite3_index_info){for(const w of["sqlite3_index_constraint","sqlite3_index_orderby","sqlite3_index_constraint_usage"])i.sqlite3_index_info[w]=i[w],delete i[w];i.sqlite3_vtab_config=n.xWrap("sqlite3__wasm_vtab_config","int",["sqlite3*","int","int"])}}const I=(y,b,C)=>u.sqlite3__wasm_db_error(y,i.SQLITE_MISUSE,b+"() requires "+C+" argument"+(C===1?"":"s")+"."),J=y=>u.sqlite3__wasm_db_error(y,i.SQLITE_FORMAT,"SQLITE_UTF8 is the only supported encoding."),L=y=>n.xWrap.argAdapter("sqlite3*")(y),G=y=>n.isPtr(y)?n.cstrToJs(y):y,p=(function(y,b){y=L(y);let C=this.dbMap.get(y);if(b)!C&&b>0&&this.dbMap.set(y,C=Object.create(null));else return this.dbMap.delete(y),C;return C}).bind(Object.assign(Object.create(null),{dbMap:new Map}));p.addCollation=function(y,b){const C=p(y,1);C.collation||(C.collation=new Set),C.collation.add(G(b).toLowerCase())},p._addUDF=function(y,b,C,U){b=G(b).toLowerCase();let w=U.get(b);w||U.set(b,w=new Set),w.add(C<0?-1:C)},p.addFunction=function(y,b,C){const U=p(y,1);U.udf||(U.udf=new Map),this._addUDF(y,b,C,U.udf)},n.exports.sqlite3_create_window_function&&(p.addWindowFunc=function(y,b,C){const U=p(y,1);U.wudf||(U.wudf=new Map),this._addUDF(y,b,C,U.wudf)}),p.cleanup=function(y){y=L(y);for(const U of[["sqlite3_busy_handler",3],["sqlite3_commit_hook",3],["sqlite3_preupdate_hook",3],["sqlite3_progress_handler",4],["sqlite3_rollback_hook",3],["sqlite3_set_authorizer",3],["sqlite3_trace_v2",4],["sqlite3_update_hook",3]]){const[w,O]=U;if(!n.exports[w])continue;const f=[y];f.length=O;try{i[w](...f)}catch(m){s.config.warn("close-time call of",w+"(",f,") threw:",m)}}const b=p(y,0);if(!b)return;if(b.collation){for(const U of b.collation)try{i.sqlite3_create_collation_v2(y,U,i.SQLITE_UTF8,0,0,0)}catch{}delete b.collation}let C;for(C=0;C<2;++C){const U=C?b.wudf:b.udf;if(!U)continue;const w=C?i.sqlite3_create_window_function:i.sqlite3_create_function_v2;for(const O of U){const f=O[0],m=O[1],q=[y,f,0,i.SQLITE_UTF8,0,0,0,0,0];C&&q.push(0);for(const M of m)try{q[2]=M,w.apply(null,q)}catch{}m.clear()}U.clear()}delete b.udf,delete b.wudf};{const y=n.xWrap("sqlite3_close_v2","int","sqlite3*");i.sqlite3_close_v2=function(b){if(arguments.length!==1)return I(b,"sqlite3_close_v2",1);if(b)try{p.cleanup(b)}catch{}return y(b)}}if(i.sqlite3session_create){const y=n.xWrap("sqlite3session_delete",void 0,["sqlite3_session*"]);i.sqlite3session_delete=function(b){if(arguments.length!==1)return I(pDb,"sqlite3session_delete",1);b&&i.sqlite3session_table_filter(b,0,0),y(b)}}{const y=(C,U)=>"argv["+U+"]:"+C[0]+":"+n.cstrToJs(C[1]).toLowerCase(),b=n.xWrap("sqlite3_create_collation_v2","int",["sqlite3*","string","int","*",new n.xWrap.FuncPtrAdapter({name:"xCompare",signature:"i(pipip)",contextKey:y}),new n.xWrap.FuncPtrAdapter({name:"xDestroy",signature:"v(p)",contextKey:y})]);i.sqlite3_create_collation_v2=function(C,U,w,O,f,m){if(arguments.length!==6)return I(C,"sqlite3_create_collation_v2",6);if((w&15)===0)w|=i.SQLITE_UTF8;else if(i.SQLITE_UTF8!==(w&15))return J(C);try{const q=b(C,U,w,O,f,m);return q===0&&f instanceof Function&&p.addCollation(C,U),q}catch(q){return u.sqlite3__wasm_db_error(C,q)}},i.sqlite3_create_collation=(C,U,w,O,f)=>arguments.length===5?i.sqlite3_create_collation_v2(C,U,w,O,f,0):I(C,"sqlite3_create_collation",5)}{const y=function(w,O){return w[0]+":"+(w[2]<0?-1:w[2])+":"+O+":"+n.cstrToJs(w[1]).toLowerCase()},b=Object.assign(Object.create(null),{xInverseAndStep:{signature:"v(pip)",contextKey:y,callProxy:w=>(O,f,m)=>{try{w(O,...i.sqlite3_values_to_js(f,m))}catch(q){i.sqlite3_result_error_js(O,q)}}},xFinalAndValue:{signature:"v(p)",contextKey:y,callProxy:w=>O=>{try{i.sqlite3_result_js(O,w(O))}catch(f){i.sqlite3_result_error_js(O,f)}}},xFunc:{signature:"v(pip)",contextKey:y,callProxy:w=>(O,f,m)=>{try{i.sqlite3_result_js(O,w(O,...i.sqlite3_values_to_js(f,m)))}catch(q){i.sqlite3_result_error_js(O,q)}}},xDestroy:{signature:"v(p)",contextKey:y,callProxy:w=>O=>{try{w(O)}catch(f){console.error("UDF xDestroy method threw:",f)}}}}),C=n.xWrap("sqlite3_create_function_v2","int",["sqlite3*","string","int","int","*",new n.xWrap.FuncPtrAdapter({name:"xFunc",...b.xFunc}),new n.xWrap.FuncPtrAdapter({name:"xStep",...b.xInverseAndStep}),new n.xWrap.FuncPtrAdapter({name:"xFinal",...b.xFinalAndValue}),new n.xWrap.FuncPtrAdapter({name:"xDestroy",...b.xDestroy})]),U=n.exports.sqlite3_create_window_function?n.xWrap("sqlite3_create_window_function","int",["sqlite3*","string","int","int","*",new n.xWrap.FuncPtrAdapter({name:"xStep",...b.xInverseAndStep}),new n.xWrap.FuncPtrAdapter({name:"xFinal",...b.xFinalAndValue}),new n.xWrap.FuncPtrAdapter({name:"xValue",...b.xFinalAndValue}),new n.xWrap.FuncPtrAdapter({name:"xInverse",...b.xInverseAndStep}),new n.xWrap.FuncPtrAdapter({name:"xDestroy",...b.xDestroy})]):void 0;i.sqlite3_create_function_v2=function w(O,f,m,q,M,Y,le,ye,Ee){if(w.length!==arguments.length)return I(O,"sqlite3_create_function_v2",w.length);if((q&15)===0)q|=i.SQLITE_UTF8;else if(i.SQLITE_UTF8!==(q&15))return J(O);try{const de=C(O,f,m,q,M,Y,le,ye,Ee);return de===0&&(Y instanceof Function||le instanceof Function||ye instanceof Function||Ee instanceof Function)&&p.addFunction(O,f,m),de}catch(de){return console.error("sqlite3_create_function_v2() setup threw:",de),u.sqlite3__wasm_db_error(O,de,"Creation of UDF threw: "+de)}},i.sqlite3_create_function=function w(O,f,m,q,M,Y,le,ye){return w.length===arguments.length?i.sqlite3_create_function_v2(O,f,m,q,M,Y,le,ye,0):I(O,"sqlite3_create_function",w.length)},U?i.sqlite3_create_window_function=function w(O,f,m,q,M,Y,le,ye,Ee,de){if(w.length!==arguments.length)return I(O,"sqlite3_create_window_function",w.length);if((q&15)===0)q|=i.SQLITE_UTF8;else if(i.SQLITE_UTF8!==(q&15))return J(O);try{const V=U(O,f,m,q,M,Y,le,ye,Ee,de);return V===0&&(Y instanceof Function||le instanceof Function||ye instanceof Function||Ee instanceof Function||de instanceof Function)&&p.addWindowFunc(O,f,m),V}catch(V){return console.error("sqlite3_create_window_function() setup threw:",V),u.sqlite3__wasm_db_error(O,V,"Creation of UDF threw: "+V)}}:delete i.sqlite3_create_window_function,i.sqlite3_create_function_v2.udfSetResult=i.sqlite3_create_function.udfSetResult=i.sqlite3_result_js,i.sqlite3_create_window_function&&(i.sqlite3_create_window_function.udfSetResult=i.sqlite3_result_js),i.sqlite3_create_function_v2.udfConvertArgs=i.sqlite3_create_function.udfConvertArgs=i.sqlite3_values_to_js,i.sqlite3_create_window_function&&(i.sqlite3_create_window_function.udfConvertArgs=i.sqlite3_values_to_js),i.sqlite3_create_function_v2.udfSetError=i.sqlite3_create_function.udfSetError=i.sqlite3_result_error_js,i.sqlite3_create_window_function&&(i.sqlite3_create_window_function.udfSetError=i.sqlite3_result_error_js)}{const y=(C,U)=>(typeof C=="string"?U=-1:u.isSQLableTypedArray(C)?(U=C.byteLength,C=n.typedArrayToString(C instanceof ArrayBuffer?new Uint8Array(C):C)):Array.isArray(C)&&(C=C.join(""),U=-1),[C,U]),b={basic:n.xWrap("sqlite3_prepare_v3","int",["sqlite3*","string","int","int","**","**"]),full:n.xWrap("sqlite3_prepare_v3","int",["sqlite3*","*","int","int","**","**"])};i.sqlite3_prepare_v3=function C(U,w,O,f,m,q){if(C.length!==arguments.length)return I(U,"sqlite3_prepare_v3",C.length);const[M,Y]=y(w,Number(O));switch(typeof M){case"string":return b.basic(U,M,Y,f,m,null);case typeof n.ptr.null:return b.full(U,n.ptr.coerce(M),Y,f,m,q);default:return u.sqlite3__wasm_db_error(U,i.SQLITE_MISUSE,"Invalid SQL argument type for sqlite3_prepare_v2/v3(). typeof="+typeof M)}},i.sqlite3_prepare_v2=function C(U,w,O,f,m){return C.length===arguments.length?i.sqlite3_prepare_v3(U,w,O,0,f,m):I(U,"sqlite3_prepare_v2",C.length)}}{const y=n.xWrap("sqlite3_bind_text","int",["sqlite3_stmt*","int","string","int","*"]),b=n.xWrap("sqlite3_bind_blob","int",["sqlite3_stmt*","int","*","int","*"]);i.sqlite3_bind_text=function C(U,w,O,f,m){if(C.length!==arguments.length)return I(i.sqlite3_db_handle(U),"sqlite3_bind_text",C.length);if(n.isPtr(O)||O===null)return y(U,w,O,f,m);O instanceof ArrayBuffer?O=new Uint8Array(O):Array.isArray(pMem)&&(O=pMem.join(""));let q,M;try{if(u.isSQLableTypedArray(O))q=n.allocFromTypedArray(O),M=O.byteLength;else if(typeof O=="string")[q,M]=n.allocCString(O);else return u.sqlite3__wasm_db_error(i.sqlite3_db_handle(U),i.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_text().");return y(U,w,q,M,i.SQLITE_WASM_DEALLOC)}catch(Y){return n.dealloc(q),u.sqlite3__wasm_db_error(i.sqlite3_db_handle(U),Y)}},i.sqlite3_bind_blob=function C(U,w,O,f,m){if(C.length!==arguments.length)return I(i.sqlite3_db_handle(U),"sqlite3_bind_blob",C.length);if(n.isPtr(O)||O===null)return b(U,w,O,f,m);O instanceof ArrayBuffer?O=new Uint8Array(O):Array.isArray(O)&&(O=O.join(""));let q,M;try{if(u.isBindableTypedArray(O))q=n.allocFromTypedArray(O),M=f>=0?f:O.byteLength;else if(typeof O=="string")[q,M]=n.allocCString(O);else return u.sqlite3__wasm_db_error(i.sqlite3_db_handle(U),i.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_blob().");return b(U,w,q,M,i.SQLITE_WASM_DEALLOC)}catch(Y){return n.dealloc(q),u.sqlite3__wasm_db_error(i.sqlite3_db_handle(U),Y)}}}if(!i.sqlite3_column_text){const y=n.xWrap.argAdapter("sqlite3_stmt*"),b=n.xWrap.argAdapter("int"),C=n.xWrap.argAdapter("sqlite3_value*"),U=(w,O)=>n.typedArrayToString(n.heap8u(),Number(w),Number(w)+O);i.sqlite3_column_text=function(w,O){const f=y(w),m=b(O),q=n.exports.sqlite3_column_text(f,m);return q?U(q,n.exports.sqlite3_column_bytes(f,m)):null},i.sqlite3_value_text=function(w){const O=C(w),f=n.exports.sqlite3_value_text(O);return f?U(f,n.exports.sqlite3_value_bytes(O)):null}}i.sqlite3_config=function(y,...b){if(arguments.length<2)return i.SQLITE_MISUSE;switch(y){case i.SQLITE_CONFIG_COVERING_INDEX_SCAN:case i.SQLITE_CONFIG_MEMSTATUS:case i.SQLITE_CONFIG_SMALL_MALLOC:case i.SQLITE_CONFIG_SORTERREF_SIZE:case i.SQLITE_CONFIG_STMTJRNL_SPILL:case i.SQLITE_CONFIG_URI:return n.exports.sqlite3__wasm_config_i(y,b[0]);case i.SQLITE_CONFIG_LOOKASIDE:return n.exports.sqlite3__wasm_config_ii(y,b[0],b[1]);case i.SQLITE_CONFIG_MEMDB_MAXSIZE:return n.exports.sqlite3__wasm_config_j(y,b[0]);case i.SQLITE_CONFIG_GETMALLOC:case i.SQLITE_CONFIG_GETMUTEX:case i.SQLITE_CONFIG_GETPCACHE2:case i.SQLITE_CONFIG_GETPCACHE:case i.SQLITE_CONFIG_HEAP:case i.SQLITE_CONFIG_LOG:case i.SQLITE_CONFIG_MALLOC:case i.SQLITE_CONFIG_MMAP_SIZE:case i.SQLITE_CONFIG_MULTITHREAD:case i.SQLITE_CONFIG_MUTEX:case i.SQLITE_CONFIG_PAGECACHE:case i.SQLITE_CONFIG_PCACHE2:case i.SQLITE_CONFIG_PCACHE:case i.SQLITE_CONFIG_PCACHE_HDRSZ:case i.SQLITE_CONFIG_PMASZ:case i.SQLITE_CONFIG_SERIALIZED:case i.SQLITE_CONFIG_SINGLETHREAD:case i.SQLITE_CONFIG_SQLLOG:case i.SQLITE_CONFIG_WIN32_HEAPSIZE:default:return i.SQLITE_NOTFOUND}};{const y=new Set;i.sqlite3_auto_extension=function(b){if(b instanceof Function)b=n.installFunction("i(ppp)",b);else if(arguments.length!==1||!n.isPtr(b))return i.SQLITE_MISUSE;const C=n.exports.sqlite3_auto_extension(b);return b!==arguments[0]&&(C===0?y.add(b):n.uninstallFunction(b)),C},i.sqlite3_cancel_auto_extension=function(b){return!b||arguments.length!==1||!n.isPtr(b)?0:n.exports.sqlite3_cancel_auto_extension(b)},i.sqlite3_reset_auto_extension=function(){n.exports.sqlite3_reset_auto_extension();for(const b of y)n.uninstallFunction(b);y.clear()}}n.xWrap.FuncPtrAdapter.warnOnUse=!0;const z=s.StructBinder,R=function y(b,C,U,w=y.installMethodArgcCheck){if(b instanceof z.StructType?!(U instanceof Function)&&!n.isPtr(U)&&r("Usage error: expecting a Function or WASM pointer to one."):r("Usage error: target object is-not-a StructType."),arguments.length===1)return(q,M)=>y(b,q,M,w);y.argcProxy||(y.argcProxy=function(q,M,Y,le){return function(...ye){return Y.length!==arguments.length&&r("Argument mismatch for",q.structInfo.name+"::"+M+": Native signature is:",le),Y.apply(this,ye)}},y.removeFuncList=function(){this.ondispose.__removeFuncList&&(this.ondispose.__removeFuncList.forEach((q,M)=>{if(n.isPtr(q))try{n.uninstallFunction(q)}catch{}}),delete this.ondispose.__removeFuncList)});const O=b.memberSignature(C);O.length<2&&r("Member",C,"does not have a function pointer signature:",O);const f=b.memberKey(C),m=w&&!n.isPtr(U)?y.argcProxy(b,f,U,O):U;if(n.isPtr(m))m&&!n.functionEntry(m)&&r("Pointer",m,"is not a WASM function table entry."),b[f]=m;else{const q=n.installFunction(m,O);b[f]=q,(!b.ondispose||!b.ondispose.__removeFuncList)&&(b.addOnDispose("ondispose.__removeFuncList handler",y.removeFuncList),b.ondispose.__removeFuncList=[]),b.ondispose.__removeFuncList.push(f,q)}return(q,M)=>y(b,q,M,w)};R.installMethodArgcCheck=!1;const te=function(y,b,C=R.installMethodArgcCheck){const U=new Map;for(const w of Object.keys(b)){const O=b[w],f=U.get(O);if(f){const m=y.memberKey(w);y[m]=y[y.memberKey(f)]}else R(y,w,O,C),U.set(O,w)}return y};z.StructType.prototype.installMethod=function(b,C,U=R.installMethodArgcCheck){return arguments.length<3&&b&&typeof b=="object"?te(this,...arguments):R(this,...arguments)},z.StructType.prototype.installMethods=function(y,b=R.installMethodArgcCheck){return te(this,y,b)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(s){const r=(...A)=>{throw new s.SQLite3Error(...A)},i=s.capi,n=s.wasm,u=s.util,F=function(A){return(...l)=>A("sqlite3.oo1:",...l)};s.__isUnderTest?F(console.debug.bind(console)):F(s.config.debug),s.__isUnderTest?F(console.warn.bind(console)):F(s.config.warn),s.__isUnderTest?F(console.error.bind(console)):F(s.config.error);const I=new WeakMap,J=new Set,L=new WeakMap,G=(A,l,_)=>{const d=Object.getOwnPropertyDescriptor(A,l);return d?d.value:_},p=function(A,l){return l&&(A instanceof y&&(A=A.pointer),r(l,"sqlite3 result code",l+":",A?i.sqlite3_errmsg(A):i.sqlite3_errstr(l))),arguments[0]},z=n.installFunction("i(ippp)",(function(A,l,_,d){i.SQLITE_TRACE_STMT===A&&console.log("SQL TRACE #"+ ++this.counter,"via sqlite3@"+l+"["+i.sqlite3_db_filename(l,null)+"]",n.cstrToJs(d))}).bind({counter:0})),R=Object.create(null),te=function A(...l){const _=A.normalizeArgs(...l);let d;if(d=_["sqlite3*"])_["sqlite3*:takeOwnership"]||J.add(this),this.filename=i.sqlite3_db_filename(d,"main");else{let E=_.filename,W=_.vfs,K=_.flags;(typeof E!="string"&&!n.isPtr(E)||typeof K!="string"||W&&typeof W!="string"&&!n.isPtr(W))&&(s.config.error("Invalid DB ctor args",_,arguments),r("Invalid arguments for DB constructor:",arguments,"opts:",_));let D=0;K.indexOf("c")>=0&&(D|=i.SQLITE_OPEN_CREATE|i.SQLITE_OPEN_READWRITE),K.indexOf("w")>=0&&(D|=i.SQLITE_OPEN_READWRITE),D===0&&(D|=i.SQLITE_OPEN_READONLY),D|=i.SQLITE_OPEN_EXRESCODE;const h=n.pstack.pointer;try{const P=n.pstack.allocPtr();let Q=i.sqlite3_open_v2(E,P,D,W||n.ptr.null);d=n.peekPtr(P),p(d,Q),i.sqlite3_extended_result_codes(d,1),K.indexOf("t")>=0&&i.sqlite3_trace_v2(d,i.SQLITE_TRACE_STMT,z,d)}catch(P){throw d&&i.sqlite3_close_v2(d),P}finally{n.pstack.restore(h)}this.filename=n.isPtr(E)?n.cstrToJs(E):E}if(I.set(this,d),L.set(this,Object.create(null)),!_["sqlite3*"])try{const E=R[i.sqlite3_js_db_vfs(d)||r("Internal error: cannot get VFS for new db handle.")];E&&(E instanceof Function?E(this,s):p(d,i.sqlite3_exec(d,E,0,0,0)))}catch(E){throw this.close(),E}};te.setVfsPostOpenCallback=function(A,l){l instanceof Function||r("dbCtorHelper.setVfsPostOpenCallback() should not be used with a non-function argument.",arguments),R[A]=l},te.normalizeArgs=function(A=":memory:",l="c",_=null){const d={};return arguments.length===1&&arguments[0]&&typeof arguments[0]=="object"?(Object.assign(d,arguments[0]),d.flags===void 0&&(d.flags="c"),d.vfs===void 0&&(d.vfs=null),d.filename===void 0&&(d.filename=":memory:")):(d.filename=A,d.flags=l,d.vfs=_),d};const y=function(...A){te.apply(this,A)};y.dbCtorHelper=te;const b={null:1,number:2,string:3,boolean:4,blob:5};n.bigIntEnabled&&(b.bigint=b.number);const C=function(){b!==arguments[2]&&r(i.SQLITE_MISUSE,"Do not call the Stmt constructor directly. Use DB.prepare()."),this.db=arguments[0],I.set(this,arguments[1]),arguments.length>3&&!arguments[3]&&J.add(this)},U=function(A){return A.pointer||r("DB has been closed."),A},w=function(A,l){return(l!==(l|0)||l<0||l>=A.columnCount)&&r("Column index",l,"is out of range."),A},O=function(A,l){const _=Object.create(null);switch(_.opt=Object.create(null),l.length){case 1:typeof l[0]=="string"||u.isSQLableTypedArray(l[0])||Array.isArray(l[0])?_.sql=l[0]:l[0]&&typeof l[0]=="object"&&(_.opt=l[0],_.sql=_.opt.sql);break;case 2:_.sql=l[0],_.opt=l[1];break;default:r("Invalid argument count for exec().")}_.sql=u.flexibleString(_.sql),typeof _.sql!="string"&&r("Missing SQL argument or unsupported SQL value type.");const d=_.opt;switch(d.returnValue){case"resultRows":d.resultRows||(d.resultRows=[]),_.returnVal=()=>d.resultRows;break;case"saveSql":d.saveSql||(d.saveSql=[]),_.returnVal=()=>d.saveSql;break;case void 0:case"this":_.returnVal=()=>A;break;default:r("Invalid returnValue value:",d.returnValue)}if(!d.callback&&!d.returnValue&&d.rowMode!==void 0&&(d.resultRows||(d.resultRows=[]),_.returnVal=()=>d.resultRows),d.callback||d.resultRows)switch(d.rowMode===void 0?"array":d.rowMode){case"object":_.cbArg=(E,W)=>{W.columnNames||(W.columnNames=E.getColumnNames([]));const K=E.get([]),D=Object.create(null);for(const h in W.columnNames)D[W.columnNames[h]]=K[h];return D};break;case"array":_.cbArg=E=>E.get([]);break;case"stmt":Array.isArray(d.resultRows)&&r("exec(): invalid rowMode for a resultRows array: must","be one of 'array', 'object',","a result column number, or column name reference."),_.cbArg=E=>E;break;default:if(u.isInt32(d.rowMode)){_.cbArg=E=>E.get(d.rowMode);break}else if(typeof d.rowMode=="string"&&d.rowMode.length>1&&d.rowMode[0]==="$"){const E=d.rowMode.substr(1);_.cbArg=W=>{const K=W.get(Object.create(null))[E];return K===void 0?r(i.SQLITE_NOTFOUND,"exec(): unknown result column:",E):K};break}r("Invalid rowMode:",d.rowMode)}return _},f=(A,l,_,...d)=>{const E=A.prepare(l);try{const W=E.bind(_).step()?E.get(...d):void 0;return E.reset(),W}finally{E.finalize()}},m=(A,l,_,d)=>A.exec({sql:l,bind:_,rowMode:d,returnValue:"resultRows"});y.checkRc=(A,l)=>p(A,l),y.prototype={isOpen:function(){return!!this.pointer},affirmOpen:function(){return U(this)},close:function(){const A=this.pointer;if(A){if(this.onclose&&this.onclose.before instanceof Function)try{this.onclose.before(this)}catch{}if(Object.keys(L.get(this)).forEach((l,_)=>{if(_&&_.pointer)try{_.finalize()}catch{}}),I.delete(this),L.delete(this),J.delete(this)||i.sqlite3_close_v2(A),this.onclose&&this.onclose.after instanceof Function)try{this.onclose.after(this)}catch{}delete this.filename}},changes:function(A=!1,l=!1){const _=U(this).pointer;return A?l?i.sqlite3_total_changes64(_):i.sqlite3_total_changes(_):l?i.sqlite3_changes64(_):i.sqlite3_changes(_)},dbFilename:function(A="main"){return i.sqlite3_db_filename(U(this).pointer,A)},dbName:function(A=0){return i.sqlite3_db_name(U(this).pointer,A)},dbVfsName:function(A=0){let l;const _=i.sqlite3_js_db_vfs(U(this).pointer,A);if(_){const d=new i.sqlite3_vfs(_);try{l=n.cstrToJs(d.$zName)}finally{d.dispose()}}return l},prepare:function(A){U(this);const l=n.pstack.pointer;let _,d;try{_=n.pstack.alloc(8),y.checkRc(this,i.sqlite3_prepare_v2(this.pointer,A,-1,_,null)),d=n.peekPtr(_)}finally{n.pstack.restore(l)}d||r("Cannot prepare empty SQL.");const E=new C(this,d,b);return L.get(this)[d]=E,E},exec:function(){U(this);const A=O(this,arguments);if(!A.sql)return r("exec() requires an SQL string.");const l=A.opt,_=l.callback,d=Array.isArray(l.resultRows)?l.resultRows:void 0;let E,W=l.bind,K=!!(A.cbArg||l.columnNames||d);const D=n.scopedAllocPush(),h=Array.isArray(l.saveSql)?l.saveSql:void 0;try{const P=u.isSQLableTypedArray(A.sql);let Q=P?A.sql.byteLength:n.jstrlen(A.sql);const ne=n.scopedAlloc(2*n.ptr.size+(Q+1)),g=n.ptr.add(ne,n.ptr.size);let N=n.ptr.add(g,n.ptr.size);const H=n.ptr.add(N,Q);for(P?n.heap8().set(A.sql,N):n.jstrcpy(A.sql,n.heap8(),N,Q,!1),n.poke8(n.ptr.add(N,Q),0);N&&n.peek8(N);){n.pokePtr([ne,g],0),y.checkRc(this,i.sqlite3_prepare_v3(this.pointer,N,Q,0,ne,g));const ie=n.peekPtr(ne);if(N=n.peekPtr(g),Q=Number(n.ptr.add(H,-N)),!!ie){if(h&&h.push(i.sqlite3_sql(ie).trim()),E=new C(this,ie,b),W&&E.parameterCount&&(E.bind(W),W=null),K&&E.columnCount){let Z=Array.isArray(l.columnNames)?0:1;if(K=!1,A.cbArg||d){const ue=Object.create(null);for(;E.step();ye.delete(E)){Z++===0&&E.getColumnNames(ue.columnNames=l.columnNames||[]),ye.add(E);const Se=A.cbArg(E,ue);if(d&&d.push(Se),_&&_.call(l,Se,E)===!1)break}ye.delete(E)}Z===0&&E.getColumnNames(l.columnNames)}else E.step();E.reset().finalize(),E=null}}}finally{E&&(ye.delete(E),E.finalize()),n.scopedAllocPop(D)}return A.returnVal()},createFunction:function(l,_,d){const E=ue=>ue instanceof Function;switch(arguments.length){case 1:d=l,l=d.name,_=d.xFunc||0;break;case 2:E(_)||(d=_,_=d.xFunc||0);break}d||(d={}),typeof l!="string"&&r("Invalid arguments: missing function name.");let W=d.xStep||0,K=d.xFinal||0;const D=d.xValue||0,h=d.xInverse||0;let P;E(_)?(P=!1,(E(W)||E(K))&&r("Ambiguous arguments: scalar or aggregate?"),W=K=null):E(W)?(E(K)||r("Missing xFinal() callback for aggregate or window UDF."),_=null):E(K)?r("Missing xStep() callback for aggregate or window UDF."):r("Missing function-type properties."),P===!1?(E(D)||E(h))&&r("xValue and xInverse are not permitted for non-window UDFs."):E(D)?(E(h)||r("xInverse must be provided if xValue is."),P=!0):E(h)&&r("xValue must be provided if xInverse is.");const Q=d.pApp;Q!=null&&!n.isPtr(Q)&&r("Invalid value for pApp property. Must be a legal WASM pointer value.");const ne=d.xDestroy||0;ne&&!E(ne)&&r("xDestroy property must be a function.");let g=0;G(d,"deterministic")&&(g|=i.SQLITE_DETERMINISTIC),G(d,"directOnly")&&(g|=i.SQLITE_DIRECTONLY),G(d,"innocuous")&&(g|=i.SQLITE_INNOCUOUS),l=l.toLowerCase();const N=_||W,H=G(d,"arity"),ie=typeof H=="number"?H:N.length?N.length-1:0;let Z;return P?Z=i.sqlite3_create_window_function(this.pointer,l,ie,i.SQLITE_UTF8|g,Q||0,W,K,D,h,ne):Z=i.sqlite3_create_function_v2(this.pointer,l,ie,i.SQLITE_UTF8|g,Q||0,_,W,K,ne),y.checkRc(this,Z),this},selectValue:function(A,l,_){return f(this,A,l,0,_)},selectValues:function(A,l,_){const d=this.prepare(A),E=[];try{for(d.bind(l);d.step();)E.push(d.get(0,_));d.reset()}finally{d.finalize()}return E},selectArray:function(A,l){return f(this,A,l,[])},selectObject:function(A,l){return f(this,A,l,{})},selectArrays:function(A,l){return m(this,A,l,"array")},selectObjects:function(A,l){return m(this,A,l,"object")},openStatementCount:function(){return this.pointer?Object.keys(L.get(this)).length:0},transaction:function(A){let l="BEGIN";arguments.length>1&&(/[^a-zA-Z]/.test(arguments[0])&&r(i.SQLITE_MISUSE,"Invalid argument for BEGIN qualifier."),l+=" "+arguments[0],A=arguments[1]),U(this).exec(l);try{const _=A(this);return this.exec("COMMIT"),_}catch(_){throw this.exec("ROLLBACK"),_}},savepoint:function(A){U(this).exec("SAVEPOINT oo1");try{const l=A(this);return this.exec("RELEASE oo1"),l}catch(l){throw this.exec("ROLLBACK to SAVEPOINT oo1; RELEASE SAVEPOINT oo1"),l}},checkRc:function(A){return p(this,A)}},y.wrapHandle=function(A,l=!1){if(!A||!n.isPtr(A))throw new s.SQLite3Error(i.SQLITE_MISUSE,"Argument must be a WASM sqlite3 pointer");return new y({"sqlite3*":A,"sqlite3*:takeOwnership":!!l})};const q=function(A){return A.pointer||r("Stmt has been closed."),A},M=function(A){let l=b[A==null?"null":typeof A];switch(l){case b.boolean:case b.null:case b.number:case b.string:return l;case b.bigint:return n.bigIntEnabled?l:void 0;default:return u.isBindableTypedArray(A)?b.blob:void 0}},Y=function(A){return M(A)||r("Unsupported bind() argument type:",typeof A)},le=function(A,l){const _=typeof l=="number"?l:i.sqlite3_bind_parameter_index(A.pointer,l);return _===0||!u.isInt32(_)?r("Invalid bind() parameter name: "+l):(_<1||_>A.parameterCount)&&r("Bind index",l,"is out of range."),_},ye=new Set,Ee=new Set,de=function(A,l){return ye.has(A)&&r("Operation is illegal when statement is locked:",l),A},V=function A(l,_,d,E){de(q(l),"bind()"),A._||(A._tooBigInt=K=>r("BigInt value is too big to store without precision loss:",K),A._={string:function(K,D,h,P){const[Q,ne]=n.allocCString(h,!0);return(P?i.sqlite3_bind_blob:i.sqlite3_bind_text)(K.pointer,D,Q,ne,i.SQLITE_WASM_DEALLOC)}}),Y(E),_=le(l,_);let W=0;switch(E==null?b.null:d){case b.null:W=i.sqlite3_bind_null(l.pointer,_);break;case b.string:W=A._.string(l,_,E,!1);break;case b.number:{let K;u.isInt32(E)?K=i.sqlite3_bind_int:typeof E=="bigint"?u.bigIntFits64(E)?n.bigIntEnabled?K=i.sqlite3_bind_int64:u.bigIntFitsDouble(E)?(E=Number(E),K=i.sqlite3_bind_double):A._tooBigInt(E):A._tooBigInt(E):(E=Number(E),n.bigIntEnabled&&Number.isInteger(E)?K=i.sqlite3_bind_int64:K=i.sqlite3_bind_double),W=K(l.pointer,_,E);break}case b.boolean:W=i.sqlite3_bind_int(l.pointer,_,E?1:0);break;case b.blob:{if(typeof E=="string"){W=A._.string(l,_,E,!0);break}else E instanceof ArrayBuffer?E=new Uint8Array(E):u.isBindableTypedArray(E)||r("Binding a value as a blob requires","that it be a string, Uint8Array, Int8Array, or ArrayBuffer.");const K=n.alloc(E.byteLength||1);n.heap8().set(E.byteLength?E:[0],Number(K)),W=i.sqlite3_bind_blob(l.pointer,_,K,E.byteLength,i.SQLITE_WASM_DEALLOC);break}default:s.config.warn("Unsupported bind() argument type:",E),r("Unsupported bind() argument type: "+typeof E)}return W&&y.checkRc(l.db.pointer,W),l};C.prototype={finalize:function(){const A=this.pointer;if(A){de(this,"finalize()");const l=J.delete(this)?0:i.sqlite3_finalize(A);return delete L.get(this.db)[A],I.delete(this),ye.delete(this),Ee.delete(this),delete this.parameterCount,delete this.db,l}},clearBindings:function(){return de(q(this),"clearBindings()"),i.sqlite3_clear_bindings(this.pointer),Ee.delete(this),this},reset:function(A){de(this,"reset()"),A&&this.clearBindings();const l=i.sqlite3_reset(q(this).pointer);return Ee.delete(this),p(this.db,l),this},bind:function(){q(this);let A,l;switch(arguments.length){case 1:A=1,l=arguments[0];break;case 2:A=arguments[0],l=arguments[1];break;default:r("Invalid bind() arguments.")}return l===void 0?this:(this.parameterCount||r("This statement has no bindable parameters."),Ee.delete(this),l===null?V(this,A,b.null,l):Array.isArray(l)?(arguments.length!==1&&r("When binding an array, an index argument is not permitted."),l.forEach((_,d)=>V(this,d+1,Y(_),_)),this):(l instanceof ArrayBuffer&&(l=new Uint8Array(l)),typeof l=="object"&&!u.isBindableTypedArray(l)?(arguments.length!==1&&r("When binding an object, an index argument is not permitted."),Object.keys(l).forEach(_=>V(this,_,Y(l[_]),l[_])),this):V(this,A,Y(l),l)))},bindAsBlob:function(A,l){q(this),arguments.length===1&&(l=A,A=1);const _=Y(l);return b.string!==_&&b.blob!==_&&b.null!==_&&r("Invalid value type for bindAsBlob()"),V(this,A,b.blob,l)},step:function(){de(this,"step()");const A=i.sqlite3_step(q(this).pointer);switch(A){case i.SQLITE_DONE:return Ee.delete(this),!1;case i.SQLITE_ROW:return Ee.add(this),!0;default:Ee.delete(this),s.config.warn("sqlite3_step() rc=",A,i.sqlite3_js_rc_str(A),"SQL =",i.sqlite3_sql(this.pointer)),y.checkRc(this.db.pointer,A)}},stepReset:function(){return this.step(),this.reset()},stepFinalize:function(){try{const A=this.step();return this.reset(),A}finally{try{this.finalize()}catch{}}},get:function(A,l){if(Ee.has(q(this))||r("Stmt.step() has not (recently) returned true."),Array.isArray(A)){let _=0;const d=this.columnCount;for(;_<d;)A[_]=this.get(_++);return A}else if(A&&typeof A=="object"){let _=0;const d=this.columnCount;for(;_<d;)A[i.sqlite3_column_name(this.pointer,_)]=this.get(_++);return A}switch(w(this,A),l===void 0?i.sqlite3_column_type(this.pointer,A):l){case i.SQLITE_NULL:return null;case i.SQLITE_INTEGER:if(n.bigIntEnabled){const _=i.sqlite3_column_int64(this.pointer,A);return _>=Number.MIN_SAFE_INTEGER&&_<=Number.MAX_SAFE_INTEGER?Number(_).valueOf():_}else{const _=i.sqlite3_column_double(this.pointer,A);return(_>Number.MAX_SAFE_INTEGER||_<Number.MIN_SAFE_INTEGER)&&r("Integer is out of range for JS integer range: "+_),u.isInt32(_)?_|0:_}case i.SQLITE_FLOAT:return i.sqlite3_column_double(this.pointer,A);case i.SQLITE_TEXT:return i.sqlite3_column_text(this.pointer,A);case i.SQLITE_BLOB:{const _=i.sqlite3_column_bytes(this.pointer,A),d=i.sqlite3_column_blob(this.pointer,A),E=new Uint8Array(_);return _&&(E.set(n.heap8u().slice(Number(d),Number(d)+_),0),this.db._blobXfer instanceof Array&&this.db._blobXfer.push(E.buffer)),E}default:r("Don't know how to translate","type of result column #"+A+".")}r("Not reached.")},getInt:function(A){return this.get(A,i.SQLITE_INTEGER)},getFloat:function(A){return this.get(A,i.SQLITE_FLOAT)},getString:function(A){return this.get(A,i.SQLITE_TEXT)},getBlob:function(A){return this.get(A,i.SQLITE_BLOB)},getJSON:function(A){const l=this.get(A,i.SQLITE_STRING);return l===null?l:JSON.parse(l)},getColumnName:function(A){return i.sqlite3_column_name(w(q(this),A).pointer,A)},getColumnNames:function(A=[]){w(q(this),0);const l=this.columnCount;for(let _=0;_<l;++_)A.push(i.sqlite3_column_name(this.pointer,_));return A},getParamIndex:function(A){return q(this).parameterCount?i.sqlite3_bind_parameter_index(this.pointer,A):void 0},getParamName:function(A){return q(this).parameterCount?i.sqlite3_bind_parameter_name(this.pointer,A):void 0},isBusy:function(){return i.sqlite3_stmt_busy(q(this))!==0},isReadOnly:function(){return i.sqlite3_stmt_readonly(q(this))!==0}};{const A={enumerable:!0,get:function(){return I.get(this)},set:()=>r("The pointer property is read-only.")};Object.defineProperty(C.prototype,"pointer",A),Object.defineProperty(y.prototype,"pointer",A)}Object.defineProperty(C.prototype,"columnCount",{enumerable:!1,get:function(){return i.sqlite3_column_count(this.pointer)},set:()=>r("The columnCount property is read-only.")}),Object.defineProperty(C.prototype,"parameterCount",{enumerable:!1,get:function(){return i.sqlite3_bind_parameter_count(this.pointer)},set:()=>r("The parameterCount property is read-only.")}),C.wrapHandle=function(A,l,_=!1){if(!(A instanceof y)||!A.pointer)throw new s.SQLite3Error(s.SQLITE_MISUSE,"First argument must be an opened sqlite3.oo1.DB instance");if(!l||!n.isPtr(l))throw new s.SQLite3Error(s.SQLITE_MISUSE,"Second argument must be a WASM sqlite3_stmt pointer");return new C(A,l,b,!!_)},s.oo1={DB:y,Stmt:C}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(s){const r=s.util;s.initWorker1API=(function(){const i=(...z)=>{throw new Error(z.join(" "))};globalThis.WorkerGlobalScope instanceof Function||i("initWorker1API() must be run from a Worker thread.");const n=this.sqlite3||i("Missing this.sqlite3 object."),u=n.oo1.DB,F=function(z){let R=I.idMap.get(z);return R||(R="db#"+ ++I.idSeq+":"+Math.floor(Math.random()*1e8)+":"+Math.floor(Math.random()*1e8),I.idMap.set(z,R),R)},I={dbList:[],idSeq:0,idMap:new WeakMap,xfer:[],open:function(z){const R=new u(z);return this.dbs[F(R)]=R,this.dbList.indexOf(R)<0&&this.dbList.push(R),R},close:function(z,R){if(z){delete this.dbs[F(z)];const te=z.filename,y=r.sqlite3__wasm_db_vfs(z.pointer,0);z.close();const b=this.dbList.indexOf(z);b>=0&&this.dbList.splice(b,1),R&&te&&y&&r.sqlite3__wasm_vfs_unlink(y,te)}},post:function(z,R){R&&R.length?(globalThis.postMessage(z,Array.from(R)),R.length=0):globalThis.postMessage(z)},dbs:Object.create(null),getDb:function(z,R=!0){return this.dbs[z]||(R?i("Unknown (or closed) DB ID:",z):void 0)}},J=function(z=I.dbList[0]){return z&&z.pointer?z:i("DB is not opened.")},L=function(z,R=!0){const te=I.getDb(z.dbId,!1)||I.dbList[0];return R?J(te):te},G=function(){return I.dbList[0]&&F(I.dbList[0])},p={open:function(z){const R=Object.create(null),te=z.args||Object.create(null);te.simulateError&&i("Throwing because of simulateError flag.");const y=Object.create(null);R.vfs=te.vfs,R.filename=te.filename||"";const b=I.open(R);return y.filename=b.filename,y.persistent=!!n.capi.sqlite3_js_db_uses_vfs(b.pointer,"opfs"),y.dbId=F(b),y.vfs=b.dbVfsName(),y},close:function(z){const R=L(z,!1),te={filename:R&&R.filename};if(R){const y=z.args&&typeof z.args=="object"?!!z.args.unlink:!1;I.close(R,y)}return te},exec:function(z){const R=typeof z.args=="string"?{sql:z.args}:z.args||Object.create(null);R.rowMode==="stmt"?i("Invalid rowMode for 'exec': stmt mode","does not work in the Worker API."):R.sql||i("'exec' requires input SQL.");const te=L(z);(R.callback||Array.isArray(R.resultRows))&&(te._blobXfer=I.xfer);const y=R.callback;let b=0;const C=!!R.columnNames;typeof y=="string"&&(C||(R.columnNames=[]),R.callback=function(U,w){I.post({type:y,columnNames:R.columnNames,rowNumber:++b,row:U},I.xfer)});try{const U=R.countChanges?te.changes(!0,R.countChanges===64):void 0;te.exec(R),U!==void 0&&(R.changeCount=te.changes(!0,R.countChanges===64)-U);const w=R.lastInsertRowId?n.capi.sqlite3_last_insert_rowid(te):void 0;w!==void 0&&(R.lastInsertRowId=w),R.callback instanceof Function&&(R.callback=y,I.post({type:y,columnNames:R.columnNames,rowNumber:null,row:void 0}))}finally{delete te._blobXfer,R.callback&&(R.callback=y)}return R},"config-get":function(){const z=Object.create(null),R=n.config;return["bigIntEnabled"].forEach(function(te){Object.getOwnPropertyDescriptor(R,te)&&(z[te]=R[te])}),z.version=n.version,z.vfsList=n.capi.sqlite3_js_vfs_list(),z},export:function(z){const R=L(z),te={byteArray:n.capi.sqlite3_js_db_export(R.pointer),filename:R.filename,mimetype:"application/x-sqlite3"};return I.xfer.push(te.byteArray.buffer),te},toss:function(z){i("Testing worker exception")}};globalThis.onmessage=async function(z){z=z.data;let R,te=z.dbId,y=z.type;const b=performance.now();try{p.hasOwnProperty(y)&&p[y]instanceof Function?R=await p[y](z):i("Unknown db worker message type:",z.type)}catch(C){y="error",R={operation:z.type,message:C.message,errorClass:C.name,input:z},C.stack&&(R.stack=typeof C.stack=="string"?C.stack.split(/\n\s*/):C.stack)}te||(te=R.dbId||G()),I.post({type:y,dbId:te,messageId:z.messageId,workerReceivedTime:b,workerRespondTime:performance.now(),departureTime:z.departureTime,result:R},I.xfer)},globalThis.postMessage({type:"sqlite3-api",result:"worker1-ready"})}).bind({sqlite3:s})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(s){const r=s.wasm,i=s.capi,n=s.util.toss3,u=Object.create(null);s.vfs=u,i.sqlite3_vfs.prototype.registerVfs=function(F=!1){this instanceof s.capi.sqlite3_vfs||n("Expecting a sqlite3_vfs-type argument.");const I=i.sqlite3_vfs_register(this,F?1:0);return I&&n("sqlite3_vfs_register(",this,") failed with rc",I),this.pointer!==i.sqlite3_vfs_find(this.$zName)&&n("BUG: sqlite3_vfs_find(vfs.$zName) failed for just-installed VFS",this),this},u.installVfs=function(F){let I=0;const J=["io","vfs"];for(const L of J){const G=F[L];G&&(++I,G.struct.installMethods(G.methods,!!G.applyArgcCheck),L==="vfs"&&(!G.struct.$zName&&typeof G.name=="string"&&G.struct.addOnDispose(G.struct.$zName=r.allocCString(G.name)),G.struct.registerVfs(!!G.asDefault)))}return I||n("Misuse: installVfs() options object requires at least","one of:",J),this}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(s){if(!s.wasm.exports.sqlite3_declare_vtab)return;const r=s.wasm,i=s.capi,n=s.util.toss3,u=Object.create(null);s.vtab=u;const F=i.sqlite3_index_info;F.prototype.nthConstraint=function(L,G=!1){if(L<0||L>=this.$nConstraint)return!1;const p=r.ptr.add(this.$aConstraint,F.sqlite3_index_constraint.structInfo.sizeof*L);return G?p:new F.sqlite3_index_constraint(p)},F.prototype.nthConstraintUsage=function(L,G=!1){if(L<0||L>=this.$nConstraint)return!1;const p=r.ptr.add(this.$aConstraintUsage,F.sqlite3_index_constraint_usage.structInfo.sizeof*L);return G?p:new F.sqlite3_index_constraint_usage(p)},F.prototype.nthOrderBy=function(L,G=!1){if(L<0||L>=this.$nOrderBy)return!1;const p=r.ptr.add(this.$aOrderBy,F.sqlite3_index_orderby.structInfo.sizeof*L);return G?p:new F.sqlite3_index_orderby(p)};const I=function(L,G){return(function(p,z=!1){if(arguments.length===0&&(p=new G),p instanceof G)return this.set(p.pointer,p),p;r.isPtr(p)||s.SQLite3Error.toss("Invalid argument to",L+"()");let R=this.get(p);return z&&this.delete(p),R}).bind(new Map)},J=function(L,G){const p=I(L,G);return Object.assign(Object.create(null),{StructType:G,create:z=>{const R=p();return r.pokePtr(z,R.pointer),R},get:z=>p(z),unget:z=>p(z,!0),dispose:z=>p(z,!0)?.dispose?.()})};u.xVtab=J("xVtab",i.sqlite3_vtab),u.xCursor=J("xCursor",i.sqlite3_vtab_cursor),u.xIndexInfo=L=>new i.sqlite3_index_info(L),u.xError=function L(G,p,z){if(L.errorReporter instanceof Function)try{L.errorReporter("sqlite3_module::"+G+"(): "+p.message)}catch{}let R;return p instanceof s.WasmAllocError?R=i.SQLITE_NOMEM:arguments.length>2?R=z:p instanceof s.SQLite3Error&&(R=p.resultCode),R||i.SQLITE_ERROR},u.xError.errorReporter=s.config.error.bind(s.config),u.xRowid=(L,G)=>r.poke(L,G,"i64"),u.setupModule=function(L){let G=!1;const p=this instanceof i.sqlite3_module?this:L.struct||(G=new i.sqlite3_module);try{const z=L.methods||n("Missing 'methods' object.");for(const R of Object.entries({xConnect:"xCreate",xDisconnect:"xDestroy"})){const te=R[0],y=R[1];z[te]===!0?z[te]=z[y]:z[y]===!0&&(z[y]=z[te])}if(L.catchExceptions){const R=function(b,C){return["xConnect","xCreate"].indexOf(b)>=0?function(U,w,O,f,m,q){try{return C(...arguments)||0}catch(M){return M instanceof s.WasmAllocError||(r.dealloc(r.peekPtr(q)),r.pokePtr(q,r.allocCString(M.message))),u.xError(b,M)}}:function(...U){try{return C(...U)||0}catch(w){return u.xError(b,w)}}},te=["xCreate","xConnect","xBestIndex","xDisconnect","xDestroy","xOpen","xClose","xFilter","xNext","xEof","xColumn","xRowid","xUpdate","xBegin","xSync","xCommit","xRollback","xFindFunction","xRename","xSavepoint","xRelease","xRollbackTo","xShadowName"],y=Object.create(null);for(const b of te){const C=z[b];if(C instanceof Function)b==="xConnect"&&z.xCreate===C?y[b]=z.xCreate:b==="xCreate"&&z.xConnect===C?y[b]=z.xConnect:y[b]=R(b,C);else continue}p.installMethods(y,!1)}else p.installMethods(z,!!L.applyArgcCheck);if(p.$iVersion===0){let R;typeof L.iVersion=="number"?R=L.iVersion:p.$xIntegrity?R=4:p.$xShadowName?R=3:p.$xSavePoint||p.$xRelease||p.$xRollbackTo?R=2:R=1,p.$iVersion=R}}catch(z){throw G&&G.dispose(),z}return p},i.sqlite3_module.prototype.setupModule=function(L){return u.setupModule.call(this,L)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(s){const r=s.capi,i=r.sqlite3_kvvfs_methods,n=r.KVVfsFile,u=s.capi.sqlite3_vfs_find("kvvfs");if(delete r.sqlite3_kvvfs_methods,delete r.KVVfsFile,!u)return;const F=s.util,I=s.wasm,J=F.toss3,L=(S,x)=>Object.prototype.hasOwnProperty.call(S,x),G=new i(I.exports.sqlite3__wasm_kvvfs_methods());F.assert(32<=G.$nKeySize,"unexpected kvvfsMethods.$nKeySize: "+G.$nKeySize);const p=Object.assign(Object.create(null),{rxJournalSuffix:/-journal$/,zKeyJrnl:I.allocCString("jrnl"),zKeySz:I.allocCString("sz"),keySize:G.$nKeySize,buffer:Object.assign(Object.create(null),{n:G.$nBufferSize,pool:Object.create(null)})});p.memBuffer=(S=0)=>p.buffer.pool[S]??=I.alloc(p.buffer.n),p.memBufferFree=S=>{const x=p.buffer.pool[S];x&&(I.dealloc(x),delete p.buffer.pool[S])};const z=()=>{},R=s.__isUnderTest?(...S)=>s.config.debug("kvvfs:",...S):z,te=(...S)=>s.config.warn("kvvfs:",...S),y=(...S)=>s.config.error("kvvfs:",...S);class b{#e;#n;#l(){return this.#n??=Object.keys(this.#e)}constructor(){this.clear()}key(x){const j=this.#l();return x<j.length?j[x]:null}getItem(x){return this.#e[x]??null}setItem(x,j){L(this.#e,x)||(this.#n=null),this.#e[x]=""+j}removeItem(x){delete this.#e[x]&&(this.#n=null)}clear(){this.#e=Object.create(null),this.#n=null}get length(){return this.#l().length}}const C=S=>S==="local"||S==="session",U=S=>C(S)?"kvvfs-"+S+"-":"",w=function(S,x=!1){if(C(S))return;const j=new Blob([S]).size;j||J(r.SQLITE_MISUSE,"Empty name is not permitted.");let B=p.keySize-1;p.rxJournalSuffix.test(S)?x||J(r.SQLITE_MISUSE,"Storage names may not have a '-journal' suffix."):["-wal","-shm"].filter(ae=>S.endsWith(ae)).length?J(r.SQLITE_MISUSE,"Storage names may not have a -wal or -shm suffix."):B-=8,j>B&&J(r.SQLITE_RANGE,"Storage name is too long. Limit =",B);let ee;for(ee=0;ee<j;++ee){const ae=S.codePointAt(ee);ae<32&&J(r.SQLITE_RANGE,"Illegal character ("+ae+"d) in storage name:",S)}},O=(S,x=void 0)=>Object.assign(Object.create(null),{jzClass:S,refc:1,deleteAtRefc0:!1,storage:x||new b,keyPrefix:U(S),files:[],listeners:void 0}),f=s.kvvfs=Object.create(null);s.__isUnderTest&&(f.log=Object.assign(Object.create(null),{xOpen:!1,xClose:!1,xWrite:!1,xRead:!1,xSync:!1,xAccess:!1,xFileControl:!1,xRcrdRead:!1,xRcrdWrite:!1,xRcrdDelete:!1}));const m=function(S){const x=p.rxJournalSuffix.test(S.jzClass)?S.jzClass.replace(p.rxJournalSuffix,""):S.jzClass+"-journal";f?.log?.xClose&&R("cleaning up storage handles [",S.jzClass,x,"]",S),delete p.storagePool[S.jzClass],delete p.storagePool[x],s.__isUnderTest||(delete S.storage,delete S.refc)},q=S=>p.storagePool[S.jzClass]=p.storagePool[S.jzClass+"-journal"]=S,M=".";p.storagePool=Object.assign(Object.create(null),{[M]:O(M)}),globalThis.Storage&&(globalThis.localStorage instanceof globalThis.Storage&&(p.storagePool.local=O("local",globalThis.localStorage)),globalThis.sessionStorage instanceof globalThis.Storage&&(p.storagePool.session=O("session",globalThis.sessionStorage))),p.builtinStorageNames=Object.keys(p.storagePool);const Y=S=>p.builtinStorageNames.indexOf(S)>-1;for(const S of Object.keys(p.storagePool)){const x=p.storagePool[S];p.storagePool[S+"-journal"]=x}p.setError=(S=void 0,x=r.SQLITE_ERROR)=>S?(p.lastError=S,S.resultCode|0||x):(delete p.lastError,0),p.popError=()=>{const S=p.lastError;return delete p.lastError,S};const le=S=>{te("kvvfs.listener handler threw:",S)},ye=I.exports.sqlite3__wasm_kvvfs_decode,Ee=I.exports.sqlite3__wasm_kvvfs_encode,de=async function(S,x,...j){try{x.keyPrefix&&j[0]&&(j[0]=j[0].replace(x.keyPrefix,""));let B,ee,ae,fe;for(const ce of x.listeners){const be=Object.create(null);be.storageName=x.jzClass,be.type=S,ce.decodePages;const Oe=ce.events[S];if(Oe){if(!ce.includeJournal&&j[0]==="jrnl")continue;if(S==="write"&&ce.decodePages&&+j[0]>0){if(be.data=[j[0]],fe?.[j[0]]){be.data[1]=fe[j[0]];continue}B??=new TextEncoder("utf-8"),ee??=p.memBuffer(10),ae??=p.memBuffer(11);const Re=B.encode(j[1]),we=I.heap8u();we.set(Re,Number(ee)),we[I.ptr.addn(ee,Re.length)]=0;const He=ye(ee,ae,p.buffer.n);if(He>0)fe??=Object.create(null),fe[j[0]]=be.data[1]=we.slice(Number(ae),I.ptr.addn(ae,He));else continue}else be.data=j.length?j.length===1?j[0]:j:void 0;try{Oe(be)?.catch?.(le)}catch(Re){te("notifyListeners [",x.jzClass,"]",S,Re)}}}}catch(B){le(B)}},V=S=>typeof S=="string"?p.storagePool[S]:p.storagePool[I.cstrToJs(S)],A=I.exports.sqlite3__wasm_kvvfsMakeKey,l=(S,x,j)=>x&&S.keyPrefix?A(x,j):j,_=(S,x,j)=>I.cstrToJs(l(S,x,j)),d=S=>+S.storage.getItem(S.keyPrefix+"sz"),E=new Map,W={vfs:Object.create(null),ioDb:Object.create(null),ioJrnl:Object.create(null)},K=new r.sqlite3_vfs(G.$pVfs),D=new r.sqlite3_io_methods(G.$pIoDb),h=new r.sqlite3_io_methods(G.$pIoJrnl),P=Object.create(null),Q=Object.assign(Object.create(null),{pFileHandles:E,cache:p,storageForZClass:V,KVVfsStorage:b,disablePageSizeChange:!0});f.log&&(f.internal=Q);const ne={recordHandler:{xRcrdRead:(S,x,j,B)=>{try{const ee=I.cstrToJs(S),ae=V(ee);if(!ae)return-1;const fe=_(ae,S,x);f?.log?.xRcrdRead&&te("xRcrdRead",ee,fe,B,ae);const ce=ae.storage.getItem(fe);if(ce===null)return-1;const be=ce.length;if(B<=0)return be;if(B===1)return I.poke(j,0),be;B+1<be&&J(r.SQLITE_RANGE,"xRcrdRead()",ee,fe,"input buffer is too small: need",be,"but have",B);const Oe=p.memBuffer(0),Re=I.heap8();let we;for(we=0;we<be;++we)Re[I.ptr.add(Oe,we)]=ce.codePointAt(we)&255;return Re.copyWithin(Number(j),Number(Oe),I.ptr.addn(Oe,we)),Re[I.ptr.add(j,be)]=0,B}catch(ee){return y("kvrecordRead()",ee),p.setError(ee),-2}},xRcrdWrite:(S,x,j)=>{try{const B=V(S),ee=_(B,S,x),ae=I.cstrToJs(j);return f?.log?.xRcrdWrite&&te("xRcrdWrite",ee,B),B.storage.setItem(ee,ae),B.listeners&&de("write",B,ee,ae),0}catch(B){return y("kvrecordWrite()",B),p.setError(B,r.SQLITE_IOERR)}},xRcrdDelete:(S,x)=>{try{const j=V(S),B=_(j,S,x);return f?.log?.xRcrdDelete&&te("xRcrdDelete",B,j),j.storage.removeItem(B),j.listeners&&de("delete",j,B),0}catch(j){return y("kvrecordDelete()",j),p.setError(j,r.SQLITE_IOERR)}}},vfs:{xOpen:function(S,x,j,B,ee){p.popError();let ae;try{x||(ae=I.allocCString(""+j+"."+(Math.random()*1e5|0)),x=ae);const fe=I.cstrToJs(x);f?.log?.xOpen&&R("xOpen",fe,"flags =",B),w(fe,!0),B&(r.SQLITE_OPEN_MAIN_DB|r.SQLITE_OPEN_TEMP_DB|r.SQLITE_OPEN_TRANSIENT_DB)&&p.rxJournalSuffix.test(fe)&&J(r.SQLITE_ERROR,"DB files may not have a '-journal' suffix.");let ce=V(fe);!ce&&!(B&r.SQLITE_OPEN_CREATE)&&J(r.SQLITE_ERROR,"Storage not found:",fe);const be=W.vfs.xOpen(S,x,j,B,ee);if(be)return be;let Oe=!!(r.SQLITE_OPEN_DELETEONCLOSE&B);I.isPtr(arguments[1])&&r.sqlite3_uri_boolean(x,"delete-on-close",0)&&(Oe=!0);const Re=new n(j);if(F.assert(Re.$zClass,"Missing f.$zClass"),Re.addOnDispose(ae),ae=void 0,ce)++ce.refc,ce.files.push(Re),I.poke32(ee,B);else{I.poke32(ee,B|r.SQLITE_OPEN_CREATE),F.assert(!Re.$isJournal,"Opening a journal before its db? "+fe);const we=fe.replace(p.rxJournalSuffix,"");ce=O(we),q(ce),ce.files.push(Re),ce.deleteAtRefc0=Oe,f?.log?.xOpen&&R("xOpen installed storage handle [",we,we+"-journal","]",ce)}return E.set(j,{store:ce,file:Re,jzClass:fe}),ce.listeners&&de("open",ce,ce.files.length),0}catch(fe){return te("xOpen:",fe),p.setError(fe)}finally{ae&&I.dealloc(ae)}},xDelete:function(S,x,j){p.popError();try{const B=I.cstrToJs(x);return p.rxJournalSuffix.test(B)&&P.xRcrdDelete(x,p.zKeyJrnl),0}catch(B){return te("xDelete",B),p.setError(B)}},xAccess:function(S,x,j,B){p.popError();try{const ee=V(x),ae=ee?.jzClass||I.cstrToJs(x);if(f?.log?.xAccess&&R("xAccess",ae,"flags =",j,"*pResOut =",I.peek32(B),"store =",ee),!ee)try{w(ae)}catch{return I.poke32(B,0),0}if(ee){const fe=ee.keyPrefix+(p.rxJournalSuffix.test(ae)?"jrnl":"1"),ce=ee.storage.getItem(fe)?0:1;I.poke32(B,ce)}else I.poke32(B,0);return 0}catch(ee){return y("xAccess",ee),p.setError(ee)}},xRandomness:function(S,x,j){const B=I.heap8u();let ee=0;const ae=Number(j);for(;ee<x;++ee)B[ae+ee]=Math.random()*255e3&255;return x},xGetLastError:function(S,x,j){const B=p.popError();if(R("xGetLastError",B),B){const ee=I.scopedAllocPush();try{const[ae,fe]=I.scopedAllocCString(B.message,!0);return I.cstrncpy(j,ae,x),fe>x&&I.poke8(I.ptr.add(j,x,-1),0),R("set xGetLastError",B.message),B.resultCode|0||r.SQLITE_IOERR}catch{return r.SQLITE_NOMEM}finally{I.scopedAllocPop(ee)}}return 0}},ioDb:{xClose:function(S){p.popError();try{const x=E.get(S);if(f?.log?.xClose&&R("xClose",S,x),x){E.delete(S);const j=x.store;j.files=j.files.filter(B=>B!==x.file),--j.refc<=0&&j.deleteAtRefc0&&m(j),W.ioDb.xClose(S),x.file.dispose(),j.listeners&&de("close",j,j.files.length)}return 0}catch(x){return y("xClose",x),p.setError(x)}},xFileControl:function(S,x,j){p.popError();try{const B=E.get(S);if(F.assert(B,"Missing KVVfsFile handle"),f?.log?.xFileControl&&R("xFileControl",B,"op =",x),x===r.SQLITE_FCNTL_PRAGMA&&Q.disablePageSizeChange){const ae=I.peekPtr(I.ptr.add(j,I.ptr.size));if(I.cstrToJs(ae)==="page_size"){f?.log?.xFileControl&&R("xFileControl pragma",I.cstrToJs(ae));const fe=I.peekPtr(I.ptr.add(j,2*I.ptr.size));if(fe)return f?.log?.xFileControl&&te("xFileControl pragma",B,"NOT setting page size to",I.cstrToJs(fe)),B.file.$szPage=-1,0;if(B.file.$szPage>0)return f?.log?.xFileControl&&te("xFileControl",B,"getting page size",B.file.$szPage),I.pokePtr(j,I.allocCString(""+B.file.$szPage)),0}}const ee=W.ioDb.xFileControl(S,x,j);return ee==0&&r.SQLITE_FCNTL_SYNC===x&&B.store.listeners&&de("sync",B.store,!1),ee}catch(B){return y("xFileControl",B),p.setError(B)}},xSync:function(S,x){p.popError();try{const j=E.get(S);f?.log?.xSync&&R("xSync",j),F.assert(j,"Missing KVVfsFile handle");const B=W.ioDb.xSync(S,x);return B==0&&j.store.listeners&&de("sync",j.store,!0),B}catch(j){return y("xSync",j),p.setError(j)}},xRead:function(S,x,j,B){p.popError();try{if(f?.log?.xRead){const ee=E.get(S);F.assert(ee,"Missing KVVfsFile handle"),R("xRead",j,B,ee)}return W.ioDb.xRead(S,x,j,B)}catch(ee){return y("xRead",ee),p.setError(ee)}},xWrite:function(S,x,j,B){p.popError();try{if(f?.log?.xWrite){const ee=E.get(S);F.assert(ee,"Missing KVVfsFile handle"),R("xWrite",j,B,ee)}return W.ioDb.xWrite(S,x,j,B)}catch(ee){return y("xWrite",ee),p.setError(ee)}}},ioJrnl:{xClose:!0}};R("pVfs and friends",K,D,h,G,r.sqlite3_file.structInfo,n.structInfo);try{F.assert(p.buffer.n>1024*129,"Heap buffer is not large enough");for(const S of Object.entries(ne.recordHandler)){const x=S[0],j=S[1];P[x]=j,G[G.memberKey(x)]=I.installFunction(G.memberSignature(x),j)}for(const S of Object.entries(ne.vfs)){const x=S[0],j=S[1],B=K.memberKey(x),ee=K.structInfo.members[x]||F.toss("Missing pVfs.structInfo[",x,"]");W.vfs[x]=I.functionEntry(K[B]),K[B]=I.installFunction(ee.signature,j)}for(const S of Object.entries(ne.ioDb)){const x=S[0],j=S[1],B=D.memberKey(x);W.ioDb[x]=I.functionEntry(D[B])||F.toss("Missing native pIoDb[",B,"]"),D[B]=I.installFunction(D.memberSignature(x),j)}for(const S of Object.entries(ne.ioJrnl)){const x=S[0],j=S[1],B=h.memberKey(x);W.ioJrnl[x]=I.functionEntry(h[B])||F.toss("Missing native pIoJrnl[",B,"]"),j===!0?h[B]=D[B]||F.toss("Missing copied pIoDb[",B,"]"):h[B]=I.installFunction(h.memberSignature(x),j)}}finally{G.dispose(),K.dispose(),D.dispose(),h.dispose()}const g=function S(x){if(x==="")return S("local")+S("session");const j=V(x);if(!j)return 0;j.files.length&&(globalThis.localStorage===j.storage||globalThis.sessionStorage===j.storage||J(r.SQLITE_ACCESS,"Cannot clear in-use database storage."));const B=j.storage,ee=[];let ae,fe=B.length;for(ae=0;ae<fe;++ae){const ce=B.key(ae);(!j.keyPrefix||ce.startsWith(j.keyPrefix))&&ee.push(ce)}return ee.forEach(ce=>B.removeItem(ce)),ee.length},N=function S(x){if(x==="")return S("local")+S("session");const j=V(x);if(!j)return 0;const B=j.storage;let ee,ae=0;for(ee=0;ee<B.length;++ee){const fe=B.key(ee);(!j.keyPrefix||fe.startsWith(j.keyPrefix))&&(ae+=fe.length,ae+=B.getItem(fe).length)}return ae*2},H=function(...x){let j;x.length===1&&typeof x[0]=="object"?j=x[0]:x.length&&(j=Object.assign(Object.create(null),{name:x[0]}));const B=j?V(j.name):null;B||J(r.SQLITE_NOTFOUND,"There is no kvvfs storage named",j?.name);const ee=B.storage,ae=Object.assign(Object.create(null),{name:B.jzClass,timestamp:Date.now(),pages:[]}),fe=Object.create(null),ce=B.keyPrefix,be=ce?/^kvvfs-[^-]+-(\w+)/:void 0;let Oe=0,Re=ee.length;for(;Oe<Re;++Oe){const we=ee.key(Oe);if(!ce||we.startsWith(ce)){let He=(ce?be.exec(we):void 0)?.[1]??we;switch(He){case"jrnl":j.includeJournal&&(ae.journal=ee.getItem(we));break;case"sz":ae.size=+ee.getItem(we);break;default:if(He=+He,(!F.isInt32(He)||He<=0)&&J(r.SQLITE_RANGE,"Malformed kvvfs key: "+we),j.decodePages){const rt=ee.getItem(we),ht=rt.length,Ye=p.memBuffer(0),Tt=p.memBuffer(1),Ze=I.heap8u();let ut=0;for(;ut<ht;++ut)Ze[I.ptr.add(Ye,ut)]=rt.codePointAt(ut)&255;Ze[I.ptr.add(Ye,ut)]=0;const Nt=ye(Ye,Tt,p.buffer.n);fe[He]=Ze.slice(Number(Tt),I.ptr.addn(Tt,Nt))}else fe[He]=ee.getItem(we);break}}}return j.decodePages&&p.memBufferFree(1),Object.keys(fe).map(we=>+we).sort().forEach(we=>ae.pages.push(fe[we])),ae},ie=function(S,x=!1){!S?.timestamp||!S.name||S.size===void 0||!Array.isArray(S.pages)?J(r.SQLITE_MISUSE,"Malformed export object."):(!S.size||S.size!==(S.size|0)||S.size>=2147483647)&&J(r.SQLITE_RANGE,"Invalid db size: "+S.size),w(S.name);let j=V(S.name);const B=!j;j?(x?!j.files||!j.jzClass?J(r.SQLITE_ERROR,"Internal storage object",S.name,"seems to be malformed."):j.files.length&&J(r.SQLITE_IOERR_ACCESS,"Cannot import db storage while it is in use."):J(r.SQLITE_ACCESS,"Storage '"+S.name+"' already exists and","overwrite was not specified."),g(S.name)):j=O(S.name);const ee=U(S.name);let ae;try{const fe=j.storage;fe.setItem(ee+"sz",S.size),S.journal&&fe.setItem(ee+"jrnl",S.journal),S.pages[0]instanceof Uint8Array?S.pages.forEach((ce,be)=>{const Oe=ce.length;ae??=p.memBuffer(1);const Re=p.memBuffer(0),we=I.heap8u();we.set(ce,Number(Re)),we[I.ptr.addn(Re,Oe)]=0;const He=Ee(Re,Oe,ae);F.assert(He<p.buffer.n,"Impossibly long output - possibly smashed the heap"),F.assert(I.peek8(I.ptr.add(ae,He))===0,"Expecting NUL-terminated encoded output");const rt=I.cstrToJs(ae);fe.setItem(ee+(be+1),rt)}):S.pages[0]&&S.pages.forEach((ce,be)=>fe.setItem(ee+(be+1),ce)),B&&q(j)}catch{if(!B)try{g(S.name)}catch{}}finally{ae&&p.memBufferFree(1)}return this},Z=function(S){let x=V(S);if(x){++x.refc;return}w(S),q(O(S))},ue=function(S){const x=V(S);return!x||C(x.jzClass)||Y(x.jzClass)||p.rxJournalSuffix.test(S)?!1:x.refc>x.files.length||x.files.length===0?(--x.refc<=0&&m(x),!0):!1},Se=function(S){(!S||typeof S!="object")&&J(r.SQLITE_MISUSE,"Expecting a listener object.");let x=V(S.storage);x||(S.storage&&S.reserve?(Z(S.storage),x=V(S.storage),F.assert(x,"Unexpectedly cannot fetch reserved storage "+S.storage)):J(r.SQLITE_NOTFOUND,"No such storage:",S.storage)),S.events&&(x.listeners??=[]).push(S)},_e=function(S){const x=V(S?.storage);if(x?.listeners&&S.events){const j=x.listeners.length;x.listeners=x.listeners.filter(ee=>ee!==S);const B=j>x.listeners.length;return x.listeners.length||(x.listeners=void 0),B}return!1};if(s.kvvfs.reserve=Z,s.kvvfs.import=ie,s.kvvfs.export=H,s.kvvfs.unlink=ue,s.kvvfs.listen=Se,s.kvvfs.unlisten=_e,s.kvvfs.exists=S=>!!V(S),s.kvvfs.estimateSize=N,s.kvvfs.clear=g,globalThis.Storage&&(r.sqlite3_js_kvvfs_size=(S="")=>N(S),r.sqlite3_js_kvvfs_clear=(S="")=>g(S)),s.oo1?.DB){const S=s.oo1.DB;s.oo1.JsStorageDb=function(j=s.oo1.JsStorageDb.defaultStorageName){const B=S.dbCtorHelper.normalizeArgs(...arguments);switch(B.vfs="kvvfs",B.filename){case":sessionStorage:":B.filename="session";break;case":localStorage:":B.filename="local";break}const ee=/(file:(\/\/)?)([^?]+)/.exec(B.filename);w(ee?ee[3]:B.filename),S.dbCtorHelper.call(this,B)},s.oo1.JsStorageDb.defaultStorageName=p.storagePool.session?"session":M;const x=s.oo1.JsStorageDb;x.prototype=Object.create(S.prototype),x.clearStorage=g,x.prototype.clearStorage=function(){return x.clearStorage(this.affirmOpen().dbFilename(),!0)},x.storageSize=N,x.prototype.storageSize=function(){return x.storageSize(this.affirmOpen().dbFilename(),!0)}}if(s.__isUnderTest&&s.vtab){const S=Object.assign(Object.create(null),{rowid:{type:"INTEGER"},name:{type:"TEXT"},nRef:{type:"INTEGER"},nOpen:{type:"INTEGER"},isTransient:{type:"INTEGER"},dbSize:{type:"INTEGER"}});Object.keys(S).forEach((fe,ce)=>S[fe].colId=ce);const x=s.vtab,j=Object.assign(Object.create(null),{row:function(){return p.storagePool[this.names[this.rowid]]}});Object.assign(Object.create(j),{rowid:0,names:Object.keys(p.storagePool).filter(fe=>!p.rxJournalSuffix.test(fe))});const B=function(fe,ce){const be=fe instanceof r.sqlite3_vtab_cursor?fe:x.xCursor.get(fe);return(ce||!be.vTabState)&&(be.vTabState=Object.assign(Object.create(j),{rowid:0,names:Object.keys(p.storagePool).filter(Oe=>!p.rxJournalSuffix.test(Oe))})),be.vTabState},ee=()=>{},ae=function fe(){return fe.mod??=new s.capi.sqlite3_module().setupModule({catchExceptions:!0,methods:{xConnect:function(ce,be,Oe,Re,we,He){try{const rt=[];Object.keys(S).forEach(Ye=>{rt.push(Ye+" "+S[Ye].type)});const ht=r.sqlite3_declare_vtab(ce,"CREATE TABLE ignored("+rt.join(",")+")");if(ht===0){const Ye=x.xVtab.create(we);F.assert(Ye===x.xVtab.get(I.peekPtr(we)),"output pointer check failed")}return ht}catch(rt){return x.xErrror("xConnect",rt,r.SQLITE_ERROR)}},xCreate:I.ptr.null,xDisconnect:function(ce){return x.xVtab.dispose(ce),0},xOpen:function(ce,be){return x.xCursor.create(be),0},xClose:function(ce){const be=x.xCursor.unget(ce);return delete be.vTabState,be.dispose(),0},xNext:function(ce){const be=x.xCursor.get(ce);return++B(be).rowid,0},xColumn:function(ce,be,Oe){const Re=B(ce),we=Re.row();switch(F.assert(we,"Unexpected xColumn call"),Oe){case S.rowid.colId:r.sqlite3_result_int(be,Re.rowid);break;case S.name.colId:r.sqlite3_result_text(be,we.jzClass,-1,r.SQLITE_TRANSIENT);break;case S.nRef.colId:r.sqlite3_result_int(be,we.refc);break;case S.nOpen.colId:r.sqlite3_result_int(be,we.files.length);break;case S.isTransient.colId:r.sqlite3_result_int(be,!!we.deleteAtRefc0);break;case S.dbSize.colId:r.sqlite3_result_int(be,d(we));break;default:return r.sqlite3_result_error(be,"Invalid column id: "+Oe),r.SQLITE_RANGE}return 0},xRowid:function(ce,be){const Oe=B(ce);return x.xRowid(be,Oe.rowid),0},xEof:function(ce){const be=B(ce);return ee("xEof?="+!be.row(),...arguments),!be.row()},xFilter:function(ce,be,Oe,Re,we){return B(ce,!0),0},xBestIndex:function(ce,be){const Oe=new r.sqlite3_index_info(be);return Oe.$estimatedRows=p.storagePool.size,Oe.$estimatedCost=1,Oe.dispose(),0}}})};s.kvvfs.create_module=function(fe,ce="sqlite_kvvfs"){return r.sqlite3_create_module(fe,ce,ae(),I.ptr.null)}}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(s){const r=function i(n){if(!globalThis.SharedArrayBuffer||!globalThis.Atomics)return Promise.reject(new Error("Cannot install OPFS: Missing SharedArrayBuffer and/or Atomics. The server must emit the COOP/COEP response headers to enable those. See https://sqlite.org/wasm/doc/trunk/persistence.md#coop-coep"));if(typeof WorkerGlobalScope>"u")return Promise.reject(new Error("The OPFS sqlite3_vfs cannot run in the main thread because it requires Atomics.wait()."));if(!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!navigator?.storage?.getDirectory)return Promise.reject(new Error("Missing required OPFS APIs."));(!n||typeof n!="object")&&(n=Object.create(null));const u=new URL(globalThis.location.href).searchParams;return u.has("opfs-disable")?Promise.resolve(s):(n.verbose===void 0&&(n.verbose=u.has("opfs-verbose")?+u.get("opfs-verbose")||2:1),n.sanityChecks===void 0&&(n.sanityChecks=u.has("opfs-sanity-check")),n.proxyUri===void 0&&(n.proxyUri=i.defaultProxyUri),typeof n.proxyUri=="function"&&(n.proxyUri=n.proxyUri()),new Promise(function(F,I){const J=[s.config.error,s.config.warn,s.config.log],L=(g,...N)=>{n.verbose>g&&J[g]("OPFS syncer:",...N)},G=(...g)=>L(2,...g),p=(...g)=>L(1,...g),z=(...g)=>L(0,...g),R=s.util.toss,te=s.capi,y=s.util,b=s.wasm,C=te.sqlite3_vfs,U=te.sqlite3_file,w=te.sqlite3_io_methods,O=Object.create(null),f=()=>globalThis.FileSystemHandle&&globalThis.FileSystemDirectoryHandle&&globalThis.FileSystemFileHandle&&globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle&&navigator?.storage?.getDirectory;O.metrics={dump:function(){let g,N=0,H=0,ie=0;for(g in V.opIds){const Z=A[g];N+=Z.count,H+=Z.time,ie+=Z.wait,Z.avgTime=Z.count&&Z.time?Z.time/Z.count:0,Z.avgWait=Z.count&&Z.wait?Z.wait/Z.count:0}s.config.log(globalThis.location.href,"metrics for",globalThis.location.href,":",A,`
Total of`,N,"op(s) for",H,"ms (incl. "+ie+" ms of waiting on the async side)"),s.config.log("Serialization metrics:",A.s11n),ye.postMessage({type:"opfs-async-metrics"})},reset:function(){let g;const N=ie=>ie.count=ie.time=ie.wait=0;for(g in V.opIds)N(A[g]=Object.create(null));let H=A.s11n=Object.create(null);H=H.serialize=Object.create(null),H.count=H.time=0,H=A.s11n.deserialize=Object.create(null),H.count=H.time=0}};const m=new w,q=new C().addOnDispose(()=>m.dispose());let M;const Y=g=>(M=!0,q.dispose(),I(g)),le=()=>(M=!1,F(s)),ye=new Worker(new URL("/litebistudio/assets/sqlite3-opfs-async-proxy-BWKAW6aw.js",self.location.href));setTimeout(()=>{M===void 0&&Y(new Error("Timeout while waiting for OPFS async proxy worker."))},4e3),ye._originalOnError=ye.onerror,ye.onerror=function(g){z("Error initializing OPFS asyncer:",g),Y(new Error("Loading OPFS async Worker failed for unknown reasons."))};const Ee=te.sqlite3_vfs_find(null),de=Ee?new C(Ee):null;m.$iVersion=1,q.$iVersion=2,q.$szOsFile=te.sqlite3_file.structInfo.sizeof,q.$mxPathname=1024,q.$zName=b.allocCString("opfs"),q.$xDlOpen=q.$xDlError=q.$xDlSym=q.$xDlClose=null,q.addOnDispose("$zName",q.$zName,"cleanup default VFS wrapper",()=>de?de.dispose():null);const V=Object.create(null);V.verbose=n.verbose,V.littleEndian=(()=>{const g=new ArrayBuffer(2);return new DataView(g).setInt16(0,256,!0),new Int16Array(g)[0]===256})(),V.asyncIdleWaitTime=150,V.asyncS11nExceptions=1,V.fileBufferSize=65536,V.sabS11nOffset=V.fileBufferSize,V.sabS11nSize=q.$mxPathname*2,V.sabIO=new SharedArrayBuffer(V.fileBufferSize+V.sabS11nSize),V.opIds=Object.create(null);const A=Object.create(null);{let g=0;V.opIds.whichOp=g++,V.opIds.rc=g++,V.opIds.xAccess=g++,V.opIds.xClose=g++,V.opIds.xDelete=g++,V.opIds.xDeleteNoWait=g++,V.opIds.xFileSize=g++,V.opIds.xLock=g++,V.opIds.xOpen=g++,V.opIds.xRead=g++,V.opIds.xSleep=g++,V.opIds.xSync=g++,V.opIds.xTruncate=g++,V.opIds.xUnlock=g++,V.opIds.xWrite=g++,V.opIds.mkdir=g++,V.opIds["opfs-async-metrics"]=g++,V.opIds["opfs-async-shutdown"]=g++,V.opIds.retry=g++,V.sabOP=new SharedArrayBuffer(g*4),O.metrics.reset()}V.sq3Codes=Object.create(null),["SQLITE_ACCESS_EXISTS","SQLITE_ACCESS_READWRITE","SQLITE_BUSY","SQLITE_CANTOPEN","SQLITE_ERROR","SQLITE_IOERR","SQLITE_IOERR_ACCESS","SQLITE_IOERR_CLOSE","SQLITE_IOERR_DELETE","SQLITE_IOERR_FSYNC","SQLITE_IOERR_LOCK","SQLITE_IOERR_READ","SQLITE_IOERR_SHORT_READ","SQLITE_IOERR_TRUNCATE","SQLITE_IOERR_UNLOCK","SQLITE_IOERR_WRITE","SQLITE_LOCK_EXCLUSIVE","SQLITE_LOCK_NONE","SQLITE_LOCK_PENDING","SQLITE_LOCK_RESERVED","SQLITE_LOCK_SHARED","SQLITE_LOCKED","SQLITE_MISUSE","SQLITE_NOTFOUND","SQLITE_OPEN_CREATE","SQLITE_OPEN_DELETEONCLOSE","SQLITE_OPEN_MAIN_DB","SQLITE_OPEN_READONLY"].forEach(g=>{(V.sq3Codes[g]=te[g])===void 0&&R("Maintenance required: not found:",g)}),V.opfsFlags=Object.assign(Object.create(null),{OPFS_UNLOCK_ASAP:1,OPFS_UNLINK_BEFORE_OPEN:2,defaultUnlockAsap:!1});const l=(g,...N)=>{const H=V.opIds[g]||R("Invalid op ID:",g);V.s11n.serialize(...N),Atomics.store(V.sabOPView,V.opIds.rc,-1),Atomics.store(V.sabOPView,V.opIds.whichOp,H),Atomics.notify(V.sabOPView,V.opIds.whichOp);const ie=performance.now();for(;Atomics.wait(V.sabOPView,V.opIds.rc,-1)!=="not-equal";);const Z=Atomics.load(V.sabOPView,V.opIds.rc);if(A[g].wait+=performance.now()-ie,Z&&V.asyncS11nExceptions){const ue=V.s11n.deserialize();ue&&z(g+"() async error:",...ue)}return Z};O.debug={asyncShutdown:()=>{p("Shutting down OPFS async listener. The OPFS VFS will no longer work."),l("opfs-async-shutdown")},asyncRestart:()=>{p("Attempting to restart OPFS VFS async listener. Might work, might not."),ye.postMessage({type:"opfs-async-restart"})}};const _=()=>{if(V.s11n)return V.s11n;const g=new TextDecoder,N=new TextEncoder("utf-8"),H=new Uint8Array(V.sabIO,V.sabS11nOffset,V.sabS11nSize),ie=new DataView(V.sabIO,V.sabS11nOffset,V.sabS11nSize);V.s11n=Object.create(null);const Z=Object.create(null);Z.number={id:1,size:8,getter:"getFloat64",setter:"setFloat64"},Z.bigint={id:2,size:8,getter:"getBigInt64",setter:"setBigInt64"},Z.boolean={id:3,size:4,getter:"getInt32",setter:"setInt32"},Z.string={id:4};const ue=_e=>Z[typeof _e]||R("Maintenance required: this value type cannot be serialized.",_e),Se=_e=>{switch(_e){case Z.number.id:return Z.number;case Z.bigint.id:return Z.bigint;case Z.boolean.id:return Z.boolean;case Z.string.id:return Z.string;default:R("Invalid type ID:",_e)}};return V.s11n.deserialize=function(_e=!1){++A.s11n.deserialize.count;const S=performance.now(),x=H[0],j=x?[]:null;if(x){const B=[];let ee=1,ae,fe,ce;for(ae=0;ae<x;++ae,++ee)B.push(Se(H[ee]));for(ae=0;ae<x;++ae){const be=B[ae];be.getter?(ce=ie[be.getter](ee,V.littleEndian),ee+=be.size):(fe=ie.getInt32(ee,V.littleEndian),ee+=4,ce=g.decode(H.slice(ee,ee+fe)),ee+=fe),j.push(ce)}}return _e&&(H[0]=0),A.s11n.deserialize.time+=performance.now()-S,j},V.s11n.serialize=function(..._e){const S=performance.now();if(++A.s11n.serialize.count,_e.length){const x=[];let j=0,B=1;for(H[0]=_e.length&255;j<_e.length;++j,++B)x.push(ue(_e[j])),H[B]=x[j].id;for(j=0;j<_e.length;++j){const ee=x[j];if(ee.setter)ie[ee.setter](B,_e[j],V.littleEndian),B+=ee.size;else{const ae=N.encode(_e[j]);ie.setInt32(B,ae.byteLength,V.littleEndian),B+=4,H.set(ae,B),B+=ae.byteLength}}}else H[0]=0;A.s11n.serialize.time+=performance.now()-S},V.s11n},d=function g(N=16){g._chars||(g._chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012346789",g._n=g._chars.length);const H=[];let ie=0;for(;ie<N;++ie){const Z=Math.random()*(g._n*64)%g._n|0;H[ie]=g._chars[Z]}return H.join("")},E=Object.create(null),W=Object.create(null);W.op=void 0,W.start=void 0;const K=g=>{W.start=performance.now(),W.op=g,++A[g].count},D=()=>A[W.op].time+=performance.now()-W.start,h={xCheckReservedLock:function(g,N){return b.poke(N,0,"i32"),0},xClose:function(g){K("xClose");let N=0;const H=E[g];return H&&(delete E[g],N=l("xClose",g),H.sq3File&&H.sq3File.dispose()),D(),N},xDeviceCharacteristics:function(g){return te.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(g,N,H){return te.SQLITE_NOTFOUND},xFileSize:function(g,N){K("xFileSize");let H=l("xFileSize",g);if(H==0)try{const ie=V.s11n.deserialize()[0];b.poke(N,ie,"i64")}catch(ie){z("Unexpected error reading xFileSize() result:",ie),H=V.sq3Codes.SQLITE_IOERR}return D(),H},xLock:function(g,N){K("xLock");const H=E[g];let ie=0;return H.lockType?H.lockType=N:(ie=l("xLock",g,N),ie===0&&(H.lockType=N)),D(),ie},xRead:function(g,N,H,ie){K("xRead");const Z=E[g];let ue;try{ue=l("xRead",g,H,Number(ie)),(ue===0||te.SQLITE_IOERR_SHORT_READ===ue)&&b.heap8u().set(Z.sabView.subarray(0,H),Number(N))}catch(Se){z("xRead(",arguments,") failed:",Se,Z),ue=te.SQLITE_IOERR_READ}return D(),ue},xSync:function(g,N){K("xSync"),++A.xSync.count;const H=l("xSync",g,N);return D(),H},xTruncate:function(g,N){K("xTruncate");const H=l("xTruncate",g,Number(N));return D(),H},xUnlock:function(g,N){K("xUnlock");const H=E[g];let ie=0;return te.SQLITE_LOCK_NONE===N&&H.lockType&&(ie=l("xUnlock",g,N)),ie===0&&(H.lockType=N),D(),ie},xWrite:function(g,N,H,ie){K("xWrite");const Z=E[g];let ue;try{Z.sabView.set(b.heap8u().subarray(Number(N),Number(N)+H)),ue=l("xWrite",g,H,Number(ie))}catch(Se){z("xWrite(",arguments,") failed:",Se,Z),ue=te.SQLITE_IOERR_WRITE}return D(),ue}},P={xAccess:function(g,N,H,ie){K("xAccess");const Z=l("xAccess",b.cstrToJs(N));return b.poke(ie,Z?0:1,"i32"),D(),0},xCurrentTime:function(g,N){return b.poke(N,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(g,N){return b.poke(N,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(g,N,H){K("xDelete");const ie=l("xDelete",b.cstrToJs(N),H,!1);return D(),ie},xFullPathname:function(g,N,H,ie){return b.cstrncpy(ie,N,H)<H?0:te.SQLITE_CANTOPEN},xGetLastError:function(g,N,H){return p("OPFS xGetLastError() has nothing sensible to return."),0},xOpen:function(N,H,ie,Z,ue){K("xOpen");let Se=0;H===0?H=d():b.isPtr(H)&&(te.sqlite3_uri_boolean(H,"opfs-unlock-asap",0)&&(Se|=V.opfsFlags.OPFS_UNLOCK_ASAP),te.sqlite3_uri_boolean(H,"delete-before-open",0)&&(Se|=V.opfsFlags.OPFS_UNLINK_BEFORE_OPEN),H=b.cstrToJs(H));const _e=Object.create(null);_e.fid=ie,_e.filename=H,_e.sab=new SharedArrayBuffer(V.fileBufferSize),_e.flags=Z,_e.readOnly=!(te.SQLITE_OPEN_CREATE&Z)&&!!(Z&te.SQLITE_OPEN_READONLY);const S=l("xOpen",ie,H,Z,Se);return S||(_e.readOnly&&b.poke(ue,te.SQLITE_OPEN_READONLY,"i32"),E[ie]=_e,_e.sabView=V.sabFileBufView,_e.sq3File=new U(ie),_e.sq3File.$pMethods=m.pointer,_e.lockType=te.SQLITE_LOCK_NONE),D(),S}};de&&(q.$xRandomness=de.$xRandomness,q.$xSleep=de.$xSleep),q.$xRandomness||(P.xRandomness=function(g,N,H){const ie=b.heap8u();let Z=0;const ue=Number(H);for(;Z<N;++Z)ie[ue+Z]=Math.random()*255e3&255;return Z}),q.$xSleep||(P.xSleep=function(g,N){return Atomics.wait(V.sabOPView,V.opIds.xSleep,0,N),0}),O.getResolvedPath=function(g,N){const H=new URL(g,"file://irrelevant").pathname;return N?H.split("/").filter(ie=>!!ie):H},O.getDirForFilename=async function(N,H=!1){const ie=O.getResolvedPath(N,!0),Z=ie.pop();let ue=O.rootDirectory;for(const Se of ie)Se&&(ue=await ue.getDirectoryHandle(Se,{create:!!H}));return[ue,Z]},O.mkdir=async function(g){try{return await O.getDirForFilename(g+"/filepart",!0),!0}catch{return!1}},O.entryExists=async function(g){try{const[N,H]=await O.getDirForFilename(g);return await N.getFileHandle(H),!0}catch{return!1}},O.randomFilename=d,O.treeList=async function(){const g=async function H(ie,Z){Z.name=ie.name,Z.dirs=[],Z.files=[];for await(const ue of ie.values())if(ue.kind==="directory"){const Se=Object.create(null);Z.dirs.push(Se),await H(ue,Se)}else Z.files.push(ue.name)},N=Object.create(null);return await g(O.rootDirectory,N),N},O.rmfr=async function(){const g=O.rootDirectory,N={recurse:!0};for await(const H of g.values())g.removeEntry(H.name,N)},O.unlink=async function(g,N=!1,H=!1){try{const[ie,Z]=await O.getDirForFilename(g,!1);return await ie.removeEntry(Z,{recursive:N}),!0}catch(ie){if(H)throw new Error("unlink(",arguments[0],") failed: "+ie.message,{cause:ie});return!1}},O.traverse=async function(g){const N={recursive:!0,directory:O.rootDirectory};typeof g=="function"&&(g={callback:g}),g=Object.assign(N,g||{}),(async function H(ie,Z){for await(const ue of ie.values()){if(g.callback(ue,ie,Z)===!1)return!1;if(g.recursive&&ue.kind==="directory"&&await H(ue,Z+1)===!1)break}})(g.directory,0)};const Q=async function(g,N){const[H,ie]=await O.getDirForFilename(g,!0);let Z=await(await H.getFileHandle(ie,{create:!0})).createSyncAccessHandle(),ue=0,Se,_e=!1;try{for(Z.truncate(0);(Se=await N())!==void 0;)Se instanceof ArrayBuffer&&(Se=new Uint8Array(Se)),!_e&&ue===0&&Se.byteLength>=15&&(y.affirmDbHeader(Se),_e=!0),Z.write(Se,{at:ue}),ue+=Se.byteLength;if((ue<512||ue%512!==0)&&R("Input size",ue,"is not correct for an SQLite database."),!_e){const S=new Uint8Array(20);Z.read(S,{at:0}),y.affirmDbHeader(S)}return Z.write(new Uint8Array([1,1]),{at:18}),ue}catch(S){throw await Z.close(),Z=void 0,await H.removeEntry(ie).catch(()=>{}),S}finally{Z&&await Z.close()}};if(O.importDb=async function(g,N){if(N instanceof Function)return Q(g,N);N instanceof ArrayBuffer&&(N=new Uint8Array(N)),y.affirmIsDb(N);const H=N.byteLength,[ie,Z]=await O.getDirForFilename(g,!0);let ue,Se=0;try{return ue=await(await ie.getFileHandle(Z,{create:!0})).createSyncAccessHandle(),ue.truncate(0),Se=ue.write(N,{at:0}),Se!=H&&R("Expected to write "+H+" bytes but wrote "+Se+"."),ue.write(new Uint8Array([1,1]),{at:18}),Se}catch(_e){throw ue&&(await ue.close(),ue=void 0),await ie.removeEntry(Z).catch(()=>{}),_e}finally{ue&&await ue.close()}},s.oo1){const g=function(...N){const H=s.oo1.DB.dbCtorHelper.normalizeArgs(...N);H.vfs=q.$zName,s.oo1.DB.dbCtorHelper.call(this,H)};g.prototype=Object.create(s.oo1.DB.prototype),s.oo1.OpfsDb=g,g.importDb=O.importDb,s.oo1.DB.dbCtorHelper.setVfsPostOpenCallback(q.pointer,function(N,H){H.capi.sqlite3_busy_timeout(N,1e4)})}const ne=function(){const g=b.scopedAllocPush(),N=new U;try{const H=N.pointer,ie=te.SQLITE_OPEN_CREATE|te.SQLITE_OPEN_READWRITE|te.SQLITE_OPEN_MAIN_DB,Z=b.scopedAlloc(8),ue="/sanity/check/file"+d(8),Se=b.scopedAllocCString(ue);let _e;if(V.s11n.serialize("This is  string."),_e=V.s11n.deserialize(),G("deserialize() says:",_e),_e[0]!=="This is  string."&&R("String d13n error."),P.xAccess(q.pointer,Se,0,Z),_e=b.peek(Z,"i32"),G("xAccess(",ue,") exists ?=",_e),_e=P.xOpen(q.pointer,Se,H,ie,Z),G("open rc =",_e,"state.sabOPView[xOpen] =",V.sabOPView[V.opIds.xOpen]),_e!==0){z("open failed with code",_e);return}P.xAccess(q.pointer,Se,0,Z),_e=b.peek(Z,"i32"),_e||R("xAccess() failed to detect file."),_e=h.xSync(N.pointer,0),_e&&R("sync failed w/ rc",_e),_e=h.xTruncate(N.pointer,1024),_e&&R("truncate failed w/ rc",_e),b.poke(Z,0,"i64"),_e=h.xFileSize(N.pointer,Z),_e&&R("xFileSize failed w/ rc",_e),G("xFileSize says:",b.peek(Z,"i64")),_e=h.xWrite(N.pointer,Se,10,1),_e&&R("xWrite() failed!");const S=b.scopedAlloc(16);_e=h.xRead(N.pointer,S,6,2),b.poke(S+6,0);let x=b.cstrToJs(S);G("xRead() got:",x),x!=="sanity"&&R("Unexpected xRead() value."),P.xSleep&&(G("xSleep()ing before close()ing..."),P.xSleep(q.pointer,2e3),G("waking up from xSleep()")),_e=h.xClose(H),G("xClose rc =",_e,"sabOPView =",V.sabOPView),G("Deleting file:",ue),P.xDelete(q.pointer,Se,4660),P.xAccess(q.pointer,Se,0,Z),_e=b.peek(Z,"i32"),_e&&R("Expecting 0 from xAccess(",ue,") after xDelete()."),p("End of OPFS sanity checks.")}finally{N.dispose(),b.scopedAllocPop(g)}};ye.onmessage=function({data:g}){switch(g.type){case"opfs-unavailable":Y(new Error(g.payload.join(" ")));break;case"opfs-async-loaded":ye.postMessage({type:"opfs-async-init",args:V});break;case"opfs-async-inited":if(M===!0)break;try{s.vfs.installVfs({io:{struct:m,methods:h},vfs:{struct:q,methods:P}}),V.sabOPView=new Int32Array(V.sabOP),V.sabFileBufView=new Uint8Array(V.sabIO,0,V.fileBufferSize),V.sabS11nView=new Uint8Array(V.sabIO,V.sabS11nOffset,V.sabS11nSize),_(),n.sanityChecks&&(p("Running sanity checks because of opfs-sanity-check URL arg..."),ne()),f()?navigator.storage.getDirectory().then(N=>{ye.onerror=ye._originalOnError,delete ye._originalOnError,s.opfs=O,O.rootDirectory=N,G("End of OPFS sqlite3_vfs setup.",q),le()}).catch(Y):le()}catch(N){z(N),Y(N)}break;default:{const N="Unexpected message from the OPFS async worker: "+JSON.stringify(g);z(N),Y(new Error(N));break}}}}))};r.defaultProxyUri="sqlite3-opfs-async-proxy.js",globalThis.sqlite3ApiBootstrap.initializersAsync.push(async i=>{try{let n=r.defaultProxyUri;return i?.scriptInfo?.sqlite3Dir&&(r.defaultProxyUri=i.scriptInfo.sqlite3Dir+n),r().catch(u=>{i.config.warn("Ignoring inability to install OPFS sqlite3_vfs:",u.message)})}catch(n){return i.config.error("installOpfsVfs() exception:",n),Promise.reject(n)}})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(s){const r=s.util.toss,i=s.util.toss3,n=Object.create(null),u=s.capi,F=s.util,I=s.wasm,J=4096,L=512,G=4,p=8,z=L+G,R=L,te=z,y=J,b=u.SQLITE_OPEN_MAIN_DB|u.SQLITE_OPEN_MAIN_JOURNAL|u.SQLITE_OPEN_SUPER_JOURNAL|u.SQLITE_OPEN_WAL,C=u.SQLITE_OPEN_MEMORY,U=".opaque",w=()=>Math.random().toString(36).slice(2),O=new TextDecoder,f=new TextEncoder,m=Object.assign(Object.create(null),{name:"opfs-sahpool",directory:void 0,initialCapacity:6,clearOnInit:!1,verbosity:2,forceReinitIfPreviouslyFailed:!1}),q=[s.config.error,s.config.warn,s.config.log];s.config.log;const M=s.config.warn;s.config.error;const Y=new Map,le=D=>Y.get(D),ye=(D,h)=>{h?Y.set(D,h):Y.delete(D)},Ee=new Map,de=D=>Ee.get(D),V=(D,h)=>{h?Ee.set(D,h):Ee.delete(D)},A={xCheckReservedLock:function(D,h){const P=de(D);return P.log("xCheckReservedLock"),P.storeErr(),I.poke32(h,1),0},xClose:function(D){const h=de(D);h.storeErr();const P=h.getOFileForS3File(D);if(P)try{h.log(`xClose ${P.path}`),h.mapS3FileToOFile(D,!1),P.sah.flush(),P.flags&u.SQLITE_OPEN_DELETEONCLOSE&&h.deletePath(P.path)}catch(Q){return h.storeErr(Q,u.SQLITE_IOERR)}return 0},xDeviceCharacteristics:function(D){return u.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(D,h,P){return u.SQLITE_NOTFOUND},xFileSize:function(D,h){const P=de(D);P.log("xFileSize");const Q=P.getOFileForS3File(D).sah.getSize()-y;return I.poke64(h,BigInt(Q)),0},xLock:function(D,h){const P=de(D);P.log(`xLock ${h}`),P.storeErr();const Q=P.getOFileForS3File(D);return Q.lockType=h,0},xRead:function(D,h,P,Q){const ne=de(D);ne.storeErr();const g=ne.getOFileForS3File(D);ne.log(`xRead ${g.path} ${P} @ ${Q}`);try{const N=g.sah.read(I.heap8u().subarray(Number(h),Number(h)+P),{at:y+Number(Q)});return N<P?(I.heap8u().fill(0,Number(h)+N,Number(h)+P),u.SQLITE_IOERR_SHORT_READ):0}catch(N){return ne.storeErr(N,u.SQLITE_IOERR)}},xSectorSize:function(D){return J},xSync:function(D,h){const P=de(D);P.log(`xSync ${h}`),P.storeErr();const Q=P.getOFileForS3File(D);try{return Q.sah.flush(),0}catch(ne){return P.storeErr(ne,u.SQLITE_IOERR)}},xTruncate:function(D,h){const P=de(D);P.log(`xTruncate ${h}`),P.storeErr();const Q=P.getOFileForS3File(D);try{return Q.sah.truncate(y+Number(h)),0}catch(ne){return P.storeErr(ne,u.SQLITE_IOERR)}},xUnlock:function(D,h){const P=de(D);P.log("xUnlock");const Q=P.getOFileForS3File(D);return Q.lockType=h,0},xWrite:function(D,h,P,Q){const ne=de(D);ne.storeErr();const g=ne.getOFileForS3File(D);ne.log(`xWrite ${g.path} ${P} ${Q}`);try{return P===g.sah.write(I.heap8u().subarray(Number(h),Number(h)+P),{at:y+Number(Q)})?0:r("Unknown write() failure.")}catch(N){return ne.storeErr(N,u.SQLITE_IOERR)}}},l=new u.sqlite3_io_methods;l.$iVersion=1,s.vfs.installVfs({io:{struct:l,methods:A}});const _={xAccess:function(D,h,P,Q){const ne=le(D);ne.storeErr();try{const g=ne.getPath(h);I.poke32(Q,ne.hasFilename(g)?1:0)}catch{I.poke32(Q,0)}return 0},xCurrentTime:function(D,h){return I.poke(h,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(D,h){return I.poke(h,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(D,h,P){const Q=le(D);Q.log(`xDelete ${I.cstrToJs(h)}`),Q.storeErr();try{return Q.deletePath(Q.getPath(h)),0}catch(ne){return Q.storeErr(ne),u.SQLITE_IOERR_DELETE}},xFullPathname:function(D,h,P,Q){return I.cstrncpy(Q,h,P)<P?0:u.SQLITE_CANTOPEN},xGetLastError:function(D,h,P){const Q=le(D),ne=Q.popErr();if(Q.log(`xGetLastError ${h} e =`,ne),ne){const g=I.scopedAllocPush();try{const[N,H]=I.scopedAllocCString(ne.message,!0);I.cstrncpy(P,N,h),H>h&&I.poke8(I.ptr.add(P,h,-1),0)}catch{return u.SQLITE_NOMEM}finally{I.scopedAllocPop(g)}}return ne?ne.sqlite3Rc||u.SQLITE_IOERR:0},xOpen:function(h,P,Q,ne,g){const N=le(h);try{ne&=~C,N.log(`xOpen ${I.cstrToJs(P)} ${ne}`);const H=P&&I.peek8(P)?N.getPath(P):w();let ie=N.getSAHForPath(H);!ie&&ne&u.SQLITE_OPEN_CREATE&&(N.getFileCount()<N.getCapacity()?(ie=N.nextAvailableSAH(),N.setAssociatedPath(ie,H,ne)):r("SAH pool is full. Cannot create file",H)),ie||r("file not found:",H);const Z={path:H,flags:ne,sah:ie};N.mapS3FileToOFile(Q,Z),Z.lockType=u.SQLITE_LOCK_NONE;const ue=new u.sqlite3_file(Q);return ue.$pMethods=l.pointer,ue.dispose(),I.poke32(g,ne),0}catch(H){return N.storeErr(H),u.SQLITE_CANTOPEN}}},d=function(D){s.capi.sqlite3_vfs_find(D)&&i("VFS name is already registered:",D);const h=new u.sqlite3_vfs,P=u.sqlite3_vfs_find(null),Q=P?new u.sqlite3_vfs(P):null;return h.$iVersion=2,h.$szOsFile=u.sqlite3_file.structInfo.sizeof,h.$mxPathname=L,h.addOnDispose(h.$zName=I.allocCString(D),()=>ye(h.pointer,0)),Q&&(h.$xRandomness=Q.$xRandomness,h.$xSleep=Q.$xSleep,Q.dispose()),!h.$xRandomness&&!_.xRandomness&&(_.xRandomness=function(ne,g,N){const H=I.heap8u();let ie=0;const Z=Number(N);for(;ie<g;++ie)H[Z+ie]=Math.random()*255e3&255;return ie}),!h.$xSleep&&!_.xSleep&&(_.xSleep=(ne,g)=>0),s.vfs.installVfs({vfs:{struct:h,methods:_}}),h};class E{vfsDir;#e;#n;#l;#i=new Map;#t=new Map;#s=new Set;#a=new Map;#r=new Uint8Array(z);#c;#o;#_;constructor(h=Object.create(null)){this.#_=h.verbosity??m.verbosity,this.vfsName=h.name||m.name,this.#o=d(this.vfsName),ye(this.#o.pointer,this),this.vfsDir=h.directory||"."+this.vfsName,this.#c=new DataView(this.#r.buffer,this.#r.byteOffset),this.isReady=this.reset(!!(h.clearOnInit??m.clearOnInit)).then(()=>{if(this.$error)throw this.$error;return this.getCapacity()?Promise.resolve(void 0):this.addCapacity(h.initialCapacity||m.initialCapacity)})}#u(h,...P){this.#_>h&&q[h](this.vfsName+":",...P)}log(...h){this.#u(2,...h)}warn(...h){this.#u(1,...h)}error(...h){this.#u(0,...h)}getVfs(){return this.#o}getCapacity(){return this.#i.size}getFileCount(){return this.#t.size}getFileNames(){const h=[];for(const P of this.#t.keys())h.push(P);return h}async addCapacity(h){for(let P=0;P<h;++P){const Q=w(),ne=await(await this.#n.getFileHandle(Q,{create:!0})).createSyncAccessHandle();this.#i.set(ne,Q),this.setAssociatedPath(ne,"",0)}return this.getCapacity()}async reduceCapacity(h){let P=0;for(const Q of Array.from(this.#s)){if(P===h||this.getFileCount()===this.getCapacity())break;const ne=this.#i.get(Q);Q.close(),await this.#n.removeEntry(ne),this.#i.delete(Q),this.#s.delete(Q),++P}return P}releaseAccessHandles(){for(const h of this.#i.keys())h.close();this.#i.clear(),this.#t.clear(),this.#s.clear()}async acquireAccessHandles(h=!1){const P=[];for await(const[Q,ne]of this.#n)ne.kind==="file"&&P.push([Q,ne]);return Promise.all(P.map(async([Q,ne])=>{try{const g=await ne.createSyncAccessHandle();if(this.#i.set(g,Q),h)g.truncate(y),this.setAssociatedPath(g,"",0);else{const N=this.getAssociatedPath(g);N?this.#t.set(N,g):this.#s.add(g)}}catch(g){throw this.storeErr(g),this.releaseAccessHandles(),g}}))}getAssociatedPath(h){h.read(this.#r,{at:0});const P=this.#c.getUint32(R);if(this.#r[0]&&(P&u.SQLITE_OPEN_DELETEONCLOSE||(P&b)===0))return M(`Removing file with unexpected flags ${P.toString(16)}`,this.#r),this.setAssociatedPath(h,"",0),"";const Q=new Uint32Array(p/4);h.read(Q,{at:te});const ne=this.computeDigest(this.#r,P);if(Q.every((g,N)=>g===ne[N])){const g=this.#r.findIndex(N=>N===0);return g===0&&h.truncate(y),g?O.decode(this.#r.subarray(0,g)):""}else return M("Disassociating file with bad digest."),this.setAssociatedPath(h,"",0),""}setAssociatedPath(h,P,Q){const ne=f.encodeInto(P,this.#r);L<=ne.written+1&&r("Path too long:",P),P&&Q&&(Q|=C),this.#r.fill(0,ne.written,L),this.#c.setUint32(R,Q);const g=this.computeDigest(this.#r,Q);h.write(this.#r,{at:0}),h.write(g,{at:te}),h.flush(),P?(this.#t.set(P,h),this.#s.delete(h)):(h.truncate(y),this.#s.add(h))}computeDigest(h,P){if(P&C){let Q=3735928559,ne=1103547991;for(const g of h)Q=Math.imul(Q^g,2654435761),ne=Math.imul(ne^g,104729);return new Uint32Array([Q>>>0,ne>>>0])}else return new Uint32Array([0,0])}async reset(h){await this.isReady;let P=await navigator.storage.getDirectory(),Q;for(const ne of this.vfsDir.split("/"))ne&&(Q=P,P=await P.getDirectoryHandle(ne,{create:!0}));return this.#e=P,this.#l=Q,this.#n=await this.#e.getDirectoryHandle(U,{create:!0}),this.releaseAccessHandles(),this.acquireAccessHandles(h)}getPath(h){return I.isPtr(h)&&(h=I.cstrToJs(h)),(h instanceof URL?h:new URL(h,"file://localhost/")).pathname}deletePath(h){const P=this.#t.get(h);return P&&(this.#t.delete(h),this.setAssociatedPath(P,"",0)),!!P}storeErr(h,P){return h&&(h.sqlite3Rc=P||u.SQLITE_IOERR,this.error(h)),this.$error=h,P}popErr(){const h=this.$error;return this.$error=void 0,h}nextAvailableSAH(){const[h]=this.#s.keys();return h}getOFileForS3File(h){return this.#a.get(h)}mapS3FileToOFile(h,P){P?(this.#a.set(h,P),V(h,this)):(this.#a.delete(h),V(h,!1))}hasFilename(h){return this.#t.has(h)}getSAHForPath(h){return this.#t.get(h)}async removeVfs(){if(!this.#o.pointer||!this.#n)return!1;u.sqlite3_vfs_unregister(this.#o.pointer),this.#o.dispose(),delete n[this.vfsName];try{this.releaseAccessHandles(),await this.#e.removeEntry(U,{recursive:!0}),this.#n=void 0,await this.#l.removeEntry(this.#e.name,{recursive:!0}),this.#e=this.#l=void 0}catch(h){s.config.error(this.vfsName,"removeVfs() failed with no recovery strategy:",h)}return!0}pauseVfs(){return this.#a.size>0&&s.SQLite3Error.toss(u.SQLITE_MISUSE,"Cannot pause VFS",this.vfsName,"because it has opened files."),this.#i.size>0&&(u.sqlite3_vfs_unregister(this.vfsName),this.releaseAccessHandles()),this}isPaused(){return this.#i.size===0}async unpauseVfs(){return this.#i.size===0?this.acquireAccessHandles(!1).then(()=>u.sqlite3_vfs_register(this.#o,0),this):this}exportFile(h){const P=this.#t.get(h)||r("File not found:",h),Q=P.getSize()-y,ne=new Uint8Array(Q>0?Q:0);if(Q>0){const g=P.read(ne,{at:y});g!=Q&&r("Expected to read "+Q+" bytes but read "+g+".")}return ne}async importDbChunked(h,P){const Q=this.#t.get(h)||this.nextAvailableSAH()||r("No available handles to import to.");Q.truncate(0);let ne=0,g,N=!1;try{for(;(g=await P())!==void 0;)g instanceof ArrayBuffer&&(g=new Uint8Array(g)),!N&&ne===0&&g.byteLength>=15&&(F.affirmDbHeader(g),N=!0),Q.write(g,{at:y+ne}),ne+=g.byteLength;if((ne<512||ne%512!==0)&&r("Input size",ne,"is not correct for an SQLite database."),!N){const H=new Uint8Array(20);Q.read(H,{at:0}),F.affirmDbHeader(H)}Q.write(new Uint8Array([1,1]),{at:y+18})}catch(H){throw this.setAssociatedPath(Q,"",0),H}return this.setAssociatedPath(Q,h,u.SQLITE_OPEN_MAIN_DB),ne}importDb(h,P){if(P instanceof ArrayBuffer)P=new Uint8Array(P);else if(P instanceof Function)return this.importDbChunked(h,P);const Q=this.#t.get(h)||this.nextAvailableSAH()||r("No available handles to import to."),ne=P.byteLength;(ne<512||ne%512!=0)&&r("Byte array size is invalid for an SQLite db.");const g="SQLite format 3";for(let H=0;H<15;++H)g.charCodeAt(H)!==P[H]&&r("Input does not contain an SQLite database header.");const N=Q.write(P,{at:y});return N!=ne?(this.setAssociatedPath(Q,"",0),r("Expected to write "+ne+" bytes but wrote "+N+".")):(Q.write(new Uint8Array([1,1]),{at:y+18}),this.setAssociatedPath(Q,h,u.SQLITE_OPEN_MAIN_DB)),N}}class W{#e;constructor(h){this.#e=h,this.vfsName=h.vfsName}async addCapacity(h){return this.#e.addCapacity(h)}async reduceCapacity(h){return this.#e.reduceCapacity(h)}getCapacity(){return this.#e.getCapacity(this.#e)}getFileCount(){return this.#e.getFileCount()}getFileNames(){return this.#e.getFileNames()}async reserveMinimumCapacity(h){const P=this.#e.getCapacity();return P<h?this.#e.addCapacity(h-P):P}exportFile(h){return this.#e.exportFile(h)}importDb(h,P){return this.#e.importDb(h,P)}async wipeFiles(){return this.#e.reset(!0)}unlink(h){return this.#e.deletePath(h)}async removeVfs(){return this.#e.removeVfs()}pauseVfs(){return this.#e.pauseVfs(),this}async unpauseVfs(){return this.#e.unpauseVfs().then(()=>this)}isPaused(){return this.#e.isPaused()}}const K=async()=>{const D=await navigator.storage.getDirectory(),h=".opfs-sahpool-sync-check-"+w(),P=(await(await D.getFileHandle(h,{create:!0})).createSyncAccessHandle()).close();return await P,await D.removeEntry(h),P?.then&&r("The local OPFS API is too old for opfs-sahpool:","it has an async FileSystemSyncAccessHandle.close() method."),!0};s.installOpfsSAHPoolVfs=async function(D=Object.create(null)){D=Object.assign(Object.create(null),m,D||{});const h=D.name;if(D.$testThrowPhase1)throw D.$testThrowPhase1;if(n[h])try{return await n[h]}catch(P){if(D.forceReinitIfPreviouslyFailed)delete n[h];else throw P}return!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!navigator?.storage?.getDirectory?n[h]=Promise.reject(new Error("Missing required OPFS APIs.")):n[h]=K().then(async function(){if(D.$testThrowPhase2)throw D.$testThrowPhase2;const P=new E(D);return P.isReady.then(async()=>{const Q=new W(P);if(s.oo1){const ne=s.oo1,g=P.getVfs(),N=function(...H){const ie=ne.DB.dbCtorHelper.normalizeArgs(...H);ie.vfs=g.$zName,ne.DB.dbCtorHelper.call(this,ie)};N.prototype=Object.create(ne.DB.prototype),Q.OpfsSAHPoolDb=N}return P.log("VFS initialized."),Q}).catch(async Q=>{throw await P.removeVfs().catch(()=>{}),Q})}).catch(P=>n[h]=Promise.reject(P))}});try{const s=Object.assign(Object.create(null),{memory:typeof lt<"u"?lt:t.wasmMemory,exports:typeof yt<"u"?yt:Object.prototype.hasOwnProperty.call(t,"wasmExports")?t.wasmExports:t.asm},globalThis.sqlite3ApiBootstrap.defaultConfig,globalThis.sqlite3ApiConfig||{});e.debugModule("Bootstrapping lib config",s);const r=globalThis.sqlite3ApiBootstrap(s);return delete globalThis.sqlite3ApiBootstrap,r}catch(s){throw console.error("sqlite3ApiBootstrap() error:",s),s}},Ht?re=c:re=new Promise((e,t)=>{Ot=e,Pt=t}),re}Rt=(function(){const oe=Rt;if(!oe)throw new Error("Expecting sqlite3InitModule to be defined by the Emscripten build.");const re=globalThis.sqlite3InitModuleState=Object.assign(Object.create(null),{moduleScript:globalThis?.document?.currentScript,isWorker:typeof WorkerGlobalScope<"u",location:globalThis.location,urlParams:globalThis?.location?.href?new URL(globalThis.location.href).searchParams:new URLSearchParams,wasmFilename:"sqlite3.wasm"});if(re.debugModule=re.urlParams.has("sqlite3.debugModule")?(...me)=>console.warn("sqlite3.debugModule:",...me):()=>{},re.urlParams.has("sqlite3.dir"))re.sqlite3Dir=re.urlParams.get("sqlite3.dir")+"/";else if(re.moduleScript){const me=re.moduleScript.src.split("/");me.pop(),re.sqlite3Dir=me.join("/")+"/"}const c=globalThis.sqlite3InitModule=function me(...Ae){return re.emscriptenLocateFile=Ae[0]?.locateFile,re.emscriptenInstantiateWasm=Ae[0]?.instantiateWasm,oe(...Ae).then(qe=>{re.debugModule("sqlite3InitModule() sIMS =",re),re.debugModule("sqlite3InitModule() EmscriptenModule =",qe);const Te=qe.runSQLite3PostLoadInit(re,qe,!!me.__isUnderTest);return re.debugModule("sqlite3InitModule() sqlite3 =",Te),Te}).catch(qe=>{throw console.error("Exception loading sqlite3 module:",qe),qe})};if(c.ready=oe.ready,re.moduleScript){let me=re.moduleScript.src.split("/");me.pop(),re.scriptDir=me.join("/")+"/"}return re.debugModule("extern-post-js.c-pp.js sqlite3InitModuleState =",re),c})();var dr=Rt;globalThis.sqlite3Worker1Promiser=function oe(re=oe.defaultConfig){if(arguments.length===1&&typeof arguments[0]=="function"){const he=re;re=Object.assign(Object.create(null),oe.defaultConfig),re.onready=he}else re=Object.assign(Object.create(null),oe.defaultConfig,re);const c=Object.create(null),me=function(){},Ae=re.onerror||me,qe=re.debug||me,Te=re.generateMessageId?void 0:Object.create(null),je=re.generateMessageId||function(he){return he.type+"#"+(Te[he.type]=(Te[he.type]||0)+1)},De=(...he)=>{throw new Error(he.join(" "))};re.worker||(re.worker=oe.defaultConfig.worker),typeof re.worker=="function"&&(re.worker=re.worker());let ke,Be;return re.worker.onmessage=function(he){he=he.data,qe("worker1.onmessage",he);let xe=c[he.messageId];if(!xe){if(he&&he.type==="sqlite3-api"&&he.result==="worker1-ready"){re.onready&&re.onready(Be);return}if(xe=c[he.type],xe&&xe.onrow){xe.onrow(he);return}re.onunhandled?re.onunhandled(arguments[0]):Ae("sqlite3Worker1Promiser() unhandled worker message:",he);return}switch(delete c[he.messageId],he.type){case"error":xe.reject(he);return;case"open":ke||(ke=he.dbId);break;case"close":he.dbId===ke&&(ke=void 0);break}try{xe.resolve(he)}catch(We){xe.reject(We)}},Be=function(){let he;arguments.length===1?he=arguments[0]:arguments.length===2?(he=Object.create(null),he.type=arguments[0],he.args=arguments[1],he.dbId=he.args.dbId):De("Invalid arguments for sqlite3Worker1Promiser()-created factory."),!he.dbId&&he.type!=="open"&&(he.dbId=ke),he.messageId=je(he),he.departureTime=performance.now();const xe=Object.create(null);xe.message=he;let We;he.type==="exec"&&he.args&&(typeof he.args.callback=="function"?(We=he.messageId+":row",xe.onrow=he.args.callback,he.args.callback=We,c[We]=xe):typeof he.args.callback=="string"&&De("exec callback may not be a string when using the Promise interface."));let st=new Promise(function(Ot,Pt){xe.resolve=Ot,xe.reject=Pt,c[he.messageId]=xe,qe("Posting",he.type,"message to Worker dbId="+(ke||"default")+":",he),re.worker.postMessage(he)});return We&&(st=st.finally(()=>delete c[We])),st}},globalThis.sqlite3Worker1Promiser.defaultConfig={worker:function(){return new Worker(new URL("/litebistudio/assets/sqlite3-worker1-DXWo2tlp.js",self.location.href),{type:"module"})},onerror:(...oe)=>console.error("sqlite3Worker1Promiser():",...oe)},globalThis.sqlite3Worker1Promiser.v2=(function oe(re=oe.defaultConfig){let c;typeof re=="function"?(c=re,re={}):typeof re?.onready=="function"&&(c=re.onready,delete re.onready);const me=Object.create(null);re=Object.assign(re||Object.create(null),{onready:async function(qe){try{c&&await c(qe),me.resolve(qe)}catch(Te){me.reject(Te)}}});const Ae=new Promise(function(qe,Te){me.resolve=qe,me.reject=Te});try{this.original(re)}catch(qe){me.reject(qe)}return Ae}).bind({original:sqlite3Worker1Promiser}),globalThis.sqlite3Worker1Promiser.v2.defaultConfig=globalThis.sqlite3Worker1Promiser.defaultConfig,sqlite3Worker1Promiser.v2,delete globalThis.sqlite3Worker1Promiser;var pr=dr,Ut=`-- Core Infrastructure Tables
CREATE TABLE IF NOT EXISTS sys_settings (
    key TEXT PRIMARY KEY,
    value TEXT
);

CREATE TABLE IF NOT EXISTS sys_user_widgets (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    sql_query TEXT NOT NULL,
    visualization_config TEXT, -- JSON
    visual_builder_config TEXT, -- JSON string of QueryConfig (for reload)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS sys_worklist (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    source_table TEXT NOT NULL,
    source_id TEXT NOT NULL,
    display_label TEXT,
    display_context TEXT,
    status TEXT DEFAULT 'open',
    comment TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS sys_migrations (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT UNIQUE,
    applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS sys_dashboards (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    layout TEXT, -- JSON string of SavedWidget[]
    is_default INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS sys_report_packs (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    config TEXT, -- JSON string of ReportPackConfig
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
`,hr=`DROP VIEW IF EXISTS kpi_history;
CREATE VIEW kpi_history AS
SELECT 
    'Volume' as metric, 
    SUM(Amount) as value, 
    'EUR' as unit, 
    'Actuals' as category, 
    CASE 
        WHEN Period LIKE '%-13' THEN date(MAX(PostingDate), '+1 day') 
        ELSE MAX(PostingDate) 
    END as date,
    Period as period
FROM records
GROUP BY Period;

DROP VIEW IF EXISTS latest_kpis;
CREATE VIEW latest_kpis AS
SELECT * FROM kpi_history
GROUP BY metric
ORDER BY date DESC;

-- Detailed summary view
DROP VIEW IF EXISTS data_summary_view;
CREATE VIEW data_summary_view AS
SELECT 
    SUM(Amount) as total_amount,
    COUNT(DISTINCT VendorName) as active_entities,
    MAX(PostingDate) as latest_date,
    MAX(FiscalYear) as latest_year,
    'EUR' as unit
FROM records;

-- Anomaly Radar View
DROP VIEW IF EXISTS view_anomalies;
CREATE VIEW view_anomalies AS
WITH ItemHistory AS (
    SELECT 
        *,
        LAG(Amount) OVER (
            PARTITION BY Category, SubCategory
            ORDER BY Period
        ) as PrevAmount,
        LAG(Period) OVER (
            PARTITION BY Category, SubCategory
            ORDER BY Period
        ) as PrevPeriod
    FROM records
),
ScoredItems AS (
    SELECT 
        *,
        -- 1. Drift Score: High deviation from previous amount
        CASE 
            WHEN PrevAmount IS NOT NULL AND Amount > PrevAmount * 1.2 AND (Amount - PrevAmount) > 500 THEN 50
            WHEN PrevAmount IS NOT NULL AND Amount < PrevAmount * 0.8 AND (PrevAmount - Amount) > 500 THEN 20
            ELSE 0 
        END as ScoreDrift,
        
        -- 2. New Item Score: First time appearance
        CASE 
            WHEN PrevAmount IS NULL THEN 30 
            ELSE 0 
        END as ScoreNew,

        -- 3. Quality Score: Synthetic IDs
        CASE 
            WHEN id < 0 THEN 25 
            ELSE 0 
        END as ScoreQuality,

        -- 4. Value Score: Logarithmic scale of amount (cap at 50)
        MIN(50, CAST((LOG10(MAX(ABS(Amount), 1)) * 10) AS INTEGER)) as ScoreValue
    FROM ItemHistory
)
SELECT 
    *,
    (ScoreDrift + ScoreNew + ScoreQuality + ScoreValue) as RiskScore,
    CASE
        WHEN ScoreDrift > 0 THEN 'Cost Drift'
        WHEN ScoreNew > 0 THEN 'New Item'
        WHEN ScoreQuality > 0 THEN 'Data Quality'
        ELSE 'Review'
    END as AnomalyType
FROM ScoredItems
WHERE RiskScore > 40;
`;let Ce=null,nt=null,mt=null;const ze=(...oe)=>console.log("[DB Worker]",...oe),et=(...oe)=>console.error("[DB Worker]",...oe),qt=7;function It(oe){return oe instanceof Error?oe.message:String(oe)}function kt(oe){return typeof oe=="object"&&oe!==null}function ct(oe,re){const c=oe[re];return typeof c=="string"?c:""}function it(){if(!Ce)throw new Error("Database not initialized");return Ce}function Wt(){if(!nt)throw new Error("SQLite API not initialized");return nt}function Qt(oe){if(!oe)return;let re=oe.selectValue("PRAGMA user_version");if(ze(`Current database schema version: ${re} (Target: ${qt})`),re>=qt){ze("Database is up to date.");return}if(re<1&&(ze("Migration V1: Initializing infrastructure schema..."),oe.exec(Ut),oe.exec("PRAGMA user_version = 1"),re=1),re<2){ze("Migration V2: Adding visual_builder_config to sys_user_widgets...");try{const c=[];oe.exec({sql:"PRAGMA table_info(sys_user_widgets)",rowMode:"object",callback:me=>c.push(ct(me,"name"))}),c.length>0&&!c.includes("visual_builder_config")&&oe.exec("ALTER TABLE sys_user_widgets ADD COLUMN visual_builder_config TEXT")}catch(c){et("Migration failed for V2",c)}oe.exec("PRAGMA user_version = 2"),re=2}if(re<3){ze("Migration V3: Enhancing sys_worklist...");try{const c=[];oe.exec({sql:"PRAGMA table_info(sys_worklist)",rowMode:"object",callback:me=>c.push(ct(me,"name"))}),c.length>0&&(c.includes("comment")||oe.exec("ALTER TABLE sys_worklist ADD COLUMN comment TEXT"),c.includes("updated_at")||(oe.exec("ALTER TABLE sys_worklist ADD COLUMN updated_at TIMESTAMP"),oe.exec("UPDATE sys_worklist SET updated_at = CURRENT_TIMESTAMP WHERE updated_at IS NULL")))}catch(c){et("Migration failed for V3",c)}oe.exec("PRAGMA user_version = 3"),re=3}if(re<4){ze("Migration V4: Adding sys_report_packs and sys_dashboards...");try{oe.exec(`
                CREATE TABLE IF NOT EXISTS sys_report_packs (
                    id TEXT PRIMARY KEY,
                    name TEXT NOT NULL,
                    description TEXT,
                    config TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                
                CREATE TABLE IF NOT EXISTS sys_dashboards (
                    id TEXT PRIMARY KEY,
                    name TEXT NOT NULL,
                    layout TEXT,
                    is_default INTEGER DEFAULT 0,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            `)}catch(c){et("Migration failed for V4",c)}oe.exec("PRAGMA user_version = 4"),re=4}if(re<5){ze("Migration V5: Finalizing versioning system...");try{oe.exec(hr)}catch{ze("Warning: views.sql execution partially or fully failed")}oe.exec("PRAGMA user_version = 5"),re=5}if(re<6){ze("Migration V6: Unifying sys_worklist statuses...");try{oe.exec("UPDATE sys_worklist SET status = 'open' WHERE status = 'pending'"),oe.exec("UPDATE sys_worklist SET status = 'closed' WHERE status IN ('error', 'obsolete', 'clarification')"),oe.exec("UPDATE sys_worklist SET status = 'done' WHERE status = 'ok'")}catch(c){et("Migration failed for V6",c)}oe.exec("PRAGMA user_version = 6"),re=6}if(re<7){ze("Migration V7: Adding category to sys_report_packs...");try{const c=[];oe.exec({sql:"PRAGMA table_info(sys_report_packs)",rowMode:"object",callback:me=>c.push(ct(me,"name"))}),c.length>0&&!c.includes("category")&&oe.exec("ALTER TABLE sys_report_packs ADD COLUMN category TEXT"),oe.exec("UPDATE sys_report_packs SET category = 'General' WHERE category IS NULL OR TRIM(category) = ''")}catch(c){et("Migration failed for V7",c)}oe.exec("PRAGMA user_version = 7"),re=7}ze(`Database migrated to version ${re}`)}async function tt(){if(!Ce)return mt||(mt=(async()=>{try{ze("Initializing SQLite...");const oe=!1;if(nt=await pr({print:ze,printErr:(...c)=>{const me=c.join(" ");oe&&(me.includes("OPFS asyncer")||me.includes("GetSyncHandleError")),et(...c)}}),nt.oo1.OpfsDb)try{Ce=new nt.oo1.OpfsDb("/litebistudio.sqlite3"),ze("Opened OPFS database")}catch(c){et("OPFS unavailable OR corrupted, falling back to memory",c),It(c).includes("is not a database")&&ze("Database file corrupted on disk. User should restore backup."),Ce=new nt.oo1.DB(":memory:")}else ze("OPFS not supported, using memory"),Ce=new nt.oo1.DB(":memory:");return Qt(Ce),!0}catch(oe){throw et("Initialization failed",oe),mt=null,oe}})(),mt)}async function mr(oe){if(!oe)return ze("No demo data provided for generic loader."),0;try{const re=it();re.exec("BEGIN TRANSACTION");let c=0;for(const[me,Ae]of Object.entries(oe))Array.isArray(Ae)&&Ae.length>0&&re.selectValue("SELECT count(*) FROM sqlite_master WHERE type='table' AND name=?",[me])&&(Vt(me,Ae,!1),c+=Ae.length);return re.exec("COMMIT"),ze(`Demo data loaded successfully: ${c} records across multiple tables.`),c}catch(re){throw it().exec("ROLLBACK"),et("Failed to load demo data",re),re}}function Vt(oe,re,c=!0){if(re.length===0)return;if(!/^[a-z0-9_]+$/i.test(oe))throw new Error(`Invalid table name: ${oe}`);const me=it(),Ae=[];me.exec({sql:`PRAGMA table_info("${oe}")`,rowMode:"object",callback:ke=>{const Be=ke.name;typeof Be=="string"&&Be.length>0&&Ae.push(Be)}});const qe=Object.keys(re[0]).filter(ke=>Ae.includes(ke));if(qe.length===0)throw new Error(`No matching columns found for table "${oe}" in import payload.`);const Te=qe.map(()=>"?").join(", "),je=qe.map(ke=>`"${ke}"`).join(", "),De=`INSERT INTO ${oe} (${je}) VALUES (${Te})`;c&&me.exec("BEGIN TRANSACTION");try{const ke=me.prepare(De);try{for(const Be of re){const he=qe.map(xe=>{const We=Be[xe];return We===void 0?null:We});ke.bind(he),ke.step(),ke.reset()}}finally{ke.finalize()}c&&me.exec("COMMIT")}catch(ke){throw c&&me.exec("ROLLBACK"),ke}}async function gr(oe){const{id:re,type:c,payload:me}=oe.data;try{let Ae;switch(c){case"INIT":await tt(),Ae=!0;break;case"EXEC":{Ce||await tt();const qe=it(),Te=kt(me)?me:{},je=typeof Te.sql=="string"?Te.sql:"",De=Array.isArray(Te.bind)?Te.bind:void 0,ke=[];qe.exec({sql:je,bind:De,rowMode:"object",callback:Be=>ke.push(Be)}),Ae=ke;break}case"GET_DIAGNOSTICS":Ce||await tt(),Ae=br();break;case"EXPORT":Ce||await tt(),Ae=Wt().capi.sqlite3_js_db_export(it().pointer);break;case"IMPORT":{if(!(me instanceof ArrayBuffer))throw new Error("IMPORT payload must be ArrayBuffer");Ae=await yr(me);break}case"CLEAR":{Ce||await tt();const qe=it();try{qe.exec("BEGIN TRANSACTION");const Te=[];qe.exec({sql:"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' AND name NOT LIKE 'sys_%'",rowMode:"object",callback:je=>Te.push(ct(je,"name"))});for(const je of Te)qe.exec(`DELETE FROM ${je};`);qe.exec("COMMIT"),ze("Database cleared (all user tables)")}catch(Te){throw qe.exec("ROLLBACK"),Te}Ae=!0;break}case"FACTORY_RESET":if(Ce&&(ze("Closing database for factory reset..."),Ce.close(),Ce=null),nt&&nt.oo1.OpfsDb)try{await(await navigator.storage.getDirectory()).removeEntry("litebistudio.sqlite3"),ze("OPFS file deleted for factory reset.")}catch(qe){ze("No OPFS file to delete or error:",qe)}mt=null,await tt(),Ae=!0;break;case"CLEAR_TABLE":{Ce||await tt();const qe=it(),Te=kt(me)?me:{},je=typeof Te.tableName=="string"?Te.tableName:"";if(!/^[a-z0-9_]+$/i.test(je))throw new Error(`Invalid table name: ${je}`);qe.exec(`DELETE FROM ${je};`),Ae=!0;break}case"GENERIC_BULK_INSERT":{Ce||await tt();const qe=kt(me)?me:{},Te=typeof qe.tableName=="string"?qe.tableName:"",je=Array.isArray(qe.records)?qe.records:[];Vt(Te,je),Ae=je.length;break}case"EXPORT_DEMO_DATA":{Ce||await tt();const qe=it(),Te={},je=[];qe.exec({sql:"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'",rowMode:"object",callback:De=>je.push(ct(De,"name"))});for(const De of je){const ke=[];qe.exec({sql:`SELECT * FROM ${De}`,rowMode:"object",callback:Be=>ke.push(Be)}),Te[De]=ke}Ae=Te;break}case"LOAD_DEMO":{Ce||await tt(),Ae=await mr(kt(me)?me:void 0);break}case"CLOSE":Ce&&(ze("Closing database..."),Ce.close(),Ce=null),Ae=!0,self.close();break}self.postMessage({id:re,result:Ae})}catch(Ae){self.postMessage({id:re,error:It(Ae)})}}function br(){const oe=it(),re=oe.selectValue("PRAGMA page_count"),c=oe.selectValue("PRAGMA page_size"),me=re*c,Ae={},qe=[];oe.exec({sql:"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'",rowMode:"object",callback:Te=>qe.push(ct(Te,"name"))});for(const Te of qe)Ae[Te]=Number(oe.selectValue(`SELECT count(*) FROM "${Te}"`)||0);return{dbSize:me,pageCount:re,pageSize:c,tableStats:Ae,schemaVersion:oe.selectValue("PRAGMA user_version")}}async function yr(oe){let re=null;const c={isValid:!1,headerMatch:!1,missingTables:[],missingColumns:{},versionInfo:{current:1,backup:0}};try{nt||await tt();const me=Wt(),Ae=new Uint8Array(oe.slice(0,16));if(new TextDecoder().decode(Ae).startsWith("SQLite format 3"))c.headerMatch=!0;else throw new Error("Invalid SQLite header");try{re=new me.oo1.DB(oe)}catch(De){return et("Temporary DB open failed",De),c.error="Memory DB allocation failed or buffer malformed: "+It(De),c}const Te=re.selectValue("PRAGMA user_version")||0;c.versionInfo={current:qt,backup:Te};const je=Ut.split(";").map(De=>{const ke=De.match(/CREATE TABLE (?:IF NOT EXISTS )?([a-z0_9_]+)/i);return ke?ke[1]:null}).filter(Boolean);for(const De of je){if(!re.selectValue("SELECT count(*) FROM sqlite_master WHERE type='table' AND name=?",[De])){c.missingTables.push(De);continue}const Be=[];if(re.exec({sql:`PRAGMA table_info("${De}")`,rowMode:"object",callback:he=>Be.push(ct(he,"name"))}),Ce){const he=it(),xe=[];he.exec({sql:`PRAGMA table_info("${De}")`,rowMode:"object",callback:st=>xe.push(ct(st,"name"))});const We=xe.filter(st=>!Be.includes(st));We.length>0&&(c.missingColumns[De]=We)}}if(Te>qt?(c.isValid=!1,c.isDowngrade=!0,c.error=`The backup (V${Te}) is newer than this application (V${qt}). Please update the application first.`):c.isValid=!0,me.oo1.OpfsDb){Ce&&(Ce.close(),Ce=null);const De=await navigator.storage.getDirectory();try{await De.removeEntry("litebistudio.sqlite3")}catch{}const Be=await(await De.getFileHandle("litebistudio.sqlite3",{create:!0})).createWritable();await Be.write(oe),await Be.close(),Ce=new me.oo1.OpfsDb("/litebistudio.sqlite3"),Qt(Ce),ze("Database imported and validated")}return c}catch(me){return et("Import failed",me),c.error=It(me),c}finally{re&&re.close()}}self.onmessage=gr})();
