import{j as a,u as He,a as pe,b as T,S as Q,c as Pt,d as mr,e as Ye,P as xr,f as hr,g as br,s as pr,h as fr,i as gr,M as Ge,k as wr,p as yr,l as kr,m as vr,n as yt}from"./index-7LPLAlBg.js";import{r as f,d as qe,u as Nr}from"./vendor-react-D64xOC9_.js";import{r as St,u as Ot}from"./xlsx-BojT3SgY.js";import{y as jr,z as _r,J as kt,K as Le,N as Cr,m as Se,O as Tr,Q as Mr,V as Rt,Y as It,X as Ze,Z as Be,d as vt,_ as $e,$ as De,D as We,u as Pe,I as Je,T as et,a0 as Er,a1 as Dr,f as Pr,n as Sr,r as Nt}from"./vendor-icons-Du2dXQHa.js";import{S as Or}from"./SchemaDocumentation-CqOaykNn.js";import{u as Rr}from"./useBackupStatus-B3NnXO8r.js";import"./vendor-pdf-FXkUb51H.js";import"./vendor-ui-BNe0Xlio.js";import"./vendor-charts-BtQqxQq4.js";const Yt=6048e5,Ir=864e5,Yr=6e4,qr=36e5,Lr=1e3,jt=Symbol.for("constructDateFrom");function V(s,e){return typeof s=="function"?s(e):s&&typeof s=="object"&&jt in s?s[jt](e):s instanceof Date?new s.constructor(e):new Date(e)}function A(s,e){return V(e||s,s)}function qt(s,e,t){const r=A(s,t?.in);return isNaN(e)?V(t?.in||s,NaN):(e&&r.setDate(r.getDate()+e),r)}let $r={};function Ne(){return $r}function me(s,e){const t=Ne(),r=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,n=A(s,e?.in),i=n.getDay(),l=(i<r?7:0)+i-r;return n.setDate(n.getDate()-l),n.setHours(0,0,0,0),n}function ve(s,e){return me(s,{...e,weekStartsOn:1})}function Lt(s,e){const t=A(s,e?.in),r=t.getFullYear(),n=V(t,0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);const i=ve(n),l=V(t,0);l.setFullYear(r,0,4),l.setHours(0,0,0,0);const x=ve(l);return t.getTime()>=i.getTime()?r+1:t.getTime()>=x.getTime()?r:r-1}function Ae(s){const e=A(s),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+s-+t}function Wr(s,...e){const t=V.bind(null,e.find(r=>typeof r=="object"));return e.map(t)}function _t(s,e){const t=A(s,e?.in);return t.setHours(0,0,0,0),t}function Ar(s,e,t){const[r,n]=Wr(t?.in,s,e),i=_t(r),l=_t(n),x=+i-Ae(i),w=+l-Ae(l);return Math.round((x-w)/Ir)}function Fr(s,e){const t=Lt(s,e),r=V(s,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),ve(r)}function Hr(s){return s instanceof Date||typeof s=="object"&&Object.prototype.toString.call(s)==="[object Date]"}function tt(s){return!(!Hr(s)&&typeof s!="number"||isNaN(+A(s)))}function Br(s,e){const t=A(s,e?.in);return t.setFullYear(t.getFullYear(),0,1),t.setHours(0,0,0,0),t}const Qr={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Vr=(s,e,t)=>{let r;const n=Qr[s];return typeof n=="string"?r=n:e===1?r=n.one:r=n.other.replace("{{count}}",e.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+r:r+" ago":r};function Ue(s){return(e={})=>{const t=e.width?String(e.width):s.defaultWidth;return s.formats[t]||s.formats[s.defaultWidth]}}const Xr={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},zr={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Gr={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Ur={date:Ue({formats:Xr,defaultWidth:"full"}),time:Ue({formats:zr,defaultWidth:"full"}),dateTime:Ue({formats:Gr,defaultWidth:"full"})},Kr={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Zr=(s,e,t,r)=>Kr[s];function Te(s){return(e,t)=>{const r=t?.context?String(t.context):"standalone";let n;if(r==="formatting"&&s.formattingValues){const l=s.defaultFormattingWidth||s.defaultWidth,x=t?.width?String(t.width):l;n=s.formattingValues[x]||s.formattingValues[l]}else{const l=s.defaultWidth,x=t?.width?String(t.width):s.defaultWidth;n=s.values[x]||s.values[l]}const i=s.argumentCallback?s.argumentCallback(e):e;return n[i]}}const Jr={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},es={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},ts={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},rs={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},ss={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},as={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},ns=(s,e)=>{const t=Number(s),r=t%100;if(r>20||r<10)switch(r%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},os={ordinalNumber:ns,era:Te({values:Jr,defaultWidth:"wide"}),quarter:Te({values:es,defaultWidth:"wide",argumentCallback:s=>s-1}),month:Te({values:ts,defaultWidth:"wide"}),day:Te({values:rs,defaultWidth:"wide"}),dayPeriod:Te({values:ss,defaultWidth:"wide",formattingValues:as,defaultFormattingWidth:"wide"})};function Me(s){return(e,t={})=>{const r=t.width,n=r&&s.matchPatterns[r]||s.matchPatterns[s.defaultMatchWidth],i=e.match(n);if(!i)return null;const l=i[0],x=r&&s.parsePatterns[r]||s.parsePatterns[s.defaultParseWidth],w=Array.isArray(x)?ls(x,h=>h.test(l)):is(x,h=>h.test(l));let g;g=s.valueCallback?s.valueCallback(w):w,g=t.valueCallback?t.valueCallback(g):g;const k=e.slice(l.length);return{value:g,rest:k}}}function is(s,e){for(const t in s)if(Object.prototype.hasOwnProperty.call(s,t)&&e(s[t]))return t}function ls(s,e){for(let t=0;t<s.length;t++)if(e(s[t]))return t}function cs(s){return(e,t={})=>{const r=e.match(s.matchPattern);if(!r)return null;const n=r[0],i=e.match(s.parsePattern);if(!i)return null;let l=s.valueCallback?s.valueCallback(i[0]):i[0];l=t.valueCallback?t.valueCallback(l):l;const x=e.slice(n.length);return{value:l,rest:x}}}const ds=/^(\d+)(th|st|nd|rd)?/i,us=/\d+/i,ms={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},xs={any:[/^b/i,/^(a|c)/i]},hs={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},bs={any:[/1/i,/2/i,/3/i,/4/i]},ps={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},fs={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},gs={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},ws={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},ys={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},ks={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},vs={ordinalNumber:cs({matchPattern:ds,parsePattern:us,valueCallback:s=>parseInt(s,10)}),era:Me({matchPatterns:ms,defaultMatchWidth:"wide",parsePatterns:xs,defaultParseWidth:"any"}),quarter:Me({matchPatterns:hs,defaultMatchWidth:"wide",parsePatterns:bs,defaultParseWidth:"any",valueCallback:s=>s+1}),month:Me({matchPatterns:ps,defaultMatchWidth:"wide",parsePatterns:fs,defaultParseWidth:"any"}),day:Me({matchPatterns:gs,defaultMatchWidth:"wide",parsePatterns:ws,defaultParseWidth:"any"}),dayPeriod:Me({matchPatterns:ys,defaultMatchWidth:"any",parsePatterns:ks,defaultParseWidth:"any"})},$t={code:"en-US",formatDistance:Vr,formatLong:Ur,formatRelative:Zr,localize:os,match:vs,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Ns(s,e){const t=A(s,e?.in);return Ar(t,Br(t))+1}function Wt(s,e){const t=A(s,e?.in),r=+ve(t)-+Fr(t);return Math.round(r/Yt)+1}function at(s,e){const t=A(s,e?.in),r=t.getFullYear(),n=Ne(),i=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,l=V(e?.in||s,0);l.setFullYear(r+1,0,i),l.setHours(0,0,0,0);const x=me(l,e),w=V(e?.in||s,0);w.setFullYear(r,0,i),w.setHours(0,0,0,0);const g=me(w,e);return+t>=+x?r+1:+t>=+g?r:r-1}function js(s,e){const t=Ne(),r=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??t.firstWeekContainsDate??t.locale?.options?.firstWeekContainsDate??1,n=at(s,e),i=V(e?.in||s,0);return i.setFullYear(n,0,r),i.setHours(0,0,0,0),me(i,e)}function At(s,e){const t=A(s,e?.in),r=+me(t,e)-+js(t,e);return Math.round(r/Yt)+1}function P(s,e){const t=s<0?"-":"",r=Math.abs(s).toString().padStart(e,"0");return t+r}const ue={y(s,e){const t=s.getFullYear(),r=t>0?t:1-t;return P(e==="yy"?r%100:r,e.length)},M(s,e){const t=s.getMonth();return e==="M"?String(t+1):P(t+1,2)},d(s,e){return P(s.getDate(),e.length)},a(s,e){const t=s.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];default:return t==="am"?"a.m.":"p.m."}},h(s,e){return P(s.getHours()%12||12,e.length)},H(s,e){return P(s.getHours(),e.length)},m(s,e){return P(s.getMinutes(),e.length)},s(s,e){return P(s.getSeconds(),e.length)},S(s,e){const t=e.length,r=s.getMilliseconds(),n=Math.trunc(r*Math.pow(10,t-3));return P(n,e.length)}},ke={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Ct={G:function(s,e,t){const r=s.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(r,{width:"abbreviated"});case"GGGGG":return t.era(r,{width:"narrow"});default:return t.era(r,{width:"wide"})}},y:function(s,e,t){if(e==="yo"){const r=s.getFullYear(),n=r>0?r:1-r;return t.ordinalNumber(n,{unit:"year"})}return ue.y(s,e)},Y:function(s,e,t,r){const n=at(s,r),i=n>0?n:1-n;if(e==="YY"){const l=i%100;return P(l,2)}return e==="Yo"?t.ordinalNumber(i,{unit:"year"}):P(i,e.length)},R:function(s,e){const t=Lt(s);return P(t,e.length)},u:function(s,e){const t=s.getFullYear();return P(t,e.length)},Q:function(s,e,t){const r=Math.ceil((s.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return P(r,2);case"Qo":return t.ordinalNumber(r,{unit:"quarter"});case"QQQ":return t.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(r,{width:"narrow",context:"formatting"});default:return t.quarter(r,{width:"wide",context:"formatting"})}},q:function(s,e,t){const r=Math.ceil((s.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return P(r,2);case"qo":return t.ordinalNumber(r,{unit:"quarter"});case"qqq":return t.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(r,{width:"narrow",context:"standalone"});default:return t.quarter(r,{width:"wide",context:"standalone"})}},M:function(s,e,t){const r=s.getMonth();switch(e){case"M":case"MM":return ue.M(s,e);case"Mo":return t.ordinalNumber(r+1,{unit:"month"});case"MMM":return t.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(r,{width:"narrow",context:"formatting"});default:return t.month(r,{width:"wide",context:"formatting"})}},L:function(s,e,t){const r=s.getMonth();switch(e){case"L":return String(r+1);case"LL":return P(r+1,2);case"Lo":return t.ordinalNumber(r+1,{unit:"month"});case"LLL":return t.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(r,{width:"narrow",context:"standalone"});default:return t.month(r,{width:"wide",context:"standalone"})}},w:function(s,e,t,r){const n=At(s,r);return e==="wo"?t.ordinalNumber(n,{unit:"week"}):P(n,e.length)},I:function(s,e,t){const r=Wt(s);return e==="Io"?t.ordinalNumber(r,{unit:"week"}):P(r,e.length)},d:function(s,e,t){return e==="do"?t.ordinalNumber(s.getDate(),{unit:"date"}):ue.d(s,e)},D:function(s,e,t){const r=Ns(s);return e==="Do"?t.ordinalNumber(r,{unit:"dayOfYear"}):P(r,e.length)},E:function(s,e,t){const r=s.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(r,{width:"short",context:"formatting"});default:return t.day(r,{width:"wide",context:"formatting"})}},e:function(s,e,t,r){const n=s.getDay(),i=(n-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return P(i,2);case"eo":return t.ordinalNumber(i,{unit:"day"});case"eee":return t.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(n,{width:"short",context:"formatting"});default:return t.day(n,{width:"wide",context:"formatting"})}},c:function(s,e,t,r){const n=s.getDay(),i=(n-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return P(i,e.length);case"co":return t.ordinalNumber(i,{unit:"day"});case"ccc":return t.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(n,{width:"narrow",context:"standalone"});case"cccccc":return t.day(n,{width:"short",context:"standalone"});default:return t.day(n,{width:"wide",context:"standalone"})}},i:function(s,e,t){const r=s.getDay(),n=r===0?7:r;switch(e){case"i":return String(n);case"ii":return P(n,e.length);case"io":return t.ordinalNumber(n,{unit:"day"});case"iii":return t.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(r,{width:"short",context:"formatting"});default:return t.day(r,{width:"wide",context:"formatting"})}},a:function(s,e,t){const n=s.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(n,{width:"narrow",context:"formatting"});default:return t.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(s,e,t){const r=s.getHours();let n;switch(r===12?n=ke.noon:r===0?n=ke.midnight:n=r/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(n,{width:"narrow",context:"formatting"});default:return t.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(s,e,t){const r=s.getHours();let n;switch(r>=17?n=ke.evening:r>=12?n=ke.afternoon:r>=4?n=ke.morning:n=ke.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(n,{width:"narrow",context:"formatting"});default:return t.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(s,e,t){if(e==="ho"){let r=s.getHours()%12;return r===0&&(r=12),t.ordinalNumber(r,{unit:"hour"})}return ue.h(s,e)},H:function(s,e,t){return e==="Ho"?t.ordinalNumber(s.getHours(),{unit:"hour"}):ue.H(s,e)},K:function(s,e,t){const r=s.getHours()%12;return e==="Ko"?t.ordinalNumber(r,{unit:"hour"}):P(r,e.length)},k:function(s,e,t){let r=s.getHours();return r===0&&(r=24),e==="ko"?t.ordinalNumber(r,{unit:"hour"}):P(r,e.length)},m:function(s,e,t){return e==="mo"?t.ordinalNumber(s.getMinutes(),{unit:"minute"}):ue.m(s,e)},s:function(s,e,t){return e==="so"?t.ordinalNumber(s.getSeconds(),{unit:"second"}):ue.s(s,e)},S:function(s,e){return ue.S(s,e)},X:function(s,e,t){const r=s.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return Mt(r);case"XXXX":case"XX":return be(r);default:return be(r,":")}},x:function(s,e,t){const r=s.getTimezoneOffset();switch(e){case"x":return Mt(r);case"xxxx":case"xx":return be(r);default:return be(r,":")}},O:function(s,e,t){const r=s.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+Tt(r,":");default:return"GMT"+be(r,":")}},z:function(s,e,t){const r=s.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+Tt(r,":");default:return"GMT"+be(r,":")}},t:function(s,e,t){const r=Math.trunc(+s/1e3);return P(r,e.length)},T:function(s,e,t){return P(+s,e.length)}};function Tt(s,e=""){const t=s>0?"-":"+",r=Math.abs(s),n=Math.trunc(r/60),i=r%60;return i===0?t+String(n):t+String(n)+e+P(i,2)}function Mt(s,e){return s%60===0?(s>0?"-":"+")+P(Math.abs(s)/60,2):be(s,e)}function be(s,e=""){const t=s>0?"-":"+",r=Math.abs(s),n=P(Math.trunc(r/60),2),i=P(r%60,2);return t+n+e+i}const Et=(s,e)=>{switch(s){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});default:return e.date({width:"full"})}},Ft=(s,e)=>{switch(s){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});default:return e.time({width:"full"})}},_s=(s,e)=>{const t=s.match(/(P+)(p+)?/)||[],r=t[1],n=t[2];if(!n)return Et(s,e);let i;switch(r){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",Et(r,e)).replace("{{time}}",Ft(n,e))},rt={p:Ft,P:_s},Cs=/^D+$/,Ts=/^Y+$/,Ms=["D","DD","YY","YYYY"];function Ht(s){return Cs.test(s)}function Bt(s){return Ts.test(s)}function st(s,e,t){const r=Es(s,e,t);if(console.warn(r),Ms.includes(s))throw new RangeError(r)}function Es(s,e,t){const r=s[0]==="Y"?"years":"days of the month";return`Use \`${s.toLowerCase()}\` instead of \`${s}\` (in \`${e}\`) for formatting ${r} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Ds=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Ps=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ss=/^'([^]*?)'?$/,Os=/''/g,Rs=/[a-zA-Z]/;function Ke(s,e,t){const r=Ne(),n=r.locale??$t,i=r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,l=r.weekStartsOn??r.locale?.options?.weekStartsOn??0,x=A(s,t?.in);if(!tt(x))throw new RangeError("Invalid time value");let w=e.match(Ps).map(k=>{const h=k[0];if(h==="p"||h==="P"){const N=rt[h];return N(k,n.formatLong)}return k}).join("").match(Ds).map(k=>{if(k==="''")return{isToken:!1,value:"'"};const h=k[0];if(h==="'")return{isToken:!1,value:Is(k)};if(Ct[h])return{isToken:!0,value:k};if(h.match(Rs))throw new RangeError("Format string contains an unescaped latin alphabet character `"+h+"`");return{isToken:!1,value:k}});n.localize.preprocessor&&(w=n.localize.preprocessor(x,w));const g={firstWeekContainsDate:i,weekStartsOn:l,locale:n};return w.map(k=>{if(!k.isToken)return k.value;const h=k.value;(Bt(h)||Ht(h))&&st(h,e,String(s));const N=Ct[h[0]];return N(x,h,n.localize,g)}).join("")}function Is(s){const e=s.match(Ss);return e?e[1].replace(Os,"'"):s}function Ys(){return Object.assign({},Ne())}function qs(s,e){const t=A(s,e?.in).getDay();return t===0?7:t}function Ls(s,e){const t=$s(e)?new e(0):V(e,0);return t.setFullYear(s.getFullYear(),s.getMonth(),s.getDate()),t.setHours(s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()),t}function $s(s){return typeof s=="function"&&s.prototype?.constructor===s}const Ws=10;class Qt{subPriority=0;validate(e,t){return!0}}class As extends Qt{constructor(e,t,r,n,i){super(),this.value=e,this.validateValue=t,this.setValue=r,this.priority=n,i&&(this.subPriority=i)}validate(e,t){return this.validateValue(e,this.value,t)}set(e,t,r){return this.setValue(e,t,this.value,r)}}class Fs extends Qt{priority=Ws;subPriority=-1;constructor(e,t){super(),this.context=e||(r=>V(t,r))}set(e,t){return t.timestampIsSet?e:V(e,Ls(e,this.context))}}class E{run(e,t,r,n){const i=this.parse(e,t,r,n);return i?{setter:new As(i.value,this.validate,this.set,this.priority,this.subPriority),rest:i.rest}:null}validate(e,t,r){return!0}}class Hs extends E{priority=140;parse(e,t,r){switch(t){case"G":case"GG":case"GGG":return r.era(e,{width:"abbreviated"})||r.era(e,{width:"narrow"});case"GGGGG":return r.era(e,{width:"narrow"});default:return r.era(e,{width:"wide"})||r.era(e,{width:"abbreviated"})||r.era(e,{width:"narrow"})}}set(e,t,r){return t.era=r,e.setFullYear(r,0,1),e.setHours(0,0,0,0),e}incompatibleTokens=["R","u","t","T"]}const $={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},ne={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function W(s,e){return s&&{value:e(s.value),rest:s.rest}}function Y(s,e){const t=e.match(s);return t?{value:parseInt(t[0],10),rest:e.slice(t[0].length)}:null}function oe(s,e){const t=e.match(s);if(!t)return null;if(t[0]==="Z")return{value:0,rest:e.slice(1)};const r=t[1]==="+"?1:-1,n=t[2]?parseInt(t[2],10):0,i=t[3]?parseInt(t[3],10):0,l=t[5]?parseInt(t[5],10):0;return{value:r*(n*qr+i*Yr+l*Lr),rest:e.slice(t[0].length)}}function Vt(s){return Y($.anyDigitsSigned,s)}function L(s,e){switch(s){case 1:return Y($.singleDigit,e);case 2:return Y($.twoDigits,e);case 3:return Y($.threeDigits,e);case 4:return Y($.fourDigits,e);default:return Y(new RegExp("^\\d{1,"+s+"}"),e)}}function Fe(s,e){switch(s){case 1:return Y($.singleDigitSigned,e);case 2:return Y($.twoDigitsSigned,e);case 3:return Y($.threeDigitsSigned,e);case 4:return Y($.fourDigitsSigned,e);default:return Y(new RegExp("^-?\\d{1,"+s+"}"),e)}}function nt(s){switch(s){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;default:return 0}}function Xt(s,e){const t=e>0,r=t?e:1-e;let n;if(r<=50)n=s||100;else{const i=r+50,l=Math.trunc(i/100)*100,x=s>=i%100;n=s+l-(x?100:0)}return t?n:1-n}function zt(s){return s%400===0||s%4===0&&s%100!==0}class Bs extends E{priority=130;incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"];parse(e,t,r){const n=i=>({year:i,isTwoDigitYear:t==="yy"});switch(t){case"y":return W(L(4,e),n);case"yo":return W(r.ordinalNumber(e,{unit:"year"}),n);default:return W(L(t.length,e),n)}}validate(e,t){return t.isTwoDigitYear||t.year>0}set(e,t,r){const n=e.getFullYear();if(r.isTwoDigitYear){const l=Xt(r.year,n);return e.setFullYear(l,0,1),e.setHours(0,0,0,0),e}const i=!("era"in t)||t.era===1?r.year:1-r.year;return e.setFullYear(i,0,1),e.setHours(0,0,0,0),e}}class Qs extends E{priority=130;parse(e,t,r){const n=i=>({year:i,isTwoDigitYear:t==="YY"});switch(t){case"Y":return W(L(4,e),n);case"Yo":return W(r.ordinalNumber(e,{unit:"year"}),n);default:return W(L(t.length,e),n)}}validate(e,t){return t.isTwoDigitYear||t.year>0}set(e,t,r,n){const i=at(e,n);if(r.isTwoDigitYear){const x=Xt(r.year,i);return e.setFullYear(x,0,n.firstWeekContainsDate),e.setHours(0,0,0,0),me(e,n)}const l=!("era"in t)||t.era===1?r.year:1-r.year;return e.setFullYear(l,0,n.firstWeekContainsDate),e.setHours(0,0,0,0),me(e,n)}incompatibleTokens=["y","R","u","Q","q","M","L","I","d","D","i","t","T"]}class Vs extends E{priority=130;parse(e,t){return Fe(t==="R"?4:t.length,e)}set(e,t,r){const n=V(e,0);return n.setFullYear(r,0,4),n.setHours(0,0,0,0),ve(n)}incompatibleTokens=["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]}class Xs extends E{priority=130;parse(e,t){return Fe(t==="u"?4:t.length,e)}set(e,t,r){return e.setFullYear(r,0,1),e.setHours(0,0,0,0),e}incompatibleTokens=["G","y","Y","R","w","I","i","e","c","t","T"]}class zs extends E{priority=120;parse(e,t,r){switch(t){case"Q":case"QQ":return L(t.length,e);case"Qo":return r.ordinalNumber(e,{unit:"quarter"});case"QQQ":return r.quarter(e,{width:"abbreviated",context:"formatting"})||r.quarter(e,{width:"narrow",context:"formatting"});case"QQQQQ":return r.quarter(e,{width:"narrow",context:"formatting"});default:return r.quarter(e,{width:"wide",context:"formatting"})||r.quarter(e,{width:"abbreviated",context:"formatting"})||r.quarter(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=1&&t<=4}set(e,t,r){return e.setMonth((r-1)*3,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]}class Gs extends E{priority=120;parse(e,t,r){switch(t){case"q":case"qq":return L(t.length,e);case"qo":return r.ordinalNumber(e,{unit:"quarter"});case"qqq":return r.quarter(e,{width:"abbreviated",context:"standalone"})||r.quarter(e,{width:"narrow",context:"standalone"});case"qqqqq":return r.quarter(e,{width:"narrow",context:"standalone"});default:return r.quarter(e,{width:"wide",context:"standalone"})||r.quarter(e,{width:"abbreviated",context:"standalone"})||r.quarter(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=1&&t<=4}set(e,t,r){return e.setMonth((r-1)*3,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]}class Us extends E{incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"];priority=110;parse(e,t,r){const n=i=>i-1;switch(t){case"M":return W(Y($.month,e),n);case"MM":return W(L(2,e),n);case"Mo":return W(r.ordinalNumber(e,{unit:"month"}),n);case"MMM":return r.month(e,{width:"abbreviated",context:"formatting"})||r.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return r.month(e,{width:"narrow",context:"formatting"});default:return r.month(e,{width:"wide",context:"formatting"})||r.month(e,{width:"abbreviated",context:"formatting"})||r.month(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=11}set(e,t,r){return e.setMonth(r,1),e.setHours(0,0,0,0),e}}class Ks extends E{priority=110;parse(e,t,r){const n=i=>i-1;switch(t){case"L":return W(Y($.month,e),n);case"LL":return W(L(2,e),n);case"Lo":return W(r.ordinalNumber(e,{unit:"month"}),n);case"LLL":return r.month(e,{width:"abbreviated",context:"standalone"})||r.month(e,{width:"narrow",context:"standalone"});case"LLLLL":return r.month(e,{width:"narrow",context:"standalone"});default:return r.month(e,{width:"wide",context:"standalone"})||r.month(e,{width:"abbreviated",context:"standalone"})||r.month(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=0&&t<=11}set(e,t,r){return e.setMonth(r,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]}function Zs(s,e,t){const r=A(s,t?.in),n=At(r,t)-e;return r.setDate(r.getDate()-n*7),A(r,t?.in)}class Js extends E{priority=100;parse(e,t,r){switch(t){case"w":return Y($.week,e);case"wo":return r.ordinalNumber(e,{unit:"week"});default:return L(t.length,e)}}validate(e,t){return t>=1&&t<=53}set(e,t,r,n){return me(Zs(e,r,n),n)}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","i","t","T"]}function ea(s,e,t){const r=A(s,t?.in),n=Wt(r,t)-e;return r.setDate(r.getDate()-n*7),r}class ta extends E{priority=100;parse(e,t,r){switch(t){case"I":return Y($.week,e);case"Io":return r.ordinalNumber(e,{unit:"week"});default:return L(t.length,e)}}validate(e,t){return t>=1&&t<=53}set(e,t,r){return ve(ea(e,r))}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]}const ra=[31,28,31,30,31,30,31,31,30,31,30,31],sa=[31,29,31,30,31,30,31,31,30,31,30,31];class aa extends E{priority=90;subPriority=1;parse(e,t,r){switch(t){case"d":return Y($.date,e);case"do":return r.ordinalNumber(e,{unit:"date"});default:return L(t.length,e)}}validate(e,t){const r=e.getFullYear(),n=zt(r),i=e.getMonth();return n?t>=1&&t<=sa[i]:t>=1&&t<=ra[i]}set(e,t,r){return e.setDate(r),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]}class na extends E{priority=90;subpriority=1;parse(e,t,r){switch(t){case"D":case"DD":return Y($.dayOfYear,e);case"Do":return r.ordinalNumber(e,{unit:"date"});default:return L(t.length,e)}}validate(e,t){const r=e.getFullYear();return zt(r)?t>=1&&t<=366:t>=1&&t<=365}set(e,t,r){return e.setMonth(0,r),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]}function ot(s,e,t){const r=Ne(),n=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,i=A(s,t?.in),l=i.getDay(),w=(e%7+7)%7,g=7-n,k=e<0||e>6?e-(l+g)%7:(w+g)%7-(l+g)%7;return qt(i,k,t)}class oa extends E{priority=90;parse(e,t,r){switch(t){case"E":case"EE":case"EEE":return r.day(e,{width:"abbreviated",context:"formatting"})||r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"});case"EEEEE":return r.day(e,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"});default:return r.day(e,{width:"wide",context:"formatting"})||r.day(e,{width:"abbreviated",context:"formatting"})||r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=6}set(e,t,r,n){return e=ot(e,r,n),e.setHours(0,0,0,0),e}incompatibleTokens=["D","i","e","c","t","T"]}class ia extends E{priority=90;parse(e,t,r,n){const i=l=>{const x=Math.floor((l-1)/7)*7;return(l+n.weekStartsOn+6)%7+x};switch(t){case"e":case"ee":return W(L(t.length,e),i);case"eo":return W(r.ordinalNumber(e,{unit:"day"}),i);case"eee":return r.day(e,{width:"abbreviated",context:"formatting"})||r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"});case"eeeee":return r.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"});default:return r.day(e,{width:"wide",context:"formatting"})||r.day(e,{width:"abbreviated",context:"formatting"})||r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=6}set(e,t,r,n){return e=ot(e,r,n),e.setHours(0,0,0,0),e}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]}class la extends E{priority=90;parse(e,t,r,n){const i=l=>{const x=Math.floor((l-1)/7)*7;return(l+n.weekStartsOn+6)%7+x};switch(t){case"c":case"cc":return W(L(t.length,e),i);case"co":return W(r.ordinalNumber(e,{unit:"day"}),i);case"ccc":return r.day(e,{width:"abbreviated",context:"standalone"})||r.day(e,{width:"short",context:"standalone"})||r.day(e,{width:"narrow",context:"standalone"});case"ccccc":return r.day(e,{width:"narrow",context:"standalone"});case"cccccc":return r.day(e,{width:"short",context:"standalone"})||r.day(e,{width:"narrow",context:"standalone"});default:return r.day(e,{width:"wide",context:"standalone"})||r.day(e,{width:"abbreviated",context:"standalone"})||r.day(e,{width:"short",context:"standalone"})||r.day(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=0&&t<=6}set(e,t,r,n){return e=ot(e,r,n),e.setHours(0,0,0,0),e}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]}function ca(s,e,t){const r=A(s,t?.in),n=qs(r,t),i=e-n;return qt(r,i,t)}class da extends E{priority=90;parse(e,t,r){const n=i=>i===0?7:i;switch(t){case"i":case"ii":return L(t.length,e);case"io":return r.ordinalNumber(e,{unit:"day"});case"iii":return W(r.day(e,{width:"abbreviated",context:"formatting"})||r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"}),n);case"iiiii":return W(r.day(e,{width:"narrow",context:"formatting"}),n);case"iiiiii":return W(r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"}),n);default:return W(r.day(e,{width:"wide",context:"formatting"})||r.day(e,{width:"abbreviated",context:"formatting"})||r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"}),n)}}validate(e,t){return t>=1&&t<=7}set(e,t,r){return e=ca(e,r),e.setHours(0,0,0,0),e}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]}class ua extends E{priority=80;parse(e,t,r){switch(t){case"a":case"aa":case"aaa":return r.dayPeriod(e,{width:"abbreviated",context:"formatting"})||r.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaaa":return r.dayPeriod(e,{width:"narrow",context:"formatting"});default:return r.dayPeriod(e,{width:"wide",context:"formatting"})||r.dayPeriod(e,{width:"abbreviated",context:"formatting"})||r.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,r){return e.setHours(nt(r),0,0,0),e}incompatibleTokens=["b","B","H","k","t","T"]}class ma extends E{priority=80;parse(e,t,r){switch(t){case"b":case"bb":case"bbb":return r.dayPeriod(e,{width:"abbreviated",context:"formatting"})||r.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbbb":return r.dayPeriod(e,{width:"narrow",context:"formatting"});default:return r.dayPeriod(e,{width:"wide",context:"formatting"})||r.dayPeriod(e,{width:"abbreviated",context:"formatting"})||r.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,r){return e.setHours(nt(r),0,0,0),e}incompatibleTokens=["a","B","H","k","t","T"]}class xa extends E{priority=80;parse(e,t,r){switch(t){case"B":case"BB":case"BBB":return r.dayPeriod(e,{width:"abbreviated",context:"formatting"})||r.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBBB":return r.dayPeriod(e,{width:"narrow",context:"formatting"});default:return r.dayPeriod(e,{width:"wide",context:"formatting"})||r.dayPeriod(e,{width:"abbreviated",context:"formatting"})||r.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,r){return e.setHours(nt(r),0,0,0),e}incompatibleTokens=["a","b","t","T"]}class ha extends E{priority=70;parse(e,t,r){switch(t){case"h":return Y($.hour12h,e);case"ho":return r.ordinalNumber(e,{unit:"hour"});default:return L(t.length,e)}}validate(e,t){return t>=1&&t<=12}set(e,t,r){const n=e.getHours()>=12;return n&&r<12?e.setHours(r+12,0,0,0):!n&&r===12?e.setHours(0,0,0,0):e.setHours(r,0,0,0),e}incompatibleTokens=["H","K","k","t","T"]}class ba extends E{priority=70;parse(e,t,r){switch(t){case"H":return Y($.hour23h,e);case"Ho":return r.ordinalNumber(e,{unit:"hour"});default:return L(t.length,e)}}validate(e,t){return t>=0&&t<=23}set(e,t,r){return e.setHours(r,0,0,0),e}incompatibleTokens=["a","b","h","K","k","t","T"]}class pa extends E{priority=70;parse(e,t,r){switch(t){case"K":return Y($.hour11h,e);case"Ko":return r.ordinalNumber(e,{unit:"hour"});default:return L(t.length,e)}}validate(e,t){return t>=0&&t<=11}set(e,t,r){return e.getHours()>=12&&r<12?e.setHours(r+12,0,0,0):e.setHours(r,0,0,0),e}incompatibleTokens=["h","H","k","t","T"]}class fa extends E{priority=70;parse(e,t,r){switch(t){case"k":return Y($.hour24h,e);case"ko":return r.ordinalNumber(e,{unit:"hour"});default:return L(t.length,e)}}validate(e,t){return t>=1&&t<=24}set(e,t,r){const n=r<=24?r%24:r;return e.setHours(n,0,0,0),e}incompatibleTokens=["a","b","h","H","K","t","T"]}class ga extends E{priority=60;parse(e,t,r){switch(t){case"m":return Y($.minute,e);case"mo":return r.ordinalNumber(e,{unit:"minute"});default:return L(t.length,e)}}validate(e,t){return t>=0&&t<=59}set(e,t,r){return e.setMinutes(r,0,0),e}incompatibleTokens=["t","T"]}class wa extends E{priority=50;parse(e,t,r){switch(t){case"s":return Y($.second,e);case"so":return r.ordinalNumber(e,{unit:"second"});default:return L(t.length,e)}}validate(e,t){return t>=0&&t<=59}set(e,t,r){return e.setSeconds(r,0),e}incompatibleTokens=["t","T"]}class ya extends E{priority=30;parse(e,t){const r=n=>Math.trunc(n*Math.pow(10,-t.length+3));return W(L(t.length,e),r)}set(e,t,r){return e.setMilliseconds(r),e}incompatibleTokens=["t","T"]}class ka extends E{priority=10;parse(e,t){switch(t){case"X":return oe(ne.basicOptionalMinutes,e);case"XX":return oe(ne.basic,e);case"XXXX":return oe(ne.basicOptionalSeconds,e);case"XXXXX":return oe(ne.extendedOptionalSeconds,e);default:return oe(ne.extended,e)}}set(e,t,r){return t.timestampIsSet?e:V(e,e.getTime()-Ae(e)-r)}incompatibleTokens=["t","T","x"]}class va extends E{priority=10;parse(e,t){switch(t){case"x":return oe(ne.basicOptionalMinutes,e);case"xx":return oe(ne.basic,e);case"xxxx":return oe(ne.basicOptionalSeconds,e);case"xxxxx":return oe(ne.extendedOptionalSeconds,e);default:return oe(ne.extended,e)}}set(e,t,r){return t.timestampIsSet?e:V(e,e.getTime()-Ae(e)-r)}incompatibleTokens=["t","T","X"]}class Na extends E{priority=40;parse(e){return Vt(e)}set(e,t,r){return[V(e,r*1e3),{timestampIsSet:!0}]}incompatibleTokens="*"}class ja extends E{priority=20;parse(e){return Vt(e)}set(e,t,r){return[V(e,r),{timestampIsSet:!0}]}incompatibleTokens="*"}const _a={G:new Hs,y:new Bs,Y:new Qs,R:new Vs,u:new Xs,Q:new zs,q:new Gs,M:new Us,L:new Ks,w:new Js,I:new ta,d:new aa,D:new na,E:new oa,e:new ia,c:new la,i:new da,a:new ua,b:new ma,B:new xa,h:new ha,H:new ba,K:new pa,k:new fa,m:new ga,s:new wa,S:new ya,X:new ka,x:new va,t:new Na,T:new ja},Ca=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Ta=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ma=/^'([^]*?)'?$/,Ea=/''/g,Da=/\S/,Pa=/[a-zA-Z]/;function Dt(s,e,t,r){const n=()=>V(t,NaN),i=Ys(),l=i.locale??$t,x=i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,w=i.weekStartsOn??i.locale?.options?.weekStartsOn??0;if(!e)return s?n():A(t,r?.in);const g={firstWeekContainsDate:x,weekStartsOn:w,locale:l},k=[new Fs(r?.in,t)],h=e.match(Ta).map(u=>{const d=u[0];if(d in rt){const v=rt[d];return v(u,l.formatLong)}return u}).join("").match(Ca),N=[];for(let u of h){Bt(u)&&st(u,e,s),Ht(u)&&st(u,e,s);const d=u[0],v=_a[d];if(v){const{incompatibleTokens:R}=v;if(Array.isArray(R)){const y=N.find(C=>R.includes(C.token)||C.token===d);if(y)throw new RangeError(`The format string mustn't contain \`${y.fullToken}\` and \`${u}\` at the same time`)}else if(v.incompatibleTokens==="*"&&N.length>0)throw new RangeError(`The format string mustn't contain \`${u}\` and any other token at the same time`);N.push({token:d,fullToken:u});const q=v.run(s,u,l.match,g);if(!q)return n();k.push(q.setter),s=q.rest}else{if(d.match(Pa))throw new RangeError("Format string contains an unescaped latin alphabet character `"+d+"`");if(u==="''"?u="'":d==="'"&&(u=Sa(u)),s.indexOf(u)===0)s=s.slice(u.length);else return n()}}if(s.length>0&&Da.test(s))return n();const c=k.map(u=>u.priority).sort((u,d)=>d-u).filter((u,d,v)=>v.indexOf(u)===d).map(u=>k.filter(d=>d.priority===u).sort((d,v)=>v.subPriority-d.subPriority)).map(u=>u[0]);let p=A(t,r?.in);if(isNaN(+p))return n();const _={};for(const u of c){if(!u.validate(p,g))return n();const d=u.set(p,_,g);Array.isArray(d)?(p=d[0],Object.assign(_,d[1])):p=d}return p}function Sa(s){return s.match(Ma)[1].replace(Ea,"'")}const Gt={Period:[{id:"MMM.YYYY",label:"MMM.YYYY (e.g. 001.2025)",description:"Converts 001.2025 to 2025-01",apply:s=>{if(typeof s!="string")return s;const e=s.match(/^(\d{3})\.(\d{4})$/);if(e){const t=parseInt(e[1],10);return`${e[2]}-${t.toString().padStart(2,"0")}`}return s}},{id:"YYYY-MM",label:"YYYY-MM (ISO)",description:"Standard ISO format",apply:s=>s},{id:"MM.YYYY",label:"MM.YYYY / MM-YYYY (e.g. 01.2025)",description:"Converts 01.2025 or 01-2025 to 2025-01",apply:s=>{if(typeof s!="string")return s;const e=String(s).trim().match(/^(\d{1,2})[.-](\d{4})$/);if(e){const t=parseInt(e[1],10);return`${e[2]}-${t.toString().padStart(2,"0")}`}return s}}],PostingDate:[{id:"DD.MM.YYYY",label:"DD.MM.YYYY",description:"German date format",apply:s=>{if(typeof s!="string"||s.match(/^\d{4}-\d{2}-\d{2}$/))return s;const e=Dt(s,"dd.MM.yyyy",new Date);return tt(e)?Ke(e,"yyyy-MM-dd"):s}},{id:"MM/DD/YYYY",label:"MM/DD/YYYY",description:"US date format",apply:s=>{if(typeof s!="string")return s;const e=Dt(s,"MM/dd/yyyy",new Date);return tt(e)?Ke(e,"yyyy-MM-dd"):s}},{id:"ExcelSerial",label:"Excel Serial Number",description:"Number like 45321",apply:s=>{const e=Number(s);if(!isNaN(e)&&e>2e4){const t=new Date((e-25569)*86400*1e3);return Ke(t,"yyyy-MM-dd")}return s}}],...["VendorName","VendorId","DocumentId","CostCenter","Category","SubCategory","Service","System","Description"].reduce((s,e)=>({...s,[e]:[{id:"Trim",label:"Trim Whitespace",description:"Removes leading and trailing spaces",apply:t=>String(t||"").trim()},{id:"UpperCase",label:"UPPER CASE",description:"Converts to uppercase",apply:t=>String(t||"").toUpperCase()},{id:"LowerCase",label:"lower case",description:"Converts to lowercase",apply:t=>String(t||"").toLowerCase()},{id:"TitleCase",label:"Title Case",description:"Capitalize First Letters",apply:t=>String(t||"").replace(/\w\S*/g,r=>r.charAt(0).toUpperCase()+r.substr(1).toLowerCase())}]}),{}),...["Amount","UnitPrice","Quantity"].reduce((s,e)=>({...s,[e]:[{id:"ParseDeCurrency",label:"German Currency (1.234,56)",description:"Parses 1.234,56 to 1234.56",apply:t=>{if(typeof t=="number")return t;if(!t)return 0;const r=String(t).replace(/\./g,"").replace(",","."),n=parseFloat(r);return isNaN(n)?0:n}},{id:"CleanNumber",label:"Clean Number (Remove Symbols)",description:"Keep only digits, dots and minus",apply:t=>{if(typeof t=="number")return t;const r=String(t).replace(/[^0-9.-]/g,""),n=parseFloat(r);return isNaN(n)?0:n}}]}),{})},Oa=(s,e,t)=>{const r=Gt[t];if(!r)return s;const n=r.find(i=>i.id===e);return n?n.apply(s):s},Ra=({sourceColumns:s,targetSchema:e,onConfirm:t,onCancel:r,initialMapping:n})=>{const[i,l]=f.useState(n||{}),x=e.properties,w=e.required||[],g=Object.keys(x).map(c=>({key:c,description:x[c].description,required:w.includes(c)})),k=f.useCallback(()=>{const c={};g.forEach(p=>{const _=s.find(u=>u.toLowerCase()===p.key.toLowerCase()||u.toLowerCase().replace(/[^a-z0-9]/g,"")===p.key.toLowerCase().replace(/[^a-z0-9]/g,""));_&&(c[p.key]={sourceColumn:_,operation:"direct"})}),l(p=>({...p,...c}))},[s,g]);f.useEffect(()=>{if(n&&Object.keys(n).length>0)return;const c=window.setTimeout(()=>{k()},0);return()=>window.clearTimeout(c)},[k,n]);const h=g.filter(c=>c.required).every(c=>{const p=i[c.key];return p?p.sourceColumn==="__CONSTANT__"?!!p.constantValue:p.operation==="concat"&&!p.secondaryColumn?!1:!!p.sourceColumn:!1}),N=()=>g.filter(c=>{if(!c.required)return!1;const p=i[c.key];return p?p.sourceColumn==="__CONSTANT__"?!p.constantValue:p.operation==="concat"&&!p.secondaryColumn?!0:!p.sourceColumn:!0}).length;return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 animate-in fade-in duration-200",children:a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col",children:[a.jsxs("div",{className:"p-4 sm:p-6 border-b border-slate-200 dark:border-slate-700 flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Map Columns & Transforms"}),a.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Match columns and apply necessary format conversions."})]}),a.jsxs("button",{onClick:k,className:"w-full sm:w-auto flex items-center justify-center gap-2 px-3 py-1.5 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium",children:[a.jsx(jr,{className:"w-4 h-4"}),"Auto-Map"]})]}),a.jsxs("div",{className:"flex-1 overflow-auto p-4 sm:p-6",children:[a.jsxs("div",{className:"hidden lg:grid grid-cols-[1fr,auto,2fr,1fr] gap-4 items-start mb-2 px-4 text-xs font-bold text-slate-400 uppercase tracking-wider",children:[a.jsx("div",{children:"Required Field"}),a.jsx("div",{className:"w-8"}),a.jsx("div",{children:"Source Configuration"}),a.jsx("div",{children:"Transformation"})]}),a.jsx("div",{className:"space-y-3",children:g.map(c=>{const p=Gt[c.key]||[],_=i[c.key],u=_?.operation||"direct";return a.jsxs("div",{className:`
                                    grid grid-cols-1 lg:grid-cols-[1fr,auto,2fr,1fr] gap-3 lg:gap-4 items-start p-4 rounded-xl border transition-colors
                                    ${_?.sourceColumn?"bg-slate-50 dark:bg-slate-900/30 border-slate-200 dark:border-slate-700":c.required?"bg-red-50 dark:bg-red-900/10 border-red-200 dark:border-red-900/30":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 opacity-70 hover:opacity-100"}
                                `,children:[a.jsxs("div",{className:"mt-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:`font-semibold ${c.required?"text-slate-900 dark:text-white":"text-slate-500 dark:text-slate-400"}`,children:c.key}),c.required&&a.jsx("span",{className:"text-[10px] bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 px-1.5 py-0.5 rounded font-bold uppercase",children:"Required"})]}),a.jsx("div",{className:"text-xs text-slate-500 mt-1 line-clamp-1",title:c.description,children:c.description})]}),a.jsx(_r,{className:`hidden lg:block w-4 h-4 mt-3 ${_?.sourceColumn?"text-blue-500":"text-slate-300"}`}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider lg:hidden",children:"Source Configuration"}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center min-h-10",children:[a.jsxs("select",{value:_?.sourceColumn||"",onChange:d=>{const v=d.target.value;l(R=>{const q={...R};if(v){let y=q[c.key]?.transformId;v==="__CONSTANT__"&&!y&&p.length>0&&(y=p[0].id),q[c.key]={sourceColumn:v,transformId:y,operation:"direct"}}else delete q[c.key];return q})},className:`
                                                    w-full sm:flex-1 h-10 px-3 rounded-lg border text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-all
                                                    ${_?.sourceColumn?"border-blue-200 bg-white dark:bg-slate-900 dark:border-blue-900/50":"border-slate-200 bg-slate-50 dark:bg-slate-800 dark:border-slate-600"}
                                                `,children:[a.jsx("option",{value:"",children:"-- Ignored --"}),a.jsx("option",{value:"__CONSTANT__",className:"font-bold text-blue-600",children:"-- Set Constant Value --"}),a.jsx("optgroup",{label:"Source Columns",children:s.map(d=>a.jsx("option",{value:d,children:d},d))})]}),_?.sourceColumn&&_.sourceColumn!=="__CONSTANT__"&&a.jsxs("div",{className:"flex h-10 sm:h-full w-full sm:w-auto bg-slate-100 dark:bg-slate-700 rounded-lg p-1 border border-slate-200 dark:border-slate-600 items-center flex-wrap sm:flex-nowrap",children:[a.jsx("button",{onClick:()=>l(d=>({...d,[c.key]:{...d[c.key],operation:"direct"}})),className:`h-full px-3 rounded-md text-xs font-bold transition-all flex items-center ${u==="direct"?"bg-white dark:bg-slate-600 shadow-sm text-slate-900 dark:text-white":"text-slate-500 hover:text-slate-700"}`,title:"Direct Mapping",children:"1:1"}),a.jsx("div",{className:"w-px h-4 bg-slate-200 dark:bg-slate-600 mx-0.5"}),a.jsx("button",{onClick:()=>l(d=>({...d,[c.key]:{...d[c.key],operation:"coalesce"}})),className:`h-full px-3 rounded-md text-xs font-bold transition-all flex items-center ${u==="coalesce"?"bg-white dark:bg-slate-600 shadow-sm text-slate-900 dark:text-white":"text-slate-500 hover:text-slate-700"}`,title:"Fallback if empty (Coalesce)",children:"Fallback"}),a.jsx("div",{className:"w-px h-4 bg-slate-200 dark:bg-slate-600 mx-0.5"}),a.jsx("button",{onClick:()=>l(d=>({...d,[c.key]:{...d[c.key],operation:"concat",separator:" "}})),className:`h-full px-3 rounded-md text-xs font-bold transition-all flex items-center ${u==="concat"?"bg-white dark:bg-slate-600 shadow-sm text-slate-900 dark:text-white":"text-slate-500 hover:text-slate-700"}`,title:"Combine Columns (Concat)",children:"Combine"})]})]}),u==="coalesce"&&a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 animate-in slide-in-from-top-2 min-h-10",children:[a.jsx(kt,{className:"w-4 h-4 text-slate-400 rotate-45"}),a.jsx("span",{className:"text-xs font-bold text-slate-400 shrink-0",children:"ELSE USE"}),a.jsxs("select",{value:_?.secondaryColumn||"",onChange:d=>l(v=>({...v,[c.key]:{...v[c.key],secondaryColumn:d.target.value}})),className:"w-full sm:flex-1 h-10 px-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"-- Select Fallback Column --"}),s.map(d=>a.jsx("option",{value:d,children:d},d))]})]}),u==="concat"&&a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 animate-in slide-in-from-top-2 min-h-10",children:[a.jsx(Le,{className:"w-4 h-4 text-slate-400"}),a.jsx("input",{type:"text",placeholder:"Separator (space)",value:_?.separator??" ",onChange:d=>l(v=>({...v,[c.key]:{...v[c.key],separator:d.target.value}})),className:"w-full sm:w-16 h-10 px-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-center text-sm",title:"Separator"}),a.jsx(Le,{className:"w-4 h-4 text-slate-400"}),a.jsxs("select",{value:_?.secondaryColumn||"",onChange:d=>l(v=>({...v,[c.key]:{...v[c.key],secondaryColumn:d.target.value}})),className:"w-full sm:flex-1 h-10 px-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"-- Select 2nd Column --"}),s.map(d=>a.jsx("option",{value:d,children:d},d))]})]}),_?.sourceColumn==="__CONSTANT__"&&a.jsx("div",{className:"relative animate-in fade-in zoom-in-95 h-10",children:a.jsx("input",{type:"text",placeholder:"Enter constant value...",value:_.constantValue||"",onChange:d=>{const v=d.target.value;l(R=>({...R,[c.key]:{...R[c.key],constantValue:v}}))},className:`
                                                        w-full h-full px-3 rounded-lg border text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-all
                                                        ${_.constantValue?"border-blue-200 bg-white dark:bg-slate-900 dark:border-blue-900/50":"border-red-300 ring-2 ring-red-100 bg-red-50"}
                                                    `})})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider lg:hidden mb-2",children:"Transformation"}),p.length>0&&(_?.sourceColumn||c.key==="Currency")&&a.jsxs("div",{className:"relative h-10",children:[a.jsx(Cr,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"}),a.jsxs("select",{value:_?.transformId||"",onChange:d=>{const v=d.target.value;l(R=>({...R,[c.key]:{...R[c.key],transformId:v||void 0}}))},className:"w-full h-full pl-9 pr-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm focus:ring-2 focus:ring-blue-500 appearance-none",children:[a.jsx("option",{value:"",children:"No Transformation"}),p.map(d=>a.jsx("option",{value:d.id,children:d.label},d.id))]}),a.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:a.jsx(kt,{className:"w-3 h-3 text-slate-400"})})]})]})]},c.key)})})]}),a.jsxs("div",{className:"p-4 sm:p-6 border-t border-slate-200 dark:border-slate-700 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 bg-slate-50 dark:bg-slate-900/50 rounded-b-2xl",children:[a.jsx("button",{onClick:r,className:"px-4 py-2 text-slate-600 hover:text-slate-900 dark:text-slate-400 dark:hover:text-white font-medium transition-colors",children:"Cancel Import"}),a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4 w-full sm:w-auto",children:[!h&&a.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm font-medium",children:[a.jsx(Se,{className:"w-4 h-4"}),N()," required fields missing"]}),a.jsxs("button",{onClick:()=>t(i),disabled:!h,className:`
                                w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-2.5 rounded-xl font-semibold shadow-lg transition-all transform
                                ${h?"bg-blue-600 hover:bg-blue-700 text-white shadow-blue-200 dark:shadow-none hover:-translate-y-0.5":"bg-slate-200 dark:bg-slate-700 text-slate-400 cursor-not-allowed"}
                            `,children:[a.jsx(Tr,{className:"w-4 h-4"}),"Confirm Mapping"]})]})]})]})})},Ia=({config:s,onImportComplete:e})=>{const{t}=He(),[r,n]=f.useState(!1),[i,l]=f.useState(!1),[x,w]=f.useState(null),[g,k]=f.useState(null),[h]=pe("import_default_mode","append"),[N]=pe("import_auto_save_mappings",!0),[c,p]=f.useState(h),[_,u]=f.useState(!1),[d,v]=f.useState(null),[R,q]=f.useState([]),y=f.useRef(null),[C,j]=pe("excel_mappings_v2",{});f.useEffect(()=>{p(h)},[h,s?.key]);const O=f.useCallback(()=>{if(!s?.schema||typeof s.schema!="object")return null;const S=s.schema;return!S.properties||typeof S.properties!="object"?null:{properties:S.properties,required:Array.isArray(S.required)?S.required:[]}},[s]),X=f.useCallback((S,z,G)=>{const ae=Object.keys(G.properties),ie=U=>U==null||U==="";return S.map(U=>{const he={};return ae.forEach(fe=>{const H=z[fe];if(!H?.sourceColumn)return;let Z;if(H.sourceColumn==="__CONSTANT__")Z=H.constantValue??"";else{const ge=U[H.sourceColumn],Oe=H.secondaryColumn?U[H.secondaryColumn]:void 0;switch(H.operation){case"coalesce":Z=ie(ge)?Oe:ge;break;case"concat":{Z=[ge,Oe].filter(B=>!ie(B)).map(B=>String(B)).join(H.separator??" ");break}default:Z=ge;break}}H.transformId&&(Z=Oa(Z,H.transformId,fe)),he[fe]=Z}),he})},[]),F=f.useCallback(async S=>{if(s){if(S.length===0){w(t("datasource.excel_import.no_valid_data"));return}c==="overwrite"&&s.clearFn&&await s.clearFn(),await s.importFn(S),k(t("datasource.excel_import.success_msg",{count:S.length})),e&&e(),window.dispatchEvent(new Event("db-updated"))}},[s,c,e,t]),ee=f.useCallback(async S=>{if(s){l(!0),w(null),k(null);try{const z=await S.arrayBuffer(),G=St(z),ae=G.SheetNames[0],ie=G.Sheets[ae],U=Ot.sheet_to_json(ie);if(U.length===0){w(t("datasource.excel_import.no_data"));return}const he=Object.keys(U[0]??{});if(O()){v(U),q(he),u(!0);return}await F(U)}catch(z){const G=z instanceof Error?z.message:String(z);w(t("datasource.excel_import.error_reading",{error:G}))}finally{l(!1)}}},[s,F,O,t]),xe=f.useCallback(async S=>{if(!s||!d)return;const z=O();if(z){u(!1),l(!0),w(null),k(null);try{const G=X(d,S,z);N&&j(ae=>({...ae,[s.key]:S})),await F(G)}catch(G){const ae=G instanceof Error?G.message:String(G);w(t("datasource.excel_import.import_failed",{error:ae}))}finally{v(null),q([]),l(!1)}}},[X,N,s,F,O,d,j,t]),Qe=f.useCallback(()=>{u(!1),v(null),q([])},[]),Ve=f.useCallback(S=>{S.preventDefault(),n(!1);const z=S.dataTransfer.files[0];z&&ee(z)},[ee]);return s?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-800 p-1 rounded-lg w-fit",children:[a.jsxs("button",{onClick:()=>p("append"),className:`px-3 py-1.5 text-xs font-bold rounded-md flex items-center gap-2 transition-all ${c==="append"?"bg-white dark:bg-slate-700 shadow text-blue-600 dark:text-blue-300":"text-slate-500 dark:text-slate-400"}`,children:[a.jsx(Mr,{className:"w-3.5 h-3.5"})," ",t("datasource.excel_import.append")]}),a.jsxs("button",{onClick:()=>p("overwrite"),className:`px-3 py-1.5 text-xs font-bold rounded-md flex items-center gap-2 transition-all ${c==="overwrite"?"bg-white dark:bg-slate-700 shadow text-red-600 dark:text-red-300":"text-slate-500 dark:text-slate-400"}`,children:[a.jsx(Rt,{className:"w-3.5 h-3.5"})," ",t("datasource.excel_import.overwrite")]})]}),a.jsxs("div",{onDragOver:S=>{S.preventDefault(),n(!0)},onDragLeave:()=>n(!1),onDrop:Ve,onClick:()=>y.current?.click(),className:`
                    relative group border-2 border-dashed rounded-2xl p-8 transition-all cursor-pointer text-center
                    ${r?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-slate-200 dark:border-slate-700 hover:border-slate-400 dark:hover:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-900/40"}
                    ${i?"opacity-50 pointer-events-none":""}
                `,children:[a.jsx("input",{type:"file",ref:y,onChange:S=>S.target.files?.[0]&&ee(S.target.files[0]),accept:".xlsx,.xls,.csv",className:"hidden"}),a.jsxs("div",{className:"flex flex-col items-center gap-3",children:[a.jsx("div",{className:`p-3 rounded-xl transition-colors ${r?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-300":"bg-slate-100 dark:bg-slate-800 text-slate-400 dark:text-slate-500 group-hover:bg-slate-200 dark:group-hover:bg-slate-700 group-hover:text-slate-600 dark:group-hover:text-slate-300"}`,children:a.jsx(It,{className:"w-8 h-8"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-bold text-slate-700 dark:text-slate-200",children:t("datasource.smart_import.upload_label")}),a.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-1",children:t("datasource.excel_import.drop_hint")})]})]}),i&&a.jsx("div",{className:"absolute inset-0 bg-white/60 dark:bg-slate-900/60 flex items-center justify-center rounded-2xl backdrop-blur-[1px]",children:a.jsxs("div",{className:"flex items-center gap-3 text-blue-600 dark:text-blue-300",children:[a.jsx("div",{className:"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin"}),a.jsx("span",{className:"text-xs font-bold",children:t("datasource.excel_import.processing_file")})]})})]}),x&&a.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border-2 border-red-100 dark:border-red-800/50 rounded-2xl flex items-start gap-3 text-red-600 dark:text-red-300 text-xs animate-in slide-in-from-top-2 relative",children:[a.jsx(Se,{className:"w-5 h-5 shrink-0 mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-black uppercase tracking-widest text-[10px] mb-1",children:t("common.error")}),a.jsx("p",{className:"font-medium leading-relaxed",children:x})]}),a.jsx("button",{onClick:()=>w(null),className:"p-1 hover:bg-red-100 dark:hover:bg-red-900/40 rounded-lg transition-colors",children:a.jsx(Ze,{className:"w-4 h-4"})})]}),g&&a.jsxs("div",{className:"p-4 bg-emerald-50 dark:bg-emerald-900/20 border-2 border-emerald-100 dark:border-emerald-800/50 rounded-2xl flex items-start gap-3 text-emerald-600 dark:text-emerald-300 text-xs animate-in slide-in-from-top-2 relative",children:[a.jsx(Be,{className:"w-5 h-5 shrink-0 mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-black uppercase tracking-widest text-[10px] mb-1",children:t("common.success")}),a.jsx("p",{className:"font-medium leading-relaxed",children:g})]}),a.jsx("button",{onClick:()=>k(null),className:"p-1 hover:bg-emerald-100 dark:hover:bg-emerald-900/40 rounded-lg transition-colors",children:a.jsx(Ze,{className:"w-4 h-4"})})]}),_&&s&&O()&&a.jsx(Ra,{sourceColumns:R,targetSchema:O(),initialMapping:C[s.key],onConfirm:S=>{xe(S)},onCancel:Qe})]}):a.jsx("div",{className:"p-8 text-center bg-slate-50 dark:bg-slate-900/40 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-2xl",children:a.jsx("p",{className:"text-slate-400 dark:text-slate-500 text-sm",children:t("datasource.excel_import.none_selected")})})};async function Ya(s){return new Promise((e,t)=>{const r=new FileReader;r.onload=n=>{try{const i=new Uint8Array(n.target?.result),l=St(i,{type:"array",cellDates:!0}),x=[];for(const w of l.SheetNames){const g=l.Sheets[w],k=Ot.sheet_to_json(g,{header:1});if(!k||k.length<2)continue;const h=k[0].map(v=>String(v).trim()),N=k.slice(1);let c=w.toLowerCase().replace(/[^a-z0-9_]/g,"_").replace(/^_+|_+$/g,"").replace(/_+/g,"_"),p,_=!0;/^[a-z][a-z0-9_]*$/.test(c)||(/^[0-9]/.test(c)?c="tbl_"+c:c===""&&(c="tbl_unnamed")),c.startsWith("sys_")&&(_=!1,p="Tabellennamen drfen nicht mit 'sys_' beginnen (reserviert).");const u=h.map((v,R)=>{let q=!0,y=!0,C=!1;const j=Math.min(N.length,100);for(let F=0;F<j;F++){const ee=N[F][R];if(ee==null||ee==="")continue;C=!0;const xe=Number(ee);if(isNaN(xe)){q=!1,y=!1;break}Number.isInteger(xe)||(q=!1)}let O="TEXT";return C&&(q?O="INTEGER":y&&(O="REAL")),{name:v.toLowerCase().replace(/[^a-z0-9_]/g,"_"),type:O}}),d=N.map(v=>{const R={};return u.forEach((q,y)=>{let C=v[y];C instanceof Date?C=C.toISOString():typeof C=="object"&&C!==null&&(C=JSON.stringify(C)),R[q.name]=C}),R});x.push({sheetName:w,suggestedTableName:c,columns:u,rowCount:N.length,data:d,isValid:_,validationError:p})}e(x)}catch(i){t(i)}},r.onerror=n=>t(n),r.readAsArrayBuffer(s)})}const qa=()=>{const{t:s}=He(),e=Pt("SmartImport"),[t]=pe("import_table_prefix","usr_"),[r,n]=f.useState(1),[i,l]=f.useState([]),[x,w]=f.useState({tables:0,records:0}),[g,k]=f.useState(!1),[h,N]=f.useState(!1),c=f.useRef(null),p=y=>y.trim(),_=y=>p(y).toLowerCase().startsWith("sys"),u=_(t)?"usr_":p(t),d=_(t),v=y=>{const C=y.trim(),j=u;return!j||C.toLowerCase().startsWith(j.toLowerCase())?C:`${j}${C}`},R=async y=>{const C=y.target.files?.[0];if(C){k(!0);try{const O=(await Ya(C)).map(X=>({sheetName:X.sheetName,tableName:v(X.suggestedTableName),columns:X.columns,rows:X.data,isValid:X.isValid,error:X.validationError}));l(O),n(2)}catch(j){e.error("Analysis failed",j),await T.error(s("datasource.smart_import.error_analyzing"))}finally{k(!1)}}},q=async()=>{N(!0);let y=0,C=0;try{for(const j of i){if(!j.isValid)continue;const O=j.columns.map(F=>`"${F.name}" ${F.type}`).join(", ");await Q.executeRaw(`CREATE TABLE IF NOT EXISTS "${j.tableName}" (${O});`);const X=500;for(let F=0;F<j.rows.length;F+=X)await Q.bulkInsert(j.tableName,j.rows.slice(F,F+X));C++,y+=j.rows.length}w({tables:C,records:y}),n(4),l([]),window.dispatchEvent(new Event("db-updated"))}catch(j){const O=j instanceof Error?j.message:String(j);await T.error(s("common.error")+": "+O)}finally{N(!1)}};return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center gap-4 px-2",children:[{s:1,label:s("datasource.smart_import.step_upload")},{s:2,label:s("datasource.smart_import.step_config")},{s:3,label:s("datasource.smart_import.step_import")}].concat(r===4?[{s:4,label:s("datasource.smart_import.step_success")}]:[]).map(({s:y,label:C})=>a.jsxs(qe.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-black ${r>=y?"bg-blue-600 text-white":"bg-slate-200 text-slate-500"}`,children:y}),a.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${r>=y?"text-slate-700":"text-slate-400"}`,children:C})]}),y<(r===4?4:3)&&a.jsx(vt,{className:"w-4 h-4 text-slate-300"})]},y))}),a.jsxs("div",{className:"min-h-[200px]",children:[r===1&&a.jsxs("div",{onClick:()=>c.current?.click(),className:"group relative border-2 border-dashed border-slate-200 hover:border-blue-400 hover:bg-blue-50/50 rounded-2xl p-12 transition-all cursor-pointer text-center",children:[a.jsx("input",{type:"file",ref:c,onChange:R,accept:".xlsx,.xls,.csv",className:"hidden"}),a.jsxs("div",{className:"flex flex-col items-center gap-4",children:[a.jsx("div",{className:"p-4 bg-blue-50 group-hover:bg-blue-100 rounded-2xl text-blue-600 transition-colors",children:a.jsx($e,{className:"w-8 h-8"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-bold text-slate-700",children:s("datasource.smart_import.upload_label")}),a.jsx("p",{className:"text-xs text-slate-400 mt-1",children:s("datasource.smart_import.upload_hint")})]})]}),g&&a.jsx("div",{className:"absolute inset-0 bg-white/80 flex items-center justify-center rounded-2xl z-10",children:a.jsxs("div",{className:"flex items-center gap-3 text-blue-600",children:[a.jsx("div",{className:"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin"}),a.jsx("span",{className:"text-xs font-bold",children:s("common.loading")})]})})]}),r===2&&a.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-2 duration-300",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-bold text-slate-700",children:s("datasource.smart_import.found_tables")}),a.jsx("p",{className:"text-[10px] text-slate-400",children:s("datasource.smart_import.found_tables_hint")}),a.jsx("p",{className:"text-[10px] text-blue-600 mt-1",children:s("datasource.smart_import.prefix_hint",{prefix:u||s("datasource.smart_import.no_prefix")})}),d&&a.jsx("p",{className:"text-[10px] text-red-600 mt-1",children:s("datasource.smart_import.prefix_invalid_config_reset")})]})}),a.jsx("div",{className:"space-y-3",children:i.map((y,C)=>a.jsx("div",{className:`p-4 rounded-xl border-2 transition-all ${y.isValid?"bg-white border-slate-100 shadow-sm":"bg-red-50 border-red-100"}`,children:a.jsxs("div",{className:"flex items-start justify-between gap-4",children:[a.jsxs("div",{className:"flex-1 space-y-3",children:[a.jsx("div",{className:"flex items-center gap-4",children:a.jsxs("div",{className:"flex-1",children:[a.jsxs("span",{className:"text-[9px] font-black text-slate-400 uppercase",children:[s("datasource.smart_import.sheet_label")," ",y.sheetName]}),a.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.jsx(De,{className:"w-4 h-4 text-blue-500"}),a.jsx("input",{value:y.tableName,onChange:j=>{const O=[...i];O[C].tableName=j.target.value,O[C].isValid=j.target.value.trim().length>0&&!j.target.value.trim().toLowerCase().startsWith("sys"),l(O)},className:`text-sm font-bold bg-transparent border-b-2 outline-none w-full ${y.isValid?"border-blue-100 focus:border-blue-500":"border-red-300"}`,placeholder:s("datasource.smart_import.table_label")})]}),!y.isValid&&a.jsxs("p",{className:"text-[10px] text-red-500 mt-1 flex items-center gap-1",children:[a.jsx(Se,{className:"w-3 h-3"})," ",s("datasource.smart_import.invalid_prefix")]})]})}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-slate-500",children:[a.jsx(We,{className:"w-3 h-3"}),s("datasource.smart_import.columns_count",{count:y.columns.length})]}),a.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-slate-500",children:[a.jsx(It,{className:"w-3 h-3"}),s("datasource.smart_import.rows_count",{count:y.rows.length})]})]}),a.jsxs("div",{className:"flex flex-wrap gap-1",children:[y.columns.slice(0,5).map(j=>a.jsxs("span",{className:"px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-[9px] font-medium",children:[j.name," ",a.jsxs("span",{className:"opacity-50 font-mono",children:["(",j.type,")"]})]},j.name)),y.columns.length>5&&a.jsx("span",{className:"px-2 py-0.5 bg-slate-100 text-slate-400 rounded text-[9px] font-medium",children:s("datasource.smart_import.more_columns",{count:y.columns.length-5})})]})]}),a.jsx("button",{onClick:()=>l(i.filter((j,O)=>O!==C)),className:"p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all",children:a.jsx(Pe,{className:"w-4 h-4"})})]})},C))}),a.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100",children:[a.jsx("button",{onClick:()=>n(1),className:"px-4 py-2 text-slate-500 font-bold text-xs hover:bg-slate-100 rounded-lg transition-colors",children:s("datasource.smart_import.back_btn")}),a.jsxs("button",{onClick:()=>{n(3),q()},disabled:i.length===0||i.some(y=>!y.isValid)||h,className:"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 disabled:opacity-30 disabled:cursor-not-allowed text-white rounded-xl text-xs font-black shadow-lg shadow-blue-500/20 transition-all flex items-center gap-2",children:[s("datasource.smart_import.start_import")," ",a.jsx(vt,{className:"w-4 h-4"})]})]})]}),r===3&&a.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center space-y-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"w-16 h-16 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin"}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:a.jsx(We,{className:"w-6 h-6 text-blue-600"})})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-bold text-slate-700",children:s("datasource.smart_import.import_running")}),a.jsx("p",{className:"text-xs text-slate-400 mt-1",children:s("common.loading")})]})]}),r===4&&a.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center space-y-6 animate-in zoom-in-95 duration-500",children:[a.jsx("div",{className:"w-20 h-20 bg-emerald-50 text-emerald-600 rounded-full flex items-center justify-center shadow-inner ring-8 ring-emerald-50/50",children:a.jsx(Be,{className:"w-10 h-10"})}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h4",{className:"text-xl font-black text-slate-800 tracking-tight",children:s("datasource.smart_import.import_success_title")}),a.jsx("p",{className:"text-sm text-slate-500 max-w-[280px] leading-relaxed",children:s("datasource.smart_import.import_success_hint",{count:x.tables})})]}),a.jsxs("div",{className:"flex items-center gap-8 py-4 px-8 bg-slate-50 rounded-2xl border border-slate-100",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1",children:s("datasource.smart_import.found_tables")}),a.jsx("p",{className:"text-lg font-black text-slate-700",children:x.tables})]}),a.jsx("div",{className:"w-px h-8 bg-slate-200"}),a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1",children:s("datasource.smart_import.rows_count",{count:0}).replace("0","").trim()}),a.jsx("p",{className:"text-lg font-black text-slate-700",children:x.records})]})]}),a.jsx("button",{onClick:()=>n(1),className:"px-8 py-3 bg-slate-900 hover:bg-black text-white rounded-xl text-sm font-bold transition-all transform hover:scale-105 active:scale-95 shadow-xl shadow-slate-900/10",children:s("datasource.smart_import.finish_btn")})]})]})]})},La=({type:s,title:e,message:t,details:r,onClose:n,className:i=""})=>{const x={success:{bg:"bg-emerald-50 dark:bg-emerald-900/20",border:"border-emerald-100 dark:border-emerald-800/50",text:"text-emerald-800 dark:text-emerald-200",icon:a.jsx(Be,{className:"w-5 h-5 text-emerald-500"})},error:{bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-100 dark:border-red-800/50",text:"text-red-800 dark:text-red-200",icon:a.jsx(Se,{className:"w-5 h-5 text-red-500"})},warning:{bg:"bg-amber-50 dark:bg-amber-900/20",border:"border-amber-100 dark:border-amber-800/50",text:"text-amber-800 dark:text-amber-200",icon:a.jsx(et,{className:"w-5 h-5 text-amber-500"})},info:{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-100 dark:border-blue-800/50",text:"text-blue-800 dark:text-blue-200",icon:a.jsx(Je,{className:"w-5 h-5 text-blue-500"})}}[s];return a.jsxs("div",{className:`p-4 rounded-2xl border-2 ${x.bg} ${x.border} flex items-start gap-4 animate-in slide-in-from-top-2 duration-300 ${i}`,children:[a.jsx("div",{className:"shrink-0 mt-0.5",children:x.icon}),a.jsxs("div",{className:"flex-1 min-w-0",children:[e&&a.jsx("h5",{className:`text-sm font-black uppercase tracking-wider mb-1 ${x.text}`,children:e}),a.jsx("p",{className:`text-sm font-medium leading-relaxed ${x.text}`,children:t}),r&&a.jsx("div",{className:"mt-3 p-3 bg-white/50 dark:bg-black/20 rounded-xl border border-white/50 dark:border-white/5",children:a.jsx("pre",{className:"text-[10px] font-mono whitespace-pre-wrap break-all opacity-80",children:r})})]}),n&&a.jsx("button",{onClick:n,className:"p-1 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg transition-colors shrink-0",children:a.jsx(Ze,{className:"w-4 h-4 opacity-50"})})]})},$a=()=>{const{t:s}=He(),[e,t]=pe("excel_mappings_v2",{}),r=f.useRef(null),[n,i]=qe.useState(null),[l,x]=qe.useState(null),w=()=>{try{const N=JSON.stringify(e,null,2),c=new Blob([N],{type:"application/json"}),p=URL.createObjectURL(c),_=document.createElement("a");_.href=p,_.download=`itdashboard_mappings_${new Date().toISOString().split("T")[0]}.json`,_.click(),URL.revokeObjectURL(p),x("success"),i(s("common.success"))}catch(N){const c=N instanceof Error?N.message:String(N);x("error"),i(s("common.error")+": "+c)}},g=N=>{const c=N.target.files?.[0];if(!c)return;const p=new FileReader;p.onload=_=>{try{const u=JSON.parse(_.target?.result);if(typeof u!="object"||u===null)throw new Error("Invalid JSON");t(d=>({...d,...u})),x("success"),i(s("common.success"))}catch(u){const d=u instanceof Error?u.message:String(u);x("error"),i(s("common.error")+": "+d)}},p.readAsText(c),r.current&&(r.current.value="")},k=async()=>{await T.confirm(s("datasource.clear_mappings_confirm"))&&(t({}),x("success"),i(s("common.success")))};qe.useEffect(()=>{if(n){const N=setTimeout(()=>{i(null),x(null)},3e3);return()=>clearTimeout(N)}},[n]);const h=Object.keys(e).length;return a.jsxs("div",{className:"flex items-center gap-3",children:[n&&a.jsxs("div",{className:`text-xs px-2 py-1 rounded flex items-center gap-1.5 animate-in fade-in slide-in-from-right-4 ${l==="success"?"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-300":"bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-300"}`,children:[l==="success"?a.jsx(Be,{className:"w-3 h-3"}):a.jsx(Se,{className:"w-3 h-3"}),n]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-xs text-slate-400 mr-2",children:s("datasource.mappings_saved",{count:h})}),a.jsx("button",{onClick:w,disabled:h===0,className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-slate-700 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:s("datasource.export_mappings"),children:a.jsx(Er,{className:"w-4 h-4"})}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"file",accept:".json",ref:r,onChange:g,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",title:s("datasource.import_mappings")}),a.jsx("button",{className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-slate-700 rounded transition-colors pointer-events-none",children:a.jsx($e,{className:"w-4 h-4"})})]}),a.jsx("div",{className:"w-px h-4 bg-slate-200 dark:bg-slate-700 mx-1"}),a.jsx("button",{onClick:k,disabled:h===0,className:"p-1.5 text-slate-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-slate-700 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:s("datasource.clear_mappings"),children:a.jsx(Pe,{className:"w-4 h-4"})})]})]})},se=Pt("DatasourceView"),Wa=["litebistudio_","data_inspector_","query_builder_","data_table_","ui_table_","notifications_","import_"],Aa=new Set(["app_log_level","custom_dashboard_layout","excel_mappings_v2","i18nextLng","visibleComponentIds","visibleSidebarComponentIds","componentOrder","isSidebarCollapsed"]),Fa=["litebistudio_","data_inspector_","query_builder_"],Ee=s=>String(s).padStart(2,"0"),Ha=(s,e)=>{const t=new Date,r=`${t.getFullYear()}-${Ee(t.getMonth()+1)}-${Ee(t.getDate())}`,n=`${Ee(t.getHours())}${Ee(t.getMinutes())}${Ee(t.getSeconds())}`,i=`${r}_${n}`,l=e?"secure":"standard",g=(s||"backup_{date}_{mode}").trim().replace(/\{date\}/gi,r).replace(/\{time\}/gi,n).replace(/\{datetime\}/gi,i).replace(/\{mode\}/gi,l).replace(/[<>:"/\\|?*]/g,"_"),h=Array.from(g).map(N=>N.charCodeAt(0)<32?"_":N).join("").trim()||`backup_${r}_${l}`;return h.toLowerCase().endsWith(".sqlite3")?h:`${h}.sqlite3`},Ba=s=>{const e=s.trim();if(e.length<8)return!0;const t=/[a-z]/.test(e),r=/[A-Z]/.test(e),n=/\d/.test(e),i=/[^A-Za-z0-9]/.test(e);return Number(t)+Number(r)+Number(n)+Number(i)<3},Qa=()=>{const s=Object.keys(window.localStorage);for(const t of s)(Aa.has(t)||Wa.some(r=>t.startsWith(r)))&&window.localStorage.removeItem(t);const e=Object.keys(window.sessionStorage);for(const t of e)Fa.some(r=>t.startsWith(r))&&window.sessionStorage.removeItem(t)},rn=({onImportComplete:s})=>{const{t:e,i18n:t}=He(),r=Nr(),n=new Date,i=e("settings.last_update",{date:n.toLocaleDateString(t.language==="de"?"de-DE":"en-US"),time:n.toLocaleTimeString(t.language==="de"?"de-DE":"en-US",{hour:"2-digit",minute:"2-digit"})}),{isReadOnly:l,isAdminMode:x}=mr(),w=o=>o instanceof Error?o.message:String(o),[g,k]=f.useState(()=>{const o=sessionStorage.getItem("litebistudio_datasource_tab");return o==="import"||o==="structure"||o==="system"?o:"import"});f.useEffect(()=>{sessionStorage.setItem("litebistudio_datasource_tab",g)},[g]);const[h,N]=f.useState(""),[c,p]=f.useState(null),[_,u]=f.useState(!1),[d,v]=f.useState(!1),[R,q]=f.useState(""),[y,C]=f.useState(""),[j,O]=f.useState([]),[X,F]=f.useState(!1),[ee,xe]=f.useState(""),[Qe,Ve]=f.useState([]),[S,z]=f.useState(!1),[G,ae]=f.useState(""),[ie,U]=f.useState(!1),[he,fe]=f.useState(`CREATE TABLE usr_my_table (
    id INTEGER PRIMARY KEY,
    name TEXT,
    amount REAL
);`),[H,Z]=f.useState([{name:"id",type:"INTEGER PRIMARY KEY"}]),{isBackupRecommended:ge,changeCount:Oe,markBackupComplete:Re}=Rr(),[B,Ut]=f.useState(!1),[Xe,it]=f.useState(""),[je,te]=f.useState(null),[lt,ct]=f.useState(!1),[dt,ut]=f.useState(!1),[Kt]=pe("backup_file_name_pattern","backup_{date}_{mode}"),[mt]=pe("backup_use_saved_location",!0),_e=f.useRef(null),xt=wr(),ht=async o=>{const m=()=>new Date().toLocaleTimeString();se.debug(`[Restore][${m()}] File selected:`,o.name,o.size,o.type);try{se.debug(`[Restore][${m()}] Calling file.arrayBuffer()...`);const b=await o.arrayBuffer();se.debug(`[Restore][${m()}] Buffer received, size:`,b.byteLength);const M=new Uint8Array(b.slice(0,16)),K=new TextDecoder().decode(M).startsWith("SQLite format 3");se.debug("[Restore] Header check - isSqlite:",K);let Ie=b;if(!K){const I=await T.prompt(e("datasource.restore_encrypted_prompt"));if(!I)return;try{Ie=await kr(b,I)}catch{te({type:"error",title:e("common.error"),message:e("datasource.restore_failed")});return}}if(!await T.confirm(e("datasource.restore_confirm")))return;se.info(`[Restore][${m()}] User confirmed restore. Starting process...`),te({type:"warning",title:e("common.loading"),message:"Verarbeite Backup-Datei..."});try{se.debug(`[Restore][${m()}] Calling worker importDatabase...`);const I=await vr(Ie);se.debug(`[Restore][${m()}] Worker report received:`,I);const{versionInfo:J}=I;if(!I.headerMatch){te({type:"error",title:e("datasource.restore_invalid"),message:I.error||e("datasource.restore_warning_hint")});return}if(I.error){te({type:"error",title:I.isDowngrade?"Incompatible Backup":e("common.error"),message:I.error,details:J?`Backup Version: V${J.backup} | App Version: V${J.current}`:void 0});return}if(I.isValid)te({type:"success",title:e("common.success"),message:e("datasource.restore_success_reload"),details:J?`Database Version: V${J.backup} (Upgraded to V${J.current})`:void 0}),se.info(`[Restore][${m()}] Success! Reloading in 2s...`),Re(),setTimeout(()=>window.location.reload(),2e3);else{let ce="";if(J&&(ce+=`Schema: V${J.backup} -> V${J.current} (Update required)

`),I.missingTables.length>0&&(ce+=e("datasource.restore_missing_tables")+`
- `+I.missingTables.join(`
- `)+`

`),Object.keys(I.missingColumns).length>0){ce+=e("datasource.restore_missing_columns")+`
`;for(const[dr,ur]of Object.entries(I.missingColumns))ce+=`- ${dr}: ${ur.join(", ")}
`}te({type:"warning",title:e("datasource.restore_warning_title"),message:e("datasource.restore_warning_hint"),details:ce})}}catch(I){se.error(`[Restore][${m()}] Inner Error:`,I),te({type:"error",title:e("common.error"),message:w(I)})}}catch(b){se.error(`[Restore][${m()}] Outer Error:`,b),te({type:"error",title:e("common.error"),message:w(b)})}},Zt=async()=>{if(te(null),mt&&xt){const o=await yr();if(o.cancelled)return;if(o.file){await ht(o.file);return}_e.current&&_e.current.click();return}_e.current&&_e.current.click()},{data:Ce,refresh:we}=Ye(()=>Q.getTables(),[]),{data:Jt,refresh:bt}=Ye(()=>Q.getDataSources(),[]),ze=o=>o.startsWith("sys_")||o==="sqlite_sequence",er=o=>o.startsWith("sys_"),le=Ce?.filter(o=>!ze(o))||[],tr=Ce?.filter(o=>ze(o))||[],de=(Jt||[]).filter(o=>o.type==="view"&&!er(o.name)),{data:pt}=Ye(async()=>{if(g!=="structure"||le.length===0)return{};const o=await Promise.all(le.map(async m=>{const[b,M]=await Promise.all([Q.executeRaw(`SELECT COUNT(*) AS count FROM ${re(m)}`),Q.executeRaw("SELECT COUNT(*) AS count FROM sqlite_master WHERE type='index' AND LOWER(tbl_name) = LOWER(?) AND name NOT LIKE 'sqlite_%'",[m])]);return[m,{rows:Number(b[0]?.count||0),indexes:Number(M[0]?.count||0)}]}));return Object.fromEntries(o)},[g,le.join("|")],{cacheKey:`datasource-table-meta-${le.join("|")}`,ttl:15e3}),{data:ye}=Ye(async()=>{if(g!=="structure"||de.length===0)return{};const o=await Promise.all(de.map(async m=>{try{const b=await Q.executeRaw(`SELECT COUNT(*) AS count FROM ${re(m.name)}`);return[m.name,{valid:!0,rows:Number(b[0]?.count||0)}]}catch(b){return[m.name,{valid:!1,error:w(b)}]}}));return Object.fromEntries(o)},[g,de.map(o=>o.name).join("|")],{cacheKey:`datasource-view-meta-${de.map(o=>o.name).join("|")}`,ttl:15e3});f.useEffect(()=>{(async()=>{if(!h){p(null);return}try{const[m,b]=await Promise.all([Q.getTableSchema(h),Q.getTableIndexes(h)]),M={};m.forEach(D=>{M[D.name]={type:D.type.toUpperCase().includes("INT")||D.type.toUpperCase().includes("REAL")?"number":"string",description:D.type}}),p({title:h,description:e("datasource.records_label",{name:h}),properties:M,required:m.filter(D=>D.notnull).map(D=>D.name),indexes:b.map(D=>({name:D.name,unique:D.unique,columns:D.columns,origin:D.origin,partial:D.partial}))})}catch(m){se.error("Failed to load schema",m),p(null)}})()},[h,Ce,_,e]);const re=o=>`"${o.replace(/"/g,'""')}"`,rr=o=>/^[A-Za-z0-9_ (),]+$/.test(o.trim()),sr=(()=>{if(!(!h||!c))return{key:`import_${h}`,entityLabel:e("datasource.records_label",{name:h}),schema:c,validate:()=>!0,getValidationErrors:()=>[],importFn:async o=>{for(let b=0;b<o.length;b+=500)await Q.bulkInsert(h,o.slice(b,b+500))},clearFn:async()=>{await Q.executeRaw(`DELETE FROM ${re(h)}`)}}})(),ar=async()=>{try{if(ie)await Q.executeRaw(he);else{const o=G.trim();if(!yt(o)){await T.warning(e("datasource.invalid_table_name","Ungueltiger Tabellenname. Bitte nur Buchstaben, Zahlen und Unterstrich verwenden."));return}if(!H.length){await T.warning(e("datasource.invalid_columns","Bitte mindestens eine gueltige Spalte angeben."));return}for(const M of H){const D=M.name.trim(),K=M.type.trim();if(!yt(D)||!K||!rr(K)){await T.warning(e("datasource.invalid_columns","Bitte mindestens eine gueltige Spalte angeben."));return}}const m=H.map(M=>`${re(M.name.trim())} ${M.type.trim()}`).join(", "),b=`CREATE TABLE ${re(o)} (${m})`;await Q.executeRaw(b)}z(!1),we(),ae(""),Z([{name:"id",type:"INTEGER PRIMARY KEY"}]),await T.info(e("datasource.table_created"))}catch(o){await T.error(e("common.error")+": "+w(o))}},ft=async o=>{if(!(localStorage.getItem("notifications_confirm_destructive")!=="false"&&!await T.confirm(e("datasource.drop_confirm",{name:o}))))try{await Q.executeRaw(`DROP TABLE ${re(o)}`),we(),bt(),h===o&&N("")}catch(b){await T.error(e("common.error")+": "+w(b))}},gt=async o=>{if(!(localStorage.getItem("notifications_confirm_destructive")!=="false"&&!await T.confirm(e("datasource.drop_view_confirm",`View "${o}" lschen?`,{name:o}))))try{await Q.executeRaw(`DROP VIEW ${re(o)}`),we(),bt(),h===o&&N("")}catch(b){await T.error(e("common.error")+": "+w(b))}},nr=async o=>{if(!(localStorage.getItem("notifications_confirm_destructive")!=="false"&&!await T.confirm(e("datasource.clear_confirm",{name:o}))))try{await Q.executeRaw(`DELETE FROM ${re(o)}`),we(),await T.info(e("datasource.cleared_success"))}catch(b){await T.error(e("common.error")+": "+w(b))}},or=async()=>{const o=e("datasource.sql_manager_reset_confirm","Reset SQL Manager? All saved SQL statements and favorites will be deleted.");if(!await T.confirm(o))return;const m=await T.prompt(e("datasource.sql_manager_reset_prompt",'Please type "RESET" to continue:'));if(m!=="RESET"){m!==null&&await T.warning(e("datasource.sql_manager_reset_aborted","Canceled: Wrong input."));return}try{ut(!0),await Q.executeRaw("DELETE FROM sys_sql_statement;"),await T.info(e("datasource.sql_manager_reset_success","SQL Manager was reset."))}catch(b){await T.error(e("common.error")+": "+w(b))}finally{ut(!1)}},ir=async o=>{try{const b=(await Q.getTableSchema(o)).map(M=>M.name).filter(Boolean);q(o),Ve(b),O([]),F(!1),xe(""),C(`idx_${o}_`),v(!0)}catch(m){await T.error(e("common.error")+": "+w(m))}},lr=o=>{O(m=>m.includes(o)?m.filter(b=>b!==o):[...m,o])},wt=(o,m)=>{O(b=>{const M=b.indexOf(o);if(M===-1)return b;const D=m==="up"?M-1:M+1;if(D<0||D>=b.length)return b;const K=[...b];return[K[M],K[D]]=[K[D],K[M]],K})},cr=async()=>{const o=y.trim();if(!o){await T.warning(e("datasource.index_create_name_required","Bitte einen Indexnamen angeben."));return}if(j.length===0){await T.warning(e("datasource.index_create_columns_required","Bitte mindestens eine Spalte auswhlen."));return}try{const m=X?"UNIQUE ":"",b=j.map(re).join(", "),M=ee.trim()?` WHERE ${ee.trim()}`:"",D=`CREATE ${m}INDEX ${re(o)} ON ${re(R)} (${b})${M};`;await Q.executeRaw(D),v(!1),await we(),await T.info(e("datasource.index_create_success","Index erstellt."))}catch(m){await T.error(e("common.error")+": "+w(m))}};return a.jsxs(xr,{header:{title:e("sidebar.datasource"),subtitle:e("datasource.subtitle"),onBack:()=>r(-1)},footer:i,children:[a.jsxs("div",{className:`max-w-4xl space-y-6 ${l?"opacity-80":""}`,children:[a.jsx("div",{className:"border-b border-slate-200 dark:border-slate-700",children:a.jsxs("div",{className:"flex items-center gap-8 px-1",children:[a.jsxs("button",{onClick:()=>k("import"),className:`relative py-3 text-sm font-bold transition-colors ${g==="import"?"text-blue-600 dark:text-blue-400":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"}`,children:[e("datasource.tab_import"),g==="import"&&a.jsx("span",{className:"absolute left-0 right-0 -bottom-px h-0.5 bg-blue-600 dark:bg-blue-400"})]}),a.jsxs("button",{onClick:()=>k("structure"),className:`relative py-3 text-sm font-bold transition-colors ${g==="structure"?"text-blue-600 dark:text-blue-400":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"}`,children:[e("datasource.tab_structure"),g==="structure"&&a.jsx("span",{className:"absolute left-0 right-0 -bottom-px h-0.5 bg-blue-600 dark:bg-blue-400"})]}),a.jsxs("button",{onClick:()=>k("system"),className:`relative py-3 text-sm font-bold transition-colors ${g==="system"?"text-blue-600 dark:text-blue-400":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"}`,children:[e("datasource.tab_system"),g==="system"&&a.jsx("span",{className:"absolute left-0 right-0 -bottom-px h-0.5 bg-blue-600 dark:bg-blue-400"})]})]})}),g==="import"&&a.jsxs("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[a.jsxs("div",{className:`bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm ${l?"pointer-events-none opacity-60":""}`,children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600",children:a.jsx(Le,{className:"w-5 h-5"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-bold text-slate-700 dark:text-slate-200 uppercase tracking-widest",children:e("datasource.smart_import_title")}),a.jsx("p",{className:"text-xs text-slate-400",children:e("datasource.smart_import_hint")})]})]}),a.jsx(qa,{})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"}),a.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase",children:e("datasource.or_separator")}),a.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"})]}),a.jsxs("div",{className:`bg-slate-50 dark:bg-slate-800/50 rounded-2xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm ${l?"pointer-events-none opacity-60":""}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-white dark:bg-slate-700 rounded-lg text-slate-600 dark:text-slate-300 shadow-sm",children:a.jsx(We,{className:"w-5 h-5"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-bold text-slate-700 dark:text-slate-200 uppercase tracking-widest",children:e("datasource.append_data_title")}),a.jsx("p",{className:"text-xs text-slate-400",children:e("datasource.append_data_hint")})]})]}),a.jsx($a,{})]}),a.jsx("div",{className:"mb-6",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("select",{value:h,onChange:o=>N(o.target.value),className:"w-full md:w-1/2 p-2.5 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-200 outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",disabled:!0,children:e("datasource.select_target_table")}),Ce?.filter(o=>!ze(o)).map(o=>a.jsx("option",{value:o,children:o},o))]}),a.jsx("button",{onClick:()=>we(),className:"p-2.5 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-400 dark:text-slate-500 hover:text-blue-600 dark:hover:text-blue-400 rounded-lg",children:a.jsx(Rt,{className:"w-5 h-5"})})]})}),h&&a.jsx(Ia,{onImportComplete:s,config:sr},h)]})]}),g==="structure"&&a.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wider flex items-center gap-2",children:[a.jsx(De,{className:"w-4 h-4"})," ",e("datasource.user_tables")]}),a.jsx("p",{className:"text-xs text-slate-400 mt-1",children:e("datasource.user_tables_hint")})]}),!l&&a.jsxs("button",{onClick:()=>z(!0),className:"flex items-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs font-bold transition-colors shadow-sm",children:[a.jsx(Le,{className:"w-4 h-4"})," ",e("datasource.new_table")]})]}),le.length===0?a.jsx("div",{className:"p-8 text-center border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-xl bg-slate-50 dark:bg-slate-900/40",children:a.jsx("p",{className:"text-slate-400 dark:text-slate-500 text-sm",children:e("datasource.no_user_tables")})}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:le.map(o=>a.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-900/40 border border-slate-200 dark:border-slate-700 rounded-xl flex items-center justify-between group",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-white dark:bg-slate-800 rounded-lg shadow-sm text-blue-600 dark:text-blue-400",children:a.jsx(De,{className:"w-4 h-4"})}),a.jsxs("div",{className:"flex flex-col min-w-0",children:[a.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-200 truncate",children:o}),a.jsxs("span",{className:"text-[10px] text-slate-400 dark:text-slate-500",children:[e("datasource.table_meta_rows",{count:pt?.[o]?.rows??0}),"  ",e("datasource.table_meta_indexes",{count:pt?.[o]?.indexes??0})]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{N(o),u(!0)},className:"p-1.5 text-slate-400 dark:text-slate-500 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors",title:e("datasource.show_schema"),children:a.jsx(Je,{className:"w-4 h-4"})}),!l&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>{ir(o)},className:"p-1.5 text-slate-400 dark:text-slate-500 hover:text-indigo-600 dark:hover:text-indigo-400 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 rounded transition-colors",title:e("datasource.create_index_title","Index erstellen"),children:a.jsx(Dr,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>{N(o),k("import")},className:"p-1.5 text-slate-400 dark:text-slate-500 hover:text-green-600 dark:hover:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 rounded transition-colors",title:e("datasource.append_data_short"),children:a.jsx($e,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>ft(o),className:"p-1.5 text-slate-400 dark:text-slate-500 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:e("common.delete"),children:a.jsx(Pe,{className:"w-4 h-4"})})]})]})]},o))})]}),a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm",children:[a.jsx("div",{className:"flex items-center justify-between mb-6",children:a.jsxs("div",{children:[a.jsxs("h3",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wider flex items-center gap-2",children:[a.jsx(De,{className:"w-4 h-4"})," ",e("datasource.user_views","Views")]}),a.jsx("p",{className:"text-xs text-slate-400 mt-1",children:e("datasource.user_views_hint","SQL views available in the local database.")})]})}),de.length===0?a.jsx("div",{className:"p-8 text-center border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-xl bg-slate-50 dark:bg-slate-900/40",children:a.jsx("p",{className:"text-slate-400 dark:text-slate-500 text-sm",children:e("datasource.no_user_views","No views available.")})}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:de.map(o=>a.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-900/40 border border-slate-200 dark:border-slate-700 rounded-xl flex items-center justify-between group",children:[a.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[a.jsx("div",{className:"p-2 bg-white dark:bg-slate-800 rounded-lg shadow-sm text-indigo-600 dark:text-indigo-400",children:a.jsx(De,{className:"w-4 h-4"})}),a.jsxs("div",{className:"min-w-0",children:[a.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-200 block truncate",children:o.name}),ye?.[o.name]?.valid===!1?a.jsx("span",{className:"text-[10px] text-rose-500 block",title:ye?.[o.name]?.error,children:e("datasource.view_invalid","Defekter View")}):a.jsx("span",{className:"text-[10px] text-slate-400 dark:text-slate-500 block",children:e("datasource.table_meta_rows",{count:ye?.[o.name]?.rows??0})})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{N(o.name),u(!0)},disabled:ye?.[o.name]?.valid===!1,className:`p-1.5 rounded transition-colors ${ye?.[o.name]?.valid===!1?"text-slate-300 dark:text-slate-600 cursor-not-allowed":"text-slate-400 dark:text-slate-500 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20"}`,title:ye?.[o.name]?.valid===!1?e("datasource.view_invalid","Defekter View"):e("datasource.show_schema"),children:a.jsx(Je,{className:"w-4 h-4"})}),!l&&a.jsx("button",{onClick:()=>gt(o.name),className:"p-1.5 text-slate-400 dark:text-slate-500 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:e("datasource.drop_view_title","Delete view"),children:a.jsx(Pe,{className:"w-4 h-4"})})]})]},o.name))})]}),x&&a.jsxs("div",{className:"bg-slate-100 dark:bg-slate-800/50 rounded-2xl p-6",children:[a.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-4",children:e("datasource.system_tables")}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:tr.map(o=>a.jsx("button",{onClick:()=>{N(o),u(!0)},className:"px-3 py-2 bg-white/50 dark:bg-slate-800/60 border border-slate-200/50 dark:border-slate-700 rounded text-xs font-mono text-slate-500 dark:text-slate-400 hover:bg-white dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 text-left transition-colors",children:o},o))})]})]}),g==="system"&&a.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm",children:[a.jsx("h3",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wider mb-4",children:e("datasource.backup_restore")}),ge&&a.jsxs("div",{className:"mb-4 p-3 bg-amber-50 dark:bg-amber-900/20 text-amber-800 dark:text-amber-200 rounded-lg border border-amber-200 dark:border-amber-800/50 text-xs flex items-center gap-2",children:[a.jsx(et,{className:"w-4 h-4"}),a.jsx("span",{children:e("datasource.backup_recommended",{count:Oe})})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("button",{onClick:()=>Ut(!B),className:`flex-1 p-3 rounded-xl border flex items-center gap-3 transition-all ${B?"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-800 ring-1 ring-emerald-500/70 dark:ring-emerald-700/70":"bg-slate-50 dark:bg-slate-900/40 border-slate-200 dark:border-slate-700"}`,children:[a.jsx("div",{className:`p-2 rounded-lg ${B?"bg-emerald-100 dark:bg-emerald-900/40 text-emerald-600 dark:text-emerald-300":"bg-slate-200 dark:bg-slate-700 text-slate-500 dark:text-slate-300"}`,children:B?a.jsx(Pr,{className:"w-4 h-4"}):a.jsx(Sr,{className:"w-4 h-4"})}),a.jsxs("div",{className:"text-left",children:[a.jsx("div",{className:`text-sm font-bold ${B?"text-emerald-900 dark:text-emerald-200":"text-slate-600 dark:text-slate-200"}`,children:e(B?"datasource.encryption_active":"datasource.encryption_standard")}),a.jsx("div",{className:"text-xs text-slate-400 dark:text-slate-500",children:e(B?"datasource.encryption_active_hint":"datasource.encryption_standard_hint")})]})]})}),B&&a.jsx("div",{className:"animate-in fade-in slide-in-from-top-2",children:a.jsx("input",{type:"password",placeholder:e("datasource.backup_password_placeholder"),value:Xe,onChange:o=>it(o.target.value),className:"w-full p-3 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-emerald-500",autoFocus:!0})}),je&&a.jsx("div",{className:"mb-4",children:a.jsx(La,{type:je.type,title:je.title,message:je.message,details:je.details,onClose:()=>te(null)})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-2",children:[a.jsxs("button",{onClick:async()=>{try{if(B){const I=Xe.trim();if(!I){await T.warning(e("datasource.backup_password_required"));return}if(Ba(I)&&!await T.confirm(e("datasource.backup_password_weak_confirm")))return}const o=await hr(),m=new Uint8Array(o).buffer;let b=m;B&&(b=await br(m,Xe.trim()));const M=Ha(Kt,B);let D=!1;if(mt&&xt)try{D=await pr(b,M)}catch{D=!1}if(!D){const I=new Blob([b],{type:"application/x-sqlite3"}),J=URL.createObjectURL(I),ce=document.createElement("a");ce.href=J,ce.download=M,ce.click()}Re(),B&&it("");const K=fr(),Ie=D?K?e("datasource.backup_saved_location_named",{folder:K}):e("datasource.backup_saved_location_remembered","Remembered backup folder"):e("datasource.backup_saved_location_downloads","Browser download folder");await T.info(e("datasource.backup_saved_success_details",{fileName:M,location:Ie}))}catch(o){await T.error(`${e("datasource.backup_save_failed","Backup could not be created.")}: ${w(o)}`)}},className:`flex items-center justify-center gap-2 p-3 border rounded-lg text-sm font-bold transition-colors ${B?"bg-emerald-600 border-emerald-700 text-white hover:bg-emerald-700":"bg-slate-50 dark:bg-slate-900/40 border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800"}`,children:[a.jsx(We,{className:"w-4 h-4"}),e(B?"datasource.save_backup_secure":"datasource.save_backup_standard")]}),a.jsxs("button",{type:"button",onClick:()=>{Zt()},className:`flex items-center justify-center gap-2 p-3 border rounded-lg text-sm font-bold transition-colors ${B?"bg-emerald-600 border-emerald-700 text-white hover:bg-emerald-700":"bg-slate-50 dark:bg-slate-900/40 border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800"}`,children:[a.jsx($e,{className:"w-4 h-4 text-amber-500"})," ",e("datasource.restore_backup")]}),a.jsx("input",{ref:_e,type:"file",accept:".sqlite3,.sqlite,.db",className:"hidden",onChange:async o=>{const m=o.target.files?.[0];m&&(te(null),await ht(m),o.currentTarget.value="")}})]})]})]}),a.jsxs("div",{className:"bg-red-50/50 dark:bg-red-900/10 rounded-2xl border border-red-200 dark:border-red-900/50 p-6 shadow-sm",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 rounded-lg",children:a.jsx(et,{className:"w-5 h-5"})}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("h3",{className:"text-sm font-bold text-red-900 dark:text-red-400 uppercase tracking-wider leading-none",children:e("datasource.danger_zone")}),a.jsx("p",{className:"text-xs text-red-700/70 dark:text-red-300/60 mt-1",children:e("datasource.danger_zone_hint")})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-6",children:[a.jsxs("div",{className:"bg-white dark:bg-slate-900 border border-red-100 dark:border-red-900/20 rounded-xl p-4 shadow-sm",children:[a.jsx("h4",{className:"text-xs font-black text-slate-400 uppercase mb-3",children:e("datasource.clear_reset")}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("select",{id:"clear-table-select",className:"flex-1 p-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs outline-none",defaultValue:"",children:[a.jsx("option",{value:"",disabled:!0,children:e("datasource.select_target_table")}),(x?Ce:le)?.map(o=>a.jsx("option",{value:o,children:o},o))]}),a.jsx("button",{onClick:()=>{const o=document.getElementById("clear-table-select");o.value&&nr(o.value)},className:"px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded font-bold text-xs transition-colors",children:e("datasource.clear_btn")})]}),a.jsx("p",{className:"text-[10px] text-slate-400 italic",children:e("datasource.clear_reset_hint")})]})]}),a.jsxs("div",{className:"bg-white dark:bg-slate-900 border border-red-100 dark:border-red-900/20 rounded-xl p-4 shadow-sm",children:[a.jsx("h4",{className:"text-xs font-black text-slate-400 uppercase mb-3",children:e("datasource.drop_table_title")}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("select",{id:"drop-table-select",className:"flex-1 p-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs outline-none",defaultValue:"",children:[a.jsx("option",{value:"",disabled:!0,children:e("datasource.select_target_table")}),le.map(o=>a.jsx("option",{value:`table:${o}`,children:o},`tbl-${o}`)),de.map(o=>a.jsxs("option",{value:`view:${o.name}`,children:[o.name," (view)"]},`view-${o.name}`))]}),a.jsx("button",{onClick:()=>{const o=document.getElementById("drop-table-select");if(!o.value)return;const[m,b]=o.value.split(":");b&&(m==="view"?gt(b):ft(b))},disabled:le.length===0&&de.length===0,className:"px-3 py-2 bg-red-900 hover:bg-black text-white rounded font-bold text-xs transition-colors disabled:opacity-30 disabled:cursor-not-allowed",children:e("datasource.drop_btn")})]}),a.jsx("p",{className:"text-[10px] text-slate-400 italic",children:e("datasource.drop_table_hint")})]})]}),a.jsxs("div",{className:"bg-white dark:bg-slate-900 border border-red-100 dark:border-red-900/20 rounded-xl p-4 shadow-sm",children:[a.jsx("h4",{className:"text-xs font-black text-slate-400 uppercase mb-3",children:e("datasource.sql_manager_reset_title","SQL Manager reset")}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("button",{disabled:dt,onClick:()=>{or()},className:"flex items-center gap-2 px-4 py-2 bg-red-700 hover:bg-red-800 text-white rounded font-bold text-xs transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[dt&&a.jsx(Nt,{className:"w-4 h-4 animate-spin"}),e("datasource.sql_manager_reset_btn","Reset SQL Manager")]})}),a.jsx("p",{className:"text-[10px] text-slate-400 italic",children:e("datasource.sql_manager_reset_hint","Deletes all saved SQL statements in the SQL Manager, including favorites and usage counters.")})]})]}),a.jsxs("div",{className:"bg-white dark:bg-slate-900 border border-red-100 dark:border-red-900/20 rounded-xl p-4 shadow-sm md:col-span-2",children:[a.jsx("h4",{className:"text-xs font-black text-slate-400 uppercase mb-3",children:e("datasource.factory_reset_title","Werkseinstellungen")}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("button",{disabled:lt,onClick:async()=>{const o=e("datasource.factory_reset_confirm","Bist du sicher? Alle Daten (inkl. Tabellen, Views und Indizes), Dashboards, Widgets und lokale Einstellungen werden endgueltig geloescht. Dies kann nicht rueckgaengig gemacht werden!");if(await T.confirm(o)){const m=await T.prompt(e("datasource.factory_reset_prompt",'Bitte tippe "RESET" ein, um fortzufahren:'));if(m==="RESET")try{ct(!0),await gr(),Qa(),await T.info(e("datasource.factory_reset_success","Datenbank wurde auf Werkseinstellungen zurckgesetzt! Lade neu...")),Re(),sessionStorage.removeItem("litebistudio_datasource_tab"),r("/"),window.location.reload()}catch(b){ct(!1),await T.error(w(b))}else m!==null&&await T.warning(e("datasource.factory_reset_aborted","Abgebrochen: Falsche Eingabe."))}},className:"flex items-center gap-2 px-4 py-2 bg-red-900 hover:bg-black text-white rounded font-bold text-xs transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[lt&&a.jsx(Nt,{className:"w-4 h-4 animate-spin"}),e("datasource.factory_reset_btn","Komplett zurcksetzen")]})}),a.jsx("p",{className:"text-[10px] text-slate-400 italic",children:e("datasource.factory_reset_hint","Loescht die gesamte Datenbank inklusive Tabellen, Views und Indizes, setzt lokale Einstellungen zurueck und erstellt ein frisches, leeres Schema der neuesten Version.")})]})]})]})]})]})]}),a.jsx(Ge,{isOpen:S,onClose:()=>z(!1),title:e("datasource.create_table_title"),children:a.jsxs("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex gap-2 mb-4 bg-slate-100 p-1 rounded-lg w-fit",children:[a.jsx("button",{onClick:()=>U(!1),className:`px-3 py-1 text-xs font-bold rounded ${ie?"text-slate-500":"bg-white shadow text-blue-600"}`,children:e("datasource.assistant")}),a.jsx("button",{onClick:()=>U(!0),className:`px-3 py-1 text-xs font-bold rounded ${ie?"bg-white shadow text-blue-600":"text-slate-500"}`,children:"SQL"})]}),ie?a.jsx("textarea",{value:he,onChange:o=>fe(o.target.value),className:"w-full h-40 font-mono text-sm p-3 bg-slate-900 text-white rounded-lg"}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:e("datasource.name_label")}),a.jsx("input",{value:G,onChange:o=>ae(o.target.value),className:"w-full p-2 border rounded",placeholder:"usr_tabelle"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:e("datasource.columns_label")}),H.map((o,m)=>a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{value:o.name,onChange:b=>{const M=[...H];M[m].name=b.target.value,Z(M)},className:"flex-1 p-2 border rounded text-sm",placeholder:e("datasource.name_label")}),a.jsxs("select",{value:o.type,onChange:b=>{const M=[...H];M[m].type=b.target.value,Z(M)},className:"w-32 p-2 border rounded text-sm",children:[a.jsx("option",{value:"TEXT",children:"TEXT"}),a.jsx("option",{value:"INTEGER",children:"INTEGER"}),a.jsx("option",{value:"REAL",children:"REAL"}),a.jsx("option",{value:"INTEGER PRIMARY KEY",children:"ID (PK)"})]}),a.jsx("button",{onClick:()=>Z(H.filter((b,M)=>M!==m)),className:"text-red-500",children:a.jsx(Pe,{className:"w-4 h-4"})})]},m)),a.jsx("button",{onClick:()=>Z([...H,{name:"",type:"TEXT"}]),className:"text-xs text-blue-600 font-bold flex items-center gap-1",children:e("datasource.add_column")})]})]}),a.jsx("div",{className:"flex justify-end gap-2 pt-4",children:a.jsx("button",{onClick:ar,className:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-bold",children:e("datasource.create_btn")})})]})}),a.jsx(Ge,{isOpen:_,onClose:()=>u(!1),title:c?.title||h,children:c?a.jsx(Or,{schema:c}):a.jsx("div",{className:"p-4 text-center",children:e("datasource.schema_not_available")})}),a.jsx(Ge,{isOpen:d,onClose:()=>v(!1),title:e("datasource.create_index_title","Index erstellen"),children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"text-xs text-slate-500",children:[e("datasource.index_create_for_table","Tabelle"),": ",a.jsx("span",{className:"font-mono font-semibold text-slate-700",children:R})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:e("datasource.index_name","Indexname")}),a.jsx("input",{value:y,onChange:o=>C(o.target.value),className:"w-full p-2 border border-slate-200 rounded text-sm",placeholder:`idx_${R}_...`})]}),a.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-600",children:[a.jsx("input",{type:"checkbox",checked:X,onChange:()=>F(!X),className:"h-4 w-4"}),e("datasource.index_unique","Unique Index")]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:e("datasource.index_columns","Spalten")}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 max-h-48 overflow-auto border border-slate-200 rounded p-2 bg-slate-50",children:Qe.map(o=>a.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-700",children:[a.jsx("input",{type:"checkbox",checked:j.includes(o),onChange:()=>lr(o),className:"h-4 w-4"}),a.jsx("span",{className:"font-mono",children:o})]},o))})]}),j.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:e("datasource.index_order","Spaltenreihenfolge")}),a.jsx("div",{className:"space-y-1 border border-slate-200 rounded p-2 bg-white",children:j.map((o,m)=>a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsxs("span",{className:"font-mono text-slate-700",children:[m+1,". ",o]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{type:"button",onClick:()=>wt(o,"up"),disabled:m===0,className:"px-2 py-0.5 text-xs border border-slate-200 rounded disabled:opacity-40",children:""}),a.jsx("button",{type:"button",onClick:()=>wt(o,"down"),disabled:m===j.length-1,className:"px-2 py-0.5 text-xs border border-slate-200 rounded disabled:opacity-40",children:""})]})]},o))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:e("datasource.index_where_optional","WHERE (optional)")}),a.jsx("input",{value:ee,onChange:o=>xe(o.target.value),className:"w-full p-2 border border-slate-200 rounded text-sm font-mono",placeholder:"status = 'open'"})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[a.jsx("button",{onClick:()=>v(!1),className:"px-4 py-2 border border-slate-200 rounded-lg text-sm",children:e("common.cancel")}),a.jsx("button",{onClick:()=>{cr()},className:"px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-bold hover:bg-indigo-700",children:e("datasource.create_index_btn","Index erstellen")})]})]})})]})};export{rn as DatasourceView};
