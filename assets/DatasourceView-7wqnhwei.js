import{j as s,u as Be,a as ke,b as j,S as A,c as St,d as ur,e as qe,P as mr,f as hr,g as xr,s as br,h as pr,i as fr,M as Ue,k as gr,p as wr,l as yr,m as kr,n as yt}from"./index-dhaNcLTM.js";import{r as w,d as $e,u as vr}from"./vendor-react-D64xOC9_.js";import{r as Pt,u as Ot}from"./xlsx-BojT3SgY.js";import{y as Nr,z as jr,J as kt,K as Le,N as _r,m as Pe,O as Cr,Q as Tr,V as Rt,Y as Yt,X as Ze,Z as Qe,d as vt,_ as We,$ as De,D as Ae,u as Se,I as Je,T as et,a0 as Mr,a1 as Er,f as Dr,n as Sr,r as Nt}from"./vendor-icons-Du2dXQHa.js";import{S as Pr}from"./SchemaDocumentation-D4hlYnEY.js";import{u as Or}from"./useBackupStatus-CcINebD6.js";import"./vendor-pdf-FXkUb51H.js";import"./vendor-ui-BNe0Xlio.js";import"./vendor-charts-BtQqxQq4.js";const It=6048e5,Rr=864e5,Yr=6e4,Ir=36e5,qr=1e3,jt=Symbol.for("constructDateFrom");function F(a,e){return typeof a=="function"?a(e):a&&typeof a=="object"&&jt in a?a[jt](e):a instanceof Date?new a.constructor(e):new Date(e)}function q(a,e){return F(e||a,a)}function qt(a,e,t){const r=q(a,t?.in);return isNaN(e)?F(t?.in||a,NaN):(e&&r.setDate(r.getDate()+e),r)}let $r={};function Ne(){return $r}function ue(a,e){const t=Ne(),r=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,n=q(a,e?.in),i=n.getDay(),c=(i<r?7:0)+i-r;return n.setDate(n.getDate()-c),n.setHours(0,0,0,0),n}function ve(a,e){return ue(a,{...e,weekStartsOn:1})}function $t(a,e){const t=q(a,e?.in),r=t.getFullYear(),n=F(t,0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);const i=ve(n),c=F(t,0);c.setFullYear(r,0,4),c.setHours(0,0,0,0);const b=ve(c);return t.getTime()>=i.getTime()?r+1:t.getTime()>=b.getTime()?r:r-1}function Fe(a){const e=q(a),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+a-+t}function Lr(a,...e){const t=F.bind(null,e.find(r=>typeof r=="object"));return e.map(t)}function _t(a,e){const t=q(a,e?.in);return t.setHours(0,0,0,0),t}function Wr(a,e,t){const[r,n]=Lr(t?.in,a,e),i=_t(r),c=_t(n),b=+i-Fe(i),k=+c-Fe(c);return Math.round((b-k)/Rr)}function Ar(a,e){const t=$t(a,e),r=F(a,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),ve(r)}function Fr(a){return a instanceof Date||typeof a=="object"&&Object.prototype.toString.call(a)==="[object Date]"}function tt(a){return!(!Fr(a)&&typeof a!="number"||isNaN(+q(a)))}function Hr(a,e){const t=q(a,e?.in);return t.setFullYear(t.getFullYear(),0,1),t.setHours(0,0,0,0),t}const Br={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Qr=(a,e,t)=>{let r;const n=Br[a];return typeof n=="string"?r=n:e===1?r=n.one:r=n.other.replace("{{count}}",e.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+r:r+" ago":r};function ze(a){return(e={})=>{const t=e.width?String(e.width):a.defaultWidth;return a.formats[t]||a.formats[a.defaultWidth]}}const Vr={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Xr={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Gr={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Ur={date:ze({formats:Vr,defaultWidth:"full"}),time:ze({formats:Xr,defaultWidth:"full"}),dateTime:ze({formats:Gr,defaultWidth:"full"})},zr={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Kr=(a,e,t,r)=>zr[a];function Te(a){return(e,t)=>{const r=t?.context?String(t.context):"standalone";let n;if(r==="formatting"&&a.formattingValues){const c=a.defaultFormattingWidth||a.defaultWidth,b=t?.width?String(t.width):c;n=a.formattingValues[b]||a.formattingValues[c]}else{const c=a.defaultWidth,b=t?.width?String(t.width):a.defaultWidth;n=a.values[b]||a.values[c]}const i=a.argumentCallback?a.argumentCallback(e):e;return n[i]}}const Zr={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Jr={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},ea={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},ta={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},ra={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},aa={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},sa=(a,e)=>{const t=Number(a),r=t%100;if(r>20||r<10)switch(r%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},na={ordinalNumber:sa,era:Te({values:Zr,defaultWidth:"wide"}),quarter:Te({values:Jr,defaultWidth:"wide",argumentCallback:a=>a-1}),month:Te({values:ea,defaultWidth:"wide"}),day:Te({values:ta,defaultWidth:"wide"}),dayPeriod:Te({values:ra,defaultWidth:"wide",formattingValues:aa,defaultFormattingWidth:"wide"})};function Me(a){return(e,t={})=>{const r=t.width,n=r&&a.matchPatterns[r]||a.matchPatterns[a.defaultMatchWidth],i=e.match(n);if(!i)return null;const c=i[0],b=r&&a.parsePatterns[r]||a.parsePatterns[a.defaultParseWidth],k=Array.isArray(b)?ia(b,h=>h.test(c)):oa(b,h=>h.test(c));let g;g=a.valueCallback?a.valueCallback(k):k,g=t.valueCallback?t.valueCallback(g):g;const v=e.slice(c.length);return{value:g,rest:v}}}function oa(a,e){for(const t in a)if(Object.prototype.hasOwnProperty.call(a,t)&&e(a[t]))return t}function ia(a,e){for(let t=0;t<a.length;t++)if(e(a[t]))return t}function la(a){return(e,t={})=>{const r=e.match(a.matchPattern);if(!r)return null;const n=r[0],i=e.match(a.parsePattern);if(!i)return null;let c=a.valueCallback?a.valueCallback(i[0]):i[0];c=t.valueCallback?t.valueCallback(c):c;const b=e.slice(n.length);return{value:c,rest:b}}}const ca=/^(\d+)(th|st|nd|rd)?/i,da=/\d+/i,ua={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},ma={any:[/^b/i,/^(a|c)/i]},ha={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},xa={any:[/1/i,/2/i,/3/i,/4/i]},ba={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},pa={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},fa={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},ga={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},wa={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},ya={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},ka={ordinalNumber:la({matchPattern:ca,parsePattern:da,valueCallback:a=>parseInt(a,10)}),era:Me({matchPatterns:ua,defaultMatchWidth:"wide",parsePatterns:ma,defaultParseWidth:"any"}),quarter:Me({matchPatterns:ha,defaultMatchWidth:"wide",parsePatterns:xa,defaultParseWidth:"any",valueCallback:a=>a+1}),month:Me({matchPatterns:ba,defaultMatchWidth:"wide",parsePatterns:pa,defaultParseWidth:"any"}),day:Me({matchPatterns:fa,defaultMatchWidth:"wide",parsePatterns:ga,defaultParseWidth:"any"}),dayPeriod:Me({matchPatterns:wa,defaultMatchWidth:"any",parsePatterns:ya,defaultParseWidth:"any"})},Lt={code:"en-US",formatDistance:Qr,formatLong:Ur,formatRelative:Kr,localize:na,match:ka,options:{weekStartsOn:0,firstWeekContainsDate:1}};function va(a,e){const t=q(a,e?.in);return Wr(t,Hr(t))+1}function Wt(a,e){const t=q(a,e?.in),r=+ve(t)-+Ar(t);return Math.round(r/It)+1}function st(a,e){const t=q(a,e?.in),r=t.getFullYear(),n=Ne(),i=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,c=F(e?.in||a,0);c.setFullYear(r+1,0,i),c.setHours(0,0,0,0);const b=ue(c,e),k=F(e?.in||a,0);k.setFullYear(r,0,i),k.setHours(0,0,0,0);const g=ue(k,e);return+t>=+b?r+1:+t>=+g?r:r-1}function Na(a,e){const t=Ne(),r=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??t.firstWeekContainsDate??t.locale?.options?.firstWeekContainsDate??1,n=st(a,e),i=F(e?.in||a,0);return i.setFullYear(n,0,r),i.setHours(0,0,0,0),ue(i,e)}function At(a,e){const t=q(a,e?.in),r=+ue(t,e)-+Na(t,e);return Math.round(r/It)+1}function E(a,e){const t=a<0?"-":"",r=Math.abs(a).toString().padStart(e,"0");return t+r}const de={y(a,e){const t=a.getFullYear(),r=t>0?t:1-t;return E(e==="yy"?r%100:r,e.length)},M(a,e){const t=a.getMonth();return e==="M"?String(t+1):E(t+1,2)},d(a,e){return E(a.getDate(),e.length)},a(a,e){const t=a.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];default:return t==="am"?"a.m.":"p.m."}},h(a,e){return E(a.getHours()%12||12,e.length)},H(a,e){return E(a.getHours(),e.length)},m(a,e){return E(a.getMinutes(),e.length)},s(a,e){return E(a.getSeconds(),e.length)},S(a,e){const t=e.length,r=a.getMilliseconds(),n=Math.trunc(r*Math.pow(10,t-3));return E(n,e.length)}},ye={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Ct={G:function(a,e,t){const r=a.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(r,{width:"abbreviated"});case"GGGGG":return t.era(r,{width:"narrow"});default:return t.era(r,{width:"wide"})}},y:function(a,e,t){if(e==="yo"){const r=a.getFullYear(),n=r>0?r:1-r;return t.ordinalNumber(n,{unit:"year"})}return de.y(a,e)},Y:function(a,e,t,r){const n=st(a,r),i=n>0?n:1-n;if(e==="YY"){const c=i%100;return E(c,2)}return e==="Yo"?t.ordinalNumber(i,{unit:"year"}):E(i,e.length)},R:function(a,e){const t=$t(a);return E(t,e.length)},u:function(a,e){const t=a.getFullYear();return E(t,e.length)},Q:function(a,e,t){const r=Math.ceil((a.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return E(r,2);case"Qo":return t.ordinalNumber(r,{unit:"quarter"});case"QQQ":return t.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(r,{width:"narrow",context:"formatting"});default:return t.quarter(r,{width:"wide",context:"formatting"})}},q:function(a,e,t){const r=Math.ceil((a.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return E(r,2);case"qo":return t.ordinalNumber(r,{unit:"quarter"});case"qqq":return t.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(r,{width:"narrow",context:"standalone"});default:return t.quarter(r,{width:"wide",context:"standalone"})}},M:function(a,e,t){const r=a.getMonth();switch(e){case"M":case"MM":return de.M(a,e);case"Mo":return t.ordinalNumber(r+1,{unit:"month"});case"MMM":return t.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(r,{width:"narrow",context:"formatting"});default:return t.month(r,{width:"wide",context:"formatting"})}},L:function(a,e,t){const r=a.getMonth();switch(e){case"L":return String(r+1);case"LL":return E(r+1,2);case"Lo":return t.ordinalNumber(r+1,{unit:"month"});case"LLL":return t.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(r,{width:"narrow",context:"standalone"});default:return t.month(r,{width:"wide",context:"standalone"})}},w:function(a,e,t,r){const n=At(a,r);return e==="wo"?t.ordinalNumber(n,{unit:"week"}):E(n,e.length)},I:function(a,e,t){const r=Wt(a);return e==="Io"?t.ordinalNumber(r,{unit:"week"}):E(r,e.length)},d:function(a,e,t){return e==="do"?t.ordinalNumber(a.getDate(),{unit:"date"}):de.d(a,e)},D:function(a,e,t){const r=va(a);return e==="Do"?t.ordinalNumber(r,{unit:"dayOfYear"}):E(r,e.length)},E:function(a,e,t){const r=a.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(r,{width:"short",context:"formatting"});default:return t.day(r,{width:"wide",context:"formatting"})}},e:function(a,e,t,r){const n=a.getDay(),i=(n-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return E(i,2);case"eo":return t.ordinalNumber(i,{unit:"day"});case"eee":return t.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(n,{width:"short",context:"formatting"});default:return t.day(n,{width:"wide",context:"formatting"})}},c:function(a,e,t,r){const n=a.getDay(),i=(n-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return E(i,e.length);case"co":return t.ordinalNumber(i,{unit:"day"});case"ccc":return t.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(n,{width:"narrow",context:"standalone"});case"cccccc":return t.day(n,{width:"short",context:"standalone"});default:return t.day(n,{width:"wide",context:"standalone"})}},i:function(a,e,t){const r=a.getDay(),n=r===0?7:r;switch(e){case"i":return String(n);case"ii":return E(n,e.length);case"io":return t.ordinalNumber(n,{unit:"day"});case"iii":return t.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(r,{width:"short",context:"formatting"});default:return t.day(r,{width:"wide",context:"formatting"})}},a:function(a,e,t){const n=a.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(n,{width:"narrow",context:"formatting"});default:return t.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(a,e,t){const r=a.getHours();let n;switch(r===12?n=ye.noon:r===0?n=ye.midnight:n=r/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(n,{width:"narrow",context:"formatting"});default:return t.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(a,e,t){const r=a.getHours();let n;switch(r>=17?n=ye.evening:r>=12?n=ye.afternoon:r>=4?n=ye.morning:n=ye.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(n,{width:"narrow",context:"formatting"});default:return t.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(a,e,t){if(e==="ho"){let r=a.getHours()%12;return r===0&&(r=12),t.ordinalNumber(r,{unit:"hour"})}return de.h(a,e)},H:function(a,e,t){return e==="Ho"?t.ordinalNumber(a.getHours(),{unit:"hour"}):de.H(a,e)},K:function(a,e,t){const r=a.getHours()%12;return e==="Ko"?t.ordinalNumber(r,{unit:"hour"}):E(r,e.length)},k:function(a,e,t){let r=a.getHours();return r===0&&(r=24),e==="ko"?t.ordinalNumber(r,{unit:"hour"}):E(r,e.length)},m:function(a,e,t){return e==="mo"?t.ordinalNumber(a.getMinutes(),{unit:"minute"}):de.m(a,e)},s:function(a,e,t){return e==="so"?t.ordinalNumber(a.getSeconds(),{unit:"second"}):de.s(a,e)},S:function(a,e){return de.S(a,e)},X:function(a,e,t){const r=a.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return Mt(r);case"XXXX":case"XX":return be(r);default:return be(r,":")}},x:function(a,e,t){const r=a.getTimezoneOffset();switch(e){case"x":return Mt(r);case"xxxx":case"xx":return be(r);default:return be(r,":")}},O:function(a,e,t){const r=a.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+Tt(r,":");default:return"GMT"+be(r,":")}},z:function(a,e,t){const r=a.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+Tt(r,":");default:return"GMT"+be(r,":")}},t:function(a,e,t){const r=Math.trunc(+a/1e3);return E(r,e.length)},T:function(a,e,t){return E(+a,e.length)}};function Tt(a,e=""){const t=a>0?"-":"+",r=Math.abs(a),n=Math.trunc(r/60),i=r%60;return i===0?t+String(n):t+String(n)+e+E(i,2)}function Mt(a,e){return a%60===0?(a>0?"-":"+")+E(Math.abs(a)/60,2):be(a,e)}function be(a,e=""){const t=a>0?"-":"+",r=Math.abs(a),n=E(Math.trunc(r/60),2),i=E(r%60,2);return t+n+e+i}const Et=(a,e)=>{switch(a){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});default:return e.date({width:"full"})}},Ft=(a,e)=>{switch(a){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});default:return e.time({width:"full"})}},ja=(a,e)=>{const t=a.match(/(P+)(p+)?/)||[],r=t[1],n=t[2];if(!n)return Et(a,e);let i;switch(r){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",Et(r,e)).replace("{{time}}",Ft(n,e))},rt={p:Ft,P:ja},_a=/^D+$/,Ca=/^Y+$/,Ta=["D","DD","YY","YYYY"];function Ht(a){return _a.test(a)}function Bt(a){return Ca.test(a)}function at(a,e,t){const r=Ma(a,e,t);if(console.warn(r),Ta.includes(a))throw new RangeError(r)}function Ma(a,e,t){const r=a[0]==="Y"?"years":"days of the month";return`Use \`${a.toLowerCase()}\` instead of \`${a}\` (in \`${e}\`) for formatting ${r} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Ea=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Da=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Sa=/^'([^]*?)'?$/,Pa=/''/g,Oa=/[a-zA-Z]/;function Ke(a,e,t){const r=Ne(),n=r.locale??Lt,i=r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,c=r.weekStartsOn??r.locale?.options?.weekStartsOn??0,b=q(a,t?.in);if(!tt(b))throw new RangeError("Invalid time value");let k=e.match(Da).map(v=>{const h=v[0];if(h==="p"||h==="P"){const N=rt[h];return N(v,n.formatLong)}return v}).join("").match(Ea).map(v=>{if(v==="''")return{isToken:!1,value:"'"};const h=v[0];if(h==="'")return{isToken:!1,value:Ra(v)};if(Ct[h])return{isToken:!0,value:v};if(h.match(Oa))throw new RangeError("Format string contains an unescaped latin alphabet character `"+h+"`");return{isToken:!1,value:v}});n.localize.preprocessor&&(k=n.localize.preprocessor(b,k));const g={firstWeekContainsDate:i,weekStartsOn:c,locale:n};return k.map(v=>{if(!v.isToken)return v.value;const h=v.value;(Bt(h)||Ht(h))&&at(h,e,String(a));const N=Ct[h[0]];return N(b,h,n.localize,g)}).join("")}function Ra(a){const e=a.match(Sa);return e?e[1].replace(Pa,"'"):a}function Ya(){return Object.assign({},Ne())}function Ia(a,e){const t=q(a,e?.in).getDay();return t===0?7:t}function qa(a,e){const t=$a(e)?new e(0):F(e,0);return t.setFullYear(a.getFullYear(),a.getMonth(),a.getDate()),t.setHours(a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()),t}function $a(a){return typeof a=="function"&&a.prototype?.constructor===a}const La=10;class Qt{subPriority=0;validate(e,t){return!0}}class Wa extends Qt{constructor(e,t,r,n,i){super(),this.value=e,this.validateValue=t,this.setValue=r,this.priority=n,i&&(this.subPriority=i)}validate(e,t){return this.validateValue(e,this.value,t)}set(e,t,r){return this.setValue(e,t,this.value,r)}}class Aa extends Qt{priority=La;subPriority=-1;constructor(e,t){super(),this.context=e||(r=>F(t,r))}set(e,t){return t.timestampIsSet?e:F(e,qa(e,this.context))}}class T{run(e,t,r,n){const i=this.parse(e,t,r,n);return i?{setter:new Wa(i.value,this.validate,this.set,this.priority,this.subPriority),rest:i.rest}:null}validate(e,t,r){return!0}}class Fa extends T{priority=140;parse(e,t,r){switch(t){case"G":case"GG":case"GGG":return r.era(e,{width:"abbreviated"})||r.era(e,{width:"narrow"});case"GGGGG":return r.era(e,{width:"narrow"});default:return r.era(e,{width:"wide"})||r.era(e,{width:"abbreviated"})||r.era(e,{width:"narrow"})}}set(e,t,r){return t.era=r,e.setFullYear(r,0,1),e.setHours(0,0,0,0),e}incompatibleTokens=["R","u","t","T"]}const Y={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},se={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function I(a,e){return a&&{value:e(a.value),rest:a.rest}}function O(a,e){const t=e.match(a);return t?{value:parseInt(t[0],10),rest:e.slice(t[0].length)}:null}function ne(a,e){const t=e.match(a);if(!t)return null;if(t[0]==="Z")return{value:0,rest:e.slice(1)};const r=t[1]==="+"?1:-1,n=t[2]?parseInt(t[2],10):0,i=t[3]?parseInt(t[3],10):0,c=t[5]?parseInt(t[5],10):0;return{value:r*(n*Ir+i*Yr+c*qr),rest:e.slice(t[0].length)}}function Vt(a){return O(Y.anyDigitsSigned,a)}function R(a,e){switch(a){case 1:return O(Y.singleDigit,e);case 2:return O(Y.twoDigits,e);case 3:return O(Y.threeDigits,e);case 4:return O(Y.fourDigits,e);default:return O(new RegExp("^\\d{1,"+a+"}"),e)}}function He(a,e){switch(a){case 1:return O(Y.singleDigitSigned,e);case 2:return O(Y.twoDigitsSigned,e);case 3:return O(Y.threeDigitsSigned,e);case 4:return O(Y.fourDigitsSigned,e);default:return O(new RegExp("^-?\\d{1,"+a+"}"),e)}}function nt(a){switch(a){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;default:return 0}}function Xt(a,e){const t=e>0,r=t?e:1-e;let n;if(r<=50)n=a||100;else{const i=r+50,c=Math.trunc(i/100)*100,b=a>=i%100;n=a+c-(b?100:0)}return t?n:1-n}function Gt(a){return a%400===0||a%4===0&&a%100!==0}class Ha extends T{priority=130;incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"];parse(e,t,r){const n=i=>({year:i,isTwoDigitYear:t==="yy"});switch(t){case"y":return I(R(4,e),n);case"yo":return I(r.ordinalNumber(e,{unit:"year"}),n);default:return I(R(t.length,e),n)}}validate(e,t){return t.isTwoDigitYear||t.year>0}set(e,t,r){const n=e.getFullYear();if(r.isTwoDigitYear){const c=Xt(r.year,n);return e.setFullYear(c,0,1),e.setHours(0,0,0,0),e}const i=!("era"in t)||t.era===1?r.year:1-r.year;return e.setFullYear(i,0,1),e.setHours(0,0,0,0),e}}class Ba extends T{priority=130;parse(e,t,r){const n=i=>({year:i,isTwoDigitYear:t==="YY"});switch(t){case"Y":return I(R(4,e),n);case"Yo":return I(r.ordinalNumber(e,{unit:"year"}),n);default:return I(R(t.length,e),n)}}validate(e,t){return t.isTwoDigitYear||t.year>0}set(e,t,r,n){const i=st(e,n);if(r.isTwoDigitYear){const b=Xt(r.year,i);return e.setFullYear(b,0,n.firstWeekContainsDate),e.setHours(0,0,0,0),ue(e,n)}const c=!("era"in t)||t.era===1?r.year:1-r.year;return e.setFullYear(c,0,n.firstWeekContainsDate),e.setHours(0,0,0,0),ue(e,n)}incompatibleTokens=["y","R","u","Q","q","M","L","I","d","D","i","t","T"]}class Qa extends T{priority=130;parse(e,t){return He(t==="R"?4:t.length,e)}set(e,t,r){const n=F(e,0);return n.setFullYear(r,0,4),n.setHours(0,0,0,0),ve(n)}incompatibleTokens=["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]}class Va extends T{priority=130;parse(e,t){return He(t==="u"?4:t.length,e)}set(e,t,r){return e.setFullYear(r,0,1),e.setHours(0,0,0,0),e}incompatibleTokens=["G","y","Y","R","w","I","i","e","c","t","T"]}class Xa extends T{priority=120;parse(e,t,r){switch(t){case"Q":case"QQ":return R(t.length,e);case"Qo":return r.ordinalNumber(e,{unit:"quarter"});case"QQQ":return r.quarter(e,{width:"abbreviated",context:"formatting"})||r.quarter(e,{width:"narrow",context:"formatting"});case"QQQQQ":return r.quarter(e,{width:"narrow",context:"formatting"});default:return r.quarter(e,{width:"wide",context:"formatting"})||r.quarter(e,{width:"abbreviated",context:"formatting"})||r.quarter(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=1&&t<=4}set(e,t,r){return e.setMonth((r-1)*3,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]}class Ga extends T{priority=120;parse(e,t,r){switch(t){case"q":case"qq":return R(t.length,e);case"qo":return r.ordinalNumber(e,{unit:"quarter"});case"qqq":return r.quarter(e,{width:"abbreviated",context:"standalone"})||r.quarter(e,{width:"narrow",context:"standalone"});case"qqqqq":return r.quarter(e,{width:"narrow",context:"standalone"});default:return r.quarter(e,{width:"wide",context:"standalone"})||r.quarter(e,{width:"abbreviated",context:"standalone"})||r.quarter(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=1&&t<=4}set(e,t,r){return e.setMonth((r-1)*3,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]}class Ua extends T{incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"];priority=110;parse(e,t,r){const n=i=>i-1;switch(t){case"M":return I(O(Y.month,e),n);case"MM":return I(R(2,e),n);case"Mo":return I(r.ordinalNumber(e,{unit:"month"}),n);case"MMM":return r.month(e,{width:"abbreviated",context:"formatting"})||r.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return r.month(e,{width:"narrow",context:"formatting"});default:return r.month(e,{width:"wide",context:"formatting"})||r.month(e,{width:"abbreviated",context:"formatting"})||r.month(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=11}set(e,t,r){return e.setMonth(r,1),e.setHours(0,0,0,0),e}}class za extends T{priority=110;parse(e,t,r){const n=i=>i-1;switch(t){case"L":return I(O(Y.month,e),n);case"LL":return I(R(2,e),n);case"Lo":return I(r.ordinalNumber(e,{unit:"month"}),n);case"LLL":return r.month(e,{width:"abbreviated",context:"standalone"})||r.month(e,{width:"narrow",context:"standalone"});case"LLLLL":return r.month(e,{width:"narrow",context:"standalone"});default:return r.month(e,{width:"wide",context:"standalone"})||r.month(e,{width:"abbreviated",context:"standalone"})||r.month(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=0&&t<=11}set(e,t,r){return e.setMonth(r,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]}function Ka(a,e,t){const r=q(a,t?.in),n=At(r,t)-e;return r.setDate(r.getDate()-n*7),q(r,t?.in)}class Za extends T{priority=100;parse(e,t,r){switch(t){case"w":return O(Y.week,e);case"wo":return r.ordinalNumber(e,{unit:"week"});default:return R(t.length,e)}}validate(e,t){return t>=1&&t<=53}set(e,t,r,n){return ue(Ka(e,r,n),n)}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","i","t","T"]}function Ja(a,e,t){const r=q(a,t?.in),n=Wt(r,t)-e;return r.setDate(r.getDate()-n*7),r}class es extends T{priority=100;parse(e,t,r){switch(t){case"I":return O(Y.week,e);case"Io":return r.ordinalNumber(e,{unit:"week"});default:return R(t.length,e)}}validate(e,t){return t>=1&&t<=53}set(e,t,r){return ve(Ja(e,r))}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]}const ts=[31,28,31,30,31,30,31,31,30,31,30,31],rs=[31,29,31,30,31,30,31,31,30,31,30,31];class as extends T{priority=90;subPriority=1;parse(e,t,r){switch(t){case"d":return O(Y.date,e);case"do":return r.ordinalNumber(e,{unit:"date"});default:return R(t.length,e)}}validate(e,t){const r=e.getFullYear(),n=Gt(r),i=e.getMonth();return n?t>=1&&t<=rs[i]:t>=1&&t<=ts[i]}set(e,t,r){return e.setDate(r),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]}class ss extends T{priority=90;subpriority=1;parse(e,t,r){switch(t){case"D":case"DD":return O(Y.dayOfYear,e);case"Do":return r.ordinalNumber(e,{unit:"date"});default:return R(t.length,e)}}validate(e,t){const r=e.getFullYear();return Gt(r)?t>=1&&t<=366:t>=1&&t<=365}set(e,t,r){return e.setMonth(0,r),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]}function ot(a,e,t){const r=Ne(),n=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,i=q(a,t?.in),c=i.getDay(),k=(e%7+7)%7,g=7-n,v=e<0||e>6?e-(c+g)%7:(k+g)%7-(c+g)%7;return qt(i,v,t)}class ns extends T{priority=90;parse(e,t,r){switch(t){case"E":case"EE":case"EEE":return r.day(e,{width:"abbreviated",context:"formatting"})||r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"});case"EEEEE":return r.day(e,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"});default:return r.day(e,{width:"wide",context:"formatting"})||r.day(e,{width:"abbreviated",context:"formatting"})||r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=6}set(e,t,r,n){return e=ot(e,r,n),e.setHours(0,0,0,0),e}incompatibleTokens=["D","i","e","c","t","T"]}class os extends T{priority=90;parse(e,t,r,n){const i=c=>{const b=Math.floor((c-1)/7)*7;return(c+n.weekStartsOn+6)%7+b};switch(t){case"e":case"ee":return I(R(t.length,e),i);case"eo":return I(r.ordinalNumber(e,{unit:"day"}),i);case"eee":return r.day(e,{width:"abbreviated",context:"formatting"})||r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"});case"eeeee":return r.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"});default:return r.day(e,{width:"wide",context:"formatting"})||r.day(e,{width:"abbreviated",context:"formatting"})||r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=6}set(e,t,r,n){return e=ot(e,r,n),e.setHours(0,0,0,0),e}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]}class is extends T{priority=90;parse(e,t,r,n){const i=c=>{const b=Math.floor((c-1)/7)*7;return(c+n.weekStartsOn+6)%7+b};switch(t){case"c":case"cc":return I(R(t.length,e),i);case"co":return I(r.ordinalNumber(e,{unit:"day"}),i);case"ccc":return r.day(e,{width:"abbreviated",context:"standalone"})||r.day(e,{width:"short",context:"standalone"})||r.day(e,{width:"narrow",context:"standalone"});case"ccccc":return r.day(e,{width:"narrow",context:"standalone"});case"cccccc":return r.day(e,{width:"short",context:"standalone"})||r.day(e,{width:"narrow",context:"standalone"});default:return r.day(e,{width:"wide",context:"standalone"})||r.day(e,{width:"abbreviated",context:"standalone"})||r.day(e,{width:"short",context:"standalone"})||r.day(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=0&&t<=6}set(e,t,r,n){return e=ot(e,r,n),e.setHours(0,0,0,0),e}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]}function ls(a,e,t){const r=q(a,t?.in),n=Ia(r,t),i=e-n;return qt(r,i,t)}class cs extends T{priority=90;parse(e,t,r){const n=i=>i===0?7:i;switch(t){case"i":case"ii":return R(t.length,e);case"io":return r.ordinalNumber(e,{unit:"day"});case"iii":return I(r.day(e,{width:"abbreviated",context:"formatting"})||r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"}),n);case"iiiii":return I(r.day(e,{width:"narrow",context:"formatting"}),n);case"iiiiii":return I(r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"}),n);default:return I(r.day(e,{width:"wide",context:"formatting"})||r.day(e,{width:"abbreviated",context:"formatting"})||r.day(e,{width:"short",context:"formatting"})||r.day(e,{width:"narrow",context:"formatting"}),n)}}validate(e,t){return t>=1&&t<=7}set(e,t,r){return e=ls(e,r),e.setHours(0,0,0,0),e}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]}class ds extends T{priority=80;parse(e,t,r){switch(t){case"a":case"aa":case"aaa":return r.dayPeriod(e,{width:"abbreviated",context:"formatting"})||r.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaaa":return r.dayPeriod(e,{width:"narrow",context:"formatting"});default:return r.dayPeriod(e,{width:"wide",context:"formatting"})||r.dayPeriod(e,{width:"abbreviated",context:"formatting"})||r.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,r){return e.setHours(nt(r),0,0,0),e}incompatibleTokens=["b","B","H","k","t","T"]}class us extends T{priority=80;parse(e,t,r){switch(t){case"b":case"bb":case"bbb":return r.dayPeriod(e,{width:"abbreviated",context:"formatting"})||r.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbbb":return r.dayPeriod(e,{width:"narrow",context:"formatting"});default:return r.dayPeriod(e,{width:"wide",context:"formatting"})||r.dayPeriod(e,{width:"abbreviated",context:"formatting"})||r.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,r){return e.setHours(nt(r),0,0,0),e}incompatibleTokens=["a","B","H","k","t","T"]}class ms extends T{priority=80;parse(e,t,r){switch(t){case"B":case"BB":case"BBB":return r.dayPeriod(e,{width:"abbreviated",context:"formatting"})||r.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBBB":return r.dayPeriod(e,{width:"narrow",context:"formatting"});default:return r.dayPeriod(e,{width:"wide",context:"formatting"})||r.dayPeriod(e,{width:"abbreviated",context:"formatting"})||r.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,r){return e.setHours(nt(r),0,0,0),e}incompatibleTokens=["a","b","t","T"]}class hs extends T{priority=70;parse(e,t,r){switch(t){case"h":return O(Y.hour12h,e);case"ho":return r.ordinalNumber(e,{unit:"hour"});default:return R(t.length,e)}}validate(e,t){return t>=1&&t<=12}set(e,t,r){const n=e.getHours()>=12;return n&&r<12?e.setHours(r+12,0,0,0):!n&&r===12?e.setHours(0,0,0,0):e.setHours(r,0,0,0),e}incompatibleTokens=["H","K","k","t","T"]}class xs extends T{priority=70;parse(e,t,r){switch(t){case"H":return O(Y.hour23h,e);case"Ho":return r.ordinalNumber(e,{unit:"hour"});default:return R(t.length,e)}}validate(e,t){return t>=0&&t<=23}set(e,t,r){return e.setHours(r,0,0,0),e}incompatibleTokens=["a","b","h","K","k","t","T"]}class bs extends T{priority=70;parse(e,t,r){switch(t){case"K":return O(Y.hour11h,e);case"Ko":return r.ordinalNumber(e,{unit:"hour"});default:return R(t.length,e)}}validate(e,t){return t>=0&&t<=11}set(e,t,r){return e.getHours()>=12&&r<12?e.setHours(r+12,0,0,0):e.setHours(r,0,0,0),e}incompatibleTokens=["h","H","k","t","T"]}class ps extends T{priority=70;parse(e,t,r){switch(t){case"k":return O(Y.hour24h,e);case"ko":return r.ordinalNumber(e,{unit:"hour"});default:return R(t.length,e)}}validate(e,t){return t>=1&&t<=24}set(e,t,r){const n=r<=24?r%24:r;return e.setHours(n,0,0,0),e}incompatibleTokens=["a","b","h","H","K","t","T"]}class fs extends T{priority=60;parse(e,t,r){switch(t){case"m":return O(Y.minute,e);case"mo":return r.ordinalNumber(e,{unit:"minute"});default:return R(t.length,e)}}validate(e,t){return t>=0&&t<=59}set(e,t,r){return e.setMinutes(r,0,0),e}incompatibleTokens=["t","T"]}class gs extends T{priority=50;parse(e,t,r){switch(t){case"s":return O(Y.second,e);case"so":return r.ordinalNumber(e,{unit:"second"});default:return R(t.length,e)}}validate(e,t){return t>=0&&t<=59}set(e,t,r){return e.setSeconds(r,0),e}incompatibleTokens=["t","T"]}class ws extends T{priority=30;parse(e,t){const r=n=>Math.trunc(n*Math.pow(10,-t.length+3));return I(R(t.length,e),r)}set(e,t,r){return e.setMilliseconds(r),e}incompatibleTokens=["t","T"]}class ys extends T{priority=10;parse(e,t){switch(t){case"X":return ne(se.basicOptionalMinutes,e);case"XX":return ne(se.basic,e);case"XXXX":return ne(se.basicOptionalSeconds,e);case"XXXXX":return ne(se.extendedOptionalSeconds,e);default:return ne(se.extended,e)}}set(e,t,r){return t.timestampIsSet?e:F(e,e.getTime()-Fe(e)-r)}incompatibleTokens=["t","T","x"]}class ks extends T{priority=10;parse(e,t){switch(t){case"x":return ne(se.basicOptionalMinutes,e);case"xx":return ne(se.basic,e);case"xxxx":return ne(se.basicOptionalSeconds,e);case"xxxxx":return ne(se.extendedOptionalSeconds,e);default:return ne(se.extended,e)}}set(e,t,r){return t.timestampIsSet?e:F(e,e.getTime()-Fe(e)-r)}incompatibleTokens=["t","T","X"]}class vs extends T{priority=40;parse(e){return Vt(e)}set(e,t,r){return[F(e,r*1e3),{timestampIsSet:!0}]}incompatibleTokens="*"}class Ns extends T{priority=20;parse(e){return Vt(e)}set(e,t,r){return[F(e,r),{timestampIsSet:!0}]}incompatibleTokens="*"}const js={G:new Fa,y:new Ha,Y:new Ba,R:new Qa,u:new Va,Q:new Xa,q:new Ga,M:new Ua,L:new za,w:new Za,I:new es,d:new as,D:new ss,E:new ns,e:new os,c:new is,i:new cs,a:new ds,b:new us,B:new ms,h:new hs,H:new xs,K:new bs,k:new ps,m:new fs,s:new gs,S:new ws,X:new ys,x:new ks,t:new vs,T:new Ns},_s=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Cs=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ts=/^'([^]*?)'?$/,Ms=/''/g,Es=/\S/,Ds=/[a-zA-Z]/;function Dt(a,e,t,r){const n=()=>F(t,NaN),i=Ya(),c=i.locale??Lt,b=i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,k=i.weekStartsOn??i.locale?.options?.weekStartsOn??0;if(!e)return a?n():q(t,r?.in);const g={firstWeekContainsDate:b,weekStartsOn:k,locale:c},v=[new Aa(r?.in,t)],h=e.match(Cs).map(u=>{const l=u[0];if(l in rt){const f=rt[l];return f(u,c.formatLong)}return u}).join("").match(_s),N=[];for(let u of h){Bt(u)&&at(u,e,a),Ht(u)&&at(u,e,a);const l=u[0],f=js[l];if(f){const{incompatibleTokens:C}=f;if(Array.isArray(C)){const H=N.find($=>C.includes($.token)||$.token===l);if(H)throw new RangeError(`The format string mustn't contain \`${H.fullToken}\` and \`${u}\` at the same time`)}else if(f.incompatibleTokens==="*"&&N.length>0)throw new RangeError(`The format string mustn't contain \`${u}\` and any other token at the same time`);N.push({token:l,fullToken:u});const D=f.run(a,u,c.match,g);if(!D)return n();v.push(D.setter),a=D.rest}else{if(l.match(Ds))throw new RangeError("Format string contains an unescaped latin alphabet character `"+l+"`");if(u==="''"?u="'":l==="'"&&(u=Ss(u)),a.indexOf(u)===0)a=a.slice(u.length);else return n()}}if(a.length>0&&Es.test(a))return n();const d=v.map(u=>u.priority).sort((u,l)=>l-u).filter((u,l,f)=>f.indexOf(u)===l).map(u=>v.filter(l=>l.priority===u).sort((l,f)=>f.subPriority-l.subPriority)).map(u=>u[0]);let y=q(t,r?.in);if(isNaN(+y))return n();const x={};for(const u of d){if(!u.validate(y,g))return n();const l=u.set(y,x,g);Array.isArray(l)?(y=l[0],Object.assign(x,l[1])):y=l}return y}function Ss(a){return a.match(Ts)[1].replace(Ms,"'")}const Ut={Period:[{id:"MMM.YYYY",label:"MMM.YYYY (e.g. 001.2025)",description:"Converts 001.2025 to 2025-01",apply:a=>{if(typeof a!="string")return a;const e=a.match(/^(\d{3})\.(\d{4})$/);if(e){const t=parseInt(e[1],10);return`${e[2]}-${t.toString().padStart(2,"0")}`}return a}},{id:"YYYY-MM",label:"YYYY-MM (ISO)",description:"Standard ISO format",apply:a=>a},{id:"MM.YYYY",label:"MM.YYYY / MM-YYYY (e.g. 01.2025)",description:"Converts 01.2025 or 01-2025 to 2025-01",apply:a=>{if(typeof a!="string")return a;const e=String(a).trim().match(/^(\d{1,2})[.-](\d{4})$/);if(e){const t=parseInt(e[1],10);return`${e[2]}-${t.toString().padStart(2,"0")}`}return a}}],PostingDate:[{id:"DD.MM.YYYY",label:"DD.MM.YYYY",description:"German date format",apply:a=>{if(typeof a!="string"||a.match(/^\d{4}-\d{2}-\d{2}$/))return a;const e=Dt(a,"dd.MM.yyyy",new Date);return tt(e)?Ke(e,"yyyy-MM-dd"):a}},{id:"MM/DD/YYYY",label:"MM/DD/YYYY",description:"US date format",apply:a=>{if(typeof a!="string")return a;const e=Dt(a,"MM/dd/yyyy",new Date);return tt(e)?Ke(e,"yyyy-MM-dd"):a}},{id:"ExcelSerial",label:"Excel Serial Number",description:"Number like 45321",apply:a=>{const e=Number(a);if(!isNaN(e)&&e>2e4){const t=new Date((e-25569)*86400*1e3);return Ke(t,"yyyy-MM-dd")}return a}}],...["VendorName","VendorId","DocumentId","CostCenter","Category","SubCategory","Service","System","Description"].reduce((a,e)=>({...a,[e]:[{id:"Trim",label:"Trim Whitespace",description:"Removes leading and trailing spaces",apply:t=>String(t||"").trim()},{id:"UpperCase",label:"UPPER CASE",description:"Converts to uppercase",apply:t=>String(t||"").toUpperCase()},{id:"LowerCase",label:"lower case",description:"Converts to lowercase",apply:t=>String(t||"").toLowerCase()},{id:"TitleCase",label:"Title Case",description:"Capitalize First Letters",apply:t=>String(t||"").replace(/\w\S*/g,r=>r.charAt(0).toUpperCase()+r.substr(1).toLowerCase())}]}),{}),...["Amount","UnitPrice","Quantity"].reduce((a,e)=>({...a,[e]:[{id:"ParseDeCurrency",label:"German Currency (1.234,56)",description:"Parses 1.234,56 to 1234.56",apply:t=>{if(typeof t=="number")return t;if(!t)return 0;const r=String(t).replace(/\./g,"").replace(",","."),n=parseFloat(r);return isNaN(n)?0:n}},{id:"CleanNumber",label:"Clean Number (Remove Symbols)",description:"Keep only digits, dots and minus",apply:t=>{if(typeof t=="number")return t;const r=String(t).replace(/[^0-9.-]/g,""),n=parseFloat(r);return isNaN(n)?0:n}}]}),{})},Ps=(a,e,t)=>{const r=Ut[t];if(!r)return a;const n=r.find(i=>i.id===e);return n?n.apply(a):a},Os=({sourceColumns:a,targetSchema:e,onConfirm:t,onCancel:r,initialMapping:n})=>{const[i,c]=w.useState(n||{}),b=e.properties,k=e.required||[],g=Object.keys(b).map(d=>({key:d,description:b[d].description,required:k.includes(d)})),v=w.useCallback(()=>{const d={};g.forEach(y=>{const x=a.find(u=>u.toLowerCase()===y.key.toLowerCase()||u.toLowerCase().replace(/[^a-z0-9]/g,"")===y.key.toLowerCase().replace(/[^a-z0-9]/g,""));x&&(d[y.key]={sourceColumn:x,operation:"direct"})}),c(y=>({...y,...d}))},[a,g]);w.useEffect(()=>{if(n&&Object.keys(n).length>0)return;const d=window.setTimeout(()=>{v()},0);return()=>window.clearTimeout(d)},[v,n]);const h=g.filter(d=>d.required).every(d=>{const y=i[d.key];return y?y.sourceColumn==="__CONSTANT__"?!!y.constantValue:y.operation==="concat"&&!y.secondaryColumn?!1:!!y.sourceColumn:!1}),N=()=>g.filter(d=>{if(!d.required)return!1;const y=i[d.key];return y?y.sourceColumn==="__CONSTANT__"?!y.constantValue:y.operation==="concat"&&!y.secondaryColumn?!0:!y.sourceColumn:!0}).length;return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 animate-in fade-in duration-200",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col",children:[s.jsxs("div",{className:"p-4 sm:p-6 border-b border-slate-200 dark:border-slate-700 flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Map Columns & Transforms"}),s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Match columns and apply necessary format conversions."})]}),s.jsxs("button",{onClick:v,className:"w-full sm:w-auto flex items-center justify-center gap-2 px-3 py-1.5 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium",children:[s.jsx(Nr,{className:"w-4 h-4"}),"Auto-Map"]})]}),s.jsxs("div",{className:"flex-1 overflow-auto p-4 sm:p-6",children:[s.jsxs("div",{className:"hidden lg:grid grid-cols-[1fr,auto,2fr,1fr] gap-4 items-start mb-2 px-4 text-xs font-bold text-slate-400 uppercase tracking-wider",children:[s.jsx("div",{children:"Required Field"}),s.jsx("div",{className:"w-8"}),s.jsx("div",{children:"Source Configuration"}),s.jsx("div",{children:"Transformation"})]}),s.jsx("div",{className:"space-y-3",children:g.map(d=>{const y=Ut[d.key]||[],x=i[d.key],u=x?.operation||"direct";return s.jsxs("div",{className:`
                                    grid grid-cols-1 lg:grid-cols-[1fr,auto,2fr,1fr] gap-3 lg:gap-4 items-start p-4 rounded-xl border transition-colors
                                    ${x?.sourceColumn?"bg-slate-50 dark:bg-slate-900/30 border-slate-200 dark:border-slate-700":d.required?"bg-red-50 dark:bg-red-900/10 border-red-200 dark:border-red-900/30":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 opacity-70 hover:opacity-100"}
                                `,children:[s.jsxs("div",{className:"mt-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`font-semibold ${d.required?"text-slate-900 dark:text-white":"text-slate-500 dark:text-slate-400"}`,children:d.key}),d.required&&s.jsx("span",{className:"text-[10px] bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 px-1.5 py-0.5 rounded font-bold uppercase",children:"Required"})]}),s.jsx("div",{className:"text-xs text-slate-500 mt-1 line-clamp-1",title:d.description,children:d.description})]}),s.jsx(jr,{className:`hidden lg:block w-4 h-4 mt-3 ${x?.sourceColumn?"text-blue-500":"text-slate-300"}`}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider lg:hidden",children:"Source Configuration"}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center min-h-10",children:[s.jsxs("select",{value:x?.sourceColumn||"",onChange:l=>{const f=l.target.value;c(C=>{const D={...C};if(f){let H=D[d.key]?.transformId;f==="__CONSTANT__"&&!H&&y.length>0&&(H=y[0].id),D[d.key]={sourceColumn:f,transformId:H,operation:"direct"}}else delete D[d.key];return D})},className:`
                                                    w-full sm:flex-1 h-10 px-3 rounded-lg border text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-all
                                                    ${x?.sourceColumn?"border-blue-200 bg-white dark:bg-slate-900 dark:border-blue-900/50":"border-slate-200 bg-slate-50 dark:bg-slate-800 dark:border-slate-600"}
                                                `,children:[s.jsx("option",{value:"",children:"-- Ignored --"}),s.jsx("option",{value:"__CONSTANT__",className:"font-bold text-blue-600",children:"-- Set Constant Value --"}),s.jsx("optgroup",{label:"Source Columns",children:a.map(l=>s.jsx("option",{value:l,children:l},l))})]}),x?.sourceColumn&&x.sourceColumn!=="__CONSTANT__"&&s.jsxs("div",{className:"flex h-10 sm:h-full w-full sm:w-auto bg-slate-100 dark:bg-slate-700 rounded-lg p-1 border border-slate-200 dark:border-slate-600 items-center flex-wrap sm:flex-nowrap",children:[s.jsx("button",{onClick:()=>c(l=>({...l,[d.key]:{...l[d.key],operation:"direct"}})),className:`h-full px-3 rounded-md text-xs font-bold transition-all flex items-center ${u==="direct"?"bg-white dark:bg-slate-600 shadow-sm text-slate-900 dark:text-white":"text-slate-500 hover:text-slate-700"}`,title:"Direct Mapping",children:"1:1"}),s.jsx("div",{className:"w-px h-4 bg-slate-200 dark:bg-slate-600 mx-0.5"}),s.jsx("button",{onClick:()=>c(l=>({...l,[d.key]:{...l[d.key],operation:"coalesce"}})),className:`h-full px-3 rounded-md text-xs font-bold transition-all flex items-center ${u==="coalesce"?"bg-white dark:bg-slate-600 shadow-sm text-slate-900 dark:text-white":"text-slate-500 hover:text-slate-700"}`,title:"Fallback if empty (Coalesce)",children:"Fallback"}),s.jsx("div",{className:"w-px h-4 bg-slate-200 dark:bg-slate-600 mx-0.5"}),s.jsx("button",{onClick:()=>c(l=>({...l,[d.key]:{...l[d.key],operation:"concat",separator:" "}})),className:`h-full px-3 rounded-md text-xs font-bold transition-all flex items-center ${u==="concat"?"bg-white dark:bg-slate-600 shadow-sm text-slate-900 dark:text-white":"text-slate-500 hover:text-slate-700"}`,title:"Combine Columns (Concat)",children:"Combine"})]})]}),u==="coalesce"&&s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 animate-in slide-in-from-top-2 min-h-10",children:[s.jsx(kt,{className:"w-4 h-4 text-slate-400 rotate-45"}),s.jsx("span",{className:"text-xs font-bold text-slate-400 shrink-0",children:"ELSE USE"}),s.jsxs("select",{value:x?.secondaryColumn||"",onChange:l=>c(f=>({...f,[d.key]:{...f[d.key],secondaryColumn:l.target.value}})),className:"w-full sm:flex-1 h-10 px-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"-- Select Fallback Column --"}),a.map(l=>s.jsx("option",{value:l,children:l},l))]})]}),u==="concat"&&s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 animate-in slide-in-from-top-2 min-h-10",children:[s.jsx(Le,{className:"w-4 h-4 text-slate-400"}),s.jsx("input",{type:"text",placeholder:"Separator (space)",value:x?.separator??" ",onChange:l=>c(f=>({...f,[d.key]:{...f[d.key],separator:l.target.value}})),className:"w-full sm:w-16 h-10 px-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-center text-sm",title:"Separator"}),s.jsx(Le,{className:"w-4 h-4 text-slate-400"}),s.jsxs("select",{value:x?.secondaryColumn||"",onChange:l=>c(f=>({...f,[d.key]:{...f[d.key],secondaryColumn:l.target.value}})),className:"w-full sm:flex-1 h-10 px-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"-- Select 2nd Column --"}),a.map(l=>s.jsx("option",{value:l,children:l},l))]})]}),x?.sourceColumn==="__CONSTANT__"&&s.jsx("div",{className:"relative animate-in fade-in zoom-in-95 h-10",children:s.jsx("input",{type:"text",placeholder:"Enter constant value...",value:x.constantValue||"",onChange:l=>{const f=l.target.value;c(C=>({...C,[d.key]:{...C[d.key],constantValue:f}}))},className:`
                                                        w-full h-full px-3 rounded-lg border text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-all
                                                        ${x.constantValue?"border-blue-200 bg-white dark:bg-slate-900 dark:border-blue-900/50":"border-red-300 ring-2 ring-red-100 bg-red-50"}
                                                    `})})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider lg:hidden mb-2",children:"Transformation"}),y.length>0&&(x?.sourceColumn||d.key==="Currency")&&s.jsxs("div",{className:"relative h-10",children:[s.jsx(_r,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"}),s.jsxs("select",{value:x?.transformId||"",onChange:l=>{const f=l.target.value;c(C=>({...C,[d.key]:{...C[d.key],transformId:f||void 0}}))},className:"w-full h-full pl-9 pr-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm focus:ring-2 focus:ring-blue-500 appearance-none",children:[s.jsx("option",{value:"",children:"No Transformation"}),y.map(l=>s.jsx("option",{value:l.id,children:l.label},l.id))]}),s.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:s.jsx(kt,{className:"w-3 h-3 text-slate-400"})})]})]})]},d.key)})})]}),s.jsxs("div",{className:"p-4 sm:p-6 border-t border-slate-200 dark:border-slate-700 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 bg-slate-50 dark:bg-slate-900/50 rounded-b-2xl",children:[s.jsx("button",{onClick:r,className:"px-4 py-2 text-slate-600 hover:text-slate-900 dark:text-slate-400 dark:hover:text-white font-medium transition-colors",children:"Cancel Import"}),s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4 w-full sm:w-auto",children:[!h&&s.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm font-medium",children:[s.jsx(Pe,{className:"w-4 h-4"}),N()," required fields missing"]}),s.jsxs("button",{onClick:()=>t(i),disabled:!h,className:`
                                w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-2.5 rounded-xl font-semibold shadow-lg transition-all transform
                                ${h?"bg-blue-600 hover:bg-blue-700 text-white shadow-blue-200 dark:shadow-none hover:-translate-y-0.5":"bg-slate-200 dark:bg-slate-700 text-slate-400 cursor-not-allowed"}
                            `,children:[s.jsx(Cr,{className:"w-4 h-4"}),"Confirm Mapping"]})]})]})]})})},Rs=({config:a,onImportComplete:e})=>{const{t}=Be(),[r,n]=w.useState(!1),[i,c]=w.useState(!1),[b,k]=w.useState(null),[g,v]=w.useState(null),[h]=ke("import_default_mode","append"),[N]=ke("import_auto_save_mappings",!0),[d,y]=w.useState(h),[x,u]=w.useState(!1),[l,f]=w.useState(null),[C,D]=w.useState([]),H=w.useRef(null),[$,Z]=ke("excel_mappings_v2",{});w.useEffect(()=>{y(h)},[h,a?.key]);const V=w.useCallback(()=>{if(!a?.schema||typeof a.schema!="object")return null;const S=a.schema;return!S.properties||typeof S.properties!="object"?null:{properties:S.properties,required:Array.isArray(S.required)?S.required:[]}},[a]),me=w.useCallback((S,B,Q)=>{const ae=Object.keys(Q.properties),oe=X=>X==null||X==="";return S.map(X=>{const xe={};return ae.forEach(pe=>{const L=B[pe];if(!L?.sourceColumn)return;let U;if(L.sourceColumn==="__CONSTANT__")U=L.constantValue??"";else{const fe=X[L.sourceColumn],Oe=L.secondaryColumn?X[L.secondaryColumn]:void 0;switch(L.operation){case"coalesce":U=oe(fe)?Oe:fe;break;case"concat":{U=[fe,Oe].filter(W=>!oe(W)).map(W=>String(W)).join(L.separator??" ");break}default:U=fe;break}}L.transformId&&(U=Ps(U,L.transformId,pe)),xe[pe]=U}),xe})},[]),J=w.useCallback(async S=>{if(a){if(S.length===0){k(t("datasource.excel_import.no_valid_data"));return}d==="overwrite"&&a.clearFn&&await a.clearFn(),await a.importFn(S),v(t("datasource.excel_import.success_msg",{count:S.length})),e&&e(),window.dispatchEvent(new Event("db-updated"))}},[a,d,e,t]),K=w.useCallback(async S=>{if(a){c(!0),k(null),v(null);try{const B=await S.arrayBuffer(),Q=Pt(B),ae=Q.SheetNames[0],oe=Q.Sheets[ae],X=Ot.sheet_to_json(oe);if(X.length===0){k(t("datasource.excel_import.no_data"));return}const xe=Object.keys(X[0]??{});if(V()){f(X),D(xe),u(!0);return}await J(X)}catch(B){const Q=B instanceof Error?B.message:String(B);k(t("datasource.excel_import.error_reading",{error:Q}))}finally{c(!1)}}},[a,J,V,t]),he=w.useCallback(async S=>{if(!a||!l)return;const B=V();if(B){u(!1),c(!0),k(null),v(null);try{const Q=me(l,S,B);N&&Z(ae=>({...ae,[a.key]:S})),await J(Q)}catch(Q){const ae=Q instanceof Error?Q.message:String(Q);k(t("datasource.excel_import.import_failed",{error:ae}))}finally{f(null),D([]),c(!1)}}},[me,N,a,J,V,l,Z,t]),Ve=w.useCallback(()=>{u(!1),f(null),D([])},[]),Xe=w.useCallback(S=>{S.preventDefault(),n(!1);const B=S.dataTransfer.files[0];B&&K(B)},[K]);return a?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-800 p-1 rounded-lg w-fit",children:[s.jsxs("button",{onClick:()=>y("append"),className:`px-3 py-1.5 text-xs font-bold rounded-md flex items-center gap-2 transition-all ${d==="append"?"bg-white dark:bg-slate-700 shadow text-blue-600 dark:text-blue-300":"text-slate-500 dark:text-slate-400"}`,children:[s.jsx(Tr,{className:"w-3.5 h-3.5"})," ",t("datasource.excel_import.append")]}),s.jsxs("button",{onClick:()=>y("overwrite"),className:`px-3 py-1.5 text-xs font-bold rounded-md flex items-center gap-2 transition-all ${d==="overwrite"?"bg-white dark:bg-slate-700 shadow text-red-600 dark:text-red-300":"text-slate-500 dark:text-slate-400"}`,children:[s.jsx(Rt,{className:"w-3.5 h-3.5"})," ",t("datasource.excel_import.overwrite")]})]}),s.jsxs("div",{onDragOver:S=>{S.preventDefault(),n(!0)},onDragLeave:()=>n(!1),onDrop:Xe,onClick:()=>H.current?.click(),className:`
                    relative group border-2 border-dashed rounded-2xl p-8 transition-all cursor-pointer text-center
                    ${r?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-slate-200 dark:border-slate-700 hover:border-slate-400 dark:hover:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-900/40"}
                    ${i?"opacity-50 pointer-events-none":""}
                `,children:[s.jsx("input",{type:"file",ref:H,onChange:S=>S.target.files?.[0]&&K(S.target.files[0]),accept:".xlsx,.xls,.csv",className:"hidden"}),s.jsxs("div",{className:"flex flex-col items-center gap-3",children:[s.jsx("div",{className:`p-3 rounded-xl transition-colors ${r?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-300":"bg-slate-100 dark:bg-slate-800 text-slate-400 dark:text-slate-500 group-hover:bg-slate-200 dark:group-hover:bg-slate-700 group-hover:text-slate-600 dark:group-hover:text-slate-300"}`,children:s.jsx(Yt,{className:"w-8 h-8"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-bold text-slate-700 dark:text-slate-200",children:t("datasource.smart_import.upload_label")}),s.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-1",children:t("datasource.excel_import.drop_hint")})]})]}),i&&s.jsx("div",{className:"absolute inset-0 bg-white/60 dark:bg-slate-900/60 flex items-center justify-center rounded-2xl backdrop-blur-[1px]",children:s.jsxs("div",{className:"flex items-center gap-3 text-blue-600 dark:text-blue-300",children:[s.jsx("div",{className:"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin"}),s.jsx("span",{className:"text-xs font-bold",children:t("datasource.excel_import.processing_file")})]})})]}),b&&s.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border-2 border-red-100 dark:border-red-800/50 rounded-2xl flex items-start gap-3 text-red-600 dark:text-red-300 text-xs animate-in slide-in-from-top-2 relative",children:[s.jsx(Pe,{className:"w-5 h-5 shrink-0 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-black uppercase tracking-widest text-[10px] mb-1",children:t("common.error")}),s.jsx("p",{className:"font-medium leading-relaxed",children:b})]}),s.jsx("button",{onClick:()=>k(null),className:"p-1 hover:bg-red-100 dark:hover:bg-red-900/40 rounded-lg transition-colors",children:s.jsx(Ze,{className:"w-4 h-4"})})]}),g&&s.jsxs("div",{className:"p-4 bg-emerald-50 dark:bg-emerald-900/20 border-2 border-emerald-100 dark:border-emerald-800/50 rounded-2xl flex items-start gap-3 text-emerald-600 dark:text-emerald-300 text-xs animate-in slide-in-from-top-2 relative",children:[s.jsx(Qe,{className:"w-5 h-5 shrink-0 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-black uppercase tracking-widest text-[10px] mb-1",children:t("common.success")}),s.jsx("p",{className:"font-medium leading-relaxed",children:g})]}),s.jsx("button",{onClick:()=>v(null),className:"p-1 hover:bg-emerald-100 dark:hover:bg-emerald-900/40 rounded-lg transition-colors",children:s.jsx(Ze,{className:"w-4 h-4"})})]}),x&&a&&V()&&s.jsx(Os,{sourceColumns:C,targetSchema:V(),initialMapping:$[a.key],onConfirm:S=>{he(S)},onCancel:Ve})]}):s.jsx("div",{className:"p-8 text-center bg-slate-50 dark:bg-slate-900/40 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-2xl",children:s.jsx("p",{className:"text-slate-400 dark:text-slate-500 text-sm",children:t("datasource.excel_import.none_selected")})})};async function Ys(a){return new Promise((e,t)=>{const r=new FileReader;r.onload=n=>{try{const i=new Uint8Array(n.target?.result),c=Pt(i,{type:"array",cellDates:!0}),b=[];for(const k of c.SheetNames){const g=c.Sheets[k],v=Ot.sheet_to_json(g,{header:1});if(!v||v.length<2)continue;const h=v[0].map(f=>String(f).trim()),N=v.slice(1);let d=k.toLowerCase().replace(/[^a-z0-9_]/g,"_").replace(/^_+|_+$/g,"").replace(/_+/g,"_"),y,x=!0;/^[a-z][a-z0-9_]*$/.test(d)||(/^[0-9]/.test(d)?d="tbl_"+d:d===""&&(d="tbl_unnamed")),d.startsWith("sys_")&&(x=!1,y="Tabellennamen drfen nicht mit 'sys_' beginnen (reserviert).");const u=h.map((f,C)=>{let D=!0,H=!0,$=!1;const Z=Math.min(N.length,100);for(let J=0;J<Z;J++){const K=N[J][C];if(K==null||K==="")continue;$=!0;const he=Number(K);if(isNaN(he)){D=!1,H=!1;break}Number.isInteger(he)||(D=!1)}let V="TEXT";return $&&(D?V="INTEGER":H&&(V="REAL")),{name:f.toLowerCase().replace(/[^a-z0-9_]/g,"_"),type:V}}),l=N.map(f=>{const C={};return u.forEach((D,H)=>{let $=f[H];$ instanceof Date?$=$.toISOString():typeof $=="object"&&$!==null&&($=JSON.stringify($)),C[D.name]=$}),C});b.push({sheetName:k,suggestedTableName:d,columns:u,rowCount:N.length,data:l,isValid:x,validationError:y})}e(b)}catch(i){t(i)}},r.onerror=n=>t(n),r.readAsArrayBuffer(a)})}const Is=()=>{const{t:a}=Be(),e=St("SmartImport"),[t,r]=w.useState(1),[n,i]=w.useState([]),[c,b]=w.useState({tables:0,records:0}),[k,g]=w.useState(!1),[v,h]=w.useState(!1),N=w.useRef(null),d=async x=>{const u=x.target.files?.[0];if(u){g(!0);try{const f=(await Ys(u)).map(C=>({sheetName:C.sheetName,tableName:C.suggestedTableName.startsWith("usr_")?C.suggestedTableName:`usr_${C.suggestedTableName}`,columns:C.columns,rows:C.data,isValid:C.isValid,error:C.validationError}));i(f),r(2)}catch(l){e.error("Analysis failed",l),await j.error(a("datasource.smart_import.error_analyzing"))}finally{g(!1)}}},y=async()=>{h(!0);let x=0,u=0;try{for(const l of n){if(!l.isValid)continue;const f=l.columns.map(D=>`"${D.name}" ${D.type}`).join(", ");await A.executeRaw(`CREATE TABLE IF NOT EXISTS "${l.tableName}" (${f});`);const C=500;for(let D=0;D<l.rows.length;D+=C)await A.bulkInsert(l.tableName,l.rows.slice(D,D+C));u++,x+=l.rows.length}b({tables:u,records:x}),r(4),i([]),window.dispatchEvent(new Event("db-updated"))}catch(l){const f=l instanceof Error?l.message:String(l);await j.error(a("common.error")+": "+f)}finally{h(!1)}};return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex items-center gap-4 px-2",children:[{s:1,label:a("datasource.smart_import.step_upload")},{s:2,label:a("datasource.smart_import.step_config")},{s:3,label:a("datasource.smart_import.step_import")}].concat(t===4?[{s:4,label:a("datasource.smart_import.step_success")}]:[]).map(({s:x,label:u})=>s.jsxs($e.Fragment,{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-black ${t>=x?"bg-blue-600 text-white":"bg-slate-200 text-slate-500"}`,children:x}),s.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${t>=x?"text-slate-700":"text-slate-400"}`,children:u})]}),x<(t===4?4:3)&&s.jsx(vt,{className:"w-4 h-4 text-slate-300"})]},x))}),s.jsxs("div",{className:"min-h-[200px]",children:[t===1&&s.jsxs("div",{onClick:()=>N.current?.click(),className:"group relative border-2 border-dashed border-slate-200 hover:border-blue-400 hover:bg-blue-50/50 rounded-2xl p-12 transition-all cursor-pointer text-center",children:[s.jsx("input",{type:"file",ref:N,onChange:d,accept:".xlsx,.xls,.csv",className:"hidden"}),s.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s.jsx("div",{className:"p-4 bg-blue-50 group-hover:bg-blue-100 rounded-2xl text-blue-600 transition-colors",children:s.jsx(We,{className:"w-8 h-8"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-bold text-slate-700",children:a("datasource.smart_import.upload_label")}),s.jsx("p",{className:"text-xs text-slate-400 mt-1",children:a("datasource.smart_import.upload_hint")})]})]}),k&&s.jsx("div",{className:"absolute inset-0 bg-white/80 flex items-center justify-center rounded-2xl z-10",children:s.jsxs("div",{className:"flex items-center gap-3 text-blue-600",children:[s.jsx("div",{className:"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin"}),s.jsx("span",{className:"text-xs font-bold",children:a("common.loading")})]})})]}),t===2&&s.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-2 duration-300",children:[s.jsx("div",{className:"flex items-center justify-between mb-2",children:s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-bold text-slate-700",children:a("datasource.smart_import.found_tables")}),s.jsx("p",{className:"text-[10px] text-slate-400",children:a("datasource.smart_import.found_tables_hint")})]})}),s.jsx("div",{className:"space-y-3",children:n.map((x,u)=>s.jsx("div",{className:`p-4 rounded-xl border-2 transition-all ${x.isValid?"bg-white border-slate-100 shadow-sm":"bg-red-50 border-red-100"}`,children:s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex-1 space-y-3",children:[s.jsx("div",{className:"flex items-center gap-4",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("span",{className:"text-[9px] font-black text-slate-400 uppercase",children:[a("datasource.smart_import.sheet_label")," ",x.sheetName]}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx(De,{className:"w-4 h-4 text-blue-500"}),s.jsx("input",{value:x.tableName,onChange:l=>{const f=[...n];f[u].tableName=l.target.value,f[u].isValid=l.target.value.length>0&&!l.target.value.startsWith("sys_"),i(f)},className:`text-sm font-bold bg-transparent border-b-2 outline-none w-full ${x.isValid?"border-blue-100 focus:border-blue-500":"border-red-300"}`,placeholder:a("datasource.smart_import.table_label")})]}),!x.isValid&&s.jsxs("p",{className:"text-[10px] text-red-500 mt-1 flex items-center gap-1",children:[s.jsx(Pe,{className:"w-3 h-3"})," ",a("datasource.smart_import.invalid_prefix")]})]})}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-slate-500",children:[s.jsx(Ae,{className:"w-3 h-3"}),a("datasource.smart_import.columns_count",{count:x.columns.length})]}),s.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-slate-500",children:[s.jsx(Yt,{className:"w-3 h-3"}),a("datasource.smart_import.rows_count",{count:x.rows.length})]})]}),s.jsxs("div",{className:"flex flex-wrap gap-1",children:[x.columns.slice(0,5).map(l=>s.jsxs("span",{className:"px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-[9px] font-medium",children:[l.name," ",s.jsxs("span",{className:"opacity-50 font-mono",children:["(",l.type,")"]})]},l.name)),x.columns.length>5&&s.jsx("span",{className:"px-2 py-0.5 bg-slate-100 text-slate-400 rounded text-[9px] font-medium",children:a("datasource.smart_import.more_columns",{count:x.columns.length-5})})]})]}),s.jsx("button",{onClick:()=>i(n.filter((l,f)=>f!==u)),className:"p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all",children:s.jsx(Se,{className:"w-4 h-4"})})]})},u))}),s.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100",children:[s.jsx("button",{onClick:()=>r(1),className:"px-4 py-2 text-slate-500 font-bold text-xs hover:bg-slate-100 rounded-lg transition-colors",children:a("datasource.smart_import.back_btn")}),s.jsxs("button",{onClick:()=>{r(3),y()},disabled:n.length===0||n.some(x=>!x.isValid)||v,className:"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 disabled:opacity-30 disabled:cursor-not-allowed text-white rounded-xl text-xs font-black shadow-lg shadow-blue-500/20 transition-all flex items-center gap-2",children:[a("datasource.smart_import.start_import")," ",s.jsx(vt,{className:"w-4 h-4"})]})]})]}),t===3&&s.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center space-y-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"w-16 h-16 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin"}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx(Ae,{className:"w-6 h-6 text-blue-600"})})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-bold text-slate-700",children:a("datasource.smart_import.import_running")}),s.jsx("p",{className:"text-xs text-slate-400 mt-1",children:a("common.loading")})]})]}),t===4&&s.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center space-y-6 animate-in zoom-in-95 duration-500",children:[s.jsx("div",{className:"w-20 h-20 bg-emerald-50 text-emerald-600 rounded-full flex items-center justify-center shadow-inner ring-8 ring-emerald-50/50",children:s.jsx(Qe,{className:"w-10 h-10"})}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"text-xl font-black text-slate-800 tracking-tight",children:a("datasource.smart_import.import_success_title")}),s.jsx("p",{className:"text-sm text-slate-500 max-w-[280px] leading-relaxed",children:a("datasource.smart_import.import_success_hint",{count:c.tables})})]}),s.jsxs("div",{className:"flex items-center gap-8 py-4 px-8 bg-slate-50 rounded-2xl border border-slate-100",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1",children:a("datasource.smart_import.found_tables")}),s.jsx("p",{className:"text-lg font-black text-slate-700",children:c.tables})]}),s.jsx("div",{className:"w-px h-8 bg-slate-200"}),s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1",children:a("datasource.smart_import.rows_count",{count:0}).replace("0","").trim()}),s.jsx("p",{className:"text-lg font-black text-slate-700",children:c.records})]})]}),s.jsx("button",{onClick:()=>r(1),className:"px-8 py-3 bg-slate-900 hover:bg-black text-white rounded-xl text-sm font-bold transition-all transform hover:scale-105 active:scale-95 shadow-xl shadow-slate-900/10",children:a("datasource.smart_import.finish_btn")})]})]})]})},qs=({type:a,title:e,message:t,details:r,onClose:n,className:i=""})=>{const b={success:{bg:"bg-emerald-50 dark:bg-emerald-900/20",border:"border-emerald-100 dark:border-emerald-800/50",text:"text-emerald-800 dark:text-emerald-200",icon:s.jsx(Qe,{className:"w-5 h-5 text-emerald-500"})},error:{bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-100 dark:border-red-800/50",text:"text-red-800 dark:text-red-200",icon:s.jsx(Pe,{className:"w-5 h-5 text-red-500"})},warning:{bg:"bg-amber-50 dark:bg-amber-900/20",border:"border-amber-100 dark:border-amber-800/50",text:"text-amber-800 dark:text-amber-200",icon:s.jsx(et,{className:"w-5 h-5 text-amber-500"})},info:{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-100 dark:border-blue-800/50",text:"text-blue-800 dark:text-blue-200",icon:s.jsx(Je,{className:"w-5 h-5 text-blue-500"})}}[a];return s.jsxs("div",{className:`p-4 rounded-2xl border-2 ${b.bg} ${b.border} flex items-start gap-4 animate-in slide-in-from-top-2 duration-300 ${i}`,children:[s.jsx("div",{className:"shrink-0 mt-0.5",children:b.icon}),s.jsxs("div",{className:"flex-1 min-w-0",children:[e&&s.jsx("h5",{className:`text-sm font-black uppercase tracking-wider mb-1 ${b.text}`,children:e}),s.jsx("p",{className:`text-sm font-medium leading-relaxed ${b.text}`,children:t}),r&&s.jsx("div",{className:"mt-3 p-3 bg-white/50 dark:bg-black/20 rounded-xl border border-white/50 dark:border-white/5",children:s.jsx("pre",{className:"text-[10px] font-mono whitespace-pre-wrap break-all opacity-80",children:r})})]}),n&&s.jsx("button",{onClick:n,className:"p-1 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg transition-colors shrink-0",children:s.jsx(Ze,{className:"w-4 h-4 opacity-50"})})]})},$s=()=>{const{t:a}=Be(),[e,t]=ke("excel_mappings_v2",{}),r=w.useRef(null),[n,i]=$e.useState(null),[c,b]=$e.useState(null),k=()=>{try{const N=JSON.stringify(e,null,2),d=new Blob([N],{type:"application/json"}),y=URL.createObjectURL(d),x=document.createElement("a");x.href=y,x.download=`itdashboard_mappings_${new Date().toISOString().split("T")[0]}.json`,x.click(),URL.revokeObjectURL(y),b("success"),i(a("common.success"))}catch(N){const d=N instanceof Error?N.message:String(N);b("error"),i(a("common.error")+": "+d)}},g=N=>{const d=N.target.files?.[0];if(!d)return;const y=new FileReader;y.onload=x=>{try{const u=JSON.parse(x.target?.result);if(typeof u!="object"||u===null)throw new Error("Invalid JSON");t(l=>({...l,...u})),b("success"),i(a("common.success"))}catch(u){const l=u instanceof Error?u.message:String(u);b("error"),i(a("common.error")+": "+l)}},y.readAsText(d),r.current&&(r.current.value="")},v=async()=>{await j.confirm(a("datasource.clear_mappings_confirm"))&&(t({}),b("success"),i(a("common.success")))};$e.useEffect(()=>{if(n){const N=setTimeout(()=>{i(null),b(null)},3e3);return()=>clearTimeout(N)}},[n]);const h=Object.keys(e).length;return s.jsxs("div",{className:"flex items-center gap-3",children:[n&&s.jsxs("div",{className:`text-xs px-2 py-1 rounded flex items-center gap-1.5 animate-in fade-in slide-in-from-right-4 ${c==="success"?"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-300":"bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-300"}`,children:[c==="success"?s.jsx(Qe,{className:"w-3 h-3"}):s.jsx(Pe,{className:"w-3 h-3"}),n]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-xs text-slate-400 mr-2",children:a("datasource.mappings_saved",{count:h})}),s.jsx("button",{onClick:k,disabled:h===0,className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-slate-700 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:a("datasource.export_mappings"),children:s.jsx(Mr,{className:"w-4 h-4"})}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"file",accept:".json",ref:r,onChange:g,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",title:a("datasource.import_mappings")}),s.jsx("button",{className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-slate-700 rounded transition-colors pointer-events-none",children:s.jsx(We,{className:"w-4 h-4"})})]}),s.jsx("div",{className:"w-px h-4 bg-slate-200 dark:bg-slate-700 mx-1"}),s.jsx("button",{onClick:v,disabled:h===0,className:"p-1.5 text-slate-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-slate-700 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:a("datasource.clear_mappings"),children:s.jsx(Se,{className:"w-4 h-4"})})]})]})},re=St("DatasourceView"),Ls=["litebistudio_","data_inspector_","query_builder_","data_table_","ui_table_","notifications_","import_"],Ws=new Set(["app_log_level","custom_dashboard_layout","excel_mappings_v2","i18nextLng","visibleComponentIds","visibleSidebarComponentIds","componentOrder","isSidebarCollapsed"]),As=["litebistudio_","data_inspector_","query_builder_"],Ee=a=>String(a).padStart(2,"0"),Fs=(a,e)=>{const t=new Date,r=`${t.getFullYear()}-${Ee(t.getMonth()+1)}-${Ee(t.getDate())}`,n=`${Ee(t.getHours())}${Ee(t.getMinutes())}${Ee(t.getSeconds())}`,i=`${r}_${n}`,c=e?"secure":"standard",g=(a||"backup_{date}_{mode}").trim().replace(/\{date\}/gi,r).replace(/\{time\}/gi,n).replace(/\{datetime\}/gi,i).replace(/\{mode\}/gi,c).replace(/[<>:"/\\|?*]/g,"_"),h=Array.from(g).map(N=>N.charCodeAt(0)<32?"_":N).join("").trim()||`backup_${r}_${c}`;return h.toLowerCase().endsWith(".sqlite3")?h:`${h}.sqlite3`},Hs=a=>{const e=a.trim();if(e.length<8)return!0;const t=/[a-z]/.test(e),r=/[A-Z]/.test(e),n=/\d/.test(e),i=/[^A-Za-z0-9]/.test(e);return Number(t)+Number(r)+Number(n)+Number(i)<3},Bs=()=>{const a=Object.keys(window.localStorage);for(const t of a)(Ws.has(t)||Ls.some(r=>t.startsWith(r)))&&window.localStorage.removeItem(t);const e=Object.keys(window.sessionStorage);for(const t of e)As.some(r=>t.startsWith(r))&&window.sessionStorage.removeItem(t)},tn=({onImportComplete:a})=>{const{t:e,i18n:t}=Be(),r=vr(),n=new Date,i=e("settings.last_update",{date:n.toLocaleDateString(t.language==="de"?"de-DE":"en-US"),time:n.toLocaleTimeString(t.language==="de"?"de-DE":"en-US",{hour:"2-digit",minute:"2-digit"})}),{isReadOnly:c,isAdminMode:b}=ur(),k=o=>o instanceof Error?o.message:String(o),[g,v]=w.useState(()=>{const o=sessionStorage.getItem("litebistudio_datasource_tab");return o==="import"||o==="structure"||o==="system"?o:"import"});w.useEffect(()=>{sessionStorage.setItem("litebistudio_datasource_tab",g)},[g]);const[h,N]=w.useState(""),[d,y]=w.useState(null),[x,u]=w.useState(!1),[l,f]=w.useState(!1),[C,D]=w.useState(""),[H,$]=w.useState(""),[Z,V]=w.useState([]),[me,J]=w.useState(!1),[K,he]=w.useState(""),[Ve,Xe]=w.useState([]),[S,B]=w.useState(!1),[Q,ae]=w.useState(""),[oe,X]=w.useState(!1),[xe,pe]=w.useState(`CREATE TABLE usr_my_table (
    id INTEGER PRIMARY KEY,
    name TEXT,
    amount REAL
);`),[L,U]=w.useState([{name:"id",type:"INTEGER PRIMARY KEY"}]),{isBackupRecommended:fe,changeCount:Oe,markBackupComplete:Re}=Or(),[W,zt]=w.useState(!1),[Ge,it]=w.useState(""),[je,ee]=w.useState(null),[lt,ct]=w.useState(!1),[dt,ut]=w.useState(!1),[Kt]=ke("backup_file_name_pattern","backup_{date}_{mode}"),[mt]=ke("backup_use_saved_location",!0),_e=w.useRef(null),ht=gr(),xt=async o=>{const m=()=>new Date().toLocaleTimeString();re.debug(`[Restore][${m()}] File selected:`,o.name,o.size,o.type);try{re.debug(`[Restore][${m()}] Calling file.arrayBuffer()...`);const p=await o.arrayBuffer();re.debug(`[Restore][${m()}] Buffer received, size:`,p.byteLength);const _=new Uint8Array(p.slice(0,16)),G=new TextDecoder().decode(_).startsWith("SQLite format 3");re.debug("[Restore] Header check - isSqlite:",G);let Ie=p;if(!G){const P=await j.prompt(e("datasource.restore_encrypted_prompt"));if(!P)return;try{Ie=await yr(p,P)}catch{ee({type:"error",title:e("common.error"),message:e("datasource.restore_failed")});return}}if(!await j.confirm(e("datasource.restore_confirm")))return;re.info(`[Restore][${m()}] User confirmed restore. Starting process...`),ee({type:"warning",title:e("common.loading"),message:"Verarbeite Backup-Datei..."});try{re.debug(`[Restore][${m()}] Calling worker importDatabase...`);const P=await kr(Ie);re.debug(`[Restore][${m()}] Worker report received:`,P);const{versionInfo:z}=P;if(!P.headerMatch){ee({type:"error",title:e("datasource.restore_invalid"),message:P.error||e("datasource.restore_warning_hint")});return}if(P.error){ee({type:"error",title:P.isDowngrade?"Incompatible Backup":e("common.error"),message:P.error,details:z?`Backup Version: V${z.backup} | App Version: V${z.current}`:void 0});return}if(P.isValid)ee({type:"success",title:e("common.success"),message:e("datasource.restore_success_reload"),details:z?`Database Version: V${z.backup} (Upgraded to V${z.current})`:void 0}),re.info(`[Restore][${m()}] Success! Reloading in 2s...`),Re(),setTimeout(()=>window.location.reload(),2e3);else{let le="";if(z&&(le+=`Schema: V${z.backup} -> V${z.current} (Update required)

`),P.missingTables.length>0&&(le+=e("datasource.restore_missing_tables")+`
- `+P.missingTables.join(`
- `)+`

`),Object.keys(P.missingColumns).length>0){le+=e("datasource.restore_missing_columns")+`
`;for(const[cr,dr]of Object.entries(P.missingColumns))le+=`- ${cr}: ${dr.join(", ")}
`}ee({type:"warning",title:e("datasource.restore_warning_title"),message:e("datasource.restore_warning_hint"),details:le})}}catch(P){re.error(`[Restore][${m()}] Inner Error:`,P),ee({type:"error",title:e("common.error"),message:k(P)})}}catch(p){re.error(`[Restore][${m()}] Outer Error:`,p),ee({type:"error",title:e("common.error"),message:k(p)})}},Zt=async()=>{if(ee(null),mt&&ht){const o=await wr();if(o.cancelled)return;if(o.file){await xt(o.file);return}_e.current&&_e.current.click();return}_e.current&&_e.current.click()},{data:Ce,refresh:ge}=qe(()=>A.getTables(),[]),{data:Jt,refresh:bt}=qe(()=>A.getDataSources(),[]),Ye=o=>o.startsWith("sys_")||o==="sqlite_sequence",ie=Ce?.filter(o=>!Ye(o))||[],er=Ce?.filter(o=>Ye(o))||[],ce=(Jt||[]).filter(o=>o.type==="view"&&!Ye(o.name)),{data:pt}=qe(async()=>{if(g!=="structure"||ie.length===0)return{};const o=await Promise.all(ie.map(async m=>{const[p,_]=await Promise.all([A.executeRaw(`SELECT COUNT(*) AS count FROM ${te(m)}`),A.executeRaw("SELECT COUNT(*) AS count FROM sqlite_master WHERE type='index' AND LOWER(tbl_name) = LOWER(?) AND name NOT LIKE 'sqlite_%'",[m])]);return[m,{rows:Number(p[0]?.count||0),indexes:Number(_[0]?.count||0)}]}));return Object.fromEntries(o)},[g,ie.join("|")],{cacheKey:`datasource-table-meta-${ie.join("|")}`,ttl:15e3}),{data:we}=qe(async()=>{if(g!=="structure"||ce.length===0)return{};const o=await Promise.all(ce.map(async m=>{try{const p=await A.executeRaw(`SELECT COUNT(*) AS count FROM ${te(m.name)}`);return[m.name,{valid:!0,rows:Number(p[0]?.count||0)}]}catch(p){return[m.name,{valid:!1,error:k(p)}]}}));return Object.fromEntries(o)},[g,ce.map(o=>o.name).join("|")],{cacheKey:`datasource-view-meta-${ce.map(o=>o.name).join("|")}`,ttl:15e3});w.useEffect(()=>{(async()=>{if(!h){y(null);return}try{const[m,p]=await Promise.all([A.getTableSchema(h),A.getTableIndexes(h)]),_={};m.forEach(M=>{_[M.name]={type:M.type.toUpperCase().includes("INT")||M.type.toUpperCase().includes("REAL")?"number":"string",description:M.type}}),y({title:h,description:e("datasource.records_label",{name:h}),properties:_,required:m.filter(M=>M.notnull).map(M=>M.name),indexes:p.map(M=>({name:M.name,unique:M.unique,columns:M.columns,origin:M.origin,partial:M.partial}))})}catch(m){re.error("Failed to load schema",m),y(null)}})()},[h,Ce,x,e]);const te=o=>`"${o.replace(/"/g,'""')}"`,tr=o=>/^[A-Za-z0-9_ (),]+$/.test(o.trim()),rr=(()=>{if(!(!h||!d))return{key:`import_${h}`,entityLabel:e("datasource.records_label",{name:h}),schema:d,validate:()=>!0,getValidationErrors:()=>[],importFn:async o=>{for(let p=0;p<o.length;p+=500)await A.bulkInsert(h,o.slice(p,p+500))},clearFn:async()=>{await A.executeRaw(`DELETE FROM ${te(h)}`)}}})(),ar=async()=>{try{if(oe)await A.executeRaw(xe);else{const o=Q.trim();if(!yt(o)){await j.warning(e("datasource.invalid_table_name","Ungueltiger Tabellenname. Bitte nur Buchstaben, Zahlen und Unterstrich verwenden."));return}if(!L.length){await j.warning(e("datasource.invalid_columns","Bitte mindestens eine gueltige Spalte angeben."));return}for(const _ of L){const M=_.name.trim(),G=_.type.trim();if(!yt(M)||!G||!tr(G)){await j.warning(e("datasource.invalid_columns","Bitte mindestens eine gueltige Spalte angeben."));return}}const m=L.map(_=>`${te(_.name.trim())} ${_.type.trim()}`).join(", "),p=`CREATE TABLE ${te(o)} (${m})`;await A.executeRaw(p)}B(!1),ge(),ae(""),U([{name:"id",type:"INTEGER PRIMARY KEY"}]),await j.info(e("datasource.table_created"))}catch(o){await j.error(e("common.error")+": "+k(o))}},ft=async o=>{if(!(localStorage.getItem("notifications_confirm_destructive")!=="false"&&!await j.confirm(e("datasource.drop_confirm",{name:o}))))try{await A.executeRaw(`DROP TABLE ${te(o)}`),ge(),bt(),h===o&&N("")}catch(p){await j.error(e("common.error")+": "+k(p))}},gt=async o=>{if(!(localStorage.getItem("notifications_confirm_destructive")!=="false"&&!await j.confirm(e("datasource.drop_view_confirm",`View "${o}" lschen?`,{name:o}))))try{await A.executeRaw(`DROP VIEW ${te(o)}`),ge(),bt(),h===o&&N("")}catch(p){await j.error(e("common.error")+": "+k(p))}},sr=async o=>{if(!(localStorage.getItem("notifications_confirm_destructive")!=="false"&&!await j.confirm(e("datasource.clear_confirm",{name:o}))))try{await A.executeRaw(`DELETE FROM ${te(o)}`),ge(),await j.info(e("datasource.cleared_success"))}catch(p){await j.error(e("common.error")+": "+k(p))}},nr=async()=>{const o=e("datasource.sql_manager_reset_confirm","Reset SQL Manager? All saved SQL statements and favorites will be deleted.");if(!await j.confirm(o))return;const m=await j.prompt(e("datasource.sql_manager_reset_prompt",'Please type "RESET" to continue:'));if(m!=="RESET"){m!==null&&await j.warning(e("datasource.sql_manager_reset_aborted","Canceled: Wrong input."));return}try{ut(!0),await A.executeRaw("DELETE FROM sys_sql_statement;"),await j.info(e("datasource.sql_manager_reset_success","SQL Manager was reset."))}catch(p){await j.error(e("common.error")+": "+k(p))}finally{ut(!1)}},or=async o=>{try{const p=(await A.getTableSchema(o)).map(_=>_.name).filter(Boolean);D(o),Xe(p),V([]),J(!1),he(""),$(`idx_${o}_`),f(!0)}catch(m){await j.error(e("common.error")+": "+k(m))}},ir=o=>{V(m=>m.includes(o)?m.filter(p=>p!==o):[...m,o])},wt=(o,m)=>{V(p=>{const _=p.indexOf(o);if(_===-1)return p;const M=m==="up"?_-1:_+1;if(M<0||M>=p.length)return p;const G=[...p];return[G[_],G[M]]=[G[M],G[_]],G})},lr=async()=>{const o=H.trim();if(!o){await j.warning(e("datasource.index_create_name_required","Bitte einen Indexnamen angeben."));return}if(Z.length===0){await j.warning(e("datasource.index_create_columns_required","Bitte mindestens eine Spalte auswhlen."));return}try{const m=me?"UNIQUE ":"",p=Z.map(te).join(", "),_=K.trim()?` WHERE ${K.trim()}`:"",M=`CREATE ${m}INDEX ${te(o)} ON ${te(C)} (${p})${_};`;await A.executeRaw(M),f(!1),await ge(),await j.info(e("datasource.index_create_success","Index erstellt."))}catch(m){await j.error(e("common.error")+": "+k(m))}};return s.jsxs(mr,{header:{title:e("sidebar.datasource"),subtitle:e("datasource.subtitle"),onBack:()=>r(-1)},footer:i,children:[s.jsxs("div",{className:`max-w-4xl space-y-6 ${c?"opacity-80":""}`,children:[s.jsx("div",{className:"border-b border-slate-200 dark:border-slate-700",children:s.jsxs("div",{className:"flex items-center gap-8 px-1",children:[s.jsxs("button",{onClick:()=>v("import"),className:`relative py-3 text-sm font-bold transition-colors ${g==="import"?"text-blue-600 dark:text-blue-400":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"}`,children:[e("datasource.tab_import"),g==="import"&&s.jsx("span",{className:"absolute left-0 right-0 -bottom-px h-0.5 bg-blue-600 dark:bg-blue-400"})]}),s.jsxs("button",{onClick:()=>v("structure"),className:`relative py-3 text-sm font-bold transition-colors ${g==="structure"?"text-blue-600 dark:text-blue-400":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"}`,children:[e("datasource.tab_structure"),g==="structure"&&s.jsx("span",{className:"absolute left-0 right-0 -bottom-px h-0.5 bg-blue-600 dark:bg-blue-400"})]}),s.jsxs("button",{onClick:()=>v("system"),className:`relative py-3 text-sm font-bold transition-colors ${g==="system"?"text-blue-600 dark:text-blue-400":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"}`,children:[e("datasource.tab_system"),g==="system"&&s.jsx("span",{className:"absolute left-0 right-0 -bottom-px h-0.5 bg-blue-600 dark:bg-blue-400"})]})]})}),g==="import"&&s.jsxs("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[s.jsxs("div",{className:`bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm ${c?"pointer-events-none opacity-60":""}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600",children:s.jsx(Le,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-bold text-slate-700 dark:text-slate-200 uppercase tracking-widest",children:e("datasource.smart_import_title")}),s.jsx("p",{className:"text-xs text-slate-400",children:e("datasource.smart_import_hint")})]})]}),s.jsx(Is,{})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"}),s.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase",children:e("datasource.or_separator")}),s.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"})]}),s.jsxs("div",{className:`bg-slate-50 dark:bg-slate-800/50 rounded-2xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm ${c?"pointer-events-none opacity-60":""}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-white dark:bg-slate-700 rounded-lg text-slate-600 dark:text-slate-300 shadow-sm",children:s.jsx(Ae,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-bold text-slate-700 dark:text-slate-200 uppercase tracking-widest",children:e("datasource.append_data_title")}),s.jsx("p",{className:"text-xs text-slate-400",children:e("datasource.append_data_hint")})]})]}),s.jsx($s,{})]}),s.jsx("div",{className:"mb-6",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("select",{value:h,onChange:o=>N(o.target.value),className:"w-full md:w-1/2 p-2.5 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-200 outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"",disabled:!0,children:e("datasource.select_target_table")}),Ce?.filter(o=>!Ye(o)).map(o=>s.jsx("option",{value:o,children:o},o))]}),s.jsx("button",{onClick:()=>ge(),className:"p-2.5 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-400 dark:text-slate-500 hover:text-blue-600 dark:hover:text-blue-400 rounded-lg",children:s.jsx(Rt,{className:"w-5 h-5"})})]})}),h&&s.jsx(Rs,{onImportComplete:a,config:rr},h)]})]}),g==="structure"&&s.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wider flex items-center gap-2",children:[s.jsx(De,{className:"w-4 h-4"})," ",e("datasource.user_tables")]}),s.jsx("p",{className:"text-xs text-slate-400 mt-1",children:e("datasource.user_tables_hint")})]}),!c&&s.jsxs("button",{onClick:()=>B(!0),className:"flex items-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs font-bold transition-colors shadow-sm",children:[s.jsx(Le,{className:"w-4 h-4"})," ",e("datasource.new_table")]})]}),ie.length===0?s.jsx("div",{className:"p-8 text-center border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-xl bg-slate-50 dark:bg-slate-900/40",children:s.jsx("p",{className:"text-slate-400 dark:text-slate-500 text-sm",children:e("datasource.no_user_tables")})}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:ie.map(o=>s.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-900/40 border border-slate-200 dark:border-slate-700 rounded-xl flex items-center justify-between group",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-white dark:bg-slate-800 rounded-lg shadow-sm text-blue-600 dark:text-blue-400",children:s.jsx(De,{className:"w-4 h-4"})}),s.jsxs("div",{className:"flex flex-col min-w-0",children:[s.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-200 truncate",children:o}),s.jsxs("span",{className:"text-[10px] text-slate-400 dark:text-slate-500",children:[e("datasource.table_meta_rows",{count:pt?.[o]?.rows??0}),"  ",e("datasource.table_meta_indexes",{count:pt?.[o]?.indexes??0})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{N(o),u(!0)},className:"p-1.5 text-slate-400 dark:text-slate-500 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors",title:e("datasource.show_schema"),children:s.jsx(Je,{className:"w-4 h-4"})}),!c&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>{or(o)},className:"p-1.5 text-slate-400 dark:text-slate-500 hover:text-indigo-600 dark:hover:text-indigo-400 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 rounded transition-colors",title:e("datasource.create_index_title","Index erstellen"),children:s.jsx(Er,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>{N(o),v("import")},className:"p-1.5 text-slate-400 dark:text-slate-500 hover:text-green-600 dark:hover:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 rounded transition-colors",title:e("datasource.append_data_short"),children:s.jsx(We,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>ft(o),className:"p-1.5 text-slate-400 dark:text-slate-500 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:e("common.delete"),children:s.jsx(Se,{className:"w-4 h-4"})})]})]})]},o))})]}),s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm",children:[s.jsx("div",{className:"flex items-center justify-between mb-6",children:s.jsxs("div",{children:[s.jsxs("h3",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wider flex items-center gap-2",children:[s.jsx(De,{className:"w-4 h-4"})," ",e("datasource.user_views","Views")]}),s.jsx("p",{className:"text-xs text-slate-400 mt-1",children:e("datasource.user_views_hint","SQL views available in the local database.")})]})}),ce.length===0?s.jsx("div",{className:"p-8 text-center border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-xl bg-slate-50 dark:bg-slate-900/40",children:s.jsx("p",{className:"text-slate-400 dark:text-slate-500 text-sm",children:e("datasource.no_user_views","No views available.")})}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:ce.map(o=>s.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-900/40 border border-slate-200 dark:border-slate-700 rounded-xl flex items-center justify-between group",children:[s.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[s.jsx("div",{className:"p-2 bg-white dark:bg-slate-800 rounded-lg shadow-sm text-indigo-600 dark:text-indigo-400",children:s.jsx(De,{className:"w-4 h-4"})}),s.jsxs("div",{className:"min-w-0",children:[s.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-200 block truncate",children:o.name}),we?.[o.name]?.valid===!1?s.jsx("span",{className:"text-[10px] text-rose-500 block",title:we?.[o.name]?.error,children:e("datasource.view_invalid","Defekter View")}):s.jsx("span",{className:"text-[10px] text-slate-400 dark:text-slate-500 block",children:e("datasource.table_meta_rows",{count:we?.[o.name]?.rows??0})})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{N(o.name),u(!0)},disabled:we?.[o.name]?.valid===!1,className:`p-1.5 rounded transition-colors ${we?.[o.name]?.valid===!1?"text-slate-300 dark:text-slate-600 cursor-not-allowed":"text-slate-400 dark:text-slate-500 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20"}`,title:we?.[o.name]?.valid===!1?e("datasource.view_invalid","Defekter View"):e("datasource.show_schema"),children:s.jsx(Je,{className:"w-4 h-4"})}),!c&&s.jsx("button",{onClick:()=>gt(o.name),className:"p-1.5 text-slate-400 dark:text-slate-500 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:e("datasource.drop_view_title","Delete view"),children:s.jsx(Se,{className:"w-4 h-4"})})]})]},o.name))})]}),b&&s.jsxs("div",{className:"bg-slate-100 dark:bg-slate-800/50 rounded-2xl p-6",children:[s.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-4",children:e("datasource.system_tables")}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:er.map(o=>s.jsx("button",{onClick:()=>{N(o),u(!0)},className:"px-3 py-2 bg-white/50 dark:bg-slate-800/60 border border-slate-200/50 dark:border-slate-700 rounded text-xs font-mono text-slate-500 dark:text-slate-400 hover:bg-white dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 text-left transition-colors",children:o},o))})]})]}),g==="system"&&s.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm",children:[s.jsx("h3",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wider mb-4",children:e("datasource.backup_restore")}),fe&&s.jsxs("div",{className:"mb-4 p-3 bg-amber-50 dark:bg-amber-900/20 text-amber-800 dark:text-amber-200 rounded-lg border border-amber-200 dark:border-amber-800/50 text-xs flex items-center gap-2",children:[s.jsx(et,{className:"w-4 h-4"}),s.jsx("span",{children:e("datasource.backup_recommended",{count:Oe})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("button",{onClick:()=>zt(!W),className:`flex-1 p-3 rounded-xl border flex items-center gap-3 transition-all ${W?"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-800 ring-1 ring-emerald-500/70 dark:ring-emerald-700/70":"bg-slate-50 dark:bg-slate-900/40 border-slate-200 dark:border-slate-700"}`,children:[s.jsx("div",{className:`p-2 rounded-lg ${W?"bg-emerald-100 dark:bg-emerald-900/40 text-emerald-600 dark:text-emerald-300":"bg-slate-200 dark:bg-slate-700 text-slate-500 dark:text-slate-300"}`,children:W?s.jsx(Dr,{className:"w-4 h-4"}):s.jsx(Sr,{className:"w-4 h-4"})}),s.jsxs("div",{className:"text-left",children:[s.jsx("div",{className:`text-sm font-bold ${W?"text-emerald-900 dark:text-emerald-200":"text-slate-600 dark:text-slate-200"}`,children:e(W?"datasource.encryption_active":"datasource.encryption_standard")}),s.jsx("div",{className:"text-xs text-slate-400 dark:text-slate-500",children:e(W?"datasource.encryption_active_hint":"datasource.encryption_standard_hint")})]})]})}),W&&s.jsx("div",{className:"animate-in fade-in slide-in-from-top-2",children:s.jsx("input",{type:"password",placeholder:e("datasource.backup_password_placeholder"),value:Ge,onChange:o=>it(o.target.value),className:"w-full p-3 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-emerald-500",autoFocus:!0})}),je&&s.jsx("div",{className:"mb-4",children:s.jsx(qs,{type:je.type,title:je.title,message:je.message,details:je.details,onClose:()=>ee(null)})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-2",children:[s.jsxs("button",{onClick:async()=>{try{if(W){const P=Ge.trim();if(!P){await j.warning(e("datasource.backup_password_required"));return}if(Hs(P)&&!await j.confirm(e("datasource.backup_password_weak_confirm")))return}const o=await hr(),m=new Uint8Array(o).buffer;let p=m;W&&(p=await xr(m,Ge.trim()));const _=Fs(Kt,W);let M=!1;if(mt&&ht)try{M=await br(p,_)}catch{M=!1}if(!M){const P=new Blob([p],{type:"application/x-sqlite3"}),z=URL.createObjectURL(P),le=document.createElement("a");le.href=z,le.download=_,le.click()}Re(),W&&it("");const G=pr(),Ie=M?G?e("datasource.backup_saved_location_named",{folder:G}):e("datasource.backup_saved_location_remembered","Remembered backup folder"):e("datasource.backup_saved_location_downloads","Browser download folder");await j.info(e("datasource.backup_saved_success_details",{fileName:_,location:Ie}))}catch(o){await j.error(`${e("datasource.backup_save_failed","Backup could not be created.")}: ${k(o)}`)}},className:`flex items-center justify-center gap-2 p-3 border rounded-lg text-sm font-bold transition-colors ${W?"bg-emerald-600 border-emerald-700 text-white hover:bg-emerald-700":"bg-slate-50 dark:bg-slate-900/40 border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800"}`,children:[s.jsx(Ae,{className:"w-4 h-4"}),e(W?"datasource.save_backup_secure":"datasource.save_backup_standard")]}),s.jsxs("button",{type:"button",onClick:()=>{Zt()},className:`flex items-center justify-center gap-2 p-3 border rounded-lg text-sm font-bold transition-colors ${W?"bg-emerald-600 border-emerald-700 text-white hover:bg-emerald-700":"bg-slate-50 dark:bg-slate-900/40 border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800"}`,children:[s.jsx(We,{className:"w-4 h-4 text-amber-500"})," ",e("datasource.restore_backup")]}),s.jsx("input",{ref:_e,type:"file",accept:".sqlite3,.sqlite,.db",className:"hidden",onChange:async o=>{const m=o.target.files?.[0];m&&(ee(null),await xt(m),o.currentTarget.value="")}})]})]})]}),s.jsxs("div",{className:"bg-red-50/50 dark:bg-red-900/10 rounded-2xl border border-red-200 dark:border-red-900/50 p-6 shadow-sm",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 rounded-lg",children:s.jsx(et,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("h3",{className:"text-sm font-bold text-red-900 dark:text-red-400 uppercase tracking-wider leading-none",children:e("datasource.danger_zone")}),s.jsx("p",{className:"text-xs text-red-700/70 dark:text-red-300/60 mt-1",children:e("datasource.danger_zone_hint")})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-6",children:[s.jsxs("div",{className:"bg-white dark:bg-slate-900 border border-red-100 dark:border-red-900/20 rounded-xl p-4 shadow-sm",children:[s.jsx("h4",{className:"text-xs font-black text-slate-400 uppercase mb-3",children:e("datasource.clear_reset")}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("select",{id:"clear-table-select",className:"flex-1 p-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs outline-none",defaultValue:"",children:[s.jsx("option",{value:"",disabled:!0,children:e("datasource.select_target_table")}),(b?Ce:ie)?.map(o=>s.jsx("option",{value:o,children:o},o))]}),s.jsx("button",{onClick:()=>{const o=document.getElementById("clear-table-select");o.value&&sr(o.value)},className:"px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded font-bold text-xs transition-colors",children:e("datasource.clear_btn")})]}),s.jsx("p",{className:"text-[10px] text-slate-400 italic",children:e("datasource.clear_reset_hint")})]})]}),s.jsxs("div",{className:"bg-white dark:bg-slate-900 border border-red-100 dark:border-red-900/20 rounded-xl p-4 shadow-sm",children:[s.jsx("h4",{className:"text-xs font-black text-slate-400 uppercase mb-3",children:e("datasource.drop_table_title")}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("select",{id:"drop-table-select",className:"flex-1 p-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-xs outline-none",defaultValue:"",children:[s.jsx("option",{value:"",disabled:!0,children:e("datasource.select_target_table")}),ie.map(o=>s.jsx("option",{value:`table:${o}`,children:o},`tbl-${o}`)),ce.map(o=>s.jsxs("option",{value:`view:${o.name}`,children:[o.name," (view)"]},`view-${o.name}`))]}),s.jsx("button",{onClick:()=>{const o=document.getElementById("drop-table-select");if(!o.value)return;const[m,p]=o.value.split(":");p&&(m==="view"?gt(p):ft(p))},disabled:ie.length===0&&ce.length===0,className:"px-3 py-2 bg-red-900 hover:bg-black text-white rounded font-bold text-xs transition-colors disabled:opacity-30 disabled:cursor-not-allowed",children:e("datasource.drop_btn")})]}),s.jsx("p",{className:"text-[10px] text-slate-400 italic",children:e("datasource.drop_table_hint")})]})]}),s.jsxs("div",{className:"bg-white dark:bg-slate-900 border border-red-100 dark:border-red-900/20 rounded-xl p-4 shadow-sm",children:[s.jsx("h4",{className:"text-xs font-black text-slate-400 uppercase mb-3",children:e("datasource.sql_manager_reset_title","SQL Manager reset")}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("button",{disabled:dt,onClick:()=>{nr()},className:"flex items-center gap-2 px-4 py-2 bg-red-700 hover:bg-red-800 text-white rounded font-bold text-xs transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[dt&&s.jsx(Nt,{className:"w-4 h-4 animate-spin"}),e("datasource.sql_manager_reset_btn","Reset SQL Manager")]})}),s.jsx("p",{className:"text-[10px] text-slate-400 italic",children:e("datasource.sql_manager_reset_hint","Deletes all saved SQL statements in the SQL Manager, including favorites and usage counters.")})]})]}),s.jsxs("div",{className:"bg-white dark:bg-slate-900 border border-red-100 dark:border-red-900/20 rounded-xl p-4 shadow-sm md:col-span-2",children:[s.jsx("h4",{className:"text-xs font-black text-slate-400 uppercase mb-3",children:e("datasource.factory_reset_title","Werkseinstellungen")}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("button",{disabled:lt,onClick:async()=>{const o=e("datasource.factory_reset_confirm","Bist du sicher? Alle Daten (inkl. Tabellen, Views und Indizes), Dashboards, Widgets und lokale Einstellungen werden endgueltig geloescht. Dies kann nicht rueckgaengig gemacht werden!");if(await j.confirm(o)){const m=await j.prompt(e("datasource.factory_reset_prompt",'Bitte tippe "RESET" ein, um fortzufahren:'));if(m==="RESET")try{ct(!0),await fr(),Bs(),await j.info(e("datasource.factory_reset_success","Datenbank wurde auf Werkseinstellungen zurckgesetzt! Lade neu...")),Re(),sessionStorage.removeItem("litebistudio_datasource_tab"),r("/"),window.location.reload()}catch(p){ct(!1),await j.error(k(p))}else m!==null&&await j.warning(e("datasource.factory_reset_aborted","Abgebrochen: Falsche Eingabe."))}},className:"flex items-center gap-2 px-4 py-2 bg-red-900 hover:bg-black text-white rounded font-bold text-xs transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[lt&&s.jsx(Nt,{className:"w-4 h-4 animate-spin"}),e("datasource.factory_reset_btn","Komplett zurcksetzen")]})}),s.jsx("p",{className:"text-[10px] text-slate-400 italic",children:e("datasource.factory_reset_hint","Loescht die gesamte Datenbank inklusive Tabellen, Views und Indizes, setzt lokale Einstellungen zurueck und erstellt ein frisches, leeres Schema der neuesten Version.")})]})]})]})]})]})]}),s.jsx(Ue,{isOpen:S,onClose:()=>B(!1),title:e("datasource.create_table_title"),children:s.jsxs("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex gap-2 mb-4 bg-slate-100 p-1 rounded-lg w-fit",children:[s.jsx("button",{onClick:()=>X(!1),className:`px-3 py-1 text-xs font-bold rounded ${oe?"text-slate-500":"bg-white shadow text-blue-600"}`,children:e("datasource.assistant")}),s.jsx("button",{onClick:()=>X(!0),className:`px-3 py-1 text-xs font-bold rounded ${oe?"bg-white shadow text-blue-600":"text-slate-500"}`,children:"SQL"})]}),oe?s.jsx("textarea",{value:xe,onChange:o=>pe(o.target.value),className:"w-full h-40 font-mono text-sm p-3 bg-slate-900 text-white rounded-lg"}):s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:e("datasource.name_label")}),s.jsx("input",{value:Q,onChange:o=>ae(o.target.value),className:"w-full p-2 border rounded",placeholder:"usr_tabelle"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:e("datasource.columns_label")}),L.map((o,m)=>s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{value:o.name,onChange:p=>{const _=[...L];_[m].name=p.target.value,U(_)},className:"flex-1 p-2 border rounded text-sm",placeholder:e("datasource.name_label")}),s.jsxs("select",{value:o.type,onChange:p=>{const _=[...L];_[m].type=p.target.value,U(_)},className:"w-32 p-2 border rounded text-sm",children:[s.jsx("option",{value:"TEXT",children:"TEXT"}),s.jsx("option",{value:"INTEGER",children:"INTEGER"}),s.jsx("option",{value:"REAL",children:"REAL"}),s.jsx("option",{value:"INTEGER PRIMARY KEY",children:"ID (PK)"})]}),s.jsx("button",{onClick:()=>U(L.filter((p,_)=>_!==m)),className:"text-red-500",children:s.jsx(Se,{className:"w-4 h-4"})})]},m)),s.jsx("button",{onClick:()=>U([...L,{name:"",type:"TEXT"}]),className:"text-xs text-blue-600 font-bold flex items-center gap-1",children:e("datasource.add_column")})]})]}),s.jsx("div",{className:"flex justify-end gap-2 pt-4",children:s.jsx("button",{onClick:ar,className:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-bold",children:e("datasource.create_btn")})})]})}),s.jsx(Ue,{isOpen:x,onClose:()=>u(!1),title:d?.title||h,children:d?s.jsx(Pr,{schema:d}):s.jsx("div",{className:"p-4 text-center",children:e("datasource.schema_not_available")})}),s.jsx(Ue,{isOpen:l,onClose:()=>f(!1),title:e("datasource.create_index_title","Index erstellen"),children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"text-xs text-slate-500",children:[e("datasource.index_create_for_table","Tabelle"),": ",s.jsx("span",{className:"font-mono font-semibold text-slate-700",children:C})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:e("datasource.index_name","Indexname")}),s.jsx("input",{value:H,onChange:o=>$(o.target.value),className:"w-full p-2 border border-slate-200 rounded text-sm",placeholder:`idx_${C}_...`})]}),s.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-600",children:[s.jsx("input",{type:"checkbox",checked:me,onChange:()=>J(!me),className:"h-4 w-4"}),e("datasource.index_unique","Unique Index")]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:e("datasource.index_columns","Spalten")}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 max-h-48 overflow-auto border border-slate-200 rounded p-2 bg-slate-50",children:Ve.map(o=>s.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-700",children:[s.jsx("input",{type:"checkbox",checked:Z.includes(o),onChange:()=>ir(o),className:"h-4 w-4"}),s.jsx("span",{className:"font-mono",children:o})]},o))})]}),Z.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:e("datasource.index_order","Spaltenreihenfolge")}),s.jsx("div",{className:"space-y-1 border border-slate-200 rounded p-2 bg-white",children:Z.map((o,m)=>s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsxs("span",{className:"font-mono text-slate-700",children:[m+1,". ",o]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{type:"button",onClick:()=>wt(o,"up"),disabled:m===0,className:"px-2 py-0.5 text-xs border border-slate-200 rounded disabled:opacity-40",children:""}),s.jsx("button",{type:"button",onClick:()=>wt(o,"down"),disabled:m===Z.length-1,className:"px-2 py-0.5 text-xs border border-slate-200 rounded disabled:opacity-40",children:""})]})]},o))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:e("datasource.index_where_optional","WHERE (optional)")}),s.jsx("input",{value:K,onChange:o=>he(o.target.value),className:"w-full p-2 border border-slate-200 rounded text-sm font-mono",placeholder:"status = 'open'"})]}),s.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[s.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 border border-slate-200 rounded-lg text-sm",children:e("common.cancel")}),s.jsx("button",{onClick:()=>{lr()},className:"px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-bold hover:bg-indigo-700",children:e("datasource.create_index_btn","Index erstellen")})]})]})})]})};export{tn as DatasourceView};
